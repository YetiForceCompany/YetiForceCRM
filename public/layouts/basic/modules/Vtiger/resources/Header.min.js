
if(/MSIE 6.0/.test(navigator.userAgent)||/MSIE 7.0/.test(navigator.userAgent)||/MSIE 8.0/.test(navigator.userAgent)||/MSIE 9.0/.test(navigator.userAgent)){if(app.getCookie("oldbrowser")!="true"){app.setCookie("oldbrowser",true,365);window.location.href="layouts/basic/modules/Vtiger/browsercompatibility/Browser_compatibility.html"}}jQuery.Class("Vtiger_Header_Js",{quickCreateModuleCache:{},self:false,getInstance:function(){if(this.self!=false){return this.self}this.self=new Vtiger_Header_Js();return this.self}},{menuContainer:false,contentContainer:false,quickCreateCallBacks:[],init:function(){this.setContentsContainer(".bodyContent")},setContentsContainer:function(a){if(a instanceof jQuery){this.contentContainer=a}else{this.contentContainer=jQuery(a)}return this},getContentsContainer:function(){return this.contentContainer},getQuickCreateForm:function(c,b,f){var d=this;var a=jQuery.Deferred();var e;if(typeof f=="undefined"){f={}}if((!f.noCache)||(typeof(f.noCache)=="undefined")){if(typeof Vtiger_Header_Js.quickCreateModuleCache[b]!="undefined"){a.resolve(Vtiger_Header_Js.quickCreateModuleCache[b]);return a.promise()}}e=c;if(typeof f.data!="undefined"){var e={};e.data=f.data;e.url=c}AppConnector.request(e).then(function(g){if((!f.noCache)||(typeof(f.noCache)=="undefined")){Vtiger_Header_Js.quickCreateModuleCache[b]=g}a.resolve(g)});return a.promise()},registerQuickCreateCallBack:function(a){if(typeof a!="function"){return false}this.quickCreateCallBacks.push(a);return true},quickCreateSave:function(c){var a=jQuery.Deferred();var b=c.serializeFormData();AppConnector.request(b).then(function(d){a.resolve(d)},function(e,d){a.reject(e,d)});return a.promise()},quickCreateGoToFullForm:function(a,b){a.find('input[name="action"]').remove();a.append('<input type="hidden" name="view" value="Edit" />');$.each(a.find("[data-validation-engine]"),function(c,d){jQuery(d).removeAttr("data-validation-engine")});a.addClass("not_validation");a.submit()},showAnnouncement:function(){var c=this;var a=jQuery("#announcements");var e=a.find(".announcement");if(e.length>0){var b=e.first();var d=b.data("id");app.showModalWindow(b.find(".modal"),function(f){b.remove();f.find("button").click(function(g){AppConnector.request({module:"Announcements",action:"BasicAjax",mode:"mark",record:d,type:$(this).data("type")}).then(function(h){app.hideModalWindow(f);c.showAnnouncement()})})},"",{backdrop:"static"})}},registerAnnouncements:function(){var b=this;var a=jQuery("#announcements");if(a.length==0){return false}b.showAnnouncement()},registerCalendarButtonClickEvent:function(){var c=jQuery("#calendarBtn");var a=c.data("dateFormat");var b=c.data("date");var d=app.convertToDatePickerFormat(a);c.on("click",function(g){g.stopImmediatePropagation();c.closest("div.nav").find("div.open").removeClass("open");var f=jQuery("#"+c.data("datepickerId"));if(jQuery(f).is(":visible")){c.DatePickerHide()}else{c.DatePickerShow()}});c.DatePicker({format:d,date:b,calendars:1,starts:1,className:"globalCalendar"})},registerHelpInfo:function(a){if(typeof a=="undefined"){a=jQuery('form[name="QuickCreate"]')}app.showPopoverElementView(a.find(".HelpInfoPopover"))},handleQuickCreateData:function(b,c){if(typeof c=="undefined"){c={}}var a=this;app.showModalWindow(b,function(h){var e=h.find('form[name="QuickCreate"]');var g=e.find('[name="module"]').val();var f=Vtiger_Edit_Js.getInstanceByModuleName(g);f.registerBasicEvents(e);a.registerChangeNearCalendarEvent(e,g);e.validationEngine(app.validationEngineOptions);if(typeof c.callbackPostShown!="undefined"){c.callbackPostShown(e)}a.registerQuickCreatePostLoadEvents(e,c);a.registerHelpInfo(e);var d={height:"5em",toolbar:"Min"};jQuery.each(h.find(".ckEditorSource"),function(j,i){var k=new Vtiger_CkEditor_Js();k.loadCkEditor(jQuery(i),d)})})},isFreeDay:function(a){if(a==0||a==6){return true}return false},getNearCalendarEvent:function(K,g){var q=$('[name="showCompanies"]').val();var u=app.getMainParams("hiddenDays",true);var b=this;var a=K.find("ul li.active a").data("tab-name");var t=K.find('[name="assigned_user_id"]');var n=K.find('[name="date_start"]');var J=n.val();var v=n.data("date-format");if(typeof J=="undefined"||!K.find(".eventsTable").length){return}var i=[];var c=7+2*u.length;var B=-1;while(i.length<3){var s=Vtiger_Helper_Js.convertToDateString(J,v,B," ");if(jQuery.inArray(Vtiger_Helper_Js.getDay(s),u)==-1){i.push(s)}B--}i.reverse();B=1;i.push(Vtiger_Helper_Js.convertToDateString(J,v,0," "));while(i.length<7){var s=Vtiger_Helper_Js.convertToDateString(J,v,B," ");if(jQuery.inArray(Vtiger_Helper_Js.getDay(s),u)==-1){i.push(s)}B++}var p=i[0];var x=i[1];var w=i[2];var r=i[3];var d=i[4];var l=i[5];var k=i[6];var h=Vtiger_Helper_Js.convertToDateString(J,v,B," ");var y=Vtiger_Helper_Js.getDay(p);var f=Vtiger_Helper_Js.getDay(x);var j=Vtiger_Helper_Js.getDay(w);var o=Vtiger_Helper_Js.getDay(r);var z=Vtiger_Helper_Js.getDay(d);var m=Vtiger_Helper_Js.getDay(l);var G=Vtiger_Helper_Js.getDay(k);var e={module:"Calendar",action:"Calendar",mode:"getEvents",start:app.getDateInVtigerFormat(v,Date.parse(p)),end:app.getDateInVtigerFormat(v,Date.parse(h)),user:t.val(),time:"current"};AppConnector.request(e).then(function(N){if(typeof N.result!="undefined"&&N.result.length>0){N=N.result;K.find(".modal-body").css({"max-height":"500px","overflow-y":"auto"});for(var P in N){var O="glyphicon glyphicon-calendar";var R="";var Q="";var L="";if(N[P]["set"]=="Task"){O="glyphicon glyphicon-tasks"}if(q){if(N[P]["linkl"]){R='<div class="cut-string"><i class="calIcon modIcon_'+N[P]["linkm"]+'"></i> '+N[P]["linkl"]+"</div>"}}L="<div><label> "+app.vtranslate("JS_START_DATE")+": &nbsp</label>"+N[P]["start_display"]+" </div>\n								<div><label> "+app.vtranslate("JS_END_DATE")+": &nbsp</label>"+N[P]["end_display"]+" </div>\n								<div class=textOverflowEllipsis><label> "+app.vtranslate("JS_SUBJECT")+": &nbsp</label>"+N[P]["title"]+"</div>\n								<div><label> "+app.vtranslate("JS_STATE")+": &nbsp</label>"+N[P]["labels"]["state"]+" </div>\n								<div><label> "+app.vtranslate("JS_STATUS")+": &nbsp</label>"+N[P]["labels"]["sta"]+" </div>\n								<div><label> "+app.vtranslate("JS_PRIORITY")+": &nbsp</label>"+N[P]["labels"]["pri"]+" </div>\n";L+=N[P]["link"]!=0&&N[P]["link"]!=null?"<div><label>"+app.vtranslate("JS_RELATION")+"</label>:"+N[P]["linkl"]:"";L+=N[P]["process"]!=0&&N[P]["process"]!=null?"<div><label>"+app.vtranslate("JS_PROCESS")+"</label>:"+N[P]["procl"]:"";L+=N[P]["subprocess"]!=0&&N[P]["subprocess"]!=null?"<div><label>"+app.vtranslate("JS_SUB_PROCESS")+"</label>:"+N[P]["subprocl"]:"";if(N[P]["start"].indexOf(p)>-1){K.find("#threeDaysAgo .table").append('<tr class="mode_'+N[P]["set"]+" "+Q+' addedNearCalendarEvent" ><td colspan="2"><a target="_blank" href="'+N[P]["url"]+'"><div class="cut-string"><i class="'+O+'" style="vertical-align:middle; margin-bottom:4px;"></i><span><strong> '+N[P]["hour_start"]+"</strong></span><span> "+N[P]["title"].substring(0,16)+' </span><span style="margin-left: 5px;margin-top: 2px;"  class="HelpInfoPopover " title="" data-placement="top" data-content="'+L+'"><i class="pull-right glyphicon glyphicon-info-sign"></i></span</div></a>'+R+"</td></tr>")}else{if(N[P]["start"].indexOf(x)>-1){K.find("#twoDaysAgo .table").append('<tr class="mode_'+N[P]["set"]+" "+Q+' addedNearCalendarEvent" ><td><a target="_blank" href="'+N[P]["url"]+'"><div class="cut-string"><i class="'+O+'" style="vertical-align:middle; margin-bottom:4px;"></i><span><strong> '+N[P]["hour_start"]+"</strong></span><span> "+N[P]["title"].substring(0,16)+' </span><span style="margin-left: 5px;margin-top: 2px;"  class="HelpInfoPopover " title="" data-placement="top" data-content="'+L+'"><i class="pull-right glyphicon glyphicon-info-sign"></i></span></div></a>'+R+"</td></tr>")}else{if(N[P]["start"].indexOf(w)>-1){K.find("#oneDaysAgo .table").append('<tr class="mode_'+N[P]["set"]+" "+Q+' addedNearCalendarEvent" ><td><a target="_blank" href="'+N[P]["url"]+'"><div class="cut-string"><i class="'+O+'" style="vertical-align:middle; margin-bottom:4px;"></i><span><strong> '+N[P]["hour_start"]+"</strong></span><span> "+N[P]["title"].substring(0,16)+' </span><span style="margin-left: 5px;margin-top: 2px;"  class="HelpInfoPopover " title="" data-placement="top" data-content="'+L+'"><i class="pull-right glyphicon glyphicon-info-sign"></i></span></div></a>'+R+"</td></tr>")}else{if(N[P]["start"].indexOf(r)>-1){K.find("#cur_events .table").append('<tr class="mode_'+N[P]["set"]+" "+Q+' addedNearCalendarEvent"><td><a target="_blank" href="'+N[P]["url"]+'"><div class="cut-string"><i class="'+O+'" style="vertical-align:middle; margin-bottom:4px;"></i><span><strong> '+N[P]["hour_start"]+"</strong></span><span> "+N[P]["title"].substring(0,16)+' </span><span style="margin-left: 5px;margin-top: 2px;"  class="HelpInfoPopover " title="" data-placement="top" data-content="'+L+'"><i class="pull-right glyphicon glyphicon-info-sign"></i></span</div></a>'+R+"</td></tr>")}else{if(N[P]["start"].indexOf(d)>-1){K.find("#oneDaysLater .table").append('<tr class="mode_'+N[P]["set"]+" "+Q+' addedNearCalendarEvent"><td><a target="_blank" href="'+N[P]["url"]+'"><div class="cut-string"><i class="'+O+'" style="vertical-align:middle; margin-bottom:4px;"></i><span><strong> '+N[P]["hour_start"]+"</strong></span><span> "+N[P]["title"].substring(0,16)+' </span><span style="margin-left: 5px;margin-top: 2px;"  class="HelpInfoPopover " title="" data-placement="top" data-content="'+L+'"><i class="pull-right glyphicon glyphicon-info-sign"></i></span</div></a>'+R+"</td></tr>")}else{if(N[P]["start"].indexOf(l)>-1){K.find("#twoDaysLater .table").append('<tr class="mode_'+N[P]["set"]+" "+Q+' addedNearCalendarEvent"><td><a target="_blank" href="'+N[P]["url"]+'"><div class="cut-string"><i class="'+O+'" style="vertical-align:middle; margin-bottom:4px;"></i><span><strong> '+N[P]["hour_start"]+"</strong></span><span> "+N[P]["title"].substring(0,16)+' </span><span style="margin-left: 5px;margin-top: 2px;"  class="HelpInfoPopover " title="" data-placement="top" data-content="'+L+'"><i class="pull-right glyphicon glyphicon-info-sign"></i></span</div></a>'+R+"</td></tr>")}else{if(N[P]["start"].indexOf(k)>-1){K.find("#threeDaysLater .table").append('<tr class="mode_'+N[P]["set"]+" "+Q+' addedNearCalendarEvent"><td colspan="2"><a target="_blank" href="'+N[P]["url"]+'"><div class="cut-string"><i class="'+O+'" style="vertical-align:middle; margin-bottom:4px;"></i><span><strong> '+N[P]["hour_start"]+"</strong></span><span> "+N[P]["title"].substring(0,16)+' </span><span style="margin-left: 5px;margin-top: 2px;"  class="HelpInfoPopover " title="" data-placement="top" data-content="'+L+'"><i class="pull-right glyphicon glyphicon-info-sign"></i></span</div></a>'+R+"</td></tr>")}}}}}}}}var M;b.registerHelpInfo(M)}else{K.find(".modal-body").css({"max-height":"","overflow-y":""})}});var I=app.getDateInVtigerFormat(v,Date.parse(p));var H=app.getDateInVtigerFormat(v,Date.parse(x));var F=app.getDateInVtigerFormat(v,Date.parse(w));var E=app.getDateInVtigerFormat(v,Date.parse(r));var D=app.getDateInVtigerFormat(v,Date.parse(d));var C=app.getDateInVtigerFormat(v,Date.parse(l));var A=app.getDateInVtigerFormat(v,Date.parse(k));K.find(".taskPrevThreeDaysAgo").html('<span class="cursorPointer dateBtn">'+I+"</span> ("+Vtiger_Helper_Js.getLabelDayFromDate(y)+")");K.find(".taskPrevTwoDaysAgo").html('<span class="cursorPointer dateBtn">'+H+"</span> ("+Vtiger_Helper_Js.getLabelDayFromDate(f)+")");K.find(".taskPrevOneDayAgo").html('<span class="cursorPointer dateBtn">'+F+"</span> ("+Vtiger_Helper_Js.getLabelDayFromDate(j)+")");K.find(".taskCur").html('<span class="cursorPointer dateBtn">'+E+"</span> ("+Vtiger_Helper_Js.getLabelDayFromDate(o)+")");K.find(".taskNextOneDayLater").html('<span class="cursorPointer dateBtn">'+D+"</span> ("+Vtiger_Helper_Js.getLabelDayFromDate(z)+")");K.find(".taskNextTwoDaysLater").html('<span class="cursorPointer dateBtn">'+C+"</span> ("+Vtiger_Helper_Js.getLabelDayFromDate(m)+")");K.find(".taskNextThreeDaysLater").html('<span class="cursorPointer dateBtn">'+A+"</span> ("+Vtiger_Helper_Js.getLabelDayFromDate(G)+")");K.find(".dateBtn").on("click",function(M){var L=jQuery(M.currentTarget);n.val(L.html());K.find('[name="due_date"]').val(L.html());K.find('[name="date_start"]').trigger("change")})},registerChangeNearCalendarEvent:function(f,c){var e=this;if(!f||c!="Calendar"||typeof c=="undefined"){return}var b=f.find('[name="assigned_user_id"]');var a=f.find('[name="date_start"]');var d=f.find('[name="due_date"]');b.on("change",function(i){var g=jQuery(i.currentTarget);var h=g.closest("form");h.find(".addedNearCalendarEvent").remove();e.getNearCalendarEvent(h,c)});a.on("change",function(i){var g=jQuery(i.currentTarget);var h=g.closest("form");h.find(".addedNearCalendarEvent").remove();e.getNearCalendarEvent(h,c)});f.find("ul li a").on("click",function(i){var g=jQuery(i.currentTarget);var h=g.closest("form");h.find(".addedNearCalendarEvent").remove();e.getNearCalendarEvent(h,c)});f.find(".nextDayBtn").on("click",function(){var g=f.find('[name="date_start"]');var i=g.val();var h=g.data("date-format");i=app.getDateInVtigerFormat(h,Date.parse(Vtiger_Helper_Js.convertToDateString(i,h,"+7"," ")));g.val(i);d.val(i);f.find(".addedNearCalendarEvent").remove();e.getNearCalendarEvent(f,c)});f.find(".previousDayBtn").on("click",function(){var g=f.find('[name="date_start"]');var i=g.val();var h=g.data("date-format");i=app.getDateInVtigerFormat(h,Date.parse(Vtiger_Helper_Js.convertToDateString(i,h,"-7"," ")));g.val(i);d.val(i);f.find(".addedNearCalendarEvent").remove();e.getNearCalendarEvent(f,c)});e.getNearCalendarEvent(f,c);e.registerHelpInfo()},registerQuickCreatePostLoadEvents:function(b,d){var a=this;var c=d.callbackFunction;var e=d.goToFullFormcallback;if(typeof c=="undefined"){c=function(){}}b.on("submit",function(k){var i=jQuery(k.currentTarget);if(i.hasClass("not_validation")){return true}var f=i.find('[name="module"]').val();if(typeof i.data("submit")!="undefined"){return false}else{var h=i.data("jqv").InvalidFields;if(h.length>0){i.removeData("submit");i.closest("#globalmodal").find(".modal-header h3").progressIndicator({mode:"hide"});k.preventDefault();return}else{i.data("submit","true");i.closest("#globalmodal").find(".modal-header h3").progressIndicator({smallLoadingImage:true,imageContainerCss:{display:"inline","margin-left":"18%",position:"absolute"}})}var j=jQuery.Event(Vtiger_Edit_Js.recordPreSave);i.trigger(j,{value:"edit",module:f});if(!(j.isDefaultPrevented())){var g=a;var l=Vtiger_Edit_Js.getInstanceByModuleName(f);if(typeof(l.quickCreateSave)==="function"){g=l}g.quickCreateSave(i).then(function(r){app.hideModalWindow();var s=app.getModuleName();var m=app.getViewName();if((f==s)&&(m=="List")){var p=new Vtiger_List_Js();p.getListViewRecords()}c(r);var o=a.quickCreateCallBacks;for(var n=0;n<o.length;n++){var q=o[n];q({data:r,name:i.find('[name="module"]').val()})}jQuery("body").trigger(jQuery.Event("QuickCreateSave.PostLoad"),r)},function(m,n){})}else{i.removeData("submit");i.closest("#globalmodal").find(".modal-header h3").progressIndicator({mode:"hide"})}k.preventDefault()}});b.find("#goToFullForm").on("click",function(g){var f=jQuery(g.currentTarget).closest("form");var h=jQuery(g.currentTarget).data("editViewUrl");if(typeof e!="undefined"){e(f)}a.quickCreateGoToFullForm(f,h)});this.registerTabEventsInQuickCreate(b)},registerTabEventsInQuickCreate:function(d){var a=d.find(".nav.nav-pills , .nav.nav-tabs").find("a");var b=function(g){var f=jQuery(g);f.find("[name]").each(function(h,i){i=jQuery(i);i.attr("data-element-name",i.attr("name")).removeAttr("name")})};var e=function(g){var f=jQuery(g);f.find("[data-element-name]").each(function(h,i){i=jQuery(i);i.attr("name",i.attr("data-element-name")).removeAttr("data-element-name")})};a.on("click",function(f){b(a.not('[aria-expanded="false"]').attr("data-target"));e($(this).attr("data-target"));d.data("jqv").InvalidFields=[]});var c=a.closest("li");c.filter(":not(.active)").find("a").each(function(f){b(jQuery(this).attr("data-target"))})},basicSearch:function(){var a=this;jQuery(".globalSearchValue").keypress(function(c){var b=jQuery(c.currentTarget);if(c.which==13){a.hideSearchMenu();a.labelSearch(b)}});jQuery(".globalSearchOperator").on("click",function(c){var b=jQuery(c.target);var d=b.closest(".globalSearchInput");d.find(".globalSearchValue").data("operator",b.data("operator"));d.find(".globalSearchOperator li").removeClass("active");b.closest("li").addClass("active")});if(jQuery("#gsAutocomplete").val()==1){$.widget("custom.gsAutocomplete",$.ui.autocomplete,{_create:function(){this._super();this.widget().menu("option","items","> :not(.ui-autocomplete-category)")},_renderMenu:function(d,c){var e=this,b="";$.each(c,function(g,h){var f;if(h.category!=b){d.append("<li class='ui-autocomplete-category'>"+h.category+"</li>");b=h.category}e._renderItemData(d,h)})},_renderItemData:function(b,c){return this._renderItem(b,c).data("ui-autocomplete-item",c)},_renderItem:function(b,c){return $("<li>").data("item.autocomplete",c).append($("<a></a>").html(c.label)).appendTo(b)},});jQuery(".globalSearchValue").gsAutocomplete({minLength:app.getMainParams("gsMinLength"),source:function(c,b){var d=new Vtiger_BasicSearch_Js();d.reduceNumberResults=app.getMainParams("gsAmountResponse");d.returnHtml=false;d.setMainContainer(this.element.closest(".globalSearchInput"));d.search(c.term).then(function(h){var h=jQuery.parseJSON(h);var g=h.result;var f=new Array();for(var i in g){var e=g[i];f.push(e)}b(f)})},select:function(d,e){var c=e.item;if(c.permitted){var b="index.php?module="+c.module+"&view=Detail&record="+c.id;window.location.href=b}return false},close:function(b,c){}})}},labelSearch:function(c){var d=c.val();if(d==""){alert(app.vtranslate("JS_PLEASE_ENTER_SOME_VALUE"));c.focus();return false}var a=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});var b=new Vtiger_BasicSearch_Js();b.setMainContainer(c.closest(".globalSearchInput"));b.search(d).then(function(e){b.showSearchResults(e);a.progressIndicator({mode:"hide"})})},recentPageViews:function(){var j=this;var c=20;var b="";var w="javascript:void();";var e=app.getMainParams("current_user_id");if(e==undefined){return false}var x="yf_history_"+e;var g=localStorage.getItem(x);if(g!=""&&g!=null){var p=g.toString().split("_|_");var s=p[p.length-1].toString().split("|");b=s[0];w=s[1]}var k='<ul class="dropdown-menu pull-right historyList" role="menu">';var v=new Date().getTime();var a=-1;var m=true;if(p!=null){for(var o=p.length-1;o>=0;o--){s=p[o].toString().split("|");var u=new Date();var h="";if(s[2]!=undefined){u.setTime(s[2]);var r=app.formatDateZ(u.getHours());var n=app.formatDateZ(u.getMinutes());if(m&&(a!=app.howManyDaysFromDate(u))){a=app.howManyDaysFromDate(u);if(a==0){k+='<li class="selectorHistory">'+app.vtranslate("JS_TODAY")+"</li>"}else{if(a==1){k+='<li class="selectorHistory">'+app.vtranslate("JS_YESTERDAY")+"</li>"}else{k+='<li class="selectorHistory">'+app.vtranslate("JS_OLDER")+"</li>";m=false}}}if(m){h='<span class="historyHour">'+r+":"+n+"</span> | "}else{h=app.formatDate(u)+" | "}}var q=$("#userDateFormat").val()+""+$("#userDateFormat").val();k+='<li><a href="'+s[1]+'">'+h+s[0]+"</a></li>"}var l=this.getHistoryLabel();if(l.length>1&&document.URL!=w){p.push(this.getHistoryLabel()+"|"+document.URL+"|"+v)}if(p.length>=c){p.splice(0,1)}localStorage.setItem(x,p.join("_|_"))}else{var f=new Array();var l=this.getHistoryLabel();if(l.length>1){f.push(this.getHistoryLabel()+"|"+document.URL+"|"+v);localStorage.setItem(x,f.join("_|_"))}}k+='<li class="divider"></li><li><a class="clearHistory" href="#">'+app.vtranslate("JS_CLEAR_HISTORY")+"</a></li>";k+="</ul>";$(".showHistoryBtn").after(k);this.registerClearHistory()},getHistoryLabel:function(){var a="";$(".breadcrumbsLinks span:not(.hideToHistory)").each(function(b){a+=$(this).text()});return a},registerClearHistory:function(){$(".historyList .clearHistory").click(function(){var a="yf_history_"+app.getMainParams("current_user_id");localStorage.removeItem(a);var b='<li class="divider"></li><li><a class="clearHistory" href="#">'+app.vtranslate("JS_CLEAR_HISTORY")+"</a></li>";$(".historyList.dropdown-menu").html(b)})},registerHotKeys:function(){$(".hotKey").each(function(b){var a=this;var c=$(a).data("hotkeys");if(c!=""){Mousetrap.bind(c,function(){a.click()})}})},quickCreateModule:function(c,e){var d=this;if(typeof e=="undefined"){e={}}if(typeof e.callbackFunction=="undefined"){e.callbackFunction=function(){}}var b="index.php?module="+c+"&view=QuickCreateAjax";if((app.getViewName()==="Detail"||app.getViewName()==="Edit")&&app.getParentModuleName()!="Settings"){b+="&sourceModule="+app.getModuleName();b+="&sourceRecord="+app.getRecordId()}var a=jQuery.progressIndicator();d.getQuickCreateForm(b,c,e).then(function(f){d.handleQuickCreateData(f,e);app.registerEventForClockPicker();a.progressIndicator({mode:"hide"})})},registerReminderNotice:function(){var a=this;$("#page").before('<div class="remindersNoticeContainer"></div>');var b=$(".remindersNoticeContainer");var c=$(".remindersNotice");c.click(function(){if(!c.hasClass("autoRefreshing")){Vtiger_Index_Js.requestReminder()}a.hideActionMenu();b.toggleClass("toggled");a.hideReminderNotification();a.hideMobileMenu();a.hideSearchMenu()});b.css("top",$(".commonActionsContainer").height());b.height($(window).height()-$("footer.navbar-default").height()-$(".commonActionsContainer").height()+2)},registerReminderNotification:function(){var a=this;$("#page").before('<div class="remindersNotificationContainer"></div>');var b=$(".remindersNotificationContainer");var c=$(".notificationsNotice");c.on("click",function(){if(!c.hasClass("autoRefreshing")){Vtiger_Index_Js.getNotificationsForReminder()}a.hideActionMenu();b.toggleClass("toggled");a.hideReminderNotice();a.hideMobileMenu();a.hideSearchMenu()});b.css("top",$(".commonActionsContainer").height());b.height($(window).height()-$("footer.navbar-default").height()-$(".commonActionsContainer").height()+2)},registerMobileEvents:function(){var a=this;$(".rightHeaderBtnMenu").click(function(){a.hideActionMenu();a.hideSearchMenu();a.hideReminderNotice();a.hideReminderNotification();$(".mobileLeftPanel ").toggleClass("mobileMenuOn")});$(".actionMenuBtn").click(function(){a.hideSearchMenu();a.hideMobileMenu();a.hideReminderNotice();a.hideReminderNotification();$(".actionMenu").toggleClass("actionMenuOn");$(".quickCreateModules").click(function(){a.hideActionMenu()})});$(".searchMenuBtn").click(function(){a.hideActionMenu();a.hideMobileMenu();a.hideReminderNotice();a.hideReminderNotification();$(".searchMenu").toggleClass("toogleSearchMenu")})},hideMobileMenu:function(){$(".mobileLeftPanel ").removeClass("mobileMenuOn")},hideSearchMenu:function(){$(".searchMenu").removeClass("toogleSearchMenu")},hideActionMenu:function(){$(".actionMenu").removeClass("actionMenuOn")},hideReminderNotice:function(){$(".remindersNoticeContainer").removeClass("toggled")},hideReminderNotification:function(){$(".remindersNotificationContainer").removeClass("toggled")},showPdfModal:function(a){var c={};if(app.getViewName()=="List"){var b=Vtiger_List_Js.getSelectedRecordsParams(false,true);jQuery.extend(c,b)}a+="&"+jQuery.param(c);app.showModalWindow(null,a)},registerFooTable:function(){var a=$(".tableRWD");a.find("thead tr th:gt(1)").attr("data-hide","phone");a.find("thead tr th:gt(3)").attr("data-hide","tablet,phone");a.find("thead tr th:last").attr("data-hide","");var c=a.find("thead").attr("col-visible-alltime");a.find("thead tr th:eq("+c+")").attr("data-hide","");$(".tableRWD, .customTableRWD").footable({breakpoints:{phone:768,tablet:1024},addRowToggle:true,toggleSelector:" > tbody > tr:not(.footable-row-detail)"});$(".footable-toggle").click(function(d){d.stopPropagation();$(this).trigger("footable_toggle_row")});var b=$(".customTableRWD").find("[data-toggle-visible=false]");b.find(".footable-toggle").css("display","none")},registerShowHideRightPanelEvent:function(a){var c=this;var b="ShowHideRightPanel"+app.getModuleName();if(app.cacheGet(b)=="show"){c.showSiteBar(a,a.find(".toggleSiteBarRightButton"))}if(app.cacheGet(b)==null){if(a.find(".siteBarRight").data("showpanel")==1){c.showSiteBar(a,a.find(".toggleSiteBarRightButton"))}}a.find(".toggleSiteBarRightButton").click(function(f){var d=$(this);if(d.closest(".siteBarRight").hasClass("hideSiteBar")){app.cacheSet(b,"show");c.showSiteBar(a,d)}else{app.cacheSet(b,"hide");c.hideSiteBar(a,d)}})},hideSiteBar:function(a,c){var d,c,f,e,b;f=c.closest(".siteBarRight");e=a.find(".rowContent");b=c.find(".glyphicon");f.addClass("hideSiteBar");e.removeClass("col-md-9").addClass("col-md-12");b.removeClass("glyphicon-chevron-right").addClass("glyphicon-chevron-left");c.addClass("hideToggleSiteBarRightButton")},showSiteBar:function(a,c){var d,c,f,e,b;f=c.closest(".siteBarRight");e=a.find(".rowContent");b=c.find(".glyphicon");f.removeClass("hideSiteBar");e.removeClass("col-md-12").addClass("col-md-9");b.removeClass("glyphicon-chevron-left").addClass("glyphicon-chevron-right");c.removeClass("hideToggleSiteBarRightButton")},registerScrollForMenu:function(){$(".slimScrollMenu").perfectScrollbar({useBothWheelAxes:true,});app.showScrollBar($(".slimScrollMenu"),{height:"100%",width:"100%",position:"left",railVisible:true,railOpacity:0.5,});app.showScrollBar($(".slimScrollSubMenu"),{height:"100%",});$(".slimScrollSubMenu .slimScrollDiv").each(function(){$(this).closest(" .slimScrollSubMenu").css("overflow","initial")})},registerToggleButton:function(){$(".buttonTextHolder .dropdown-menu li a").click(function(){$(this).parents(".btn-group").find(".dropdown-toggle .textHolder").html($(this).text())})},listenTextAreaChange:function(){var a=this;$("textarea").live("keyup",function(){var b=$(this);if(!b.data("has-scroll")){b.data("has-scroll",true);b.bind("scroll keyup",function(){a.resizeTextArea($(this))})}a.resizeTextArea($(this))})},resizeTextArea:function(a){a.height(1);a.scrollTop(0);a.height(a[0].scrollHeight-a[0].clientHeight+a.height())},registerEvents:function(){var a=this;a.listenTextAreaChange();a.recentPageViews();a.registerFooTable();a.registerScrollForMenu();a.registerShowHideRightPanelEvent($("#centerPanel"));jQuery(".globalSearch").click(function(){var c=$(this);a.hideSearchMenu();var b=new Vtiger_AdvanceSearch_Js();b.setParentContainer(c.closest(".globalSearchInput"));b.initiateSearch().then(function(){b.selectBasicSearchValue()})});jQuery(".searchIcon").on("click",function(d){var c=$(this).closest(".globalSearchInput").find(".globalSearchValue");var b=jQuery.Event("keypress");b.which=13;c.trigger(b)});a.registerAnnouncements();a.registerHotKeys();a.registerToggleButton();jQuery(".basicSearchModulesList").change(function(){var b=$(this).closest(".globalSearchInput").find(".globalSearchValue");setTimeout(function(){b.focus()},100)});a.basicSearch();$(".bodyHeader .dropdownMenu").on("click",function(b){$(this).next("ul").toggle()});jQuery(".quickCreateModules").on("click",".quickCreateModule",function(c,d){var b=jQuery(c.currentTarget).data("name");a.quickCreateModule(b)});a.registerMobileEvents();if(/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){jQuery("#basicSearchModulesList_chosen").find(".chzn-results").css({"max-height":"350px","overflow-y":"scroll"})}else{app.showScrollBar(jQuery("#basicSearchModulesList_chosen").find(".chzn-results"),{height:"450px",railVisible:true,alwaysVisible:true,size:"6px"});if(window.outerWidth<=1024){}a.registerReminderNotice();a.registerReminderNotification()}},});jQuery(document).ready(function(){$(window).on("popstate",function(a){if(a.state){window.location.href=a.state.url}});Vtiger_Header_Js.getInstance().registerEvents()});