{"version":3,"file":"Connector.min.js","sources":["Connector.js"],"sourcesContent":["/*+***********************************************************************************\n * The contents of this file are subject to the vtiger CRM Public License Version 1.0\n * (\"License\"); You may not use this file except in compliance with the License\n * The Original Code is:  vtiger CRM Open Source\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n *************************************************************************************/\n'use strict';\n\nwindow.AppConnector = {\n\t/**\n\t * Sends a pjax request (push state +ajax)\n\t * The function is deferred. it will be resolved on success and error on failure\n\t *  Success - if request is success it will send you data that it recieved\n\t *  error - it will send two parameters first gives string regarding error\n\t *                   Second gives you error object if exists\n\t *\n\t *  @return - deferred promise\n\t */\n\trequestPjax: function (params) {\n\t\treturn AppConnector._request(params, true);\n\t},\n\n\t/**\n\t *  Sends ajax request to the specified url.\n\t *  The function is deferred. it will be resolved on success and error on failure\n\t *  Success - if request is success it will send you data that it recieved\n\t *  error - it will send two parameters first gives string regarding error\n\t *                   Second gives you error object if exists\n\t *\n\t *  @return - deferred promise\n\t */\n\trequest: function (params, rawData) {\n\t\treturn AppConnector._request(params, false, rawData);\n\t},\n\n\t_request: function (params, pjaxMode, rawData) {\n\t\tconst aDeferred = jQuery.Deferred();\n\t\tif (typeof rawData === 'undefined') {\n\t\t\trawData = false;\n\t\t}\n\t\tif (typeof pjaxMode === 'undefined') {\n\t\t\tpjaxMode = false;\n\t\t}\n\t\tif (typeof params === 'undefined') {\n\t\t\tparams = {};\n\t\t}\n\t\tlet fullUrl = '',\n\t\t\tindex,\n\t\t\tcallerParams;\n\t\t//caller has send only data\n\t\tif (typeof params.data === 'undefined' || rawData) {\n\t\t\tif (typeof params === 'string') {\n\t\t\t\tcallerParams = fullUrl = params;\n\t\t\t\tindex = callerParams.indexOf('?');\n\t\t\t\tif (index !== -1) {\n\t\t\t\t\tlet subStr = callerParams.substr(0, index + 1); //need to replace only \"index.php?\" or \"?\"\n\t\t\t\t\tcallerParams = callerParams.replace(subStr, '');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tcallerParams = $.extend({}, params);\n\t\t\t}\n\t\t\tparams = {};\n\t\t\tparams.data = callerParams;\n\t\t}\n\t\t//Make the request as post by default\n\t\tif (typeof params.type === 'undefined' || rawData) params.type = 'POST';\n\t\tif (typeof params.jsonp === 'undefined' || rawData) params.jsonp = false;\n\n\t\t//By default we expect json from the server\n\t\tif (typeof params.dataType === 'undefined' || rawData) {\n\t\t\tlet data = params.data;\n\t\t\t//view will return html\n\t\t\tparams.dataType = 'json';\n\t\t\tif (data.hasOwnProperty('view')) {\n\t\t\t\tparams.dataType = 'html';\n\t\t\t} else if (typeof data === 'string' && data.indexOf('&view=') !== -1) {\n\t\t\t\tparams.dataType = 'html';\n\t\t\t}\n\t\t\tif (typeof params.url !== 'undefined' && params.url.indexOf('&view=') !== -1) {\n\t\t\t\tparams.dataType = 'html';\n\t\t\t}\n\t\t}\n\t\t//If url contains params then seperate them and make them as data\n\t\tif (typeof params.url !== 'undefined' && params.url.indexOf('?') !== -1) {\n\t\t\tfullUrl = params.url;\n\t\t\tlet urlSplit = params.url.split('?'),\n\t\t\t\tqueryString = urlSplit[1];\n\t\t\tparams.url = urlSplit[0];\n\t\t\tlet queryParameters = queryString.split('&');\n\t\t\tfor (index = 0; index < queryParameters.length; index++) {\n\t\t\t\tlet queryParam = queryParameters[index],\n\t\t\t\t\tqueryParamComponents = queryParam.split('=');\n\t\t\t\tparams.data[queryParamComponents[0]] = queryParamComponents[1];\n\t\t\t}\n\t\t}\n\t\tif (typeof params.url === 'undefined' || params.url.length <= 0) {\n\t\t\tparams.url = 'index.php';\n\t\t}\n\t\tparams.success = function (data, status, jqXHR) {\n\t\t\tif (data !== null && typeof data === 'object' && data.error) {\n\t\t\t\tapp.errorLog(data.error);\n\t\t\t\tif (data.error.message) {\n\t\t\t\t\tVtiger_Helper_Js.showMessage({\n\t\t\t\t\t\ttext: data.error.message,\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\taDeferred.resolve(data);\n\t\t};\n\t\tparams.error = function (jqXHR, textStatus, errorThrown) {\n\t\t\tlet action = jqXHR.getResponseHeader('yf-action');\n\t\t\tif (action === 'logout') {\n\t\t\t\twindow.location.href = 'index.php';\n\t\t\t}\n\t\t\tif (CONFIG.debug) {\n\t\t\t\tif (jqXHR.status === 406) {\n\t\t\t\t\tlet sep = '-'.repeat(150);\n\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t'%cYetiForce debug mode!!!',\n\t\t\t\t\t\t'color: red; font-family: sans-serif; font-size: 1.5em; font-weight: bolder; text-shadow: #000 1px 1px;'\n\t\t\t\t\t);\n\t\t\t\t\tconsole.error(\n\t\t\t\t\t\t'Error: ' + errorThrown,\n\t\t\t\t\t\t'\\n' + sep + '\\nTrace:\\n' + sep + '\\n' + (jqXHR.responseJSON ? jqXHR.responseJSON.error.trace : ''),\n\t\t\t\t\t\t'\\n' + sep + '\\nParams:\\n' + sep + '\\n' + JSON.stringify(params, null, '\\t')\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tapp.errorLog(jqXHR, textStatus, errorThrown);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (textStatus == 'error' && jqXHR.responseJSON) {\n\t\t\t\ttextStatus = jqXHR.responseJSON.error.message;\n\t\t\t}\n\t\t\taDeferred.reject(textStatus, errorThrown, jqXHR);\n\t\t};\n\t\tif (params.data === '') {\n\t\t\tapp.showNotify({ type: 'error', title: app.vtranslate('JS_ERROR') });\n\t\t\treturn aDeferred.reject();\n\t\t}\n\t\tjQuery.ajax(params);\n\t\tif (pjaxMode) {\n\t\t\tif (typeof params.data.historyUrl !== 'undefined') {\n\t\t\t\tfullUrl = params.data.historyUrl;\n\t\t\t}\n\t\t\tif (fullUrl === '') {\n\t\t\t\tfullUrl = 'index.php?' + $.param(params.data);\n\t\t\t} else if (fullUrl.indexOf('index.php?') === -1) {\n\t\t\t\tfullUrl = 'index.php?' + fullUrl;\n\t\t\t}\n\t\t\tif (app.isWindowTop() && history.pushState && fullUrl !== '') {\n\t\t\t\tconst currentHref = window.location.href;\n\t\t\t\tif (!history.state) {\n\t\t\t\t\thistory.replaceState(currentHref, 'title 1', currentHref);\n\t\t\t\t}\n\t\t\t\thistory.pushState(fullUrl, 'title 2', fullUrl);\n\t\t\t}\n\t\t}\n\t\treturn aDeferred.promise();\n\t},\n\n\trequestForm: function (url, params = {}) {\n\t\tapp.openUrlMethodPost(url, params);\n\t}\n};\n"],"names":["window","AppConnector","requestPjax","params","_request","request","rawData","pjaxMode","jQuery","Deferred","callerParams","fullUrl","data","$","extend","index","indexOf","substr","replace","subStr","type","jsonp","dataType","hasOwnProperty","url","split","queryString","urlSplit","queryParameters","length","queryParamComponents","queryParam","success","error","app","errorLog","message","Vtiger_Helper_Js","showMessage","text","aDeferred","resolve","jqXHR","textStatus","errorThrown","getResponseHeader","location","href","CONFIG","debug","status","console","warn","responseJSON","trace","JSON","stringify","reject","showNotify","title","vtranslate","ajax","historyUrl","param","isWindowTop","history","pushState","state","replaceState","currentHref","promise","requestForm","openUrlMethodPost"],"mappings":"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"}