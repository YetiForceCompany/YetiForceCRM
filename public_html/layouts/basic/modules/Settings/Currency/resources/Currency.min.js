jQuery.Class("Settings_Currency_Js",{currencyInstance:false,triggerAdd:function(b){b.stopPropagation();var a=Settings_Currency_Js.currencyInstance;a.showEditView()},triggerEdit:function(b,c){b.stopPropagation();var a=Settings_Currency_Js.currencyInstance;a.showEditView(c)},triggerDelete:function(c,e){c.stopPropagation();var d=jQuery(c.currentTarget);var b=d.closest("tr");var a=Settings_Currency_Js.currencyInstance;a.transformEdit(e).then(function(g){var f=function(i){var h=jQuery("#transformCurrency");app.showSelect2ElementView(h.find("select.select2"));h.submit(function(k){k.preventDefault();var j=h.find('select[name="transform_to_id"]');a.deleteCurrency(e,j,b)})};app.showModalWindow(g,function(h){if(typeof f=="function"){f(h)}},{width:"500px"})},function(f,g){})}},{init:function(){Settings_Currency_Js.currencyInstance=this},showEditView:function(e){var b=this;var a=jQuery.Deferred();var c=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});var d={};d.module=app.getModuleName();d.parent=app.getParentModuleName();d.view="EditAjax";d.record=e;AppConnector.request(d).then(function(g){var f=function(j){var i=jQuery("#editCurrency");var h=i.find('[name="record"]').val();app.showSelect2ElementView(i.find("select.select2"));var k=i.find('[name="currency_status"]').is(":checked");if(h!=""&&k){b.registerCurrencyStatusChangeEvent(i)}b.registerCurrencyNameChangeEvent(i);var l=app.validationEngineOptions;l.onValidationComplete=function(n,m){if(m){b.saveCurrencyDetails(n);return m}};i.validationEngine(l);i.submit(function(m){m.preventDefault()})};c.progressIndicator({mode:"hide"});app.showModalWindow(g,function(h){if(typeof f=="function"){f(h)}},{width:"600px"})},function(f){c.progressIndicator({mode:"hide"});a.reject(f)});return a.promise()},registerCurrencyStatusChangeEvent:function(a){a.find('[name="currency_status"]').on("change",function(c){var b=jQuery(c.currentTarget);if(b.is(":checked")){a.find("div.transferCurrency").addClass("d-none")}else{a.find("div.transferCurrency").removeClass("d-none")}})},registerCurrencyNameChangeEvent:function(b){var a=b.find('select[name="currency_name"]');a.on("change",function(){var c=a.find("option:selected");b.find('[name="currency_code"]').val(c.data("code"));b.find('[name="currency_symbol"]').val(c.data("symbol"))})},saveCurrencyDetails:function(b){var a=this;var d=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});var c=b.serializeFormData();c.module=app.getModuleName();c.parent=app.getParentModuleName();c.action="SaveAjax";AppConnector.request(c).then(function(e){if(e.success){d.progressIndicator({mode:"hide"});app.hideModalWindow();var f={};f.text=app.vtranslate("JS_CURRENCY_DETAILS_SAVED");Settings_Vtiger_Index_Js.showMessage(f);a.loadListViewContents()}},function(e){d.progressIndicator({mode:"hide"})})},loadListViewContents:function(){var a=this;var b=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});var c={};c.module=app.getModuleName();c.parent=app.getParentModuleName();c.view="List";AppConnector.request(c).then(function(d){b.progressIndicator({mode:"hide"});jQuery("#listViewContents").html(d)},function(d,e){b.progressIndicator({mode:"hide"})})},transformEdit:function(c){var a=jQuery.Deferred();var b={};b.module=app.getModuleName();b.parent=app.getParentModuleName();b.view="TransformEditAjax";b.record=c;AppConnector.request(b).then(function(d){a.resolve(d)},function(d,e){a.reject()});return a.promise()},deleteCurrency:function(e,a,c){var b=a.find("option:selected").val();var d={};d.module=app.getModuleName();d.parent=app.getParentModuleName();d.action="DeleteAjax";d.record=e;d.transform_to_id=b;AppConnector.request(d).then(function(f){app.hideModalWindow();var g={};g.text=app.vtranslate("JS_CURRENCY_DELETED_SUCCESSFULLY");Settings_Vtiger_Index_Js.showMessage(g);c.fadeOut("slow").remove()},function(f,g){})},triggerDisplayTypeEvent:function(){var a=app.cacheGet("widthType","narrowWidthType");if(a){var b=jQuery(".listViewEntriesTable").find("td,th");b.attr("class",a)}},registerRowClick:function(){var a=this;jQuery("#listViewContents").on("click",".listViewEntries",function(c){var b=jQuery(c.currentTarget);if(b.find(".fas fa-edit ").length<=0){return}a.showEditView(b.data("id"))})},registerEvents:function(){this.registerRowClick()}});jQuery(document).ready(function(){var a=new Settings_Currency_Js();a.registerEvents()});