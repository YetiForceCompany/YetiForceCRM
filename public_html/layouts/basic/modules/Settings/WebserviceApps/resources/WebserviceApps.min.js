'use strict';

$.Class('Settings_WebserviceApps_Index_Js',{},{getContainer:function a(){return this.container},registerTableEvents:function c(){var a=this,b=this.container=$('.configContainer');b.find('.edit').on('click',function(b){var c=$(b.currentTarget),d=c.closest('tr');a.showFormToEditKey(d.data('id'));}),b.find('.remove').on('click',function(b){var c=jQuery(b.currentTarget),d=c.closest('tr'),e=app.vtranslate('JS_DELETE_CONFIRMATION');Vtiger_Helper_Js.showConfirmationBox({message:e}).done(function(){var b={module:app.getModuleName(),parent:app.getParentModuleName(),action:'Delete',id:d.data('id')},c=jQuery.progressIndicator();AppConnector.request(b).done(function(){c.progressIndicator({mode:'hide'}),a.loadTable();});});});},loadTable:function d(){var a=this,b={module:app.getModuleName(),parent:app.getParentModuleName(),view:'Index'},c=jQuery.progressIndicator();AppConnector.request(b).done(function(b){c.progressIndicator({mode:'hide'}),$('.configContainer').html(b),a.registerTableEvents();});},showFormToEditKey:function e(a){var b=this,c={module:app.getModuleName(),parent:app.getParentModuleName(),view:'CreateApp'};''!=a&&(c.record=a);var d=jQuery.progressIndicator();AppConnector.request(c).done(function(c){d.progressIndicator({mode:'hide'}),app.showModalWindow(c,function(c){var d=c.find('.previewPassword'),e=c.find('[name="pass"]');d.on('mousedown',function(){e.attr('type','text');}),d.on('mouseup',function(){e.attr('type','password');}),d.on('mouseout',function(){e.attr('type','password');});var f=App.Fields.Text.registerCopyClipboard(c,'.copyPassword');c.one('hidden.bs.modal',function(){f.destroy();}),Vtiger_Edit_Js.getInstance().registerEvents();var g=c.find('form');g.validationEngine(app.validationEngineOptions),c.find('[name="saveButton"]').on('click',function(){if(g.validationEngine('validate')){var d={module:app.getModuleName(),parent:app.getParentModuleName(),action:'SaveAjax',name:c.find('[name="name"]').val(),url:c.find('[name="addressUrl"]').val(),status:c.find('[name="status"]').is(':checked'),type:c.find('.typeServer').val(),pass:e.val(),accounts:c.find('[name="accountsid"]').val()};''!=a&&(d.id=a),AppConnector.request(d).done(function(){b.loadTable(),app.hideModalWindow();});}});});});},registerAddButton:function b(){var a=this;$('.createKey').on('click',function(){a.showFormToEditKey();});},registerEvents:function a(){this.registerAddButton(),this.registerTableEvents(),App.Fields.Text.registerCopyClipboard(this.getContainer());}});
