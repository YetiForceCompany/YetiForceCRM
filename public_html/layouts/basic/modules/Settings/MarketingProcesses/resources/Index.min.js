'use strict';

jQuery.Class('Settings_MarketingProcesses_Index_Js',{},{registerChangeVal:function b(a){a.find('.configField').on('change',function(a){var b,c=$(a.currentTarget);b='checkbox'===c.attr('type')?this.checked:null==c.val()?'':c.val(),AppConnector.request({module:app.getModuleName(),parent:app.getParentModuleName(),action:'SaveAjax',mode:'updateConfig',type:c.data('type'),param:c.attr('name'),value:b}).done(function(a){Settings_Vtiger_Index_Js.showMessage({type:'success',text:a.result.message});});});},registerSaveMapping:function c(a){var b=this;a.find('button.saveMapping').on('click',function(){var a=[];jQuery('#convertLeadMapping tr.listViewEntries:not(.d-none)').each(function(){var c=jQuery(this).find('select.leadsFields').val(),d=jQuery(this).find('select.accountsFields').val(),e=[];e[c]=d,e=jQuery.extend({},e),b.uniqueReduce(a,e)&&a.push(e);}),a.length?jQuery('[name="mapping"]').val(JSON.stringify(a)).change():Settings_Vtiger_Index_Js.showMessage({type:'info',text:app.vtranslate('JS_NO_CONDITIONS')});});},uniqueReduce:function d(a,b){for(var c in a)if(JSON.stringify(a[c])===JSON.stringify(b))return !1;return !0},registerEventToDeleteMapping:function b(a){a.find('.deleteMapping').on('click',function(a){var b=jQuery(a.currentTarget),c=b.closest('tr');c.remove();});},registerMapping:function b(a){a.find('[name="create_always"]').on('change',function(){var a=jQuery('.mappingTable');this.checked?a.removeClass('d-none'):a.addClass('d-none');});},registerEvents:function c(){var a=$('#supportProcessesContainer');this.registerChangeVal(a),this.registerSaveMapping(a),this.registerMapping(a),this.registerEventToDeleteMapping(a);var b=new Settings_LeadMapping_Js;b.registerEventForAddingNewMapping();}});
