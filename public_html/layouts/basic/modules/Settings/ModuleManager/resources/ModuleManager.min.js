'use strict';

jQuery.Class('Settings_Module_Manager_Js',{validateField:function c(a){var b=/[&\<\>\:\'\"\,]/;return !b.test(a.val())||app.vtranslate('JS_SPECIAL_CHARACTERS_NOT_ALLOWED')},registerMondalCreateModule:function d(a){a.find('[name="saveButton"]').attr('disabled',!0);var b=a.find('form');b.validationEngine(app.validationEngineOptions);var c=new Settings_Module_Manager_Js;a.find('input').on('change',function(){'module_name'==$(this).attr('name')?c.checkModuleName($(this).val(),a):''==$(this).val()?$(this).attr('check',!1):$(this).attr('check',!0);var b=!0;a.find('input[name]').each(function(){('false'==$(this).attr('check')||$(this).attr('check')==null)&&(b=!1);}),b?a.find('[name="saveButton"]').attr('disabled',!1):a.find('[name="saveButton"]').attr('disabled',!0);}),a.find('[name="saveButton"]').on('click',function(){if(b.validationEngine('validate')){var a=b.serializeFormData(),c=$.progressIndicator({message:app.vtranslate('Adding a Key'),blockInfo:{enabled:!0}}),d={};d.module=app.getModuleName(),d.parent=app.getParentModuleName(),d.action='Basic',d.mode='createModule',d.formData=a,AppConnector.request(d).done(function(a){var b=a.result;if(!b.success){var c={text:b.text,type:'error'};Vtiger_Helper_Js.showPnotify(c);}else window.location.href='index.php?parent=Settings&module=LayoutEditor&sourceModule='+b.text;}),c.progressIndicator({mode:'hide'});}});}},{updateModuleStatus:function g(a){var b=jQuery.Deferred(),c=a.data('module'),d=a.is(':checked'),e=jQuery.progressIndicator({position:'html',blockInfo:{enabled:!0}}),f={};return f.module=app.getModuleName(),f.parent=app.getParentModuleName(),f.updateStatus=d,f.forModule=c,f.action='Basic',f.mode='updateModuleStatus',AppConnector.request(f).done(function(a){e.progressIndicator({mode:'hide'}),b.resolve(a);}).fail(function(a){e.progressIndicator({mode:'hide'}),b.reject(a);}),b.promise()},createModule:function b(){var a=jQuery.progressIndicator();app.showModalWindow(null,'index.php?module=ModuleManager&parent=Settings&view=CreateModule',function(b){a.progressIndicator({mode:'hide'}),Settings_Module_Manager_Js.registerMondalCreateModule(b);});},checkModuleName:function e(a,b){var c=jQuery.progressIndicator();b.find('[name="module_name"]').attr('check',!1);var d={};d.data={module:app.getModuleName(),action:'Basic',parent:app.getParentModuleName(),mode:'checkModuleName',moduleName:a},d.async=!1,d.dataType='json',AppConnector.request(d).done(function(a){var d=a.result;if(d.success)b.find('[name="module_name"]').attr('check',!0);else{b.find('[name="module_name"]').attr('check',!1);var e={text:d.text,type:'error'};Vtiger_Helper_Js.showPnotify(e),b.find('[name="saveButton"]').attr('disabled',!0);}c.progressIndicator({mode:'hide'});});},showNotify:function c(a){var b={title:app.vtranslate('JS_MESSAGE'),text:'',type:'info'};$.extend(b,a),Vtiger_Helper_Js.showPnotify(b);},frameProgress:!1,deleteModule:function b(a){a.on('click','.deleteModule',function(a){var b=jQuery(a.currentTarget),c=b.attr('name'),d={};d.data={module:app.getModuleName(),action:'Basic',parent:app.getParentModuleName(),mode:'deleteModule',forModule:c},this.frameProgress=$.progressIndicator({position:'html',message:app.vtranslate('JS_FRAME_IN_PROGRESS'),blockInfo:{enabled:!0}}),AppConnector.request(d).done(function(){var a={title:app.vtranslate('JS_REMOVED_MODULE'),type:'info'};Vtiger_Helper_Js.showPnotify(a),window.location.href='index.php?module=ModuleManager&parent=Settings&view=List';});});},registerEvents:function d(){var a=this,b=jQuery('#moduleManagerContents');b.find('.createModule').on('click',a.createModule);var c=b.find('.js-scrollbar');app.showNewScrollbarTopBottom(c),a.deleteModule(b),b.on('click','[name="moduleStatus"]',function(b){var c=jQuery(b.currentTarget),d=c.closest('.moduleManagerBlock'),e=d.find('.actions'),f=c.data('moduleTranslation'),g=d.find('.moduleImage, .moduleName');c.is(':checked')?(e.removeClass('d-none'),g.removeClass('dull'),a.updateModuleStatus(c).done(function(b){var c={text:f+' '+app.vtranslate('JS_MODULE_ENABLED')};!1==b.success&&(c.type='error',c.text=b.error.message),a.showNotify(c);})):(e.addClass('d-none'),g.addClass('dull'),a.updateModuleStatus(c).done(function(){var b={text:f+' '+app.vtranslate('JS_MODULE_DISABLED')};a.showNotify(b);}));});}}),jQuery(document).ready(function(){var a=new Settings_Module_Manager_Js;a.registerEvents();});
