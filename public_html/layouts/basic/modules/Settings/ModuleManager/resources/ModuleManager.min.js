'use strict';

/*+***********************************************************************************
 * The contents of this file are subject to the vtiger CRM Public License Version 1.0
 * ("License"); You may not use this file except in compliance with the License
 * The Original Code is:  vtiger CRM Open Source
 * The Initial Developer of the Original Code is vtiger.
 * Portions created by vtiger are Copyright (C) vtiger.
 * All Rights Reserved.
 * Contributor(s): YetiForce S.A.
 *************************************************************************************/"use strict";jQuery.Class("Settings_Module_Manager_Js",{validateField:function validateField(field){return !/[&\<\>\:\'\"\,]/.test(field.val())||app.vtranslate("JS_SPECIAL_CHARACTERS_NOT_ALLOWED")},validateModuleName:function validateModuleName(field){var returnVal=!1,progressIndicatorElement=jQuery.progressIndicator();return AppConnector.request({async:!1,dataType:"json",data:{module:app.getModuleName(),action:"Basic",parent:app.getParentModuleName(),mode:"checkModuleName",moduleName:field.val()}}).done(function(data){var result=data.result;returnVal=!!result.success||result.text,progressIndicatorElement.progressIndicator({mode:"hide"});}).fail(function(){progressIndicatorElement.progressIndicator({mode:"hide"}),returnVal=app.vtranslate("JS_NOT_ALLOWED_VALUE");}),returnVal},sendForm:function sendForm(form){var formData=form.serializeFormData(),progress=$.progressIndicator({message:app.vtranslate("Adding a Key"),blockInfo:{enabled:!0}});AppConnector.request({module:app.getModuleName(),parent:app.getParentModuleName(),action:"Basic",mode:"createModule",formData:formData}).done(function(data){progress.progressIndicator({mode:"hide"});var result=data.result;result.success?window.location.href="index.php?parent=Settings&module=LayoutEditor&sourceModule="+result.text:app.showNotify({text:result.text,type:"error"});});},registerModalCreateModule:function registerModalCreateModule(data){var _this=this,form=data.find("form");form.validationEngine(app.validationEngineOptions),data.find("[name=\"saveButton\"]").on("click",function(){form.validationEngine("validate")&&_this.sendForm(form);});}},{/*
		 * function to update the module status for the module
		 * @params: currentTarget - checkbox related to module.
		 */updateModuleStatus:function updateModuleStatus(currentTarget){var aDeferred=jQuery.Deferred(),forModule=currentTarget.data("module"),status=currentTarget.is(":checked"),progressIndicatorElement=jQuery.progressIndicator({position:"html",blockInfo:{enabled:!0}}),params={};return params.module=app.getModuleName(),params.parent=app.getParentModuleName(),params.updateStatus=status,params.forModule=forModule,params.action="Basic",params.mode="updateModuleStatus",AppConnector.request(params).done(function(data){progressIndicatorElement.progressIndicator({mode:"hide"}),aDeferred.resolve(data);}).fail(function(error){progressIndicatorElement.progressIndicator({mode:"hide"}),aDeferred.reject(error);}),aDeferred.promise()},createModule:function createModule(){var progressIndicatorElement=jQuery.progressIndicator();app.showModalWindow(null,"index.php?module=ModuleManager&parent=Settings&view=CreateModule",function(wizardContainer){progressIndicatorElement.progressIndicator({mode:"hide"}),Settings_Module_Manager_Js.registerModalCreateModule(wizardContainer);});},//This will show the notification message using pnotify
showNotify:function showNotify(customParams){var params={title:app.vtranslate("JS_MESSAGE"),text:"",type:"info"};$.extend(params,customParams),app.showNotify(params);},frameProgress:!1,deleteModule:function deleteModule(container){var self=this;container.on("click",".deleteModule",function(){var forModule=$(this).attr("name");app.showConfirmModal({title:app.vtranslate("JS_LBL_ARE_YOU_SURE_YOU_WANT_TO_DELETE"),confirmedCallback:function confirmedCallback(){self.frameProgress=$.progressIndicator({position:"html",message:app.vtranslate("JS_FRAME_IN_PROGRESS"),blockInfo:{enabled:!0}}),AppConnector.request({module:app.getModuleName(),action:"Basic",parent:app.getParentModuleName(),mode:"deleteModule",forModule:forModule}).done(function(){app.showNotify({title:app.vtranslate("JS_REMOVED_MODULE"),type:"info"}),app.openUrl("index.php?module=ModuleManager&parent=Settings&view=List");});}});});},registerEvents:function registerEvents(){var thisInstance=this,container=jQuery("#moduleManagerContents");container.find(".createModule").on("click",thisInstance.createModule);var scrollbar=container.find(".js-scrollbar");//register click event for check box to update the module status
app.showNewScrollbarTopBottom(scrollbar),thisInstance.deleteModule(container),container.on("click","[name=\"moduleStatus\"]",function(e){var currentTarget=jQuery(e.currentTarget),moduleBlock=currentTarget.closest(".moduleManagerBlock"),actionButtons=moduleBlock.find(".actions"),forModule=currentTarget.data("moduleTranslation"),moduleDetails=moduleBlock.find(".moduleImage, .moduleName");currentTarget.is(":checked")?(actionButtons.removeClass("d-none"),moduleDetails.removeClass("dull"),thisInstance.updateModuleStatus(currentTarget).done(function(data){var params={text:forModule+" "+app.vtranslate("JS_MODULE_ENABLED")};!1==data.success&&(params.type="error",params.text=data.error.message),thisInstance.showNotify(params);})):(actionButtons.addClass("d-none"),moduleDetails.addClass("dull"),thisInstance.updateModuleStatus(currentTarget).done(function(){var params={text:forModule+" "+app.vtranslate("JS_MODULE_DISABLED")};thisInstance.showNotify(params);}));});}}),jQuery(document).ready(function(){var settingModuleManagerInstance=new Settings_Module_Manager_Js;settingModuleManagerInstance.registerEvents();});
//# sourceMappingURL=ModuleManager.min.js.map
