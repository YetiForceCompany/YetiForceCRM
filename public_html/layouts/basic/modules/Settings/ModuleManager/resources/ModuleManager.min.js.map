{"version":3,"file":"ModuleManager.min.js","sources":["ModuleManager.js"],"sourcesContent":["/*+***********************************************************************************\n * The contents of this file are subject to the vtiger CRM Public License Version 1.0\n * (\"License\"); You may not use this file except in compliance with the License\n * The Original Code is:  vtiger CRM Open Source\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n * Contributor(s): YetiForce.com\n *************************************************************************************/\n'use strict';\n\njQuery.Class('Settings_Module_Manager_Js', {\n\tvalidateField(field, rules, i, options) {\n\t\tconst specialChars = /[&\\<\\>\\:\\'\\\"\\,]/;\n\t\tif (specialChars.test(field.val())) {\n\t\t\treturn app.vtranslate('JS_SPECIAL_CHARACTERS_NOT_ALLOWED');\n\t\t}\n\t\treturn true;\n\t},\n\tvalidateModuleName(field, rules, i, options) {\n\t\tlet returnVal = false;\n\t\tconst progressIndicatorElement = jQuery.progressIndicator();\n\t\tAppConnector.request({\n\t\t\tasync: false,\n\t\t\tdataType: 'json',\n\t\t\tdata: {\n\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\taction: 'Basic',\n\t\t\t\tparent: app.getParentModuleName(),\n\t\t\t\tmode: 'checkModuleName',\n\t\t\t\tmoduleName: field.val()\n\t\t\t}\n\t\t}).done((data) => {\n\t\t\tconst result = data.result;\n\t\t\tif (result.success) {\n\t\t\t\treturnVal = true;\n\t\t\t} else {\n\t\t\t\treturnVal = result.text;\n\t\t\t}\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t}).fail((data, error) => {\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\treturnVal = app.vtranslate('JS_NOT_ALLOWED_VALUE');\n\t\t});\n\t\treturn returnVal;\n\t},\n\tsendForm(form) {\n\t\tconst formData = form.serializeFormData();\n\t\tconst progress = $.progressIndicator({\n\t\t\t'message': app.vtranslate('Adding a Key'),\n\t\t\t'blockInfo': {\n\t\t\t\t'enabled': true\n\t\t\t}\n\t\t});\n\t\tAppConnector.request({\n\t\t\tmodule: app.getModuleName(),\n\t\t\tparent: app.getParentModuleName(),\n\t\t\taction: 'Basic',\n\t\t\tmode: 'createModule',\n\t\t\tformData: formData\n\t\t}).done(function (data) {\n\t\t\tprogress.progressIndicator({'mode': 'hide'});\n\t\t\tconst result = data.result;\n\t\t\tif (!result.success) {\n\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\ttext: result.text,\n\t\t\t\t\ttype: 'error'\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\twindow.location.href = 'index.php?parent=Settings&module=LayoutEditor&sourceModule=' + result.text;\n\t\t\t}\n\t\t});\n\t},\n\tregisterModalCreateModule(data) {\n\t\tconst form = data.find('form');\n\t\tform.validationEngine(app.validationEngineOptions);\n\t\tdata.find('[name=\"saveButton\"]').on('click', (e) => {\n\t\t\tif (form.validationEngine('validate')) {\n\t\t\t\tthis.sendForm(form);\n\t\t\t}\n\t\t});\n\t}\n}, {\n\t/*\n\t * function to update the module status for the module\n\t * @params: currentTarget - checkbox related to module.\n\t */\n\tupdateModuleStatus: function (currentTarget) {\n\t\tvar aDeferred = jQuery.Deferred();\n\t\tvar forModule = currentTarget.data('module');\n\t\tvar status = currentTarget.is(':checked');\n\n\t\tvar progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t'position': 'html',\n\t\t\t'blockInfo': {\n\t\t\t\t'enabled': true\n\t\t\t}\n\t\t});\n\n\t\tvar params = {}\n\t\tparams['module'] = app.getModuleName();\n\t\tparams['parent'] = app.getParentModuleName();\n\t\tparams['updateStatus'] = status;\n\t\tparams['forModule'] = forModule;\n\t\tparams['action'] = 'Basic';\n\t\tparams['mode'] = 'updateModuleStatus';\n\n\t\tAppConnector.request(params).done(function (data) {\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\taDeferred.resolve(data);\n\t\t}).fail(function (error) {\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\taDeferred.reject(error);\n\t\t});\n\t\treturn aDeferred.promise();\n\t},\n\tcreateModule: function (currentTarget) {\n\t\tvar progressIndicatorElement = jQuery.progressIndicator();\n\t\tapp.showModalWindow(null, \"index.php?module=ModuleManager&parent=Settings&view=CreateModule\", function (wizardContainer) {\n\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\tSettings_Module_Manager_Js.registerModalCreateModule(wizardContainer);\n\t\t});\n\t},\n\t//This will show the notification message using pnotify\n\tshowNotify: function (customParams) {\n\t\tvar params = {\n\t\t\ttitle: app.vtranslate('JS_MESSAGE'),\n\t\t\ttext: '',\n\t\t\ttype: 'info'\n\t\t};\n\t\t$.extend(params, customParams);\n\t\tVtiger_Helper_Js.showPnotify(params);\n\t},\n\tframeProgress: false,\n\tdeleteModule: function(container) {\n\t\tconst self = this;\n\t\tcontainer.on('click', '.deleteModule', function() {\n\t\t\tlet forModule = $(this).attr(\"name\");\n\t\t\tVtiger_Helper_Js.showConfirmationBox({\n\t\t\t\tmessage: app.vtranslate(\"JS_LBL_ARE_YOU_SURE_YOU_WANT_TO_DELETE\")\n\t\t\t}).done(function(e) {\n\t\t\t\tself.frameProgress = $.progressIndicator({\n\t\t\t\t\tposition: \"html\",\n\t\t\t\t\tmessage: app.vtranslate(\"JS_FRAME_IN_PROGRESS\"),\n\t\t\t\t\tblockInfo: {\n\t\t\t\t\t\tenabled: true\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tAppConnector.request({\n\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\taction: \"Basic\",\n\t\t\t\t\tparent: app.getParentModuleName(),\n\t\t\t\t\tmode: \"deleteModule\",\n\t\t\t\t\tforModule: forModule\n\t\t\t\t}).done(function(data) {\n\t\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\t\ttitle: app.vtranslate(\"JS_REMOVED_MODULE\"),\n\t\t\t\t\t\ttype: \"info\"\n\t\t\t\t\t});\n\t\t\t\t\tapp.openUrl(\"index.php?module=ModuleManager&parent=Settings&view=List\");\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t},\n\tregisterEvents: function (e) {\n\t\tvar thisInstance = this;\n\t\tvar container = jQuery('#moduleManagerContents');\n\t\tcontainer.find('.createModule').on('click', thisInstance.createModule);\n\t\tvar scrollbar = container.find('.js-scrollbar');\n\t\tapp.showNewScrollbarTopBottom(scrollbar);\n\t\tthisInstance.deleteModule(container);\n\t\t//register click event for check box to update the module status\n\t\tcontainer.on('click', '[name=\"moduleStatus\"]', function (e) {\n\t\t\tvar currentTarget = jQuery(e.currentTarget);\n\t\t\tvar moduleBlock = currentTarget.closest('.moduleManagerBlock');\n\t\t\tvar actionButtons = moduleBlock.find('.actions');\n\t\t\tvar forModule = currentTarget.data('moduleTranslation');\n\t\t\tvar moduleDetails = moduleBlock.find('.moduleImage, .moduleName');\n\n\t\t\tif (currentTarget.is(':checked')) {\n\t\t\t\t//show the settings button for the module.\n\t\t\t\tactionButtons.removeClass('d-none');\n\n\t\t\t\t//changing opacity of the block if the module is enabled\n\t\t\t\tmoduleDetails.removeClass('dull');\n\n\t\t\t\t//update the module status as enabled\n\t\t\t\tthisInstance.updateModuleStatus(currentTarget).done(function (data) {\n\t\t\t\t\tvar params = {\n\t\t\t\t\t\ttext: forModule + ' ' + app.vtranslate('JS_MODULE_ENABLED'),\n\t\t\t\t\t}\n\t\t\t\t\tif (data.success == false) {\n\t\t\t\t\t\tparams.type = 'error';\n\t\t\t\t\t\tparams.text = data.error.message;\n\n\t\t\t\t\t}\n\t\t\t\t\tthisInstance.showNotify(params);\n\t\t\t\t});\n\n\t\t\t} else {\n\t\t\t\t//hide the settings button for the module.\n\t\t\t\tactionButtons.addClass('d-none');\n\n\t\t\t\t//changing opacity of the block if the module is disabled\n\t\t\t\tmoduleDetails.addClass('dull');\n\n\t\t\t\t//update the module status as disabled\n\t\t\t\tthisInstance.updateModuleStatus(currentTarget).done(function (data) {\n\t\t\t\t\tvar params = {\n\t\t\t\t\t\ttext: forModule + ' ' + app.vtranslate('JS_MODULE_DISABLED')\n\t\t\t\t\t}\n\t\t\t\t\tthisInstance.showNotify(params);\n\t\t\t\t});\n\t\t\t}\n\n\t\t});\n\t}\n});\njQuery(document).ready(function () {\n\tvar settingModuleManagerInstance = new Settings_Module_Manager_Js();\n\tsettingModuleManagerInstance.registerEvents();\n})\n"],"names":["jQuery","Class","validateField","field","specialChars","test","val","app","vtranslate","validateModuleName","progressIndicatorElement","progressIndicator","request","async","dataType","data","module","getModuleName","action","parent","getParentModuleName","mode","moduleName","done","result","returnVal","success","text","fail","sendForm","form","serializeFormData","progress","$","AppConnector","formData","window","location","href","Vtiger_Helper_Js","showPnotify","type","registerModalCreateModule","find","validationEngine","validationEngineOptions","on","updateModuleStatus","currentTarget","Deferred","forModule","status","is","params","aDeferred","resolve","error","reject","promise","createModule","showModalWindow","wizardContainer","Settings_Module_Manager_Js","showNotify","customParams","title","extend","frameProgress","deleteModule","container","attr","showConfirmationBox","message","self","position","blockInfo","enabled","openUrl","registerEvents","thisInstance","showNewScrollbarTopBottom","scrollbar","e","moduleBlock","closest","actionButtons","moduleDetails","removeClass","addClass","document","ready","settingModuleManagerInstance"],"mappings":";;AAWAA,OAAOC,KAAP,CAAa,4BAAb,CAA2C,CAC1CC,aAD0C,wBAC5BC,KAD4B,CACF,CACvC,iBAAqB,iBAArB,CADuC,QAEnCC,aAAaC,IAAb,CAAkBF,MAAMG,GAAN,EAAlB,CAFmC,EAG/BC,IAAIC,UAAJ,CAAe,mCAAf,CAGR,CAPyC,CAQ1CC,kBAR0C,6BAQvBN,KARuB,CAQG,iBAAA,CAEtCO,yBAA2BV,OAAOW,iBAAP,EAFW,CAyB5C,oBAtBaC,OAAb,CAAqB,CACpBC,QADoB,CAEpBC,SAAU,MAFU,CAGpBC,KAAM,CACLC,OAAQT,IAAIU,aAAJ,EADH,CAELC,OAAQ,OAFH,CAGLC,OAAQZ,IAAIa,mBAAJ,EAHH,CAILC,KAAM,iBAJD,CAKLC,WAAYnB,MAAMG,GAAN,EALP,CAHc,CAArB,EAUGiB,IAVH,CAUQ,SAACR,IAAD,CAAU,CACjB,WAAeA,KAAKS,MAApB,CAECC,SAHgB,GAEbD,OAAOE,OAFM,EAKJF,OAAOG,IALH,CAOjBjB,yBAAyBC,iBAAzB,CAA2C,CAAC,KAAQ,MAAT,CAA3C,EACA,CAlBD,EAkBGiB,IAlBH,CAkBQ,UAAiB,CACxBlB,yBAAyBC,iBAAzB,CAA2C,CAAC,KAAQ,MAAT,CAA3C,CADwB,CAExBc,UAAYlB,IAAIC,UAAJ,CAAe,sBAAf,EACZ,CArBD,CAsBA,CAAOiB,SACP,CAlCyC,CAmC1CI,QAnC0C,mBAmCjCC,IAnCiC,CAmC3B,cACGA,KAAKC,iBAAL,EADH,CAERC,SAAWC,EAAEtB,iBAAF,CAAoB,CACpC,QAAWJ,IAAIC,UAAJ,CAAe,cAAf,CADyB,CAEpC,UAAa,CACZ,UADY,CAFuB,CAApB,CAFH,CAQd0B,aAAatB,OAAb,CAAqB,CACpBI,OAAQT,IAAIU,aAAJ,EADY,CAEpBE,OAAQZ,IAAIa,mBAAJ,EAFY,CAGpBF,OAAQ,OAHY,CAIpBG,KAAM,cAJc,CAKpBc,SAAUA,QALU,CAArB,EAMGZ,IANH,CAMQ,SAAUR,IAAV,CAAgB,CACvBiB,SAASrB,iBAAT,CAA2B,CAAC,KAAQ,MAAT,CAA3B,CADuB,CAEvB,WAAeI,KAAKS,MAApB,CACKA,OAAOE,OAHW,CAStBU,OAAOC,QAAP,CAAgBC,IAAhB,CAAuB,8DAAgEd,OAAOG,IATxE,CAItBY,iBAAiBC,WAAjB,CAA6B,CAC5Bb,KAAMH,OAAOG,IADe,CAE5Bc,KAAM,OAFsB,CAA7B,EAOD,CAjBD,EAkBA,CA7DyC,CA8D1CC,yBA9D0C,oCA8DhB3B,IA9DgB,CA8DV,gBACzBe,KAAOf,KAAK4B,IAAL,CAAU,MAAV,CADkB,CAE/Bb,KAAKc,gBAAL,CAAsBrC,IAAIsC,uBAA1B,CAF+B,CAG/B9B,KAAK4B,IAAL,CAAU,qBAAV,EAAiCG,EAAjC,CAAoC,OAApC,CAA6C,UAAO,CAC/ChB,KAAKc,gBAAL,CAAsB,UAAtB,CAD+C,EAElD,MAAKf,QAAL,CAAcC,IAAd,EAED,CAJD,EAKA,CAtEyC,CAA3C,CAuEG,CAKFiB,mBAAoB,4BAAUC,aAAV,CAAyB,eAC5BhD,OAAOiD,QAAP,EAD4B,CAExCC,UAAYF,cAAcjC,IAAd,CAAmB,QAAnB,CAF4B,CAGxCoC,OAASH,cAAcI,EAAd,CAAiB,UAAjB,CAH+B,CAKxC1C,yBAA2BV,OAAOW,iBAAP,CAAyB,CACvD,SAAY,MAD2C,CAEvD,UAAa,CACZ,UADY,CAF0C,CAAzB,CALa,CAYxC0C,OAAS,EAZ+B,CA2B5C,qBAdmB9C,IAAIU,aAAJ,EAcnB,CAbAoC,cAAmB9C,IAAIa,mBAAJ,EAanB,CAZAiC,oBAAyBF,MAYzB,CAXAE,iBAAsBH,SAWtB,CAVAG,cAAmB,OAUnB,CATAA,YAAiB,oBASjB,CAPAnB,aAAatB,OAAb,CAAqByC,MAArB,EAA6B9B,IAA7B,CAAkC,SAAUR,IAAV,CAAgB,CACjDL,yBAAyBC,iBAAzB,CAA2C,CAAC,KAAQ,MAAT,CAA3C,CADiD,CAEjD2C,UAAUC,OAAV,CAAkBxC,IAAlB,EACA,CAHD,EAGGa,IAHH,CAGQ,SAAU4B,KAAV,CAAiB,CACxB9C,yBAAyBC,iBAAzB,CAA2C,CAAC,KAAQ,MAAT,CAA3C,CADwB,CAExB2C,UAAUG,MAAV,CAAiBD,KAAjB,EACA,CAND,CAOA,CAAOF,UAAUI,OAAV,EACP,CAjCC,CAkCFC,aAAc,uBAAyB,CACtC,6BAA+B3D,OAAOW,iBAAP,EAA/B,CACAJ,IAAIqD,eAAJ,CAAoB,IAApB,CAA0B,kEAA1B,CAA8F,SAAUC,eAAV,CAA2B,CACxHnD,yBAAyBC,iBAAzB,CAA2C,CAAC,KAAQ,MAAT,CAA3C,CADwH,CAExHmD,2BAA2BpB,yBAA3B,CAAqDmB,eAArD,EACA,CAHD,EAIA,CAxCC,CA0CFE,WAAY,oBAAUC,YAAV,CAAwB,CACnC,WAAa,CACZC,MAAO1D,IAAIC,UAAJ,CAAe,YAAf,CADK,CAEZmB,KAAM,EAFM,CAGZc,KAAM,MAHM,CAAb,CAKAR,EAAEiC,MAAF,CAASb,MAAT,CAAiBW,YAAjB,CANmC,CAOnCzB,iBAAiBC,WAAjB,CAA6Ba,MAA7B,EACA,CAlDC,CAmDFc,gBAnDE,CAoDFC,aAAc,sBAASC,SAAT,CAAoB,CACjC,SAAa,IAAb,CACAA,UAAUvB,EAAV,CAAa,OAAb,CAAsB,eAAtB,CAAuC,UAAW,CACjD,cAAgBb,EAAE,IAAF,EAAQqC,IAAR,CAAa,MAAb,CAAhB,CACA/B,iBAAiBgC,mBAAjB,CAAqC,CACpCC,QAASjE,IAAIC,UAAJ,CAAe,wCAAf,CAD2B,CAArC,EAEGe,IAFH,CAEQ,UAAY,CACnBkD,KAAKN,aAAL,CAAqBlC,EAAEtB,iBAAF,CAAoB,CACxC+D,SAAU,MAD8B,CAExCF,QAASjE,IAAIC,UAAJ,CAAe,sBAAf,CAF+B,CAGxCmE,UAAW,CACVC,UADU,CAH6B,CAApB,CADF,CAQnB1C,aAAatB,OAAb,CAAqB,CACpBI,OAAQT,IAAIU,aAAJ,EADY,CAEpBC,OAAQ,OAFY,CAGpBC,OAAQZ,IAAIa,mBAAJ,EAHY,CAIpBC,KAAM,cAJc,CAKpB6B,UAAWA,SALS,CAArB,EAMG3B,IANH,CAMQ,UAAe,CACtBgB,iBAAiBC,WAAjB,CAA6B,CAC5ByB,MAAO1D,IAAIC,UAAJ,CAAe,mBAAf,CADqB,CAE5BiC,KAAM,MAFsB,CAA7B,CADsB,CAKtBlC,IAAIsE,OAAJ,CAAY,0DAAZ,EACA,CAZD,EAaA,CAvBD,EAwBA,CA1BD,EA2BA,CAjFC,CAkFFC,eAAgB,yBAAa,kBACT,IADS,CAExBT,UAAYrE,OAAO,wBAAP,CAFY,CAG5BqE,UAAU1B,IAAV,CAAe,eAAf,EAAgCG,EAAhC,CAAmC,OAAnC,CAA4CiC,aAAapB,YAAzD,CAH4B,CAI5B,cAAgBU,UAAU1B,IAAV,CAAe,eAAf,CAAhB,CACApC,IAAIyE,yBAAJ,CAA8BC,SAA9B,CAL4B,CAM5BF,aAAaX,YAAb,CAA0BC,SAA1B,CAN4B,CAQ5BA,UAAUvB,EAAV,CAAa,OAAb,CAAsB,uBAAtB,CAA+C,SAAUoC,CAAV,CAAa,mBACvClF,OAAOkF,EAAElC,aAAT,CADuC,CAEvDmC,YAAcnC,cAAcoC,OAAd,CAAsB,qBAAtB,CAFyC,CAGvDC,cAAgBF,YAAYxC,IAAZ,CAAiB,UAAjB,CAHuC,CAIvDO,UAAYF,cAAcjC,IAAd,CAAmB,mBAAnB,CAJ2C,CAKvDuE,cAAgBH,YAAYxC,IAAZ,CAAiB,2BAAjB,CALuC,CAOvDK,cAAcI,EAAd,CAAiB,UAAjB,CAPuD,EAS1DiC,cAAcE,WAAd,CAA0B,QAA1B,CAT0D,CAY1DD,cAAcC,WAAd,CAA0B,MAA1B,CAZ0D,CAe1DR,aAAahC,kBAAb,CAAgCC,aAAhC,EAA+CzB,IAA/C,CAAoD,SAAUR,IAAV,CAAgB,CACnE,WAAa,CACZY,KAAMuB,UAAY,GAAZ,CAAkB3C,IAAIC,UAAJ,CAAe,mBAAf,CADZ,CAAb,CAGI,SAAKkB,OAJ0D,GAKlE2B,OAAOZ,IAAP,CAAc,OALoD,CAMlEY,OAAO1B,IAAP,CAAcZ,KAAKyC,KAAL,CAAWgB,OANyC,EASnEO,aAAahB,UAAb,CAAwBV,MAAxB,EACA,CAVD,CAf0D,GA6B1DgC,cAAcG,QAAd,CAAuB,QAAvB,CA7B0D,CAgC1DF,cAAcE,QAAd,CAAuB,MAAvB,CAhC0D,CAmC1DT,aAAahC,kBAAb,CAAgCC,aAAhC,EAA+CzB,IAA/C,CAAoD,UAAgB,CACnE,WAAa,CACZI,KAAMuB,UAAY,GAAZ,CAAkB3C,IAAIC,UAAJ,CAAe,oBAAf,CADZ,CAAb,CAGAuE,aAAahB,UAAb,CAAwBV,MAAxB,EACA,CALD,CAnC0D,EA2C3D,CA3CD,EA4CA,CAtIC,CAvEH,EA+MArD,OAAOyF,QAAP,EAAiBC,KAAjB,CAAuB,UAAY,CAClC,iCAAmC,8BAAnC,CACAC,6BAA6Bb,cAA7B,GACA,CAHD"}