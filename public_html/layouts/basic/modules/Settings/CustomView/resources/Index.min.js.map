{"version":3,"file":"Index.min.js","sources":["Index.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 4.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\njQuery.Class(\n\t'Settings_CustomView_Index_Js',\n\t{},\n\t{\n\t\tcontainer: false,\n\t\tcontents: false,\n\t\t/**\n\t\t * Register events\n\t\t * @param {jQuery} container\n\t\t */\n\t\tinitEvents: function (container) {\n\t\t\tcontainer.on('click', '.js-delete-filter', (e) => {\n\t\t\t\tthis.deleteFilter(e);\n\t\t\t});\n\t\t\tcontainer.on('change', '.js-update-field', (e) => {\n\t\t\t\tthis.updateField(e);\n\t\t\t});\n\t\t\tcontainer.on('click', '.js-update,.js-create-filter', (e) => {\n\t\t\t\tthis.update(e);\n\t\t\t});\n\t\t\tcontainer.on('change', '.js-module-filter', (e) => {\n\t\t\t\tthis.registerFilterChange(e);\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Load form to edit filter\n\t\t * @param {jQuery.Event} e\n\t\t */\n\t\tupdate: function (e) {\n\t\t\tvar target = $(e.currentTarget);\n\t\t\tvar editUrl = target.data('editurl');\n\t\t\tnew CustomView(editUrl);\n\t\t},\n\t\t/**\n\t\t * Update parameter\n\t\t * @param {jQuery.Event} e\n\t\t */\n\t\tupdateField: function (e) {\n\t\t\tconst thisInstance = this,\n\t\t\t\ttarget = $(e.currentTarget),\n\t\t\t\tclosestTrElement = target.closest('.js-filter-row');\n\t\t\t$.progressIndicator({\n\t\t\t\tmessage: app.vtranslate('JS_SAVE_LOADER_INFO'),\n\t\t\t\tblockInfo: {\n\t\t\t\t\tenabled: true\n\t\t\t\t}\n\t\t\t});\n\t\t\tconst params = {\n\t\t\t\tcvid: closestTrElement.data('cvid'),\n\t\t\t\tmod: closestTrElement.data('mod'),\n\t\t\t\tname: target.attr('name'),\n\t\t\t\tvalue: target.val()\n\t\t\t};\n\t\t\tapp.saveAjax('updateField', {}, params).done(function (data) {\n\t\t\t\tthisInstance.getContainer().find('.js-module-filter').trigger('change');\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Delete filter\n\t\t * @param {jQuery.Event} e\n\t\t */\n\t\tdeleteFilter: function (e) {\n\t\t\tvar thisInstance = this;\n\t\t\tvar target = $(e.currentTarget);\n\t\t\tvar closestTrElement = target.closest('.js-filter-row');\n\t\t\t$.progressIndicator({\n\t\t\t\tmessage: app.vtranslate('JS_SAVE_LOADER_INFO'),\n\t\t\t\tblockInfo: {\n\t\t\t\t\tenabled: true\n\t\t\t\t}\n\t\t\t});\n\t\t\tapp\n\t\t\t\t.saveAjax(\n\t\t\t\t\t'delete',\n\t\t\t\t\t{},\n\t\t\t\t\t{\n\t\t\t\t\t\tcvid: closestTrElement.data('cvid')\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t\t.done(function () {\n\t\t\t\t\tthisInstance.getContainer().find('.js-module-filter').trigger('change');\n\t\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Function to regiser the event to make the filters sortable\n\t\t */\n\t\tmakeFilterListSortable: function (container) {\n\t\t\tvar thisInstance = this;\n\t\t\tvar tbody = container.find('tbody');\n\n\t\t\tif (tbody.children().length > 1) {\n\t\t\t\ttbody.each(function () {\n\t\t\t\t\tjQuery(this).sortable({\n\t\t\t\t\t\tcontainment: 'tbody',\n\t\t\t\t\t\trevert: true,\n\t\t\t\t\t\ttolerance: 'pointer',\n\t\t\t\t\t\tcursor: 'move',\n\t\t\t\t\t\thelper: function (e, ui) {\n\t\t\t\t\t\t\t//while dragging helper elements td element will take width as contents width\n\t\t\t\t\t\t\t//so we are explicitly saying that it has to be same width so that element will not\n\t\t\t\t\t\t\t//look like disturbed\n\t\t\t\t\t\t\tui.children().each(function (index, element) {\n\t\t\t\t\t\t\t\telement = jQuery(element);\n\t\t\t\t\t\t\t\telement.width(element.width());\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\treturn ui;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tupdate: function (e, ui) {\n\t\t\t\t\t\t\tthisInstance.updateSequence();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Update sequences\n\t\t */\n\t\tupdateSequence: function () {\n\t\t\tvar sequences = [];\n\t\t\tthis.getContents()\n\t\t\t\t.find('.js-filter-row')\n\t\t\t\t.each(function (n, row) {\n\t\t\t\t\tvar cvId = $(row).data('cvid');\n\t\t\t\t\tsequences.push(cvId);\n\t\t\t\t});\n\t\t\tapp.saveAjax('upadteSequences', sequences).done(function (data) {\n\t\t\t\tif (data.success) {\n\t\t\t\t\tapp.showNotify({ text: data.result.message, type: 'success' });\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Load list of filter for module\n\t\t * @param {jQuery.Event} e\n\t\t */\n\t\tregisterFilterChange: function (e) {\n\t\t\tvar thisInstance = this;\n\t\t\tvar aDeferred = $.Deferred();\n\t\t\tvar progress = $.progressIndicator({\n\t\t\t\tmessage: app.vtranslate('JS_LOADING_PLEASE_WAIT'),\n\t\t\t\tblockInfo: {\n\t\t\t\t\tenabled: true\n\t\t\t\t}\n\t\t\t});\n\t\t\tvar params = {\n\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\tview: app.getViewName(),\n\t\t\t\tparent: app.getParentModuleName(),\n\t\t\t\tsourceModule: $(e.currentTarget).val()\n\t\t\t};\n\t\t\tAppConnector.requestPjax(params)\n\t\t\t\t.done(function (data) {\n\t\t\t\t\tvar contents = thisInstance.getContents().html(data);\n\t\t\t\t\tthisInstance.makeFilterListSortable(contents);\n\t\t\t\t\tthisInstance\n\t\t\t\t\t\t.getContainer()\n\t\t\t\t\t\t.find('.js-create-filter')\n\t\t\t\t\t\t.data('editurl', contents.find('#js-add-filter-url').val());\n\t\t\t\t\tprogress.progressIndicator({ mode: 'hide' });\n\t\t\t\t\taDeferred.resolve(data);\n\t\t\t\t})\n\t\t\t\t.fail(function (error) {\n\t\t\t\t\taDeferred.reject();\n\t\t\t\t});\n\t\t\treturn aDeferred.promise();\n\t\t},\n\t\tgetContainer: function () {\n\t\t\tif (this.container == false) {\n\t\t\t\tthis.container = jQuery('div.contentsDiv');\n\t\t\t}\n\t\t\treturn this.container;\n\t\t},\n\t\tgetContents: function () {\n\t\t\tif (this.contents == false) {\n\t\t\t\tthis.contents = this.getContainer().find('.indexContents');\n\t\t\t}\n\t\t\treturn this.contents;\n\t\t},\n\t\t/**\n\t\t * Main function\n\t\t */\n\t\tregisterEvents: function () {\n\t\t\tvar container = this.getContainer();\n\t\t\tthis.initEvents(container);\n\t\t\tthis.makeFilterListSortable(container);\n\t\t}\n\t}\n);\n"],"names":["jQuery","Class","container","contents","initEvents","on","e","deleteFilter","updateField","update","registerFilterChange","target","$","currentTarget","editUrl","data","CustomView","thisInstance","closestTrElement","closest","progressIndicator","message","app","vtranslate","blockInfo","enabled","params","cvid","mod","name","attr","value","val","saveAjax","done","getContainer","find","trigger","makeFilterListSortable","tbody","children","length","each","sortable","containment","revert","tolerance","cursor","helper","ui","index","element","width","updateSequence","sequences","getContents","n","row","cvId","push","success","showNotify","text","result","type","aDeferred","Deferred","progress","module","getModuleName","view","getViewName","parent","getParentModuleName","sourceModule","AppConnector","requestPjax","html","mode","resolve","fail","reject","promise","registerEvents"],"mappings":"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"}