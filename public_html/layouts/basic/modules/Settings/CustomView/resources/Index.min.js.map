{"version":3,"file":"Index.min.js","sources":["Index.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\njQuery.Class('Settings_CustomView_Index_Js', {}, {\n\tcontainer: false,\n\tcontents: false,\n\t/**\n\t * Register events\n\t * @param {jQuery} container\n\t */\n\tinitEvents: function (container) {\n\t\tcontainer.on('click', '.js-delete-filter', (e) => {\n\t\t\tthis.deleteFilter(e);\n\t\t});\n\t\tcontainer.on('change', '.js-update-field', (e) => {\n\t\t\tthis.updateField(e);\n\t\t});\n\t\tcontainer.on('click', '.js-update,.js-create-filter', (e) => {\n\t\t\tthis.update(e);\n\t\t});\n\t\tcontainer.on('change', '.js-module-filter', (e) => {\n\t\t\tthis.registerFilterChange(e);\n\t\t});\n\t},\n\t/**\n\t * Load form to edit filter\n\t * @param {jQuery.Event} e\n\t */\n\tupdate: function (e) {\n\t\tvar target = $(e.currentTarget);\n\t\tvar editUrl = target.data('editurl');\n\t\tnew CustomView(editUrl);\n\t},\n\t/**\n\t * Update parameter\n\t * @param {jQuery.Event} e\n\t */\n\tupdateField: function (e) {\n\t\tconst thisInstance = this,\n\t\t\ttarget = $(e.currentTarget),\n\t\t\tclosestTrElement = target.closest('.js-filter-row');\n\t\t$.progressIndicator({\n\t\t\tmessage: app.vtranslate('JS_SAVE_LOADER_INFO'),\n\t\t\tblockInfo: {\n\t\t\t\tenabled: true\n\t\t\t}\n\t\t});\n\t\tconst params = {\n\t\t\tcvid: closestTrElement.data('cvid'),\n\t\t\tmod: closestTrElement.data('mod'),\n\t\t\tname: target.attr('name'),\n\t\t\tvalue: target.val(),\n\t\t};\n\t\tapp.saveAjax('updateField', {}, params).done(function (data) {\n\t\t\tthisInstance.getContainer().find('.js-module-filter').trigger('change');\n\t\t});\n\t},\n\t/**\n\t * Delete filter\n\t * @param {jQuery.Event} e\n\t */\n\tdeleteFilter: function (e) {\n\t\tvar thisInstance = this;\n\t\tvar target = $(e.currentTarget);\n\t\tvar closestTrElement = target.closest('.js-filter-row');\n\t\t$.progressIndicator({\n\t\t\tmessage: app.vtranslate('JS_SAVE_LOADER_INFO'),\n\t\t\tblockInfo: {\n\t\t\t\tenabled: true\n\t\t\t}\n\t\t});\n\t\tapp.saveAjax('delete', {}, {\n\t\t\tcvid: closestTrElement.data('cvid'),\n\t\t}).done(function () {\n\t\t\tthisInstance.getContainer().find('.js-module-filter').trigger('change');\n\t\t});\n\t},\n\t/**\n\t * Function to regiser the event to make the filters sortable\n\t */\n\tmakeFilterListSortable: function (container) {\n\t\tvar thisInstance = this;\n\t\tvar tbody = container.find('tbody');\n\n\t\tif (tbody.children().length > 1) {\n\t\t\ttbody.each(function () {\n\t\t\t\tjQuery(this).sortable({\n\t\t\t\t\tcontainment: 'tbody',\n\t\t\t\t\trevert: true,\n\t\t\t\t\ttolerance: 'pointer',\n\t\t\t\t\tcursor: 'move',\n\t\t\t\t\thelper: function (e, ui) {\n\t\t\t\t\t\t//while dragging helper elements td element will take width as contents width\n\t\t\t\t\t\t//so we are explicitly saying that it has to be same width so that element will not\n\t\t\t\t\t\t//look like disturbed\n\t\t\t\t\t\tui.children().each(function (index, element) {\n\t\t\t\t\t\t\telement = jQuery(element);\n\t\t\t\t\t\t\telement.width(element.width());\n\t\t\t\t\t\t})\n\t\t\t\t\t\treturn ui;\n\t\t\t\t\t},\n\t\t\t\t\tupdate: function (e, ui) {\n\t\t\t\t\t\tthisInstance.updateSequence();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t},\n\t/**\n\t * Update sequences\n\t */\n\tupdateSequence: function () {\n\t\tvar sequences = [];\n\t\tthis.getContents().find('.js-filter-row').each(function (n, row) {\n\t\t\tvar cvId = $(row).data('cvid');\n\t\t\tsequences.push(cvId);\n\t\t});\n\t\tapp.saveAjax('upadteSequences', sequences).done(function (data) {\n\t\t\tif (data.success) {\n\t\t\t\tVtiger_Helper_Js.showPnotify({text: data.result.message, type: 'success'});\n\t\t\t}\n\t\t});\n\t},\n\t/**\n\t * Load list of filter for module\n\t * @param {jQuery.Event} e\n\t */\n\tregisterFilterChange: function (e) {\n\t\tvar thisInstance = this;\n\t\tvar aDeferred = $.Deferred();\n\t\tvar progress = $.progressIndicator({\n\t\t\tmessage: app.vtranslate('JS_LOADING_PLEASE_WAIT'),\n\t\t\tblockInfo: {\n\t\t\t\tenabled: true\n\t\t\t}\n\t\t});\n\t\tvar params = {\n\t\t\tmodule: app.getModuleName(),\n\t\t\tview: app.getViewName(),\n\t\t\tparent: app.getParentModuleName(),\n\t\t\tsourceModule: $(e.currentTarget).val()\n\t\t}\n\t\tAppConnector.requestPjax(params).done(function (data) {\n\t\t\tvar contents = thisInstance.getContents().html(data);\n\t\t\tthisInstance.makeFilterListSortable(contents);\n\t\t\tthisInstance.getContainer().find('.js-create-filter').data('editurl', contents.find('#js-add-filter-url').val());\n\t\t\tprogress.progressIndicator({mode: 'hide'});\n\t\t\taDeferred.resolve(data);\n\t\t}).fail(function (error) {\n\t\t\taDeferred.reject();\n\t\t});\n\t\treturn aDeferred.promise();\n\t},\n\tgetContainer: function () {\n\t\tif (this.container == false) {\n\t\t\tthis.container = jQuery('div.contentsDiv');\n\t\t}\n\t\treturn this.container;\n\t},\n\tgetContents: function () {\n\t\tif (this.contents == false) {\n\t\t\tthis.contents = this.getContainer().find('.indexContents');\n\t\t}\n\t\treturn this.contents;\n\t},\n\t/**\n\t * Main function\n\t */\n\tregisterEvents: function () {\n\t\tvar container = this.getContainer();\n\t\tthis.initEvents(container);\n\t\tthis.makeFilterListSortable(container);\n\t}\n\n});\n"],"names":["jQuery","Class","container","contents","initEvents","on","e","deleteFilter","updateField","update","registerFilterChange","$","currentTarget","editUrl","target","data","closestTrElement","closest","progressIndicator","message","app","vtranslate","blockInfo","enabled","cvid","mod","name","attr","value","val","saveAjax","params","done","thisInstance","getContainer","find","trigger","makeFilterListSortable","tbody","children","length","each","sortable","containment","revert","tolerance","cursor","helper","ui","index","element","width","updateSequence","getContents","n","row","sequences","push","cvId","success","Vtiger_Helper_Js","showPnotify","text","result","type","aDeferred","Deferred","progress","module","getModuleName","view","getViewName","parent","getParentModuleName","sourceModule","requestPjax","html","mode","resolve","fail","reject","promise","registerEvents"],"mappings":"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"}