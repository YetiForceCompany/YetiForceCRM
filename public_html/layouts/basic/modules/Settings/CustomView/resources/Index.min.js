
jQuery.Class("Settings_CustomView_Index_Js",{},{container:false,contents:false,initEvants:function(a){var b=this;a.on("click",".delete",function(c){b.deleteFilter(c)});a.on("switchChange.bootstrapSwitch",".updateField",function(d,c){b.updateField(d,c)});a.on("click",".update,.createFilter",function(c){b.update(c)});a.on("change","#moduleFilter",function(c){b.registerFilterChange(c)})},update:function(c){var b=$(c.currentTarget);var a=b.data("editurl");Vtiger_CustomView_Js.loadFilterView(a)},updateField:function(f){var c=this;var d=$(f.currentTarget);var a=d.closest("tr");var b=$.progressIndicator({message:app.vtranslate("JS_SAVE_LOADER_INFO"),blockInfo:{enabled:true}});var g={cvid:a.data("cvid"),mod:a.data("mod"),name:d.attr("name"),value:d.prop("checked")?1:0,};app.saveAjax("updateField",g).then(function(e){c.getContainer().find("#moduleFilter").trigger("change")})},deleteFilter:function(f){var c=this;var d=$(f.currentTarget);var a=d.closest("tr");var b=$.progressIndicator({message:app.vtranslate("JS_SAVE_LOADER_INFO"),blockInfo:{enabled:true}});app.saveAjax("delete",{cvid:a.data("cvid"),}).then(function(e){c.getContainer().find("#moduleFilter").trigger("change")})},makeFilterListSortable:function(a){var c=this;var b=a.find("tbody");if(b.children().length>1){b.each(function(){jQuery(this).sortable({containment:"tbody",revert:true,tolerance:"pointer",cursor:"move",helper:function(f,d){d.children().each(function(e,g){g=jQuery(g);g.width(g.width())});return d},update:function(f,d){c.updateSequence()}})})}},updateSequence:function(){var a=[];this.getContents().find("tbody tr").each(function(d,c){var b=jQuery(c).data("cvid");a.push(b)});app.saveAjax("upadteSequences",a).then(function(b){if(b.success){Vtiger_Helper_Js.showPnotify({text:b.result.message,type:"success"})}})},registerFilterChange:function(d){var c=this;var a=jQuery.Deferred();var b=$.progressIndicator({message:app.vtranslate("JS_LOADING_PLEASE_WAIT"),blockInfo:{enabled:true}});var f={module:app.getModuleName(),view:app.getViewName(),parent:app.getParentModuleName(),sourceModule:jQuery(d.currentTarget).val()};AppConnector.requestPjax(f).then(function(g){var e=c.getContents().html(g);app.showBtnSwitch(e.find(".switchBtn"));c.makeFilterListSortable(e);c.getContainer().find(".createFilter").data("editurl",e.find("#addFilterUrl").val());b.progressIndicator({mode:"hide"});a.resolve(g)},function(e){a.reject()});return a.promise()},getContainer:function(){if(this.container==false){this.container=jQuery("div.contentsDiv")}return this.container},getContents:function(){if(this.contents==false){this.contents=this.getContainer().find(".indexContents")}return this.contents},registerEvents:function(){var a=this.getContainer();this.initEvants(a);this.makeFilterListSortable(a)}});