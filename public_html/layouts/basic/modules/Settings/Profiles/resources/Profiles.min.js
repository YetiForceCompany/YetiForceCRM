'use strict';

var Settings_Profiles_Js={initEditView:function b(){function a(a,b){var c=jQuery(b.handle);c.hasClass('mini-slider-control')||(c=c.closest('.mini-slider-control'));var d=jQuery('[data-range-input="'+c.data('range')+'"]');d.val(b.value),c.attr('data-value',b.value);}jQuery('[data-module-state]').on('change',function(a){var b=jQuery(a.currentTarget),c=b.data('value'),d=b.closest('tr');b.prop('checked')?(jQuery('[data-action-state]',d).prop('checked',!0),jQuery('[data-handlerfor]',d).removeAttr('disabled')):(jQuery('[data-action-state]',d).prop('checked',!1),jQuery('[data-handlerfor]',d).attr('disabled','disabled'),jQuery('[data-togglecontent="'+c+'-fields"]').hide(),jQuery('[data-togglecontent="'+c+'-tools"]').hide());}),jQuery('[data-action-state]').on('change',function(a){var b=jQuery(a.currentTarget),c=b.closest('tr'),d=!!b.prop('checked');('EditView'==b.data('action-state')||'Delete'==b.data('action-state'))&&d&&(jQuery('[data-action-state="DetailView"]',c).prop('checked',!0),jQuery('[data-module-state]',c).prop('checked',!0),jQuery('[data-handlerfor]',c).removeAttr('disabled')),'DetailView'==b.data('action-state')&&(d?(jQuery('[data-module-state]',c).prop('checked',!0),jQuery('[data-handlerfor]',c).removeAttr('disabled')):(jQuery('[data-action-state]',c).prop('checked',!1),jQuery('[data-module-state]',c).prop('checked',!1).trigger('change')));}),jQuery('#mainAction1CheckBox,#mainAction2CheckBox, #mainAction7CheckBox').on('change',function(a){var b=jQuery(a.currentTarget),c=!!b.prop('checked');c&&(jQuery('#mainAction4CheckBox').prop('checked',!0),jQuery('#mainModulesCheckBox').prop('checked',!0),jQuery('.modulesCheckBox').prop('checked',!0),jQuery('.action4CheckBox').prop('checked',!0),jQuery('[data-handlerfor]').removeAttr('disabled'));}),jQuery('[data-togglehandler]').on('click',function(a){var b=jQuery(a.currentTarget),c=jQuery('[data-togglecontent="'+b.data('togglehandler')+'"]'),d=c.closest('tr');b.find('[data-fa-i2svg]').hasClass('fa-chevron-down')?(d.removeClass('d-none'),c.slideDown('slow'),b.find('[data-fa-i2svg]').removeClass('fa-chevron-down').addClass('fa-chevron-up')):(c.slideUp('slow',function(){d.addClass('d-none');}),b.find('.fa-chevron-up').removeClass('fa-chevron-up').addClass('fa-chevron-down'));}),jQuery('[data-range]').each(function(b,c){c=jQuery(c);var d=c.data('value');c.slider({min:0,max:2,value:d,disabled:c.data('locked'),slide:a});}),jQuery('[data-range]').find('a').css('filter','');},registerSelectAllModulesEvent:function g(){var a=jQuery('.modulesCheckBox'),b=jQuery('#mainAction4CheckBox'),c=jQuery('#mainAction1CheckBox'),d=jQuery('#mainAction2CheckBox'),f=jQuery('#mainAction7CheckBox'),e=jQuery('#mainModulesCheckBox');e.on('change',function(g){var e=jQuery(g.currentTarget);e.is(':checked')?(a.prop('checked',!0),b.prop('checked',!0),c.show().prop('checked',!0),d.show().prop('checked',!0),f.show().prop('checked',!0),a.trigger('change')):(a.prop('checked',!1),a.trigger('change'),b.prop('checked',!1),c.prop('checked',!1),d.prop('checked',!1),f.prop('checked',!1));}),a.on('change',function(){Settings_Profiles_Js.checkSelectAll(a,e),Settings_Profiles_Js.checkSelectAll(jQuery('.action4CheckBox'),b),Settings_Profiles_Js.checkSelectAll(jQuery('.action1CheckBox'),c),Settings_Profiles_Js.checkSelectAll(jQuery('.action2CheckBox'),d),Settings_Profiles_Js.checkSelectAll(jQuery('.action7CheckBox'),f);});},registerSelectAllViewActionsEvent:function d(){var a=jQuery('.action4CheckBox'),b=jQuery('#mainAction4CheckBox'),c=jQuery('#mainModulesCheckBox');b.on('change',function(a){var b=jQuery(a.currentTarget);b.is(':checked')?(c.prop('checked',!0),c.trigger('change')):(c.prop('checked',!1),c.trigger('change'));}),a.on('change',function(){Settings_Profiles_Js.checkSelectAll(a,b);});},registerSelectAllEditActionsEvent:function c(){var a=jQuery('.action1CheckBox'),b=jQuery('#mainAction1CheckBox');b.on('change',function(b){var c=jQuery(b.currentTarget);c.is(':checked')?a.prop('checked',!0):a.prop('checked',!1);}),b.on('change',function(){Settings_Profiles_Js.checkSelectAll(a,b);});},registerSelectAllDeleteActionsEvent:function c(){var a=jQuery('.action2CheckBox'),b=jQuery('#mainAction2CheckBox');b.on('change',function(b){var c=jQuery(b.currentTarget);c.is(':checked')?a.prop('checked',!0):a.prop('checked',!1);}),a.on('change',function(){Settings_Profiles_Js.checkSelectAll(a,b);});},registerSelectAllCreateActionsEvent:function c(){var a=jQuery('.action7CheckBox'),b=jQuery('#mainAction7CheckBox');b.on('change',function(b){var c=jQuery(b.currentTarget);c.is(':checked')?a.prop('checked',!0):a.prop('checked',!1);}),a.on('change',function(){Settings_Profiles_Js.checkSelectAll(a,b);});},checkSelectAll:function d(a,b){var c=!0;return 'undefined'!=typeof a&&'undefined'!=typeof b&&void(a.each(function(a,b){return jQuery(b).is(':checked')?void(c=!0):(c=!1,!1)}),!0==c?b.prop('checked',!0):b.prop('checked',!1))},performSelectAllActionsOnLoad:function a(){0<jQuery('[data-module-unchecked]').length&&jQuery('#mainModulesCheckBox').prop('checked',!1),0>=jQuery('[data-action4-unchecked]').length&&jQuery('#mainAction4CheckBox').prop('checked',!0),0>=jQuery('[data-action1-unchecked]').length&&jQuery('#mainAction1CheckBox').prop('checked',!0),0<jQuery('[data-action2-unchecked]').length&&jQuery('#mainAction2CheckBox').prop('checked',!1);},registerSubmitEvent:function c(){var a=this,b=jQuery('[name="EditProfile"]');b.on('submit',function(c){var d=b.find('button[type="submit"]');if(d.attr('disabled',!0),progressIndicatorInstance=jQuery.progressIndicator({position:'html',blockInfo:{enabled:!0}}),'true'==b.data('submit')&&'true'==b.data('performCheck'))return !0;if(0>=b.data('jqv').InvalidFields.length){var e=b.serializeFormData();a.checkDuplicateName({profileName:e.profilename,profileId:e.record}).done(function(){b.data('submit','true'),b.data('performCheck','true'),b.submit();}).fail(function(a){progressIndicatorInstance.progressIndicator({mode:'hide'}),d.attr('disabled',!1);var b={};return b.text=a.message,b.type='error',Settings_Vtiger_Index_Js.showMessage(b),!1});}else progressIndicatorInstance.progressIndicator({mode:'hide'}),d.attr('disabled',!1),b.removeData('submit'),app.formAlignmentAfterValidation(b);c.preventDefault();});},checkDuplicateName:function f(a){var b=a.profileName,c=a.profileId,d=jQuery.Deferred(),e={module:app.getModuleName(),parent:app.getParentModuleName(),action:'EditAjax',mode:'checkDuplicate',profilename:b,record:c};return AppConnector.request(e).done(function(a){var b=a.result,c=b.success;!0==c?d.reject(b):d.resolve(b);}).fail(function(a,b){d.reject(a,b);}),d.promise()},registerGlobalPermissionActionsEvent:function c(){var a=jQuery('[name="editall"]').filter(':checkbox'),b=jQuery('[name="viewall"]').filter(':checkbox');a.is(':checked')&&b.attr('readonly','readonly'),b.on('change',function(a){var b=jQuery(a.currentTarget);if('readonly'==b.attr('readonly')){var c=jQuery(a.currentTarget).is(':checked');c?jQuery(a.currentTarget).prop('checked',!1):jQuery(a.currentTarget).prop('checked',!0),a.preventDefault();}}),a.on('change',function(a){var c=jQuery(a.currentTarget);c.is(':checked')?(b.prop('checked','checked'),b.attr('readonly','readonly')):b.removeAttr('readonly');});},registerEvents:function a(){Settings_Profiles_Js.initEditView(),Settings_Profiles_Js.registerSelectAllModulesEvent(),Settings_Profiles_Js.registerSelectAllViewActionsEvent(),Settings_Profiles_Js.registerSelectAllCreateActionsEvent(),Settings_Profiles_Js.registerSelectAllEditActionsEvent(),Settings_Profiles_Js.registerSelectAllDeleteActionsEvent(),Settings_Profiles_Js.performSelectAllActionsOnLoad(),Settings_Profiles_Js.registerSubmitEvent(),Settings_Profiles_Js.registerGlobalPermissionActionsEvent();}};jQuery(document).ready(function(){Settings_Profiles_Js.registerEvents();});
