'use strict';

Settings_Vtiger_List_Js('Settings_MappedFields_List_Js',{},{getListContainer:function a(){return jQuery('#listViewContainer')},registerFilterChangeEvent:function b(){var a=this;jQuery('#moduleFilter').on('change',function(b){jQuery('#pageNumber').val('1'),jQuery('#pageToJump').val('1'),jQuery('#orderBy').val(''),jQuery('#sortOrder').val('');var c={module:app.getModuleName(),parent:app.getParentModuleName(),sourceModule:jQuery(b.currentTarget).val()};jQuery('#recordsCount').val(''),jQuery('#totalPageCount').text(''),a.getListViewRecords(c).done(function(){a.updatePagination(),a.registerBasic();});});},registerRowClickEvent:function b(){var a=this.getListViewContentContainer();a.on('click','.listViewEntries td:not(.tdActions)',function(a){var b=jQuery(a.currentTarget).parent().find('.[data-fa-i2svg]').closest('a').attr('href');window.location.href=b;});},getDefaultParams:function e(){var a=jQuery('#pageNumber').val(),b=app.getModuleName(),c=app.getParentModuleName(),d={module:b,parent:c,page:a,view:'List',sourceModule:jQuery('#moduleFilter').val()};return d},registerAddNewTemplate:function b(a){jQuery('#addButton',a).on('click',function(){var a=jQuery('#moduleFilter option:selected').val();window.location.href=jQuery(this).data('url')+(a?'&source_module='+a:'');});},registerImportTemplate:function c(a){var b=this;jQuery('#importButton',a).on('click',function(a){var c=jQuery(a.currentTarget),d=c.data('url');'undefined'!=typeof d&&app.showModalWindow(null,d,function(a){var c=a.find('form');c.validationEngine(app.validationEngineOptions),c.on('submit',function(a){var c=jQuery(a.currentTarget),d=c.data('jqv').InvalidFields;if(0<d.length)return void c.removeData('submit');var e=jQuery.progressIndicator({position:'html',blockInfo:{enabled:!0}});b.importSave(c).done(function(a){app.hideModalWindow(),e.progressIndicator({mode:'hide'}),Settings_Vtiger_Index_Js.showMessage({text:a.result.message,type:'info'}),jQuery('#moduleFilter').trigger('change');}).fail(function(){}),a.preventDefault();});}),a.stopPropagation();});},importSave:function d(a){var b=jQuery.Deferred(),c=new FormData(a[0]);if('undefined'!=typeof file&&(c.append('imported_xml',file),file=!1),c){AppConnector.request({url:'index.php',type:'POST',data:c,processData:!1,contentType:!1}).done(function(a){b.resolve(a);}).fail(function(a,c){b.reject(a,c);});}return b.promise()},registerDeleteMap:function b(){var a=this;this.getListContainer().find('.deleteMap').each(function(){jQuery(this).on('click',function(b){b.stopPropagation(),b.preventDefault();var c=jQuery(this).closest('tr').data('id');Settings_MappedFields_List_Js.deleteById(c).done(function(){a.registerBasic();});});});},registerBasic:function a(){this.registerDeleteMap();},registerEvents:function b(){this._super();var a=this.getListContainer();this.registerFilterChangeEvent(),this.registerAddNewTemplate(a),this.registerImportTemplate(a),this.registerBasic();}});
