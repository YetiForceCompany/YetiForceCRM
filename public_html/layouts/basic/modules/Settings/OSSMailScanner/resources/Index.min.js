'use strict';

jQuery.Class("Settings_OSSMailScanner_Index_Js",{},{registerColorField:function c(a){var b={};b.tags=!0,b.templateSelection=function(a){var b=a.id,c=b.split("@"),d=a.text;return c[0]||(d=$("<span class=\"domain\">"+a.text+"</span>")),d},App.Fields.Picklist.showSelect2ElementView(a,b);},registerEditFolders:function b(a){a.find(".editFolders").on("click",function(){var a="index.php?module=OSSMailScanner&parent=Settings&view=Folders&record="+$(this).data("user"),b=jQuery.progressIndicator({message:app.vtranslate("LBL_LOADING_LIST_OF_FOLDERS"),position:"html",blockInfo:{enabled:!0}});app.showModalWindow("",a,function(a){b.progressIndicator({mode:"hide"}),app.showScrollBar(a.find(".modal-body"),{height:app.getScreenHeight(70)+"px"}),a.find("[name=\"saveButton\"]").on("click",function(){var b={};a.find("select").each(function(){var a=$(this),c=a.val();null==c&&(c=[]),b[a.attr("name")]=c;});var c={module:"OSSMailScanner",parent:"Settings",action:"SaveAjax",mode:"updateFolders",user:a.find(".modal-body").data("user"),folders:b};AppConnector.request(c).done(function(a){var b=a.result;if(b.success){var c={text:b.message,type:"info"};Vtiger_Helper_Js.showPnotify(c);}else{var c={text:b.message};Vtiger_Helper_Js.showPnotify(c);}app.hideModalWindow();});});});});},registerEvents:function c(){var a=this,b=jQuery(".contentsDiv");a.registerColorField($("#exceptions select")),a.registerEditFolders(b),$("#exceptions select").on("select2:select",function(b){var c=b.params.data.id;if(!!a.domainValidateToExceptions(c)||!!a.email_validate(c))a.saveWidgetConfig(jQuery(this).attr("name"),jQuery(this).val().join(),"exceptions"),a.registerColorField(jQuery(this));else{jQuery(this).find("option[value='"+c+"']").remove(),jQuery(this).trigger("change");var d={text:app.vtranslate("JS_mail_error"),type:"error"};Vtiger_Helper_Js.showPnotify(d);}}).on("select2:unselect",function(){a.saveWidgetConfig(jQuery(this).attr("name"),jQuery(this).val(),"exceptions");}),$("#status").on("change",function(){$("#confirm").attr("disabled",!this.checked);}),jQuery(".conftabChangeTicketStatus").on("click",function(){return "1"!=$(this).data("active")&&void($(".conftabChangeTicketStatus").data("active",0),$(this).data("active",1),AppConnector.request({async:!0,data:{module:"OSSMailScanner",action:"SaveRcConfig",ct:"emailsearch",type:"changeTicketStatus",vale:$(this).val()}}).done(function(a){if(a.success){var b={text:a.result.data,type:"info"};Vtiger_Helper_Js.showPnotify(b);}},function(){}))}),jQuery(".delate_accont").on("click",function(){if(window.confirm(app.vtranslate("whether_remove_an_identity"))){var a={},b=jQuery(this).data("user-id");a.data={module:"OSSMailScanner",action:"AccontRemove",id:b},a.async=!0,AppConnector.request(a).done(function(a){var c={text:a.result.data,type:"info"};Vtiger_Helper_Js.showPnotify(c),jQuery("#row_account_"+b).hide();},function(){});}}),jQuery(".identities_del").on("click",function(){var a=this;if(window.confirm(app.vtranslate("whether_remove_an_identity"))){var b={};b.data={module:"OSSMailScanner",action:"IdentitiesDel",id:jQuery(this).data("id")},b.async=!0,AppConnector.request(b).done(function(){var b={text:app.vtranslate("removed_identity"),type:"info"};Vtiger_Helper_Js.showPnotify(b),jQuery(a).parent().parent().remove();},function(){});}}),jQuery(".expand-hide").on("click",function(){var a=jQuery(this).data("user-id"),b=jQuery("tr[data-user-id=\""+a+"\"]");"none"==b.css("display")?b.show():b.hide();}),$(".alert").alert(),jQuery("select[id^='function_list_']").on("change",function(){a.saveActions(jQuery(this).data("user-id"),jQuery(this).val());}),jQuery("select[id^='user_list_']").on("change",function(){a.saveCRMuser(jQuery(this).data("user"),jQuery(this).val());}),jQuery("#email_search").on("change",function(){a.saveEmailSearchList(jQuery("#email_search").val());}),jQuery("#tab_email_view_widget_limit").on("blur",function(){a.saveWidgetConfig("widget_limit",jQuery(this).val(),"email_list");}),jQuery("#tab_email_view_open_window").on("change",function(){a.saveWidgetConfig("target",jQuery(this).val(),"email_list");}),jQuery("[name=\"email_to_notify\"]").on("blur",function(){var b=jQuery(this).val();if(!!a.email_validate(b))a.saveWidgetConfig("email",b,"cron");else{var c={text:app.vtranslate("JS_mail_error"),type:"error"};Vtiger_Helper_Js.showPnotify(c);}}),jQuery("[name=\"time_to_notify\"]").on("blur",function(){var b=jQuery(this).val();if(!!a.number_validate(b))a.saveWidgetConfig("time",jQuery(this).val(),"cron");else{var c={text:app.vtranslate("JS_time_error"),type:"error"};Vtiger_Helper_Js.showPnotify(c);}});},saveActions:function c(a,b){AppConnector.request({module:"OSSMailScanner",action:"SaveActions",userid:a,vale:b}).done(function(a){var b=a.result;if(b.success){var c={text:b.data,type:"info"};Vtiger_Helper_Js.showPnotify(c);}else{var c={text:b.data};Vtiger_Helper_Js.showPnotify(c);}});},saveCRMuser:function c(a,b){AppConnector.request({module:"OSSMailScanner",action:"SaveCRMuser",userid:a,value:b}).done(function(a){var b=a.result;if(b.success){var c={text:b.data,type:"info"};Vtiger_Helper_Js.showPnotify(c);}else{var c={text:b.data};Vtiger_Helper_Js.showPnotify(c);}});},isEmpty:function b(a){return !a?"":a},saveEmailSearchList:function b(a){AppConnector.request({module:"OSSMailScanner",action:"SaveEmailSearchList",vale:a}).done(function(a){var b=a.result;if(b.success){var c={text:b.data,type:"info"};Vtiger_Helper_Js.showPnotify(c);}else{var c={text:b.data};Vtiger_Helper_Js.showPnotify(c);}});},domainValidateToExceptions:function c(a){var b=/^@([a-zA-Z0-9.-]+\.)+[a-zA-Z0-9.-]{2,63}$/;return b.test(a)},email_validate:function c(a){var b=/^[a-zA-Z0-9._-]+@([a-zA-Z0-9.-]+\.)+[a-zA-Z0-9.-]{2,63}$/;return b.test(a)},number_validate:function c(a){var b=!/^\s*$/.test(a)&&!isNaN(a);return b},saveWidgetConfig:function d(a,b,c){AppConnector.request({module:"OSSMailScanner",action:"SaveWidgetConfig",conf_type:c,name:a,value:b}).done(function(a){var b=a.result;if(b.success){var c={text:b.data,type:"info"};Vtiger_Helper_Js.showPnotify(c);}else{var c={text:b.data};Vtiger_Helper_Js.showPnotify(c);}});}});
