'use strict';

Settings_Vtiger_List_Js('Settings_CronTasks_List_Js',{triggerEditEvent:function b(a){AppConnector.request(a).done(function(a){app.showModalWindow(a),jQuery('#cronJobSaveAjax').validationEngine(app.validationEngineOptions);var b=Settings_CronTasks_List_Js.getInstance();b.registerSaveEvent();});}},{getListViewRecords:function d(){var a=this,b={module:app.getModuleName(),parent:app.getParentModuleName(),view:'List'},c=jQuery.progressIndicator({position:'html',blockInfo:{enabled:!0}});AppConnector.request(b).done(function(b){jQuery('#listViewContents').html(b),a.registerSortableEvent(),c.progressIndicator({mode:'hide'});});},registerSaveEvent:function b(){var a=this;jQuery('#cronJobSaveAjax').on('submit',function(b){var c=jQuery(b.currentTarget),d=c.validationEngine('validate');if(!0==d){var e=jQuery('#time_format').val(),f=jQuery('#frequencyValue');if('hours'==e)var g=60*(60*f.val());else g=60*f.val();var h=app.vtranslate('JS_VALUE_SHOULD_NOT_BE_LESS_THAN'),i=jQuery('#minimumFrequency').val(),j=app.vtranslate('JS_MINUTES');if(g<i)return f.validationEngine('showPrompt',h+' '+i/60+' '+j,'error'),void b.preventDefault();jQuery('#frequency').val(g);var k=c.serializeFormData();AppConnector.request(k).done(function(b){'undefined'!=typeof b.result&&!0==b.result[0]&&(app.hideModalWindow(),a.getListViewRecords());});}b.preventDefault();});},registerSortableEvent:function d(){var a=this,b={},c=jQuery('tbody',jQuery('.listViewEntriesTable'));c.sortable({helper:function c(a,b){return b.children().each(function(a,b){b=jQuery(b),b.width(b.width());}),b},containment:c,revert:!0,update:function d(){jQuery('tbody tr').each(function(a){b[++a]=jQuery(this).data('id');});var c={sequencesList:JSON.stringify(b),module:app.getModuleName(),parent:app.getParentModuleName(),action:'UpdateSequence'};AppConnector.request(c).done(function(){a.getListViewRecords();});}});},registerEvents:function a(){this.registerSortableEvent();}});
