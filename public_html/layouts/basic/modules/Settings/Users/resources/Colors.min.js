var Colors_Js={initEvants:function(){$(".UserColors .updateColor").click(Colors_Js.updateColor);$(".UserColors .generateColor").click(Colors_Js.generateColor);$(".UserColors .activeColor").click(Colors_Js.activeColor);$(".UserColors .addPicklistColorColumn").click(Colors_Js.addPicklistColorColumn);$(".UserColors .updatePicklistValueColor").click(Colors_Js.updatePicklistValueColor);$(".UserColors .generatePicklistValueColor").click(Colors_Js.generatePicklistValueColor)},updateColor:function(f){var g=$(f.currentTarget);var a=g.closest("tr");var c=g.closest("table");var j=jQuery(".UserColors .editColorContainer");var h=j.clone(true,true);var d=g.data("metod");var i=$("#calendarColorPreview"+g.data("type")+g.data("id"));var b=function(e){e.find(".editColorContainer").removeClass("hide").show();var l=e.find(".selectedColor");l.val(i.data("color"));var k={flat:true,color:i.data("color"),onChange:function(m,o,n){l.val("#"+o);i.data("color","#"+o)}};if(typeof customParams!="undefined"){k=jQuery.extend(k,customParams)}e.find(".calendarColorPicker").ColorPicker(k);e.find('[name="saveButton"]').click(function(n){var m=$.progressIndicator({message:app.vtranslate("JS_LOADING_PLEASE_WAIT"),blockInfo:{enabled:true}});Colors_Js.registerSaveEvent(d,{color:l.val(),id:g.data("id"),fieldId:g.data("fieldid"),fieldValueId:g.data("fieldvalueid"),table:a.data("table"),field:c.data("fieldname")});i.css("background",l.val());g.data("color",l.val());m.progressIndicator({mode:"hide"});app.hideModalWindow()})};app.showModalWindow(h,function(e){if(typeof b=="function"){b(e)}},{width:"1000px"})},generateColor:function(f){var d=$(f.currentTarget);var b=d.closest("table");var c=d.data("metod");var a=$("#calendarColorPreview"+d.data("type")+d.data("id"));var g={module:app.getModuleName(),action:"SaveAjax",mode:"generateColor",params:{id:d.data("id"),fieldId:d.data("fieldid"),fieldValueId:d.data("fieldvalueid"),color:a.data("color"),table:d.data("table"),field:b.data("fieldname"),mode:c}};AppConnector.request(g).then(function(h){var e=h.result;var i={text:e.message,animation:"show",type:"success"};a.css("background",e.color);a.data("color",e.color);Vtiger_Helper_Js.showPnotify(i)},function(h,e){})},registerSaveEvent:function(c,a){var b={};b.data={module:app.getModuleName(),action:"SaveAjax",mode:c,params:a};b.async=false;b.dataType="json";AppConnector.request(b).done(function(e){var d=e.result;var f={text:d.message,animation:"show",type:"success"};Vtiger_Helper_Js.showPnotify(f);return d},function(e,d){})},activeColor:function(c){var b=$(c.currentTarget);var a=$("#calendarColorPreview"+b.data("type")+b.data("id"));var d={};d.data={module:app.getModuleName(),action:"SaveAjax",mode:"activeColor",params:{status:b.is(":checked"),color:a.data("color"),id:b.data("id")}};d.async=false;d.dataType="json";AppConnector.request(d).done(function(f){var e=f.result;var g={text:e.message,animation:"show",type:"success"};Vtiger_Helper_Js.showPnotify(g);a.css("background",e.color);a.data("color",e.color)})},registerModuleTabEvent:function(){jQuery("#picklistsColorsTab").on("click",function(b){var a=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});AppConnector.request({module:"Users",parent:app.getParentModuleName(),view:"ColorsAjax",mode:"getPickListView"}).then(function(d){var c=jQuery(".picklistViewContentDiv");c.html(d);a.progressIndicator({mode:"hide"});app.changeSelectElementView(jQuery(".pickListModulesSelectContainer"));Colors_Js.registerModuleChangeEvent();c.find(".modulePickList").trigger("change")})})},registerModuleChangeEvent:function(){var a=jQuery(".picklistViewContentDiv");a.find(".pickListModules").on("change",function(d){var b=jQuery(d.currentTarget).val();if(b.length<=0){Settings_Vtiger_Index_Js.showMessage({type:"error",text:app.vtranslate("JS_PLEASE_SELECT_MODULE")})}var c=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});AppConnector.request({module:"Users",parent:app.getParentModuleName(),source_module:b,view:"ColorsAjax",mode:"getPickListView"}).then(function(e){a.html(e);c.progressIndicator({mode:"hide"});app.changeSelectElementView(jQuery(".pickListModulesSelectContainer"));app.changeSelectElementView(jQuery(".pickListModulesPicklistSelectContainer"));Colors_Js.registerModuleChangeEvent();Colors_Js.registerModulePickListChangeEvent();jQuery("#modulePickList").trigger("change")})})},registerModulePickListChangeEvent:function(){var a=jQuery(".picklistViewContentDiv");a.find(".modulePickList").on("change",function(c){var b=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});AppConnector.request({module:"Users",parent:app.getParentModuleName(),source_module:jQuery("#pickListModules").val(),view:"ColorsAjax",mode:"getPickListView",fieldId:jQuery(c.currentTarget).val()}).then(function(d){a.html(d);app.changeSelectElementView(jQuery(".pickListModulesSelectContainer"));app.changeSelectElementView(jQuery(".pickListModulesPicklistSelectContainer"));Colors_Js.registerModuleChangeEvent();Colors_Js.registerModulePickListChangeEvent();Colors_Js.initEvants();b.progressIndicator({mode:"hide"})})})},registerEvents:function(){Colors_Js.registerModuleTabEvent();Colors_Js.registerModuleChangeEvent();Colors_Js.registerModulePickListChangeEvent();Colors_Js.initEvants()},addPicklistColorColumn:function(c){var a=jQuery(".picklistViewContentDiv");var b=$(c.currentTarget);AppConnector.request({module:"Picklist",parent:"Settings",action:"SaveAjax",mode:"addPicklistColorColumn",picklistModule:b.data("fieldmodule"),fieldId:b.data("fieldid")}).then(function(e){var d=e.result;var f={text:d.message,animation:"show",type:"success"};Vtiger_Helper_Js.showPnotify(f);a.find(".modulePickList").trigger("change")})},updatePicklistValueColor:function(h){var b=jQuery(".picklistViewContentDiv");var g=$(h.currentTarget);var a=jQuery(".UserColors .editColorContainer");var c=a.clone(true,true);var f=b.find("#calendarColorPreviewPicklistValue"+g.data("fieldvalueid"));var d=function(e){e.find(".editColorContainer").removeClass("hide").show();var j=e.find(".selectedColor");j.val(f.data("color"));var i={flat:true,color:f.data("color"),onChange:function(k,m,l){j.val("#"+m);f.data("color","#"+m)}};if(typeof customParams!="undefined"){i=jQuery.extend(i,customParams)}e.find(".calendarColorPicker").ColorPicker(i);e.find('[name="saveButton"]').click(function(m){var k=$.progressIndicator({message:app.vtranslate("JS_LOADING_PLEASE_WAIT"),blockInfo:{enabled:true}});var l={};AppConnector.request({module:"Picklist",parent:"Settings",action:"SaveAjax",mode:"updatePicklistValueColor",color:j.val(),fieldId:g.data("fieldid"),fieldValueId:g.data("fieldvalueid")}).then(function(o){var n=o.result;var p={text:n.message,animation:"show",type:"success"};Vtiger_Helper_Js.showPnotify(p);return n},function(o,n){});f.css("background",j.val());g.data("color",j.val());k.progressIndicator({mode:"hide"});app.hideModalWindow()})};app.showModalWindow(c,function(e){if(typeof d=="function"){d(e)}},{width:"1000px"})},generatePicklistValueColor:function(f){var a=jQuery(".picklistViewContentDiv");var d=$(f.currentTarget);var c=a.find("#calendarColorPreviewPicklistValue"+d.data("fieldvalueid"));var b=$.progressIndicator({message:app.vtranslate("JS_LOADING_PLEASE_WAIT"),blockInfo:{enabled:true}});AppConnector.request({module:"Picklist",parent:"Settings",action:"SaveAjax",mode:"updatePicklistValueColor",fieldId:d.data("fieldid"),fieldValueId:d.data("fieldvalueid")}).then(function(g){var e=g.result;var h={text:e.message,animation:"show",type:"success"};c.css("background",e.color);c.data("color",e.color);Vtiger_Helper_Js.showPnotify(h)},function(g,e){});b.progressIndicator({mode:"hide"});app.hideModalWindow()}};$(document).ready(function(){Colors_Js.registerEvents()});