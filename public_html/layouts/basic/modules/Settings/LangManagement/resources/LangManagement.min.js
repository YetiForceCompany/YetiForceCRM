'use strict';

var Settings_Index_Js={initEvants:function a(){$('.LangManagement .add_lang').on('click',Settings_Index_Js.ShowLangMondal),$('.LangManagement .edit_lang a').on('click',function(){jQuery('#edit_lang').html(''),document.showDiff=!1,Settings_Index_Js.LoadEditLang(this);}),$('.AddNewLangMondal .btn-primary').on('click',Settings_Index_Js.AddLangMondal),$('.AddNewTranslationMondal .btn-primary').on('click',Settings_Index_Js.AddTranslationMondal),$('#lang_list tr').each(function(a,b){b=$(b),Settings_Index_Js.initEvant(b);});},LoadEditLang:function f(a){var b=jQuery(a),c=b.attr('href');'undefined'==typeof c&&(c='#'+b.attr('id'));var d=$.progressIndicator({message:app.vtranslate('LBL_Loader'),position:c,blockInfo:{enabled:!0}}),e={module:'LangManagement',parent:app.getParentModuleName(),view:'Edit'};$('.LangManagement '+c+' #langs_list').val()!=null&&(e.lang=$('.LangManagement '+c+' #langs_list').val()),$('.LangManagement #mods_list').val()!=null&&(e.mod=$('.LangManagement '+c+' #mods_list').val()),!0==document.showDiff&&(e.sd=1),AppConnector.request(e).done(function(a){jQuery(c).html(a),Settings_Index_Js.initEditLang(c),d.progressIndicator({mode:'hide'});});},initEditLang:function b(a){element=$('.LangManagement .layoutContent .active #langs_list'),App.Fields.Picklist.changeSelectElementView(element,'selectize',{plugins:['remove_button']}).on('change',function(a){a=jQuery(this).closest('.active'),Settings_Index_Js.LoadEditLang(a);}),App.Fields.Picklist.changeSelectElementView($('.LangManagement .layoutContent .active #mods_list'),'select2').on('change',function(a){a=jQuery(this).closest('.active'),Settings_Index_Js.LoadEditLang(a);}),$('#edit_lang .translation').on('change',function(b){Settings_Index_Js.changeTranslation(b,a);}),$('#edit_lang .js-add-translation').on('click',Settings_Index_Js.ShowTranslationMondal),$('#edit_lang .js-delete').on('click',function(b){Settings_Index_Js.deleteTranslation(b,a);}),$('.LangManagement '+a+' .show_differences').on('click',Settings_Index_Js.ShowDifferences),$.extend($.fn.dataTable.defaults,{searching:!0,ordering:!1,bFilter:!1,bLengthChange:!1,bPaginate:!1,bInfo:!1,pageLength:-1,language:{sZeroRecords:app.vtranslate('No matching records found'),sSearch:app.vtranslate('Search'),sEmptyTable:app.vtranslate('No data available in table')}}),$(''+a+' .listViewEntriesTable').dataTable();},ShowDifferences:function b(a){$(a.currentTarget);document.showDiff=!!$(this).is(':checked'),a=$(this).closest('.active'),Settings_Index_Js.LoadEditLang(a);},changeTranslation:function g(a,b,c){var d=$(a.currentTarget);'undefined'==typeof a.currentTarget&&(d=jQuery(a));var e=d.closest('tr'),f=$.progressIndicator({message:app.vtranslate('LBL_Loader'),position:b,blockInfo:{enabled:!0}});c==null&&(c=jQuery('.LangManagement '+b+' #mods_list').data('target')?jQuery('.LangManagement '+b+' #mods_list').data('target'):jQuery('.LangManagement '+b+' #mods_list').val()),Settings_Index_Js.registerSaveEvent('saveTranslation',{lang:d.data('lang'),mod:c,type:d.data('type'),variable:e.data('langkey'),val:d.val(),is_new:d.hasClass('empty_value')}),d.removeClass('empty_value'),f.progressIndicator({mode:'hide'});},deleteTranslation:function g(a,b){var c=$(a.currentTarget);'undefined'==typeof a.currentTarget&&(c=a);var d=c.closest('tr'),f=$.progressIndicator({message:app.vtranslate('LBL_Loader'),position:b,blockInfo:{enabled:!0}});Settings_Index_Js.registerSaveEvent('deleteTranslation',{lang:$('.LangManagement #langs_list').val(),mod:$('.LangManagement '+b+' #mods_list').data('target')?$('.LangManagement '+b+' #mods_list').data('target'):$('.LangManagement '+b+' #mods_list').val(),langkey:d.data('langkey'),type:d.data('type')}),f.progressIndicator({mode:'hide'}),a=c.closest('.active'),Settings_Index_Js.LoadEditLang(a);},initEvant:function d(a){var b={title:app.vtranslate('LBL_AreYouSure'),trigger:'manual',placement:'left',html:!0,content:'<div class="popover_block"><button class="btn btn-danger deleteItem marginLeft10">'+app.vtranslate('LBL_YES')+'</button>   <button class="btn btn-warning pull-right cancel">'+app.vtranslate('Cancel')+'</button></div>'},c={title:app.vtranslate('JS_ARE_YOU_SURE_TO_SET_AS_DEFAULT'),trigger:'manual',placement:'left',html:!0,content:'<div class="popover_block"><button class="btn btn-danger setDefaultItem">'+app.vtranslate('LBL_YES')+'</button>   <button class="btn btn-warning pull-right cancel">'+app.vtranslate('Cancel')+'</button></div>'};a.find('#deleteItemC').on('click',function(c){$(c.currentTarget).popover(b).popover('show'),$('.popover_block .deleteItem').on('click',function(){Settings_Index_Js.DeleteLang(a,c),$(c.currentTarget).popover('hide');}),$('.popover_block .cancel').on('click',function(){$(c.currentTarget).popover('hide');});}),a.find('#setAsDefault').on('click',function(b){$(b.currentTarget).popover(c).popover('show'),$('.popover_block .setDefaultItem').on('click',function(){$(b.currentTarget).popover('hide'),Settings_Index_Js.setAsDefaultLang(a,b);}),$('.popover_block .cancel').on('click',function(){$(b.currentTarget).popover('hide');});});},ShowLangMondal:function d(a){var b=$(a.currentTarget),c=$('.AddNewLangMondal').clone(!0,!0);app.showModalWindow($(c)),$(c).css('z-index','9999999');},ShowTranslationMondal:function e(a){var b=$('.LangManagement #langs_list').val(),c='',d=$('.AddNewTranslationMondal').clone(!0,!0);d.find('input[name="langs"]').val(JSON.stringify(b)),$.each(b,function(a){c+='<div class="form-group"><label class="col-md-4 col-form-label">'+b[a]+':</label><div class="col-md-8"><input name="'+b[a]+'" class="form-control" type="text" /></div></div>';}),d.find('.add_translation_block').html(c);$(a.currentTarget);app.showModalWindow($(d)),$(d).css('z-index','9999999');},AddLangMondal:function f(a){var b=$(a.currentTarget),c=b.closest('.modalContainer'),d=Settings_Index_Js.registerSaveEvent('add',{type:'Add',label:c.find('input[name=\'label\']').val(),name:c.find('input[name=\'name\']').val(),prefix:c.find('input[name=\'prefix\']').val()});if(d.resp){$('#lang_list table tbody').append('<tr data-prefix="'+d.params.prefix+'"><td>'+d.params.label+'</td><td>'+d.params.name+'</td><td>'+d.params.prefix+'</td><td><a href="index.php?module=LangManagement&parent=Settings&action=Export&lang='+d.params.prefix+'" class="btn btn-primary btn-xs marginLeft10">'+app.vtranslate('JS_EXPORT')+'</a> <button class="btn btn-success btn-xs marginLeft10" data-toggle="confirmation" id="setAsDefault">'+app.vtranslate('JS_DEFAULT')+'</button> <button class="btn btn-danger btn-xs" data-toggle="confirmation" data-original-title="" id="deleteItemC">'+app.vtranslate('Delete')+'</button></td></tr>');var e=$('#lang_list tr[data-prefix='+d.params.prefix+']');Settings_Index_Js.initEvant(e),c.find('.AddNewLangMondal').modal('hide'),$('.AddNewLangMondal input[name=\'label\']').val(''),$('.AddNewLangMondal input[name=\'name\']').val(''),$('.AddNewLangMondal input[name=\'prefix\']').val('');}},AddTranslationMondal:function e(a){var b=$(a.currentTarget),c=b.closest('.modalContainer'),d=Settings_Index_Js.registerSaveEvent('addTranslation',$.extend({mod:$('.LangManagement #mods_list').val()},c.find('.AddTranslationForm').serializeFormData()));d.resp&&c.find('.AddNewTranslationMondal').modal('hide'),Settings_Index_Js.LoadEditLang(jQuery('#edit_lang')),a.preventDefault();},DeleteLang:function b(a){Settings_Index_Js.registerSaveEvent('delete',{prefix:a.data('prefix')}),a.hide();},setAsDefaultLang:function f(a,b){var c=Settings_Index_Js.registerSaveEvent('setAsDefault',{prefix:a.data('prefix')});$(b.currentTarget).closest('td').find('#deleteItemC').remove(),$(b.currentTarget).remove();var d=c.result.prefixOld,e=a.closest('tbody');OldTrDefaultLang=e.find('tr[data-prefix="'+d+'"]'),OldTrDefaultLang.find('td:last').prepend('<button class="btn btn-danger marginLeftZero" data-toggle="confirmation" data-original-title="" id="deleteItemC">'+app.vtranslate('Delete')+'</button> <button class="btn btn-primary marginLeftZero" data-toggle="confirmation" id="setAsDefault">'+app.vtranslate('JS_DEFAULT')+'</button>'),Settings_Index_Js.initEvant(OldTrDefaultLang);},registerSaveEvent:function f(a,b){var c='',d='',e={};return e.data={module:app.getModuleName(),parent:app.getParentModuleName(),action:'SaveAjax',mode:a},e.data=$.extend(e.data,b),e.async=!1,e.dataType='json',AppConnector.request(e).done(function(a){c=a.result;var b={text:c.message?c.message:app.vtranslate('JS_ERROR')};!0==c.success&&(b.type='info'),Vtiger_Helper_Js.showPnotify(b),d=c.success;}),{resp:d,params:e.data.params,result:c}},registerStats:function b(){var a=this;jQuery('.showStats').on('click',function(){var b={},c=jQuery('[name="langs"]').val();b.data={module:app.getModuleName(),parent:app.getParentModuleName(),action:'GetChart',langBase:jQuery('[name="langs_basic"]').val(),langs:c},AppConnector.request(b).done(function(b){var c=b.result;c.success&&0!==c.data.length&&a.showStats(c.data,c.modules);});});},showStats:function m(a,b){var c=this,d='<div class="col-md-12"><div class="panel panel-default"><div class="panel-body">',e=0,f=[];for(var g in b)for(var h in b[g]){if(1==a[h].length){e+=a[h][0];continue}var i=a[h][0];for(var j in e+=i,delete a[h][0],d+='<div class="row moduleRow" data-module="'+h+'"><label class="col-md-3 form-control-plaintext col-form-label mt-2">'+b[g][h]+': </label><div class="form-control-plaintext col-md-9">',a[h]){'undefined'==typeof f[j]&&(f[j]=0),f[j]+=a[h][j].length;var k=100*a[h][j].length/i;d+='<button class="btn btn-xs btn-primary" data-lang="'+j+'"> '+jQuery('select option[value="'+j+'"]').text()+' - '+k.toFixed(2)+'% </button>&nbsp;';}d+='</div></div>';}d+='</div></div></div>',this.getDataCharts(f,e);var l=jQuery('.statsData').html(d);app.showScrollBar(l.find('.panel-body'),{height:'400px',railVisible:!0}),c.registerStatsEvent();},registerStatsEvent:function b(){var a=this;jQuery('.statsData .btn').on('click',function(b){var c=$.progressIndicator({position:'html',blockInfo:{enabled:!0}}),d=jQuery(b.currentTarget),e=d.closest('.moduleRow'),f='index.php?module='+app.getModuleName()+'&parent='+app.getParentModuleName()+'&view=GetLabels&langBase='+jQuery('[name="langs_basic"]').val()+'&lang='+d.data('lang')+'&sourceModule='+e.data('module');app.showModalWindow(null,f,function(b){c.progressIndicator({mode:'hide'}),b.find('button:not(.close)').on('click',function(b){var c=jQuery(b.currentTarget),d=c.closest('tr').find('input');a.changeTranslation(d,'html',d.data('mod'));});});});},getDataCharts:function i(a,b){var c=1,d=[],e={labels:[],datasets:[{data:d,backgroundColor:[],datalabels:{font:{weight:'bold'},color:'white',anchor:'end',align:'start'}}]};for(var f in a){var g=100*a[f]/b,h=jQuery('select option[value="'+f+'"]').text();d.push(Math.round(100*g)/100),e.datasets[0].backgroundColor.push(App.Fields.Colors.getRandomColor()),e.labels.push(h),++c;}0<d.length&&(jQuery('.widgetData').val(JSON.stringify(e)),this.showCharts());},showCharts:function b(){var a=Vtiger_Widget_Js.getInstance(jQuery('.chartBlock'),'Bar');a.init(jQuery('.chartBlock')),a.loadChart({scales:{xAxes:[{ticks:{minRotation:0}}]}});},registerEvents:function a(){Settings_Index_Js.initEvants(),this.registerStats();}};$(document).ready(function(){document.showDiff=!1,Settings_Index_Js.registerEvents();});
