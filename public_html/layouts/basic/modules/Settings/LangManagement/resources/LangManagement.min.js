'use strict';

/* {[The file is published on the basis of YetiForce Public License 5.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */"use strict";var Settings_Index_Js={initEvants:function initEvants(){var container=$(".LangManagement");container.find(".add_lang").on("click",Settings_Index_Js.ShowLangMondal),container.find(".edit_lang a").on("click",function(){jQuery("#edit_lang").html(""),document.showDiff=!1,Settings_Index_Js.LoadEditLang(this);}),container.find(".js-add-languages-modal").on("click",function(){var progressIndicatorElement=$.progressIndicator({position:"html",blockInfo:{enabled:!0}});app.showModalWindow(null,"index.php?module=YetiForce&parent=Settings&view=DownloadLanguageModal",function(){progressIndicatorElement.progressIndicator({mode:"hide"});});}),$(".AddNewLangMondal .btn-primary").on("click",Settings_Index_Js.AddLangMondal),$(".AddNewTranslationMondal .btn-primary").on("click",Settings_Index_Js.AddTranslationMondal),$("#lang_list tr").each(function(index,element){element=$(element),Settings_Index_Js.initEvant(element);}),this.registerUpdateLanguageBtn(container);},registerUpdateLanguageBtn:function registerUpdateLanguageBtn(container){container.find(".js-update").on("click",function(e){var icon=$(e.target).find(".js-update__icon"),progress=$.progressIndicator({message:app.vtranslate("JS_LOADING_PLEASE_WAIT"),blockInfo:{enabled:!0}});icon.addClass("fa-spin"),AppConnector.request({module:"YetiForce",parent:"Settings",action:"DownloadLanguage",prefix:$(e.target).data("prefix")}).done(function(data){app.showNotify({text:data.result.message,type:data.result.type}),"success"===data.result.type?location.reload():(progress.progressIndicator({mode:"hide"}),icon.removeClass("fa-spin"));});});},LoadEditLang:function LoadEditLang(e){var element=jQuery(e),position=element.attr("href");"undefined"==typeof position&&(position="#"+element.attr("id"));var progress=$.progressIndicator({message:app.vtranslate("LBL_Loader"),position:position,blockInfo:{enabled:!0}}),param={module:"LangManagement",parent:app.getParentModuleName(),view:"Edit"};$(".LangManagement "+position+" #langs_list").val()!=null&&(param.lang=$(".LangManagement "+position+" #langs_list").val()),$(".LangManagement #mods_list").val()!=null&&(param.mod=$(".LangManagement "+position+" #mods_list").val()),!0==document.showDiff&&(param.sd=1),AppConnector.request(param).done(function(data){jQuery(position).html(data),Settings_Index_Js.initEditLang(position),progress.progressIndicator({mode:"hide"});});},initEditLang:function initEditLang(position){App.Fields.Picklist.changeSelectElementView($(".LangManagement .layoutContent .active .select2"),"select2").on("change",function(e){e=jQuery(this).closest(".active"),Settings_Index_Js.LoadEditLang(e);}),$("#edit_lang .translation").on("change",function(e){Settings_Index_Js.changeTranslation(e,position);}),$("#edit_lang .js-add-translation").on("click",Settings_Index_Js.ShowTranslationMondal),$("#edit_lang .js-delete").on("click",function(e){Settings_Index_Js.deleteTranslation(e,position);}),$(".LangManagement "+position+" .show_differences").on("click",Settings_Index_Js.ShowDifferences),$.extend($.fn.dataTable.defaults,{searching:!0,ordering:!1,bFilter:!1,bLengthChange:!1,bPaginate:!1,bInfo:!1,pageLength:-1,language:{sZeroRecords:app.vtranslate("No matching records found"),sSearch:app.vtranslate("Search"),sEmptyTable:app.vtranslate("No data available in table")}}),$(""+position+" .listViewEntriesTable").dataTable();},ShowDifferences:function ShowDifferences(e){document.showDiff=!!$(this).is(":checked"),e=$(this).closest(".active"),Settings_Index_Js.LoadEditLang(e);},changeTranslation:function changeTranslation(e,position,mod){var target=$(e.currentTarget);"undefined"==typeof e.currentTarget&&(target=jQuery(e));var closestTrElement=target.closest("tr"),progress=$.progressIndicator({message:app.vtranslate("LBL_Loader"),position:position,blockInfo:{enabled:!0}});mod==null&&(mod=jQuery(".LangManagement "+position+" #mods_list").data("target")?jQuery(".LangManagement "+position+" #mods_list").data("target"):jQuery(".LangManagement "+position+" #mods_list").val()),Settings_Index_Js.registerSaveEvent("saveTranslation",{lang:target.data("lang"),mod:mod,type:target.data("type"),variable:closestTrElement.data("langkey"),val:target.val(),is_new:target.hasClass("empty_value")}),target.removeClass("empty_value"),progress.progressIndicator({mode:"hide"});},deleteTranslation:function deleteTranslation(e,position){var target=$(e.currentTarget);"undefined"==typeof e.currentTarget&&(target=e);var closestTrElement=target.closest("tr"),progress=$.progressIndicator({message:app.vtranslate("LBL_Loader"),position:position,blockInfo:{enabled:!0}});Settings_Index_Js.registerSaveEvent("deleteTranslation",{lang:$(".LangManagement #langs_list").val(),mod:$(".LangManagement "+position+" #mods_list").data("target")?$(".LangManagement "+position+" #mods_list").data("target"):$(".LangManagement "+position+" #mods_list").val(),langkey:closestTrElement.data("langkey"),type:closestTrElement.data("type")}),progress.progressIndicator({mode:"hide"}),e=target.closest(".active"),Settings_Index_Js.LoadEditLang(e);},initEvant:function initEvant(element){var options={title:app.vtranslate("LBL_AreYouSure"),trigger:"manual",placement:"left",html:!0,sanitize:!1,content:"<div class=\"popover_block\"><button type=\"button\" role=\"button\" class=\"btn btn-danger deleteItem marginLeft10\">"+app.vtranslate("LBL_YES")+"</button> <button type=\"button\"  role=\"button\" class=\"btn btn-warning pull-right cancel\">"+app.vtranslate("Cancel")+"</button></div>"},makeSureOptions={title:app.vtranslate("JS_ARE_YOU_SURE_TO_SET_AS_DEFAULT"),trigger:"manual",placement:"left",html:!0,sanitize:!1,content:"<div class=\"popover_block\"><button type=\"button\" role=\"button\" class=\"btn btn-danger setDefaultItem\">"+app.vtranslate("LBL_YES")+"</button>   <button type=\"button\" role=\"button\" class=\"btn btn-warning pull-right cancel\">"+app.vtranslate("Cancel")+"</button></div>"};element.find("#deleteItemC").on("click",function(e){$(e.currentTarget).popover(options).popover("show"),$(".popover_block .deleteItem").on("click",function(){Settings_Index_Js.DeleteLang(element,e),$(e.currentTarget).popover("hide");}),$(".popover_block .cancel").on("click",function(){$(e.currentTarget).popover("hide");});}),element.find("#setAsDefault").on("click",function(e){$(e.currentTarget).popover(makeSureOptions).popover("show"),$(".popover_block .setDefaultItem").on("click",function(){$(e.currentTarget).popover("hide");var saveEvent=Settings_Index_Js.registerSaveEvent("setAsDefault",{prefix:element.data("prefix")});saveEvent.resp&&window.location.reload();}),$(".popover_block .cancel").on("click",function(){$(e.currentTarget).popover("hide");});});},ShowLangMondal:function ShowLangMondal(){var cloneModal=$(".AddNewLangMondal").clone(!0,!0);app.showModalWindow($(cloneModal));},ShowTranslationMondal:function ShowTranslationMondal(){var langs_list=$(".LangManagement #langs_list").val(),langs_fields="",cloneModal=$(".AddNewTranslationMondal").clone(!0,!0);cloneModal.find("input[name=\"langs\"]").val(JSON.stringify(langs_list)),$.each(langs_list,function(key){langs_fields+="<div class=\"form-group\"><label class=\"col-md-4 col-form-label\">"+langs_list[key]+":</label><div class=\"col-md-8\"><input name=\""+langs_list[key]+"\" class=\"form-control\" type=\"text\" /></div></div>";}),cloneModal.find(".add_translation_block").html(langs_fields),app.showModalWindow($(cloneModal)),$(cloneModal).css("z-index","9999999");},AddLangMondal:function AddLangMondal(e){var currentTarget=$(e.currentTarget),container=currentTarget.closest(".modalContainer"),SaveEvent=Settings_Index_Js.registerSaveEvent("add",{type:"Add",label:container.find("input[name='label']").val(),name:container.find("input[name='name']").val(),prefix:container.find("input[name='prefix']").val()});SaveEvent.resp&&window.location.reload();},AddTranslationMondal:function AddTranslationMondal(e){var currentTarget=$(e.currentTarget),container=currentTarget.closest(".modalContainer"),SaveEvent=Settings_Index_Js.registerSaveEvent("addTranslation",$.extend({mod:$(".LangManagement #mods_list").val()},container.find(".AddTranslationForm").serializeFormData()));SaveEvent.resp&&container.find(".AddNewTranslationMondal").modal("hide"),Settings_Index_Js.LoadEditLang(jQuery("#edit_lang")),e.preventDefault();},DeleteLang:function DeleteLang(closestTrElement){Settings_Index_Js.registerSaveEvent("delete",{prefix:closestTrElement.data("prefix")}),closestTrElement.hide();},registerSaveEvent:function registerSaveEvent(mode,data){var response="",resp="",params={};return params.data={module:app.getModuleName(),parent:app.getParentModuleName(),action:"SaveAjax",mode:mode},params.data=$.extend(params.data,data),params.async=!1,params.dataType="json",AppConnector.request(params).done(function(data){response=data.result;var params={text:response.message?response.message:app.vtranslate("JS_ERROR")};!0==response.success&&(params.type="info"),app.showNotify(params),resp=response.success;}),{resp:resp,params:params.data.params,result:response}},registerStats:function registerStats(){var thisInstance=this;jQuery(".showStats").on("click",function(){var params={},langs=jQuery("[name=\"langs\"]").val();params.data={module:app.getModuleName(),parent:app.getParentModuleName(),action:"GetChart",langBase:jQuery("[name=\"langs_basic\"]").val(),langs:langs},AppConnector.request(params).done(function(data){var response=data.result;response.success&&0!==response.data.length&&thisInstance.showStats(response.data,response.modules);});});},showStats:function showStats(data,modules){var thisInstance=this,container=$(".LangManagement"),html="<div class=\"col-md-12\"><div class=\"panel panel-default\"><div class=\"panel-body col-md-12\">",langStats=0,shortages=[];for(var i in modules)for(var k in modules[i]){if(1==data[k].length){langStats+=data[k][0];continue}var max=data[k][0];for(var q in langStats+=max,delete data[k][0],html+="<div class=\"row moduleRow\" data-module=\""+k+"\"><label class=\"col-md-3 form-control-plaintext col-form-label mt-2\">"+modules[i][k]+": </label><div class=\"form-control-plaintext col-md-9\">",data[k]){"undefined"==typeof shortages[q]&&(shortages[q]=0),shortages[q]+=data[k][q].length;var x=100*data[k][q].length/max;html+="<button class=\"btn btn-xs btn-primary\" data-lang=\""+q+"\"> "+container.find("select option[value=\""+q+"\"]").first().text()+" - "+x.toFixed(2)+"% </button>&nbsp;";}html+="</div></div>";}html+="</div></div></div>",this.getDataCharts(shortages,langStats);var element=container.find(".statsData").html(html);app.showScrollBar(element.find(".panel-body"),{height:"400px",railVisible:!0}),thisInstance.registerStatsEvent();},registerStatsEvent:function registerStatsEvent(){var thisInstance=this;jQuery(".statsData .btn").on("click",function(e){var progress=$.progressIndicator({position:"html",blockInfo:{enabled:!0}}),element=jQuery(e.currentTarget),row=element.closest(".moduleRow"),url="index.php?module="+app.getModuleName()+"&parent="+app.getParentModuleName()+"&view=GetLabels&langBase="+jQuery("[name=\"langs_basic\"]").val()+"&lang="+element.data("lang")+"&sourceModule="+row.data("module");app.showModalWindow(null,url,function(data){progress.progressIndicator({mode:"hide"}),data.find("button:not(.close)").on("click",function(e){var button=jQuery(e.currentTarget),input=button.closest("tr").find("input");thisInstance.changeTranslation(input,"html",input.data("mod"));});});});},getDataCharts:function getDataCharts(shortages,max){var container=$(".LangManagement"),data=[],chartData={labels:[],datasets:[{data:data,backgroundColor:[],datalabels:{font:{weight:"bold"},color:"white",anchor:"end",align:"start"}}]};for(var i in shortages){var x=100*shortages[i]/max,langName=container.find("select option[value=\""+i+"\"]").first().text();data.push(Math.round(100*x)/100),chartData.datasets[0].backgroundColor.push(App.Fields.Colors.getRandomColor()),chartData.labels.push(langName);}0<data.length&&(container.find(".widgetData").val(JSON.stringify(chartData)),this.showCharts());},showCharts:function showCharts(){var instance=Vtiger_Widget_Js.getInstance(jQuery(".chartBlock"),"Bar");instance.init(jQuery(".chartBlock")),instance.loadChart({scales:{xAxes:[{ticks:{minRotation:0}}]}});},registerEvents:function registerEvents(){Settings_Index_Js.initEvants(),this.registerStats();}};jQuery(function(){document.showDiff=!1,Settings_Index_Js.registerEvents();});
//# sourceMappingURL=LangManagement.min.js.map
