'use strict';

jQuery.Class('Settings_CustomRecordNumbering_Js',{},{form:!1,getForm:function a(){return !1==this.form&&(this.form=jQuery('#EditView')),this.form},registerOnChangeEventOfSourceModule:function b(){var a=this.getForm();a.find('[name="sourceModule"]').on('change',function(b){$('.saveButton').removeAttr('disabled'),AppConnector.request({module:app.getModuleName(),parent:app.getParentModuleName(),action:'CustomRecordNumberingAjax',mode:'getModuleCustomNumberingData',sourceModule:$(b.currentTarget).val()}).done(function(b){b&&(a.find('[name="prefix"]').val(b.result.prefix),a.find('[name="reset_sequence"]').val(b.result.reset_sequence).trigger('change'),a.find('[name="postfix"]').val(b.result.postfix),a.find('[name="sequenceNumber"]').val(b.result.sequenceNumber),a.find('[name="sequenceNumber"]').data('oldSequenceNumber',b.result.sequenceNumber));});});},saveModuleCustomNumbering:function j(){if(!$('.saveButton').attr('disabled')){var a=this.getForm(),b=a.find('[name="sourceModule"]').val(),c=a.find('[name="prefix"]'),d=$.trim(c.val()),e=a.find('[name="postfix"]'),f=jQuery.trim(e.val()),g=a.find('[name="sequenceNumber"]'),h=g.val(),i=g.data('oldSequenceNumber');return h<i&&d===c.data('oldPrefix')&&f===e.data('oldPostfix')?void g.validationEngine('showPrompt',app.vtranslate('JS_SEQUENCE_NUMBER_MESSAGE')+' '+i,'error','topLeft',!0):void(a.find('.saveButton').attr('disabled','disabled'),AppConnector.request({module:app.getModuleName(),parent:app.getParentModuleName(),action:'CustomRecordNumberingAjax',mode:'saveModuleCustomNumberingData',sourceModule:b,prefix:d,postfix:f,sequenceNumber:h,reset_sequence:a.find('[name="reset_sequence"]').val()}).done(function(c){!0===c.success?Settings_Vtiger_Index_Js.showMessage({text:app.vtranslate('JS_RECORD_NUMBERING_SAVED_SUCCESSFULLY_FOR')+' '+a.find('option[value="'+b+'"]').text()}):Settings_Vtiger_Index_Js.showMessage({text:d+' '+app.vtranslate(c.error.message),type:'error'});}))}},registerEventToUpdateRecordsWithSequenceNumber:function b(){var a=this.getForm();a.find('[name="updateRecordWithSequenceNumber"]').on('click',function(){var b=a.find('[name="sourceModule"]').val();AppConnector.request({module:app.getModuleName(),parent:app.getParentModuleName(),action:'CustomRecordNumberingAjax',mode:'updateRecordsWithSequenceNumber',sourceModule:b}).done(function(c){!0===c.success?Settings_Vtiger_Index_Js.showMessage({text:app.vtranslate('JS_RECORD_NUMBERING_UPDATED_SUCCESSFULLY_FOR')+' '+a.find('option[value="'+b+'"]').text()}):Settings_Vtiger_Index_Js.showMessage(c.error.message);});});},registerChangeEvent:function a(){this.getForm().find('[name="prefix"],[name="sequenceNumber"],[name="postfix"],[name="reset_sequence"]').on('change',this.checkResetSequence.bind(this));},registerCopyClipboard:function b(a){new ClipboardJS('#customVariableCopy',{text:function b(){return Vtiger_Helper_Js.showPnotify({text:app.vtranslate('JS_NOTIFY_COPY_TEXT'),type:'success'}),'{{'+a.find('#customVariables').val()+'}}'}});},checkResetSequence:function g(){var a=!1,b=this.getForm(),c=b.find('[name="reset_sequence"]').val(),d=b.find('[name="prefix"]').val(),e=b.find('[name="postfix"]').val(),f=b.find('.saveButton');switch(c){case'Y':-1===d.indexOf('{{YY}}')&&-1===d.indexOf('{{YYYY}}')&&-1===e.indexOf('{{YY}}')&&-1===e.indexOf('{{YYYY}}')?(f.attr('disabled','disabled'),Vtiger_Helper_Js.showMessage({type:'error',text:app.vtranslate('JS_RS_ADD_YEAR_VARIABLE')})):(f.removeAttr('disabled'),a=!0);break;case'M':-1===d.indexOf('{{MM}}')&&-1===d.indexOf('{{M}}')&&-1===e.indexOf('{{MM}}')&&-1===e.indexOf('{{M}}')?(f.attr('disabled','disabled'),Vtiger_Helper_Js.showMessage({type:'error',text:app.vtranslate('JS_RS_ADD_MONTH_VARIABLE')})):(f.removeAttr('disabled'),a=!0);break;case'D':-1===d.indexOf('{{DD}}')&&-1===d.indexOf('{{D}}')&&-1===e.indexOf('{{DD}}')&&-1===e.indexOf('{{D}}')?(f.attr('disabled','disabled'),Vtiger_Helper_Js.showMessage({type:'error',text:app.vtranslate('JS_RS_ADD_DAY_VARIABLE')})):(f.removeAttr('disabled'),a=!0);break;case'X':default:f.removeAttr('disabled'),a=!0;}return a},registerEvents:function d(){var a=this,b=this.getForm();this.registerOnChangeEventOfSourceModule(),this.registerEventToUpdateRecordsWithSequenceNumber(),this.registerChangeEvent();var c=app.validationEngineOptions;c.onValidationComplete=function(b,c){return c&&a.saveModuleCustomNumbering(),!1},b.validationEngine('detach'),b.validationEngine('attach',c),this.registerCopyClipboard(b);}}),jQuery(document).ready(function(){var a=new Settings_CustomRecordNumbering_Js;a.registerEvents();});
//# sourceMappingURL=CustomRecordNumbering.min.js.map
