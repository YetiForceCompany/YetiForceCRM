'use strict';

jQuery.Class('Settings_Vtiger_ConfigEditor_Js',{},{saveConfigEditor:function f(a){var b=jQuery.Deferred(),c=a.serializeFormData(),d={};jQuery.each(c,function(a,b){'__vtrftk'===a||(d[a]=b);});var e={module:app.getModuleName(),parent:app.getParentModuleName(),action:'ConfigEditorSaveAjax',updatedFields:JSON.stringify(d)};return AppConnector.request(e).done(function(a){b.resolve(a);}).fail(function(a,c){b.reject(a,c);}),b.promise()},loadContents:function c(a){var b=jQuery.Deferred();return AppConnector.requestPjax(a).done(function(a){b.resolve(a);}).fail(function(){b.reject();}),b.promise()},registerEditViewEvents:function f(){var a=this,b=jQuery('#ConfigEditorForm'),c=b.data('detailUrl');App.Fields.Picklist.showSelect2ElementView(b.find('select.select2'),{dropdownCss:{"z-index":0}});var d=app.validationEngineOptions;d.onValidationComplete=function(b,d){if(d){var e=jQuery.progressIndicator({position:'html',blockInfo:{enabled:!0}});return a.saveConfigEditor(b).done(function(b){var d={};b.success?(d.text=app.vtranslate('JS_CONFIGURATION_DETAILS_SAVED'),a.loadContents(c).done(function(b){e.progressIndicator({mode:'hide'}),jQuery('.contentsDiv').html(b),a.registerDetailViewEvents();})):(e.progressIndicator({mode:'hide'}),d.text=b.error.message,d.type='error'),Settings_Vtiger_Index_Js.showMessage(d);}).fail(function(){e.progressIndicator({mode:'hide'});}),d}},b.validationEngine(d),b.on('submit',function(a){a.preventDefault();});var e=b.find('.cancelLink');e.on('click',function(){var b=jQuery.progressIndicator({position:'html',blockInfo:{enabled:!0}});a.loadContents(c).done(function(c){b.progressIndicator({mode:'hide'}),jQuery('.contentsDiv').html(c),a.registerDetailViewEvents();});});},registerDetailViewEvents:function d(){var a=this,b=jQuery('#ConfigEditorDetails'),c=b.find('.editButton');c.on('click',function(){var b=c.data('url'),d=jQuery.progressIndicator({position:'html',blockInfo:{enabled:!0}});a.loadContents(b).done(function(b){d.progressIndicator({mode:'hide'}),jQuery('.contentsDiv').html(b),a.registerEditViewEvents();}).fail(function(){d.progressIndicator({mode:'hide'});});});},registerEvents:function a(){0<jQuery('#ConfigEditorDetails').length?this.registerDetailViewEvents():this.registerEditViewEvents();}}),jQuery(document).ready(function(){var a=new Settings_Vtiger_ConfigEditor_Js;a.registerEvents();}),Vtiger_WholeNumberGreaterThanZero_Validator_Js('Vtiger_NumberRange5_Validator_Js',{invokeValidation:function d(a){var b=new Vtiger_NumberRange5_Validator_Js;b.setElement(a);var c=b.validate();if(!0!=c)return b.getError()}},{validate:function d(){var a=this._super();if(!0!=a)return a;var b=this.getFieldValue();if(1>b||5<b){var c=app.vtranslate('JS_PLEASE_ENTER_NUMBER_IN_RANGE_1TO5');return this.setError(c),!1}return !0}}),Vtiger_WholeNumberGreaterThanZero_Validator_Js('Vtiger_NumberRange2_Validator_Js',{invokeValidation:function d(a){var b=new Vtiger_NumberRange5_Validator_Js;b.setElement(a);var c=b.validate();if(!0!=c)return b.getError()}},{validate:function d(){var a=this._super();if(!0!=a)return a;var b=this.getFieldValue();if(1>b||2<b){var c=app.vtranslate('JS_PLEASE_ENTER_NUMBER_IN_RANGE_1TO2');return this.setError(c),!1}return !0}}),Vtiger_WholeNumberGreaterThanZero_Validator_Js('Vtiger_NumberRange100_Validator_Js',{invokeValidation:function d(a){var b=new Vtiger_NumberRange100_Validator_Js;b.setElement(a);var c=b.validate();if(!0!=c)return b.getError()}},{validate:function d(){var a=this._super();if(!0!=a)return a;var b=this.getFieldValue();if(1>b||100<b){var c=app.vtranslate('JS_PLEASE_ENTER_NUMBER_IN_RANGE_1TO100');return this.setError(c),!1}return !0}});
