'use strict';

Settings_Vtiger_Edit_Js('Settings_Workflows_Edit_Js',{instance:{}},{currentInstance:!1,workFlowsContainer:!1,init:function a(){this.initiate();},getContainer:function a(){return this.workFlowsContainer},setContainer:function b(a){return this.workFlowsContainer=a,this},getInstance:function b(a){if(a in Settings_Workflows_Edit_Js.instance)return Settings_Workflows_Edit_Js.instance[a];return Settings_Workflows_Edit_Js.instance[a]=new window['Settings_Workflows_Edit'+a+'_Js'],Settings_Workflows_Edit_Js.instance[a]},getStepValue:function b(){var a=this.currentInstance.getContainer();return jQuery('.step',a).val()},initiate:function b(a){'undefined'==typeof a&&(a=jQuery('.workFlowContents')),a.is('.workFlowContents')?this.setContainer(a):this.setContainer(jQuery('.workFlowContents',a)),this.initiateStep('1'),this.currentInstance.registerEvents();},initiateStep:function c(a){this.activateHeader('step'+a);var b=this.getInstance(a);this.currentInstance=b;},activateHeader:function c(a){var b=jQuery('.crumbs ');b.find('.active').removeClass('active'),jQuery('#'+a,b).addClass('active');},registerFormSubmitEvent:function c(a){var b=this;jQuery.isFunction(b.currentInstance.submit)&&a.on('submit',function(a){var c=jQuery(a.currentTarget),d=!0;if(jQuery.isFunction(b.currentInstance.isFormValidate))var d=b.currentInstance.isFormValidate();c.validationEngine('validate')&&d&&b.currentInstance.submit().done(function(a){b.getContainer().append(a);var c=b.getStepValue(),d=parseInt(c)+1;b.initiateStep(d),b.currentInstance.initialize();var e=b.currentInstance.getContainer();b.registerFormSubmitEvent(e),b.currentInstance.registerEvents();}),a.preventDefault();});},back:function h(){var a=this.getStepValue(),b=parseInt(a)-1;this.currentInstance.initialize();var c=this.currentInstance.getContainer(),d=jQuery('[name="record"]',c),e=d.val();c.remove(),this.initiateStep(b);var f=this.currentInstance.getContainer();f.show(),jQuery('[name="record"]',f).val(e);var g=jQuery('#moduleName',f);0<g.length&&''!=e&&g.attr('disabled','disabled').trigger('chosen:updated');},getPopUp:function c(a){var b=this;'undefined'==typeof a&&(a=b.getContainer()),a.on('click','.getPopupUi',function(a){var c=jQuery(a.currentTarget),d=c.val(),e=c.closest('.fieldUiHolder'),f=e.find('[name="valuetype"]').val();''==f&&(f='rawtext');var g=c.closest('.js-conditions-container'),h=c.closest('.js-conditions-row'),i=g.find('.popupUi').clone(!0,!0).removeClass('popupUi').addClass('clonedPopupUi');if(i.find('select').addClass('chzn-select'),i.find('.fieldValue').val(d),c.hasClass('date')){i.find('.textType').find('option[value="rawtext"]').attr('data-ui','input');var j=c.data('date-format');if('rawtext'==f)var k=c.val();else k='';var l='<input type="text" class="dateField fieldValue col-md-4" value="'+k+'" data-date-format="'+j+'" data-input="true" >';i.find('.fieldValueContainer').prepend(l);}else if(c.hasClass('time')){if(i.find('.textType').find('option[value="rawtext"]').attr('data-ui','input'),'rawtext'==f)var k=c.val();else k='';var m='<input type="text" class="timepicker-default fieldValue col-md-4 form-control" value="'+k+'" data-input="true" >';i.find('.fieldValueContainer').prepend(m);}else if(c.hasClass('boolean')){if(i.find('.textType').find('option[value="rawtext"]').attr('data-ui','input'),'rawtext'==f)var k=c.val();else k='';var n='<input type="checkbox" class="fieldValue col-md-4" value="'+k+'" data-input="true" >';i.find('.fieldValueContainer').prepend(n);var d=i.find('.fieldValueContainer input').val();'true:boolean'==k||''==k?i.find('.fieldValueContainer input').attr('checked','checked'):i.find('.fieldValueContainer input').removeAttr('checked');}var o=function(a){a.find('.clonedPopupUi').removeClass('d-none');var c=h.find('[name="modulename"]');if(0<c.length){var d=c.val();a.find('.useFieldElement').addClass('d-none'),a.find('[name="'+d+'"]').removeClass('d-none');}App.Fields.Picklist.changeSelectElementView(a),App.Fields.Date.register(a),app.registerEventForClockPicker(a),b.postShowModalAction(a,f),b.registerChangeFieldEvent(a),b.registerSelectOptionEvent(a),b.registerPopUpSaveEvent(a,e),b.registerRemoveModalEvent(a),a.find('.fieldValue').filter(':visible').trigger('focus'),a.find('[data-close-modal="modal"]').off('click').on('click',function(){jQuery(this).closest('.modal').removeClass('in').css('display','none');});};g.find('.clonedPopUp').html(i),jQuery('.clonedPopupUi').on('shown.bs.modal',function(){'function'==typeof o&&o(jQuery('.clonedPopupUi',g));}),jQuery('.clonedPopUp',g).find('.clonedPopupUi').modal();});},registerRemoveModalEvent:function b(a){a.on('click','.closeModal',function(){a.modal('hide');});},registerPopUpSaveEvent:function c(a,b){jQuery('[name="saveButton"]',a).on('click',function(){var c=jQuery('.textType',a).val();b.find('[name="valuetype"]').val(c);var d=b.find('.getPopupUi');'rawtext'==c?(d.addClass('validate[funcCall[Vtiger_Base_Validator_Js.invokeValidation]]'),d.attr('data-validation-engine','validate[funcCall[Vtiger_Base_Validator_Js.invokeValidation]]')):(d.removeAttr('data-validation-engine'),d.removeClass('validate[funcCall[Vtiger_Base_Validator_Js.invokeValidation]]'));var e=a.find('.fieldValue').filter(':visible').attr('type'),f=a.find('.fieldValue').filter(':visible').val();'checkbox'==e&&(a.find('.fieldValue').filter(':visible').is(':checked')?f='true:boolean':f='false:boolean'),d.val(f),d.validationEngine('hide'),a.remove();});},registerSelectOptionEvent:function b(a){jQuery('.useField,.useFunction',a).on('change',function(b){var c=jQuery(b.currentTarget),d=c.val(),e=a.find('.fieldValue').filter(':visible').val();if(!c.hasClass('useField'))f=e+d;else if(''!=e)var f=e+' '+d;else f=d;a.find('.fieldValue').val(f),c.val('').trigger('chosen:updated');});},registerChangeFieldEvent:function b(a){jQuery('.textType',a).on('change',function(b){var c=jQuery(b.currentTarget).val(),d=jQuery('.useFieldContainer',a),e=jQuery('.useFunctionContainer',a),f=jQuery(b.currentTarget).find('option:selected').data('ui');jQuery('.fieldValue',a).hide(),jQuery('[data-'+f+']',a).show(),'fieldname'==c?(d.removeClass('d-none'),e.addClass('d-none')):'expression'==c?(d.removeClass('d-none'),e.removeClass('d-none')):(d.addClass('d-none'),e.addClass('d-none')),jQuery('.helpmessagebox',a).addClass('d-none'),jQuery('#'+c+'_help',a).removeClass('d-none'),a.find('.fieldValue').val('');});},postShowModalAction:function d(a,b){'fieldname'==b?(jQuery('.useFieldContainer',a).removeClass('d-none'),jQuery('.textType',a).val(b).trigger('chosen:updated')):'expression'==b&&(jQuery('.useFieldContainer',a).removeClass('d-none'),jQuery('.useFunctionContainer',a).removeClass('d-none'),jQuery('.textType',a).val(b).trigger('chosen:updated')),jQuery('#'+b+'_help',a).removeClass('d-none');var c=jQuery('.textType',a).find('option:selected').data('ui');jQuery('.fieldValue',a).hide(),jQuery('[data-'+c+']',a).show();},registerBackStepClickEvent:function c(){var a=this,b=this.getContainer();b.on('click','.backStep',function(){a.back();});},registerEvents:function b(){var a=this.currentInstance.getContainer();this.registerFormSubmitEvent(a),this.registerBackStepClickEvent();}});
