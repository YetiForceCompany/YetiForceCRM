'use strict';

/*+***********************************************************************************
 * The contents of this file are subject to the vtiger CRM Public License Version 1.0
 * ("License"); You may not use this file except in compliance with the License
 * The Original Code is:  vtiger CRM Open Source
 * The Initial Developer of the Original Code is vtiger.
 * Portions created by vtiger are Copyright (C) vtiger.
 * All Rights Reserved.
 *************************************************************************************/"use strict";Settings_Workflows_Edit_Js("Settings_Workflows_Edit2_Js",{},{step2Container:!1,advanceFilterInstance:!1,init:function init(){this.initialize();},/**
		 * Function to get the container which holds all the reports step1 elements
		 * @return jQuery object
		 */getContainer:function getContainer(){return this.step2Container},/**
		 * Function to set the reports step1 container
		 * @params : element - which represents the reports step1 container
		 * @return : current instance
		 */setContainer:function setContainer(element){return this.step2Container=element,this},/**
		 * Function  to intialize the reports step1
		 */initialize:function initialize(container){"undefined"==typeof container&&(container=jQuery("#workflow_step2")),container.is("#workflow_step2")?this.setContainer(container):this.setContainer(jQuery("#workflow_step2"));},calculateValues:function calculateValues(){//handled advanced filters saved values.
var enableFilterElement=jQuery("#enableAdvanceFilters");if(0<enableFilterElement.length&&!1==enableFilterElement.is(":checked"))jQuery("#advanced_filter").val(jQuery("#olderConditions").val());else {jQuery("[name=\"filtersavedinnew\"]").val("6");var advfilterlist=this.advanceFilterInstance.getValues();jQuery("#advanced_filter").val(JSON.stringify(advfilterlist));}},submit:function submit(){var aDeferred=jQuery.Deferred(),form=this.getContainer();this.calculateValues();var formData=form.serializeFormData(),progressIndicatorElement=jQuery.progressIndicator({position:"html",blockInfo:{enabled:!0}});return AppConnector.request(formData).done(function(data){if(form.hide(),data.result){Settings_Vtiger_Index_Js.showMessage({text:app.vtranslate("JS_WORKFLOW_SAVED_SUCCESSFULLY")});var workflowRecordElement=jQuery("[name=\"record\"]",form);""==workflowRecordElement.val()&&workflowRecordElement.val(data.result.id);var params={module:app.getModuleName(),parent:app.getParentModuleName(),view:"Edit",mode:"step3",record:data.result.id};AppConnector.request(params).done(function(data){aDeferred.resolve(data);});}progressIndicatorElement.progressIndicator({mode:"hide"});}),aDeferred.promise()},registerEnableFilterOption:function registerEnableFilterOption(){jQuery("[name=\"conditionstype\"]").on("change",function(e){var advanceFilterContainer=jQuery("#advanceFilterContainer"),currentRadioButtonElement=jQuery(e.currentTarget);currentRadioButtonElement.hasClass("recreate")?currentRadioButtonElement.is(":checked")&&advanceFilterContainer.removeClass("zeroOpacity"):advanceFilterContainer.addClass("zeroOpacity");});},registerEvents:function registerEvents(){var opts=app.validationEngineOptions;// to prevent the page reload after the validation has completed
opts.onValidationComplete=function(form,valid){//returns the valid status
return valid},opts.promptPosition="bottomRight",jQuery("#workflow_step2").validationEngine(opts);var container=this.getContainer();// When you come to step2 we should remove validation for condition values other than rawtwxt
jQuery("button[type=\"submit\"]",container).on("click",function(){for(var fieldUiHolders=jQuery(".fieldUiHolder"),i=0;i<fieldUiHolders.length;i++){var fieldUiHolder=fieldUiHolders[i],fieldValueElement=jQuery(".getPopupUi",fieldUiHolder),valueType=jQuery("[name=\"valuetype\"]",fieldUiHolder).val();"rawtext"!=valueType&&(fieldValueElement.removeAttr("data-validation-engine"),fieldValueElement.removeClass("validate[funcCall[Vtiger_Base_Validator_Js.invokeValidation]]"));}}),App.Fields.Picklist.changeSelectElementView(container),this.advanceFilterInstance=Vtiger_AdvanceFilter_Js.getInstance(jQuery(".filterContainer",container)),this.getPopUp(),"5"==jQuery("[name=\"filtersavedinnew\"]",container).val()&&this.registerEnableFilterOption();}});
//# sourceMappingURL=Edit2.min.js.map
