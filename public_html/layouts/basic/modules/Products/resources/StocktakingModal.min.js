'use strict';

/* {[The file is published on the basis of YetiForce Public License 5.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)descriptor=props[i],descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor);}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}window.Products_StocktakingModal_JS=/*#__PURE__*/function(){function _class(){_classCallCheck(this,_class);}return _createClass(_class,[{key:"showStep",value:/**
	 * Show step by name.
	 * @param {string} name
	 */function showStep(name){this.container.find(".js-step").addClass("d-none"),this.container.find(".js-step[data-step=\"".concat(name,"\"]")).removeClass("d-none");}/**
	 * Register analyze file events.
	 */},{key:"registerAnalyzeFile",value:function registerAnalyzeFile(){var _this=this,form=this.container.find("form");form.validationEngine(app.validationEngineOptions),this.container.find(".js-send-file").on("click",function(){if(form.validationEngine("validate")){var formData=new FormData(form[0]);formData.append("module","Products"),formData.append("action","StocktakingModal"),formData.append("mode","analyzeFile");var progress=$.progressIndicator({position:"html",blockInfo:{enabled:!0}});AppConnector.request({url:"index.php",type:"POST",data:formData,processData:!1,contentType:!1}).done(function(response){_this.showStep("selectColumn"),_this.container.find(".js-encoding").val(response.result.encoding),_this.container.find(".js-count").val(response.result.count),_this.container.find(".js-randomKey").val(response.result.randomKey);var eanField=_this.container.find("#skuColumnSeq"),qtyField=_this.container.find("#qtyColumnSeq");$.each(response.result.column,function(index,value){eanField.append("<option value=\"".concat(index,"\">").concat(value,"</option>")),qtyField.append("<option value=\"".concat(index,"\">").concat(value,"</option>"));}),qtyField.val(1),App.Fields.Picklist.showSelect2ElementView(qtyField),App.Fields.Picklist.showSelect2ElementView(eanField),progress.progressIndicator({mode:"hide"});}).fail(function(){progress.progressIndicator({mode:"hide"}),app.showNotify({text:app.vtranslate("JS_ERROR"),type:"error"});});}});}/**
	 * Register compare stock levels.
	 */},{key:"registerCompare",value:function registerCompare(){var _this2=this,form=this.container.find("form");this.container.find(".js-compare").on("click",function(){var formData=form.serializeFormData();formData.module="Products",formData.action="StocktakingModal",formData.mode="compare";var progress=$.progressIndicator({position:"html",blockInfo:{enabled:!0}});AppConnector.request(formData).done(function(response){_this2.showStep("showCompare"),_this2.container.find(".js-entries-update").val(response.result.update),_this2.container.find(".js-entries-no-update").val(response.result.same),_this2.container.find(".js-entries-not-found").val(response.result.counterNotFound),_this2.container.find(".js-list-entries-not-found").val(response.result.notFound),_this2.toUpdate=response.result.toUpdate,0===response.result.update?_this2.container.find(".js-import").addClass("d-none"):0!=formData.storage&&_this2.container.find(".js-record-name").removeClass("d-none"),progress.progressIndicator({mode:"hide"});}).fail(function(){progress.progressIndicator({mode:"hide"}),app.showNotify({text:app.vtranslate("JS_ERROR"),type:"error"});});});}/**
	 * Register importing stock differences.
	 */},{key:"registerImport",value:function registerImport(){var _this3=this,form=this.container.find("form");this.container.find(".js-import").on("click",function(){var formData=form.serializeFormData();if(0==formData.storage||form.validationEngine("validate")){formData.module="Products",formData.action="StocktakingModal",formData.mode="import",formData.records=_this3.toUpdate;var progress=$.progressIndicator({position:"html",blockInfo:{enabled:!0}});AppConnector.request(formData).done(function(response){_this3.showStep("showSummary"),response.result.product&&(_this3.container.find(".js-imported").removeClass("d-none"),_this3.container.find(".js-imported-counter").val(response.result.product)),response.result.igin&&_this3.container.find(".js-btn-igin").removeClass("d-none").attr("href","index.php?module=IGIN&view=Detail&record="+response.result.igin),response.result.iidn&&_this3.container.find(".js-btn-iidn").removeClass("d-none").attr("href","index.php?module=IIDN&view=Detail&record="+response.result.iidn),(response.result.igin||response.result.iidn)&&_this3.container.find(".js-alert").removeClass("d-none"),progress.progressIndicator({mode:"hide"});}).fail(function(){progress.progressIndicator({mode:"hide"}),app.showNotify({text:app.vtranslate("JS_ERROR"),type:"error"});});}});}/**
	 * Register modal events.
	 * @param {jQuery} modalContainer
	 */},{key:"registerEvents",value:function registerEvents(modalContainer){this.container=modalContainer,this.registerAnalyzeFile(),this.registerCompare(),this.registerImport();}}]),_class}();
//# sourceMappingURL=StocktakingModal.min.js.map
