"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};jQuery.Class("Vtiger_Widget_Js",{widgetPostLoadEvent:"Vtiget.Dashboard.PostLoad",widgetPostRefereshEvent:"Vtiger.Dashboard.PostRefresh",getInstance:function(container,widgetClassName,moduleName){void 0===moduleName&&(moduleName=app.getModuleName());var moduleClass=window[moduleName+"_"+widgetClassName+"_Widget_Js"],fallbackClass=window["Vtiger_"+widgetClassName+"_Widget_Js"],yetiClass=window["YetiForce_"+widgetClassName+"_Widget_Js"],basicClass=YetiForce_Widget_Js;return void 0!==moduleClass?new moduleClass(container,!1,widgetClassName):void 0!==fallbackClass?new fallbackClass(container,!1,widgetClassName):void 0!==yetiClass?new yetiClass(container,!1,widgetClassName):new basicClass(container,!1,widgetClassName)}},{container:!1,plotContainer:!1,chartInstance:!1,chartData:[],paramCache:!1,init:function(container,reload,widgetClassName){container=$(container),this.setContainer(container),this.registerWidgetPostLoadEvent(container),reload||this.registerWidgetPostRefreshEvent(container),this.registerCache(container)},areColorsFromDividingField:function(){return!!Number(this.getContainer().find('[name="colorsFromDividingField"]').val())},getSourceChartType:function(){return this.getContainer().find('[name="typeChart"]').val()},isMultiFilter:function(){return void 0!==this.filterIds&&this.filterIds.length>1},getWidgetData:function(){if(void 0!==this.widgetData)return this.widgetData;var widgetDataEl=this.getContainer().find(".widgetData");return!!widgetDataEl.length&&(this.widgetData=JSON.parse(widgetDataEl.val()))},globalChartFunctions:{scales:{formatAxesLabels:function(value,index,values){return String(value).length>0&&!isNaN(Number(value))?App.Fields.Double.formatToDisplay(value):value}},datalabels:{display:function(context){return!0!==context.chart.getDatasetMeta(context.datasetIndex).hidden},formatter:function(value,context){return void 0!==this.widgetData&&void 0!==this.widgetData.valueType&&"count"===this.widgetData.valueType?App.Fields.Double.formatToDisplay(value,0):void 0!==context.chart.data.datasets[context.datasetIndex].dataFormatted&&void 0!==context.chart.data.datasets[context.datasetIndex].dataFormatted[context.dataIndex]?context.chart.data.datasets[context.datasetIndex].dataFormatted[context.dataIndex]:String(value).length>0&&isNaN(Number(value))?App.Fields.Double.formatToDisplay(value):value}},tooltips:{label:function(tooltipItem,data){return void 0!==data.datasets[tooltipItem.datasetIndex].dataFormatted&&"undefined"!==data.datasets[tooltipItem.datasetIndex].dataFormatted[tooltipItem.index]?data.datasets[tooltipItem.datasetIndex].dataFormatted[tooltipItem.index]:String(data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index]).length>0&&!isNaN(Number(data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index]))?void 0!==this.widgetData&&void 0!==this.widgetData.valueType&&"count"===this.widgetData.valueType?App.Fields.Double.formatToDisplay(data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index],0):App.Fields.Double.formatToDisplay(data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index]):data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index]},title:function(tooltipItems,data){var tooltipItem=tooltipItems[0];return void 0!==data.datasets[tooltipItem.datasetIndex].titlesFormatted&&"undefined"!==data.datasets[tooltipItem.datasetIndex].titlesFormatted[tooltipItem.index]?data.datasets[tooltipItem.datasetIndex].titlesFormatted[tooltipItem.index]:String(data.labels[tooltipItem.index]).length>0&&!isNaN(Number(data.labels[tooltipItem.index]))?void 0!==this.widgetData&&void 0!==this.widgetData.valueType&&"count"===this.widgetData.valueType?App.Fields.Double.formatToDisplay(data.labels[tooltipItem.index],0):App.Fields.Double.formatToDisplay(data.labels[tooltipItem.index]):data.labels[tooltipItem.index]}},legend:{onClick:function(e,legendItem){var type=this.chartInstance.config.type;return void 0!==Chart.defaults[type]?Chart.defaults[type].legend.onClick.apply(this.chartInstance,[e,legendItem]):Chart.defaults.global.legend.onClick.apply(this.chartInstance,[e,legendItem])},generateLabels:function(chart){var type=chart.config.type,labels=void 0;return labels=void 0!==Chart.defaults[type]?Chart.defaults[type].legend.labels.generateLabels(chart):Chart.defaults.global.legend.labels.generateLabels(chart),(this.areColorsFromDividingField()||this.isMultiFilter())&&(chart.config.options.legend.labels.boxWidth=12,labels.forEach((function(label,index){label.fillStyle="rgba(0,0,0,0)",label.strokeStyle="rgba(0,0,0,0.15)"}))),labels},display:function(){return!(!this.isMultiFilter()&&!this.areColorsFromDividingField())}},plugins:{hideVerticalBarDatalabelsIfNeeded:function(chart){for(var datasetsMeta=function(chart){var datasets=[],data=chart.data;if(void 0!==data&&void 0!==data.datasets&&Array.isArray(data.datasets))for(var i=0,len=data.datasets.length;i<len;i++){var meta=chart.getDatasetMeta(i);void 0!==meta.data&&Array.isArray(meta.data)&&datasets.push(meta)}return datasets}(chart),datasets=chart.data.datasets,i=0,len=datasets.length;i<len;i++){var dataset=datasets[i],meta=datasetsMeta[i];if(!meta.hidden){var metaData=meta.data;void 0===dataset._models&&(dataset._models={}),void 0===dataset.datalabels&&(dataset.datalabels={}),void 0===dataset.datalabels.display&&(dataset.datalabels.display=!0);for(var iItem=0,lenItem=metaData.length;iItem<lenItem;iItem++){var dataItem=metaData[iItem];if(void 0!==dataItem.$datalabels&&void 0!==dataItem.$datalabels._model){var model=dataItem.$datalabels._model;if(null!=model)dataset._models[iItem]=model;else{if(null===dataset._models[iItem]||void 0===dataset._models[iItem])return!1;model=dataset._models[iItem]}var labelWidth=model.size.width+model.padding.width+2*model.borderWidth,labelHeight=model.size.height+model.padding.height+2*model.borderWidth,barHeight=dataItem.height(),threshold=10;void 0!==chart.config.options.verticalBarLabelsThreshold&&(threshold=chart.config.options.verticalBarLabelsThreshold),dataItem._view.width+threshold<labelWidth||barHeight+threshold<labelHeight?dataItem.$datalabels._model.positioner=function(){return!1}:dataItem.$datalabels._model=model}}}}},hideHorizontalBarDatalabelsIfNeeded:function(chart){for(var datasetsMeta=function(chart){var datasets=[],data=chart.data;if(void 0!==data&&void 0!==data.datasets&&Array.isArray(data.datasets))for(var i=0,len=data.datasets.length;i<len;i++){var meta=chart.getDatasetMeta(i);void 0!==meta.data&&Array.isArray(meta.data)&&datasets.push(meta)}return datasets}(chart),datasets=chart.data.datasets,i=0,len=datasets.length;i<len;i++){var dataset=datasets[i],meta=datasetsMeta[i];if(!meta.hidden){var metaData=meta.data;void 0===dataset._models&&(dataset._models={}),void 0===dataset.datalabels&&(dataset.datalabels={}),void 0===dataset.datalabels.display&&(dataset.datalabels.display=!0);for(var iItem=0,lenItem=metaData.length;iItem<lenItem;iItem++){var dataItem=metaData[iItem];if(void 0!==dataItem.$datalabels&&void 0!==dataItem.$datalabels._model){var model=dataItem.$datalabels._model;if(null!=model)dataset._models[iItem]=model;else{if(null===dataset._models[iItem]||void 0===dataset._models[iItem])return!1;model=dataset._models[iItem]}var labelWidth=model.size.width+model.padding.width+2*model.borderWidth,labelHeight=model.size.height+model.padding.height+2*model.borderWidth,barWidth=dataItem.width,threshold=10;void 0!==chart.config.options.horizontalBarLabelsThreshold&&(threshold=chart.config.options.horizontalBarLabelsThreshold),dataItem._view.height+threshold<labelHeight||barWidth+threshold<labelWidth?dataItem.$datalabels._model.positioner=function(){return!1}:dataItem.$datalabels._model=model}}}}},fixXAxisLabels:function(chart){var shortenXTicks=function(data,options){return void 0===options.scales&&(options.scales={}),void 0===options.scales.xAxes&&(options.scales.xAxes=[{}]),options.scales.xAxes.forEach((function(axis){void 0===axis.ticks&&(axis.ticks={}),axis.ticks.callback=function(value,index,values){return value.length>13?value.substr(0,10)+"...":value}})),options};chart.data.datasets.forEach((function(dataset,index){if(dataset._updated)return!1;var _loop=function(prop){if(dataset._meta.hasOwnProperty(prop)){for(var i=0,len=dataset._meta[prop].data.length;i<len;i++){var metaDataItem=dataset._meta[prop].data[i],label=metaDataItem._xScale.ticks[i],ctx=metaDataItem._xScale.ctx,categoryWidth=metaDataItem._xScale.width/dataset._meta[prop].data.length;if(void 0!==metaDataItem._xScale.options.categoryPercentage&&(categoryWidth*=metaDataItem._xScale.options.categoryPercentage),categoryWidth<ctx.measureText(label).width){var shortened=label.substr(0,10)+"...";if(categoryWidth<ctx.measureText(shortened).width?(chart.options=(chart.data,void 0===(options=chart.options).scales&&(options.scales={}),void 0===options.scales.xAxes&&(options.scales.xAxes=[{}]),options.scales.xAxes.forEach((function(axis){void 0===axis.ticks&&(axis.ticks={}),axis.ticks.minRotation=90})),options),chart.options=shortenXTicks(chart.data,chart.options)):chart.options=shortenXTicks(chart.data,chart.options),!dataset._updated){dataset._updated=!0,chart.update(),chart.data.datasets.forEach((function(dataset,index){dataset._meta[prop].data.forEach((function(metaDataItem,dataIndex){metaDataItem._view.x=metaDataItem._xScale.getPixelForValue(index,dataIndex),metaDataItem._view.base=metaDataItem._xScale.getBasePixel(),metaDataItem._view.width=metaDataItem._xScale.width/dataset._meta[prop].data.length*metaDataItem._xScale.options.categoryPercentage*metaDataItem._xScale.options.barPercentage}))}));break}}}dataset._updated=!0}var options};for(var prop in dataset._meta)_loop(prop)}))},fixYAxisLabels:function(chart){chart.data.datasets.forEach((function(dataset,index){if(dataset._updated)return!1;var _loop2=function(prop){if(dataset._meta.hasOwnProperty(prop)){for(var i=0,len=dataset._meta[prop].data.length;i<len;i++){if(dataset._meta[prop].data[i]._view.label.length>13&&(chart.options=(chart.data,void 0===(options=chart.options).scales&&(options.scales={}),void 0===options.scales.yAxes&&(options.scales.yAxes=[{}]),options.scales.yAxes.forEach((function(axis){void 0===axis.ticks&&(axis.ticks={}),axis.ticks.callback=function(value,index,values){return value.length>13?value.substr(0,10)+"...":value}})),options),!dataset._updated)){dataset._updated=!0,chart.update(),chart.data.datasets.forEach((function(dataset,index){dataset._meta[prop].data.forEach((function(metaDataItem,dataIndex){void 0!==metaDataItem._xScale&&(metaDataItem._view.x=metaDataItem._xScale.getPixelForValue(index,dataIndex),metaDataItem._view.base=metaDataItem._xScale.getBasePixel(),metaDataItem._view.width=metaDataItem._xScale.width/dataset._meta[prop].data.length*metaDataItem._xScale.options.categoryPercentage*metaDataItem._xScale.options.barPercentage)}))}));break}}dataset._updated=!0}var options};for(var prop in dataset._meta)_loop2(prop)}))}}},getFunctionFromReplacementString:function(replacementStr){var assignResult=!1;"()"===replacementStr.substr(replacementStr.length-2)&&(replacementStr=replacementStr.substr(0,replacementStr.length-2),assignResult=!0);var splitted=replacementStr.split(":");2!==splitted.length&&app.errorLog(new Error("Function replacement string should look like 'function:path.to.fn' not like '"+replacementStr+"'"));var finalFunction=splitted[1].split(".").reduce((function(previous,current){return previous[current]}),this.globalChartFunctions);return"function"!=typeof finalFunction&&app.errorLog(new Error("Global function does not exists: "+splitted[1])),assignResult?finalFunction.call(this):finalFunction.bind(this)},isReplacementString:function(str){return"string"==typeof str&&"function:"===str.substr(0,9)},parseOptionsObject:function(options,original){var afterInit=arguments.length>2&&void 0!==arguments[2]&&arguments[2],result={};for(var propertyName in options){var _value=options[propertyName];afterInit?"_"===propertyName.substr(0,1)?result[propertyName]=_value:Array.isArray(_value)?result[propertyName]=this.parseOptionsArray(_value,original,afterInit):"object"===(void 0===_value?"undefined":_typeof(_value))&&null!==_value?result[propertyName]=this.parseOptionsObject(_value,original,afterInit):result[propertyName]=_value:"_"===propertyName.substr(0,1)?result[propertyName]=_value:this.isReplacementString(_value)?result[propertyName]=this.getFunctionFromReplacementString(_value,afterInit,original):Array.isArray(_value)?result[propertyName]=this.parseOptionsArray(_value,original,afterInit):"object"===(void 0===_value?"undefined":_typeof(_value))&&null!==_value?result[propertyName]=this.parseOptionsObject(_value,original,afterInit):result[propertyName]=_value}return result},parseOptionsArray:function(arr,original){var _this=this,afterInit=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return arr.map((function(item,index){return _this.isReplacementString(item)?_this.getFunctionFromReplacementString(value):Array.isArray(item)?_this.parseOptionsArray(item,original,afterInit):"object"===(void 0===item?"undefined":_typeof(item))&&null!==item?_this.parseOptionsObject(item,original,afterInit):item}))},parseOptions:function(options,original){var afterInit=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Array.isArray(options)?this.parseOptionsArray(options,original,afterInit):"object"===(void 0===options?"undefined":_typeof(options))&&null!==options?this.parseOptionsObject(options,original,afterInit):void app.errorLog(new Error("Unknown options format ["+(void 0===options?"undefined":_typeof(options))+"] - should be object."))},removeStackedFromName:function(chartSubType){var dividedPos=chartSubType.indexOf("Stacked");return dividedPos>0?chartSubType.substr(0,dividedPos):chartSubType},getGlobalDefaultChartsOptions:function(chartSubType,chartData){var options={bar:{basic:{maintainAspectRatio:!1,title:{display:!1},legend:{display:"function:legend.display()"},tooltips:{mode:"point",callbacks:{label:"function:tooltips.label",title:"function:tooltips.title"}},scales:{xAxes:[{ticks:{autoSkip:!1,beginAtZero:!0,maxRotation:90,callback:"function:scales.formatAxesLabels"}}],yAxes:[{ticks:{autoSkip:!1,beginAtZero:!0,callback:"function:scales.formatAxesLabels"}}]}},dataset:{datalabels:{font:{size:11},color:"white",backgroundColor:"rgba(0,0,0,0.2)",borderColor:"rgba(255,255,255,0.2)",borderWidth:2,borderRadius:2,anchor:"center",align:"center",formatter:"function:datalabels.formatter",display:"function:datalabels.display"}},plugins:[{beforeDraw:"function:plugins.fixXAxisLabels"},{beforeDraw:"function:plugins.hideVerticalBarDatalabelsIfNeeded"}]},barStacked:{basic:{maintainAspectRatio:!1,title:{display:!1},legend:{display:"function:legend.display()"},tooltips:{mode:"point",callbacks:{label:"function:tooltips.label",title:"function:tooltips.title"}},scales:{xAxes:[{stacked:!0,ticks:{autoSkip:!1,beginAtZero:!0,maxRotation:90,callback:"function:scales.formatAxesLabels"}}],yAxes:[{stacked:!0,ticks:{autoSkip:!1,beginAtZero:!0,callback:"function:scales.formatAxesLabels"}}]}},dataset:{datalabels:{font:{size:11},color:"white",backgroundColor:"rgba(0,0,0,0.2)",borderColor:"rgba(255,255,255,0.2)",borderWidth:2,borderRadius:2,anchor:"center",align:"center",formatter:"function:datalabels.formatter",display:"function:datalabels.display"}},plugins:[{beforeDraw:"function:plugins.fixXAxisLabels"},{beforeDraw:"function:plugins.hideVerticalBarDatalabelsIfNeeded"}]},horizontalBar:{basic:{maintainAspectRatio:!1,title:{display:!1},legend:{display:"function:legend.display()"},tooltips:{mode:"point",callbacks:{label:"function:tooltips.label",title:"function:tooltips.title"}},scales:{xAxes:[{ticks:{autoSkip:!1,beginAtZero:!0,maxRotation:90,callback:"function:scales.formatAxesLabels"}}],yAxes:[{ticks:{autoSkip:!1,beginAtZero:!0,callback:"function:scales.formatAxesLabels"}}]}},dataset:{datalabels:{font:{size:11},color:"white",backgroundColor:"rgba(0,0,0,0.2)",borderColor:"rgba(255,255,255,0.2)",borderWidth:2,borderRadius:2,anchor:"center",align:"center",formatter:"function:datalabels.formatter",display:"function:datalabels.display"}},plugins:[{beforeDraw:"function:plugins.fixYAxisLabels"},{beforeDraw:"function:plugins.hideHorizontalBarDatalabelsIfNeeded"}]},horizontalBarStacked:{basic:{maintainAspectRatio:!1,title:{display:!1},legend:{display:"function:legend.display()"},tooltips:{mode:"point",callbacks:{label:"function:tooltips.label",title:"function:tooltips.title"}},scales:{xAxes:[{stacked:!0,ticks:{autoSkip:!1,beginAtZero:!0,maxRotation:90,callback:"function:scales.formatAxesLabels"}}],yAxes:[{stacked:!0,ticks:{autoSkip:!1,beginAtZero:!0,callback:"function:scales.formatAxesLabels"}}]}},dataset:{datalabels:{font:{size:11},color:"white",backgroundColor:"rgba(0,0,0,0.2)",borderColor:"rgba(255,255,255,0.2)",borderWidth:2,borderRadius:2,anchor:"center",align:"center",formatter:"function:datalabels.formatter",display:"function:datalabels.display"}},plugins:[{beforeDraw:"function:plugins.fixYAxisLabels"},{beforeDraw:"function:plugins.hideHorizontalBarDatalabelsIfNeeded"}]},line:{basic:{maintainAspectRatio:!1,title:{display:!1},legend:{display:"function:legend.display()"},tooltips:{mode:"point",callbacks:{label:"function:tooltips.label",title:"function:tooltips.title"}},scales:{xAxes:[{ticks:{autoSkip:!1,beginAtZero:!0,maxRotation:90,callback:"function:scales.formatAxesLabels",labelOffset:0}}],yAxes:[{ticks:{autoSkip:!1,beginAtZero:!0,callback:"function:scales.formatAxesLabels"}}]}},dataset:{fill:!1,datalabels:{font:{size:11},color:"white",backgroundColor:"rgba(0,0,0,0.5)",borderColor:"rgba(255,255,255,0.5)",borderWidth:2,borderRadius:2,anchor:"bottom",align:"bottom",formatter:"function:datalabels.formatter",display:"function:datalabels.display"}},plugins:[{beforeDraw:"function:plugins.fixXAxisLabels"}]},lineStacked:{basic:{maintainAspectRatio:!1,title:{display:!1},legend:{display:"function:legend.display()"},tooltips:{mode:"point",callbacks:{label:"function:tooltips.label",title:"function:tooltips.title"}},scales:{xAxes:[{ticks:{autoSkip:!1,beginAtZero:!0,maxRotation:90,callback:"function:scales.formatAxesLabels",labelOffset:0}}],yAxes:[{stacked:!0,ticks:{autoSkip:!1,beginAtZero:!0,callback:"function:scales.formatAxesLabels"}}]}},dataset:{fill:!1,datalabels:{font:{size:11},color:"white",backgroundColor:"rgba(0,0,0,0.5)",borderColor:"rgba(255,255,255,0.5)",borderWidth:2,borderRadius:2,anchor:"bottom",align:"bottom",formatter:"function:datalabels.formatter",display:"function:datalabels.display"}},plugins:[{beforeDraw:"function:plugins.fixXAxisLabels"}]},linePlain:{basic:{maintainAspectRatio:!1,title:{display:!1},legend:{display:"function:legend.display()"},tooltips:{mode:"point",callbacks:{label:"function:tooltips.label",title:"function:tooltips.title"}},scales:{xAxes:[{ticks:{autoSkip:!1,beginAtZero:!0,maxRotation:90,callback:"function:scales.formatAxesLabels",labelOffset:0}}],yAxes:[{ticks:{autoSkip:!1,beginAtZero:!0,callback:"function:scales.formatAxesLabels"}}]}},dataset:{lineTension:0,fill:!1,datalabels:{font:{size:11},color:"white",backgroundColor:"rgba(0,0,0,0.5)",borderColor:"rgba(255,255,255,0.5)",borderWidth:2,borderRadius:2,anchor:"bottom",align:"bottom",formatter:"function:datalabels.formatter",display:"function:datalabels.display"}},plugins:[{beforeDraw:"function:plugins.fixXAxisLabels"}]},linePlainStacked:{basic:{maintainAspectRatio:!1,title:{display:!1},legend:{display:"function:legend.display()"},tooltips:{mode:"point",callbacks:{label:"function:tooltips.label",title:"function:tooltips.title"}},scales:{xAxes:[{ticks:{autoSkip:!1,beginAtZero:!0,maxRotation:90,callback:"function:scales.formatAxesLabels",labelOffset:0}}],yAxes:[{stacked:!0,ticks:{autoSkip:!1,beginAtZero:!0,callback:"function:scales.formatAxesLabels"}}]}},dataset:{fill:!1,lineTension:0,datalabels:{font:{size:11},color:"white",backgroundColor:"rgba(0,0,0,0.5)",borderColor:"rgba(255,255,255,0.5)",borderWidth:2,borderRadius:2,anchor:"bottom",align:"bottom",formatter:"function:datalabels.formatter",display:"function:datalabels.display"}},plugins:[{beforeDraw:"function:plugins.fixXAxisLabels"}]},pie:{basic:{maintainAspectRatio:!1,title:{display:!1},legend:{display:!0,labels:{generateLabels:"function:legend.generateLabels"}},cutoutPercentage:0,layout:{padding:{bottom:12}},tooltips:{mode:"point",callbacks:{label:"function:tooltips.label",title:"function:tooltips.title"}},scales:{}},dataset:{datalabels:{font:{size:11},color:"white",backgroundColor:"rgba(0,0,0,0.5)",borderColor:"rgba(255,255,255,0.5)",borderWidth:2,borderRadius:4,anchor:"end",align:"center",formatter:"function:datalabels.formatter",display:"function:datalabels.display"}},plugins:[]},doughnut:{basic:{maintainAspectRatio:!1,title:{display:!1},legend:{display:!0,onClick:"function:legend.onClick",labels:{generateLabels:"function:legend.generateLabels"}},cutoutPercentage:50,layout:{padding:{bottom:12}},tooltips:{mode:"point",callbacks:{label:"function:tooltips.label",title:"function:tooltips.title"}},scales:{}},dataset:{datalabels:{font:{size:11},color:"white",backgroundColor:"rgba(0,0,0,0.5)",borderColor:"rgba(255,255,255,0.5)",borderWidth:2,borderRadius:4,anchor:"end",align:"center",formatter:"function:datalabels.formatter",display:"function:datalabels.display"}},plugins:[]},funnel:{basic:{maintainAspectRatio:!1,title:{display:!1},legend:{display:!1},sort:"desc",tooltips:{mode:"point",callbacks:{label:"function:tooltips.label",title:"function:tooltips.title"}},scales:{yAxes:[{display:!0,beginAtZero:!0,ticks:{callback:"function:scales.formatAxesLabels"}}]}},dataset:{datalabels:{display:!1}},plugins:[{beforeDraw:"function:plugins.fixYAxisLabels"}]}};if(void 0!==options[chartSubType])return options[chartSubType];var notStackedChartSubType=this.removeStackedFromName(chartSubType);if(void 0!==options[notStackedChartSubType])return options[notStackedChartSubType];app.errorLog(new Error(chartSubType+" chart does not exists!"))},getDefaultBasicOptions:function(chartSubType,chartData){return this.getGlobalDefaultChartsOptions(chartSubType,chartData).basic},getDefaultDatasetOptions:function(chartSubType,chartData){return this.getGlobalDefaultChartsOptions(chartSubType,chartData).dataset},getDefaultPlugins:function(chartSubType,chartData){return this.getGlobalDefaultChartsOptions(chartSubType,chartData).plugins},getContainer:function(){return this.container},setContainer:function(element){return this.container=element,this},isEmptyData:function(){return 0===this.getContainer().find(".widgetData").length||this.getContainer().find(".noDataMsg").length>0},getUserDateFormat:function(){return CONFIG.dateFormat},getChartContainer:function(useCache){return void 0===useCache&&(useCache=!1),!1!==this.plotContainer&&useCache||(this.plotContainer=this.getContainer().find(".widgetChartContainer").find("canvas").get(0)),this.plotContainer},registerRecordsCount:function(){var recordsCountBtn=this.getContainer().find(".recordCount");recordsCountBtn.on("click",(function(){var url=recordsCountBtn.data("url");AppConnector.request(url).done((function(response){recordsCountBtn.find(".count").html(response.result.totalCount),recordsCountBtn.find(".fas").addClass("d-none").attr("aria-hidden",!0),recordsCountBtn.find("a").removeClass("d-none").attr("aria-hidden",!1)}))}))},loadScrollbar:function(){var container=$(this.getChartContainer(!1));if(void 0===container)return!1;var widget=container.closest(".dashboardWidget"),content=widget.find(".dashboardWidgetContent"),footer=widget.find(".dashboardWidgetFooter"),adjustedHeight=widget.innerHeight()-widget.find(".dashboardWidgetHeader").outerHeight();footer.length&&(adjustedHeight-=footer.outerHeight()),content.length&&(content.css("height",adjustedHeight+"px"),content.css("max-height",adjustedHeight+"px"),void 0!==this.scrollbar?this.scrollbar.update():this.scrollbar=app.showNewScrollbar(content,{wheelPropagation:!0}))},restrictContentDrag:function(){this.getContainer().on("mousedown.draggable",(function(e){jQuery(e.target).closest(".dashboardWidgetHeader").length>0||e.stopPropagation()}))},generateData:function(){var jData=this.getContainer().find(".widgetData").val();return void 0===jData?this.chartData=jData:(this.chartData=JSON.parse(jData),this.chartData)},positionNoDataMsg:function(){var widgetContentsContainer=this.getContainer().find(".dashboardWidgetContent");widgetContentsContainer.find(".noDataMsg").position({my:"center center",at:"center center",of:widgetContentsContainer})},printHtml:function(element){var _this2=this,widget=element.closest(".dashboardWidget"),title=widget.find(".dashboardTitle").prop("title"),printContainer=widget.find(".js-print__container").get(0),imgEl=$('<img style="width:100%">');imgEl.get(0).onload=function(){var width=$(printContainer).outerWidth(),height=$(printContainer).outerHeight();width<600&&(width=600),height<400&&(height=400),_this2.printImage(imgEl.get(0),title,width,height)},app.htmlToImage(printContainer,(function(imageBase64){imgEl.get(0).src=imageBase64}))},downloadHtmlAsImage:function(element){var widget=element.closest(".dashboardWidget"),title=widget.find(".dashboardTitle").prop("title");app.htmlToImage(widget.find(".js-print__container").get(0),(function(imageBase64){var anchor=document.createElement("a");anchor.setAttribute("href",imageBase64),anchor.setAttribute("download",title+".png"),anchor.click()}))},postLoadWidget:function(){this.isEmptyData()?this.positionNoDataMsg():this.loadChart(this.options),this.registerSectionClick(),this.registerFilter(),this.registerFilterChangeEvent(),this.restrictContentDrag(),this.registerContentAutoResize(),this.registerWidgetSwitch(),this.registerChangeSorting(),this.registerLoadMore(),this.registerHeaderButtons(),this.loadScrollbar()},postRefreshWidget:function(){this.loadScrollbar(),this.isEmptyData()?this.positionNoDataMsg():this.loadChart(this.options),this.registerSectionClick(),this.registerLoadMore()},setSortingButton:function(currentElement){if(currentElement.length){var drefresh=this.getContainer().find('a[name="drefresh"]'),url=drefresh.data("url");url=(url=url.replace("&sortorder=desc","")).replace("&sortorder=asc",""),url+="&sortorder=";var sortorder="desc",icon="fa-sort-amount-down",iconBase="fa-sort-amount-up";"desc"==currentElement.data("sort")&&(sortorder="asc",icon="fa-sort-amount-up",iconBase="fa-sort-amount-down"),currentElement.data("sort",sortorder),currentElement.attr("title",currentElement.data(sortorder)),currentElement.attr("alt",currentElement.data(sortorder)),url+=sortorder,currentElement.find(".fas").removeClass(iconBase).addClass(icon),drefresh.data("url",url)}},getChartImage:function(){var base64Image=this.chartInstance.toBase64Image(),image=new Image;return image.src=base64Image,image},printImage:function(imgEl,title,width,height){var print=window.open("","PRINT","height="+height+",width="+width);print.document.write("<html><head><title>"+title+"</title>"),print.document.write("</head><body >"),print.document.write($("<div>").append(imgEl).html()),print.document.write("</body></html>"),print.document.close(),print.focus(),setTimeout((function(){print.print(),print.close()}),1e3)},registerHeaderButtons:function(){var _this3=this,container=this.getContainer(),header=container.find(".dashboardWidgetHeader"),downloadWidget=header.find(".downloadWidget");header.find(".printWidget").on("click",(function(e){var imgEl=_this3.getChartImage();_this3.printImage(imgEl,header.find(".dashboardTitle").text(),600,400)})),downloadWidget.on("click",(function(e){var imgEl=$(_this3.getChartImage()),a=$("<a>").attr("href",imgEl.attr("src")).attr("download",header.find(".js-widget__header__title").text()+".png").appendTo(container);a[0].click(),a.remove()})),container.find(".js-widget-quick-create").on("click",(function(e){Vtiger_Header_Js.getInstance().quickCreateModule($(this).data("module-name"))}))},registerChangeSorting:function(){var thisInstance=this,container=this.getContainer();thisInstance.setSortingButton(container.find(".changeRecordSort")),container.find(".changeRecordSort").on("click",(function(e){var drefresh=container.find('a[name="drefresh"]');thisInstance.setSortingButton(jQuery(e.currentTarget)),drefresh.click()}))},registerWidgetSwitch:function(){var thisInstance=this,switchButtons=this.getContainer().find(".dashboardWidgetHeader .js-switch--calculations");thisInstance.setUrlSwitch(switchButtons),switchButtons.on("change",(function(e){var currentElement=$(e.currentTarget),drefresh=currentElement.closest(".dashboardWidgetHeader").find('a[name="drefresh"]');thisInstance.setUrlSwitch(currentElement).done((function(data){data&&drefresh.click()}))}))},setUrlSwitch:function(switchButtons){var aDeferred=jQuery.Deferred();return switchButtons.each((function(index,e){var currentElement=jQuery(e),drefresh=currentElement.closest(".dashboardWidgetHeader").find('a[name="drefresh"]'),url=drefresh.data("url"),urlparams=currentElement.data("urlparams");if(""!==urlparams){var switchUrl=currentElement.data("url-value");url=url.replace("&"+urlparams+"="+switchUrl,""),url+="&"+urlparams+"="+switchUrl,drefresh.data("url",url),aDeferred.resolve(!0)}else aDeferred.reject()})),aDeferred.promise()},getFilterData:function(){return{}},refreshWidget:function(){var parent=this.getContainer(),url=parent.find('a[name="drefresh"]').data("url"),contentContainer=parent.find(".dashboardWidgetContent"),params=url,widgetFilters=parent.find(".widgetFilter");widgetFilters.length>0&&((params={}).url=url,params.data={},widgetFilters.each((function(index,domElement){var widgetFilter=$(domElement),filterName=widgetFilter.attr("name");"checkbox"===widgetFilter.attr("type")?params.data[filterName]=widgetFilter.is(":checked"):params.data[filterName]=widgetFilter.val()})));var additionalWidgetFilters=parent.find(".js-chartFilter__additional-filter-field");additionalWidgetFilters.length>0&&((params={}).url=url,params.data={},additionalWidgetFilters.each((function(index,domElement){var widgetFilter=jQuery(domElement),filterName=widgetFilter.attr("name"),arr=!1;"[]"===filterName.substr(-2)&&(arr=!0,filterName=filterName.substr(0,filterName.length-2),Array.isArray(params.data[filterName])||(params.data[filterName]=[])),"checkbox"===widgetFilter.attr("type")?arr?params.data[filterName].push(widgetFilter.is(":checked")):params.data[filterName]=widgetFilter.is(":checked"):arr?params.data[filterName].push(widgetFilter.val()):params.data[filterName]=widgetFilter.val()})));var refreshContainer=parent.find(".dashboardWidgetContent"),refreshContainerFooter=parent.find(".dashboardWidgetFooter");refreshContainer.html(""),refreshContainerFooter.html(""),refreshContainer.progressIndicator(),this.paramCache&&(additionalWidgetFilters.length||widgetFilters.length||parent.find(".listSearchContributor"))&&this.setFilterToCache(params.url?params.url:params,params.data?params.data:{}),AppConnector.request(params).done((function(data){var footer=(data=$(data)).filter(".widgetFooterContent");refreshContainer.progressIndicator({mode:"hide"}),footer.length&&(footer=footer.clone(!0,!0),refreshContainerFooter.html(footer),data.each((function(n,e){jQuery(this).hasClass("widgetFooterContent")&&data.splice(n,1)}))),contentContainer.html(data).trigger(YetiForce_Widget_Js.widgetPostRefereshEvent)})).fail((function(){refreshContainer.progressIndicator({mode:"hide"})}))},registerFilter:function(){var container=this.getContainer(),search=container.find(".listSearchContributor"),refreshBtn=container.find('a[name="drefresh"]'),originalUrl=refreshBtn.data("url"),selects=container.find(".select2noactive");search.css("width","100%"),search.parent().addClass("w-100"),search.each((function(index,element){var fieldInfo=$(element).data("fieldinfo");$(element).attr("placeholder",fieldInfo.label).data("placeholder",fieldInfo.label)})),App.Fields.Picklist.changeSelectElementView(selects,"select2",{containerCssClass:"form-control"}),App.Fields.Date.register(container),App.Fields.Date.registerRange(container),search.on("change apply.daterangepicker",(function(e){var searchParams=[];container.find(".listSearchContributor").each((function(index,domElement){var searchInfo=[],searchContributorElement=$(domElement),fieldInfo=searchContributorElement.data("fieldinfo"),fieldName=searchContributorElement.attr("name"),searchValue=searchContributorElement.val();if("object"===(void 0===searchValue?"undefined":_typeof(searchValue))&&(searchValue=null==searchValue?"":searchValue.join("##")),(searchValue=searchValue.trim()).length<=0)return!0;var searchOperator="a";fieldInfo.hasOwnProperty("searchOperator")?searchOperator=fieldInfo.searchOperator:jQuery.inArray(fieldInfo.type,["modules","time","userCreator","owner","picklist","tree","boolean","fileLocationType","userRole","companySelect","multiReferenceValue"])>=0?searchOperator="e":"date"===fieldInfo.type||"datetime"===fieldInfo.type?searchOperator="bw":"multipicklist"!==fieldInfo.type&&"categoryMultipicklist"!==fieldInfo.type||(searchOperator="c"),searchInfo.push(fieldName),searchInfo.push(searchOperator),searchInfo.push(searchValue),"tree"!==fieldInfo.type&&"categoryMultipicklist"!==fieldInfo.type||searchInfo.push($('.listViewHeaders .searchInSubcategories[data-columnname="'+fieldName+'"]').prop("checked")),searchParams.push(searchInfo)}));var url=originalUrl+"&search_params="+JSON.stringify([searchParams]);refreshBtn.data("url",url),refreshBtn.trigger("click")}))},registerFilterChangeEvent:function(){var container=this.getContainer();container.on("change",".widgetFilter",(function(e){container.find('a[name="drefresh"]').trigger("click")})),container.find(".widgetFilterByField").length&&(App.Fields.Picklist.showSelect2ElementView(container.find(".select2noactive")),this.getContainer().on("change",".widgetFilterByField .form-control",(function(e){container.find('a[name="drefresh"]').trigger("click")})))},registerWidgetPostLoadEvent:function(container){var thisInstance=this;container.on(YetiForce_Widget_Js.widgetPostLoadEvent,(function(e){thisInstance.postLoadWidget()}))},registerWidgetPostRefreshEvent:function(container){var thisInstance=this;container.off(YetiForce_Widget_Js.widgetPostRefereshEvent),container.on(YetiForce_Widget_Js.widgetPostRefereshEvent,(function(e){thisInstance.postRefreshWidget()}))},registerSectionClick:function(){var thisInstance=this,pointer=!1;$(thisInstance.chartInstance.canvas).on("click",(function(e){void 0!==thisInstance.getDataFromEvent(e,["links"]).links&&(window.location.href=thisInstance.getDataFromEvent(e,["links"]).links)})).on("mousemove",(function(e){void 0!==thisInstance.getDataFromEvent(e,["links"]).links?pointer||($(this).css("cursor","pointer"),pointer=!0):pointer&&($(this).css("cursor","auto"),pointer=!1)})).on("mouseout",(function(){pointer&&($(this).css("cursor","auto"),pointer=!1)}))},registerLoadMore:function(){var contentContainer=this.getContainer().find(".dashboardWidgetContent");contentContainer.off("click",".showMoreHistory"),contentContainer.on("click",".showMoreHistory",(function(e){var element=jQuery(e.currentTarget);element.hide();var parent=jQuery(e.delegateTarget).closest(".dashboardWidget");jQuery(parent).find(".slimScrollDiv").css("overflow","visible");var url=element.data("url")+"&content=true",additionalFilter=parent.find(".widgetFilter");additionalFilter.length>0&&additionalFilter.each((function(){url+="&"+$(this).attr("name")+"="+$(this).val()})),parent.find(".changeRecordSort").length>0&&(url+="&sortorder="+parent.find(".changeRecordSort").data("sort")),contentContainer.progressIndicator(),AppConnector.request(url).done((function(data){contentContainer.progressIndicator({mode:"hide"}),jQuery(parent).find(".dashboardWidgetContent").append(data),element.parent().remove()}))}))},setFilterToCache:function(url,data){var paramCache=url,container=this.getContainer();for(var i in paramCache=paramCache.replace("&content=","&notcontent="),data)"object"==_typeof(data[i])&&(data[i]=JSON.stringify(data[i])),paramCache+="&"+i+"="+data[i];var userId=CONFIG.userId,name=container.data("name");app.cacheSet(name+userId,paramCache)},registerCache:function(container){1==container.data("cache")&&(this.paramCache=!0)},registerContentAutoResize:function(){var _this4=this;this.getContainer().closest(".grid-stack").on("gsresizestop",(function(event,elem){_this4.loadScrollbar()}))},loadChart:function(){var _this5=this;if(void 0===this.chartData||void 0===this.getChartContainer())return!1;this.getWidgetData();var type=this.getType(),data=this.generateData();data.datasets=this.loadDatasetOptions(data);var options=this.parseOptions(this.loadBasicOptions(data)),plugins=this.parseOptions(this.loadPlugins(data));data=this.parseOptions(data);var chart=this.chartInstance=new Chart(this.getChartContainer().getContext("2d"),{type:type,data:data,options:options,plugins:plugins});return data.datasets=data.datasets.map((function(dataset,index){return dataset.datasetIndex=index,_this5.parseOptions(dataset,dataset,!0)})),chart},getDataFromEvent:function(e,additionalFields){var chart=this.chartInstance,elements=chart.getElementAtEvent(e);if(0===elements.length)return!1;var element=elements[0],dataIndex=element._index,datasetIndex=element._datasetIndex,eventData={label:chart.data.labels[dataIndex],value:chart.data.datasets[0].data[dataIndex]};return void 0!==additionalFields&&Array.isArray(additionalFields)&&additionalFields.forEach((function(fieldName){void 0!==chart.data.datasets[datasetIndex][fieldName]&&void 0!==chart.data.datasets[datasetIndex][fieldName][dataIndex]&&(eventData[fieldName]=chart.data.datasets[datasetIndex][fieldName][dataIndex])})),eventData},loadBasicOptions:function(chartData){return this.formatTooltipTitles(chartData),this.formatTooltipLabels(chartData),this.mergeOptions(this.getBasicOptions(chartData),this.getDefaultBasicOptions(this.getSubType(),chartData))},loadDatasetOptions:function(chartData){var _this6=this;return chartData.datasets.map((function(dataset,index){return _this6.mergeOptions(dataset,_this6.getDatasetOptions(chartData),_this6.getDefaultDatasetOptions(_this6.getSubType(),chartData))}))},loadPlugins:function(chartData){return this.mergeOptionsArray(this.getPlugins(chartData),this.getDefaultPlugins(this.getSubType(),chartData))},formatTooltipTitles:function(data){var _this7=this;data.datasets.forEach((function(dataset){void 0===dataset.titlesFormatted&&(dataset.titlesFormatted=[],dataset.data.forEach((function(dataItem,index){var defaultLabel=data.labels[index];if(String(defaultLabel).length>0&&!isNaN(Number(defaultLabel))&&(defaultLabel=void 0!==_this7.widgetData&&void 0!==_this7.widgetData.valueType&&"count"===_this7.widgetData.valueType?App.Fields.Double.formatToDisplay(defaultLabel,0):App.Fields.Double.formatToDisplay(defaultLabel)),void 0!==dataset.label){var label=dataset.label;String(label).length>0&&!isNaN(Number(label))&&(label=void 0!==_this7.widgetData&&void 0!==_this7.widgetData.valueType&&"count"===_this7.widgetData.valueType?App.Fields.Double.formatToDisplay(label,0):App.Fields.Double.formatToDisplay(label)),defaultLabel+=" ("+label+")"}dataset.titlesFormatted.push(defaultLabel)})))}))},formatTooltipLabels:function(data){var _this8=this;data.datasets.forEach((function(dataset){void 0===dataset.dataFormatted&&(dataset.dataFormatted=[],dataset.data.forEach((function(dataItem,index){var dataFormatted=dataItem;String(dataItem).length>0&&!isNaN(Number(dataItem))&&(dataFormatted=void 0!==_this8.widgetData&&void 0!==_this8.widgetData.valueType&&"count"===_this8.widgetData.valueType?App.Fields.Double.formatToDisplay(dataItem,0):App.Fields.Double.formatToDisplay(dataItem)),dataset.dataFormatted.push(dataFormatted)})))}))},mergeOptionsArray:function(to,fromArray){var _this9=this;return void 0!==to?to:(to=[],fromArray.map((function(from,index){return Array.isArray(from)&&!to.hasOwnProperty(key)?_this9.mergeOptionsArray(to[index],from):"object"===(void 0===from?"undefined":_typeof(from))&&null!==from&&(void 0===to[index]||"object"===_typeof(to[index])&&null!==to[index])?_this9.mergeOptionsObject(to[index],from):to[index]})).filter((function(item){return void 0!==item})))},mergeOptionsObject:function(to,from){for(var _key in void 0===to&&(to={}),from)from.hasOwnProperty(_key)&&(Array.isArray(from[_key])?to.hasOwnProperty(_key)||(to[_key]=this.mergeOptionsArray(void 0,from[_key])):"object"!==_typeof(from[_key])||null===from[_key]||to.hasOwnProperty(_key)&&("object"!==_typeof(to[_key])||null===to[_key]||Array.isArray(to[_key]))?to.hasOwnProperty(_key)||(to[_key]=from[_key]):to[_key]=this.mergeOptionsObject(to[_key],from[_key]));return to},mergeOptions:function(){for(var to=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},_len=arguments.length,fromArray=Array(_len>1?_len-1:0),_key2=1;_key2<_len;_key2++)fromArray[_key2-1]=arguments[_key2];for(var i=0,len=fromArray.length;i<len;i++)"object"!==_typeof(fromArray[i])||Array.isArray(fromArray[i])?app.errorLog(new Error("Options argument should be an object! Chart subType: "+this.getSubType()+" ["+fromArray[i].toString()+"]")):to=this.mergeOptionsObject(to,fromArray[i]);return to},getBasicOptions:function(chartData){return{responsive:!0,maintainAspectRatio:!1}},getDatasetOptions:function(chartData){return{}},getPlugins:function(chartData){},getType:function(chartData){return"bar"},getSubType:function(chartData){return this.getType()}}),Vtiger_Widget_Js("YetiForce_Widget_Js",{},{}),YetiForce_Widget_Js("YetiForce_Bar_Widget_Js",{},{getType:function(){return"bar"}}),YetiForce_Bar_Widget_Js("YetiForce_BarStacked_Widget_Js",{},{getSubType:function(){return"barStacked"}}),YetiForce_Bar_Widget_Js("YetiForce_Horizontal_Widget_Js",{},{getType:function(){return"horizontalBar"}}),YetiForce_Horizontal_Widget_Js("YetiForce_HorizontalStacked_Widget_Js",{},{getType:function(){return"horizontalBar"},getSubType:function(){return"horizontalBarStacked"}}),YetiForce_Widget_Js("YetiForce_Funnel_Widget_Js",{},{getType:function(){return"funnel"}}),YetiForce_Widget_Js("YetiForce_Pie_Widget_Js",{},{getType:function(){return"pie"}}),YetiForce_Pie_Widget_Js("YetiForce_PieDivided_Widget_Js",{},{getSubType:function(){return"pieDivided"}}),YetiForce_Pie_Widget_Js("YetiForce_Donut_Widget_Js",{},{getType:function(){return"doughnut"}}),YetiForce_Donut_Widget_Js("YetiForce_Axis_Widget_Js",{},{}),YetiForce_Widget_Js("YetiForce_BarDivided_Widget_Js",{},{getType:function(){return"bar"},getSubType:function(){return"barDivided"}}),YetiForce_Widget_Js("YetiForce_Line_Widget_Js",{},{getType:function(){return"line"}}),YetiForce_Line_Widget_Js("YetiForce_LineStacked_Widget_Js",{},{getType:function(){return"line"},getSubType:function(){return"lineStacked"}}),YetiForce_Line_Widget_Js("YetiForce_LinePlain_Widget_Js",{},{getSubType:function(){return"linePlain"}}),YetiForce_LineStacked_Widget_Js("YetiForce_LinePlainStacked_Widget_Js",{},{getSubType:function(){return"linePlainStacked"}}),YetiForce_Bar_Widget_Js("YetiForce_TicketsByStatus_Widget_Js",{},{getBasicOptions:function(){return{legend:{display:!0},scales:{xAxes:[{stacked:!0}],yAxes:[{stacked:!0}]}}}}),YetiForce_Widget_Js("YetiForce_Calendar_Widget_Js",{},{calendarView:!1,calendarCreateView:!1,registerCalendar:function(){var _this10=this,thisInstance=this,container=thisInstance.getContainer(),userDefaultTimeFormat=CONFIG.hourFormat;userDefaultTimeFormat=24==userDefaultTimeFormat?"H(:mm)":"h(:mm) A";var convertedFirstDay=CONFIG.firstDayOfWeekNo,defaultFirstHour=app.getMainParams("startHour"),explodedTime=defaultFirstHour.split(":");defaultFirstHour=explodedTime[0];var defaultDate=app.getMainParams("defaultDate");this.paramCache&&defaultDate!=moment().format("YYYY-MM-DD")&&(defaultDate=1==moment(defaultDate).format("D")?moment(defaultDate):moment(defaultDate).add(1,"M")),container.find(".js-widget-quick-create").on("click",(function(e){Vtiger_Header_Js.getInstance().quickCreateModule($(this).data("module-name"))})),thisInstance.getCalendarView().fullCalendar({header:{left:" ",center:"prev title next",right:" "},defaultDate:defaultDate,timeFormat:userDefaultTimeFormat,axisFormat:userDefaultTimeFormat,firstHour:defaultFirstHour,firstDay:convertedFirstDay,defaultView:"month",editable:!1,slotMinutes:15,theme:!1,defaultEventMinutes:0,eventLimit:!0,allDaySlot:!1,monthNames:[app.vtranslate("JS_JANUARY"),app.vtranslate("JS_FEBRUARY"),app.vtranslate("JS_MARCH"),app.vtranslate("JS_APRIL"),app.vtranslate("JS_MAY"),app.vtranslate("JS_JUNE"),app.vtranslate("JS_JULY"),app.vtranslate("JS_AUGUST"),app.vtranslate("JS_SEPTEMBER"),app.vtranslate("JS_OCTOBER"),app.vtranslate("JS_NOVEMBER"),app.vtranslate("JS_DECEMBER")],monthNamesShort:[app.vtranslate("JS_JAN"),app.vtranslate("JS_FEB"),app.vtranslate("JS_MAR"),app.vtranslate("JS_APR"),app.vtranslate("JS_MAY"),app.vtranslate("JS_JUN"),app.vtranslate("JS_JUL"),app.vtranslate("JS_AUG"),app.vtranslate("JS_SEP"),app.vtranslate("JS_OCT"),app.vtranslate("JS_NOV"),app.vtranslate("JS_DEC")],dayNames:[app.vtranslate("JS_SUNDAY"),app.vtranslate("JS_MONDAY"),app.vtranslate("JS_TUESDAY"),app.vtranslate("JS_WEDNESDAY"),app.vtranslate("JS_THURSDAY"),app.vtranslate("JS_FRIDAY"),app.vtranslate("JS_SATURDAY")],dayNamesShort:[app.vtranslate("JS_SUN"),app.vtranslate("JS_MON"),app.vtranslate("JS_TUE"),app.vtranslate("JS_WED"),app.vtranslate("JS_THU"),app.vtranslate("JS_FRI"),app.vtranslate("JS_SAT")],buttonText:{today:app.vtranslate("JS_TODAY"),month:app.vtranslate("JS_MONTH"),week:app.vtranslate("JS_WEEK"),day:app.vtranslate("JS_DAY")},allDayText:app.vtranslate("JS_ALL_DAY"),eventLimitText:app.vtranslate("JS_MORE"),eventRender:function(event,element,view){for(var key in element='<div class="cell-calendar">',event.event)element+='<a class="" href="javascript:;" data-date="'+event.date+'" data-type="'+key+'" title="'+event.event[key].label+'"><span class="'+event.event[key].className+(event.width<=20?" small-badge":"")+(event.width>=24?" big-badge":"")+' badge badge-secondary u-font-size-95per">'+event.event[key].count+"</span></a>\n";return element+="</div>"}}),thisInstance.getCalendarView().find("td.fc-day-top").on("mouseenter",(function(){jQuery('<span class="plus pull-left fas fa-plus"></span>').prependTo($(this))})).on("mouseleave",(function(){$(this).find(".plus").remove()}));var formatDate=CONFIG.dateFormat.toUpperCase();thisInstance.getCalendarView().find("td.fc-day-top").on("click",(function(){var date=moment($(this).data("date")).format(formatDate),params={noCache:!0,data:{date_start:date,due_date:date},callbackFunction:function(){thisInstance.getCalendarView().closest(".dashboardWidget").find('a[name="drefresh"]').trigger("click")}};Vtiger_Header_Js.getInstance().quickCreateModule("Calendar",params)})),container.find(".js-switch--calendar").on("change",(function(e){var currentTarget=$(e.currentTarget);void 0!==currentTarget.data("on-text")?container.find(".widgetFilterSwitch").val("current"):void 0!==currentTarget.data("off-text")&&container.find(".widgetFilterSwitch").val("history"),_this10.refreshWidget()}))},loadCalendarData:function(allEvents){var thisInstance=this;thisInstance.getCalendarView().fullCalendar("removeEvents");var view=thisInstance.getCalendarView().fullCalendar("getView"),formatDate=CONFIG.dateFormat.toUpperCase(),start_date=view.start.format(formatDate),end_date=view.end.format(formatDate),parent=thisInstance.getContainer(),user=parent.find(".owner").val();"all"==user&&(user="");var params={module:"Calendar",action:"Calendar",mode:"getEvents",start:start_date,end:end_date,user:user,widget:!0};if(parent.find(".customFilter").length>0){var customFilter=parent.find(".customFilter").val();params.customFilter=customFilter}if(parent.find(".widgetFilterSwitch").length>0&&(params.time=parent.find(".widgetFilterSwitch").val()),this.paramCache){var url=this.getContainer().find('a[name="drefresh"]').data("url"),paramCache={owner:user,customFilter:customFilter,start:start_date};thisInstance.setFilterToCache(url,paramCache)}AppConnector.request(params).done((function(events){var height=thisInstance.getCalendarView().find(".fc-bg :first").height()-thisInstance.getCalendarView().find(".fc-day-number").height()-10,width=thisInstance.getCalendarView().find(".fc-day-number").width()/2-10;for(var i in events.result)events.result[i].width=width,events.result[i].height=height;thisInstance.getCalendarView().fullCalendar("addEventSource",events.result),thisInstance.getCalendarView().find(".cell-calendar a").on("click",(function(){var container=thisInstance.getContainer(),url="index.php?module=Calendar&view=List";url+=customFilter?"&viewname="+container.find("select.widgetFilter.customFilter").val():"&viewname=All",url+="&search_params=[[";var owner=container.find(".widgetFilter.owner option:selected");("all"!=owner.val()&&(url+='["assigned_user_id","e","'+owner.val()+'"],'),parent.find(".widgetFilterSwitch").length>0)&&(url+='["activitystatus","e","'+parent.find(".widgetFilterSwitch").data()[params.time]+'"],');var date=moment($(this).data("date")).format(thisInstance.getUserDateFormat().toUpperCase());window.location.href=url+'["activitytype","e","'+$(this).data("type")+'"],["date_start","bw","'+date+","+date+'"]]]'}))}))},getCalendarView:function(){return 0==this.calendarView&&(this.calendarView=this.getContainer().find(".js-calendar__container")),this.calendarView},getMonthName:function(){var month=this.getCalendarView().find(".fc-toolbar h2").text();month&&this.getContainer().find(".headerCalendar .month").html("<h3>"+month+"</h3>")},registerChangeView:function(){var thisInstance=this,container=this.getContainer();container.find(".fc-toolbar").addClass("d-none");var month=container.find(".fc-toolbar h2").text();month&&(container.find(".headerCalendar").removeClass("d-none").find(".month").append("<h3>"+month+"</h3>"),container.find(".headerCalendar button").each((function(){var tag=jQuery(this).data("type");jQuery(this).on("click",(function(){thisInstance.getCalendarView().find(".fc-toolbar ."+tag).trigger("click"),thisInstance.loadCalendarData(),thisInstance.getMonthName()}))})))},postLoadWidget:function(){this.registerCalendar(),this.loadCalendarData(!0),this.registerChangeView(),this.registerFilterChangeEvent()},refreshWidget:function(){var refreshContainer=this.getContainer().find(".dashboardWidgetContent");refreshContainer.progressIndicator(),this.loadCalendarData(),refreshContainer.progressIndicator({mode:"hide"})}}),YetiForce_Widget_Js("YetiForce_CalendarActivities_Widget_Js",{},{modalView:!1,postLoadWidget:function(){this._super(),this.registerActivityChange(),this.registerListViewButton()},postRefreshWidget:function(){this._super(),this.registerActivityChange()},registerActivityChange:function(){var thisInstance=this;this.getContainer().find(".dashboardWidgetContent").find(".changeActivity").on("click",(function(e){if(!jQuery(e.target).is("a")&&!thisInstance.modalView){var url=jQuery(this).data("url");if(void 0!==url){thisInstance.modalView=!0,app.showModalWindow(null,url,(function(){thisInstance.modalView=!1}))}}}))},registerListViewButton:function(){var container=this.getContainer();container.find(".goToListView").on("click",(function(){var status=void 0,activitiesStatus=container.data("name");status="OverdueActivities"===activitiesStatus?"PLL_OVERDUE":"CalendarActivities"===activitiesStatus?"PLL_IN_REALIZATION##PLL_PLANNED":"PLL_IN_REALIZATION##PLL_PLANNED##PLL_OVERDUE";var url="index.php?module=Calendar&view=List&viewname=All";url+="&search_params=[[";var owner=container.find(".widgetFilter.owner option:selected");"all"!==owner.val()&&(url+='["assigned_user_id","e","'+owner.val()+'"],'),url+='["activitystatus","e","'+encodeURIComponent(status)+'"]]]',window.location.href=url}))}}),YetiForce_CalendarActivities_Widget_Js("YetiForce_CreatedNotMineActivities_Widget_Js",{},{}),YetiForce_CalendarActivities_Widget_Js("YetiForce_CreatedNotMineOverdueActivities_Widget_Js",{},{}),YetiForce_CalendarActivities_Widget_Js("YetiForce_OverDueActivities_Widget_Js",{},{}),YetiForce_CalendarActivities_Widget_Js("YetiForce_OverdueActivities_Widget_Js",{},{}),YetiForce_Widget_Js("YetiForce_ProductsSoldToRenew_Widget_Js",{},{modalView:!1,postLoadWidget:function(){this._super(),this.registerAction(),this.registerListViewButton()},postRefreshWidget:function(){this._super(),this.registerAction()},registerAction:function(){var thisInstance=this;this.getContainer().find(".dashboardWidgetContent").find(".rowAction").on("click",(function(e){if(!jQuery(e.target).is("a")&&!thisInstance.modalView){var url=jQuery(this).data("url");if(void 0!==url){thisInstance.modalView=!0,app.showModalWindow(null,url,(function(){thisInstance.modalView=!1}))}}}))},registerListViewButton:function(){var container=this.getContainer();container.on("click",".goToListView",(function(){var url=jQuery(this).data("url"),orderBy=container.find(".orderby"),sortOrder=container.find(".changeRecordSort");orderBy.length&&(url+="&orderby="+orderBy.val()),sortOrder.length&&(url+="&sortorder="+sortOrder.data("sort").toUpperCase()),window.location.href=url}))}}),YetiForce_ProductsSoldToRenew_Widget_Js("YetiForce_ServicesSoldToRenew_Widget_Js",{},{}),YetiForce_Bar_Widget_Js("YetiForce_AllTimeControl_Widget_Js",{},{getBasicOptions:function(){return{legend:{display:!0},scales:{yAxes:[{stacked:!0,ticks:{callback:function(value,index,values){return app.formatToHourText(value,"short",!1,!1)}}}],xAxes:[{stacked:!0,ticks:{minRotation:0}}]},tooltips:{callbacks:{label:function(tooltipItem,data){return data.datasets[tooltipItem.datasetIndex].original_label+": "+app.formatToHourText(tooltipItem.yLabel)},title:function(tooltipItems,data){return data.fullLabels[tooltipItems[0].index]}}}}},getDatasetOptions:function(dataset,type,datasetIndex){return{datalabels:{formatter:function(value,context){return app.formatToHourText(value)}}}}}),YetiForce_Bar_Widget_Js("YetiForce_LeadsBySource_Widget_Js",{},{}),YetiForce_Pie_Widget_Js("YetiForce_ClosedTicketsByPriority_Widget_Js",{},{}),YetiForce_Bar_Widget_Js("YetiForce_ClosedTicketsByUser_Widget_Js",{},{}),YetiForce_Bar_Widget_Js("YetiForce_OpenTickets_Widget_Js",{},{}),YetiForce_Bar_Widget_Js("YetiForce_AccountsByIndustry_Widget_Js",{},{}),YetiForce_Funnel_Widget_Js("YetiForce_EstimatedvalueByStatus_Widget_Js",{},{getBasicOptions:function(){return{sort:"data-desc"}},getPlugins:function(){return[]}}),YetiForce_Bar_Widget_Js("YetiForce_NotificationsBySender_Widget_Js",{},{}),YetiForce_Bar_Widget_Js("YetiForce_NotificationsByRecipient_Widget_Js",{},{}),YetiForce_Bar_Widget_Js("YetiForce_TeamsEstimatedSales_Widget_Js",{},{generateChartData:function(){var jData=this.getContainer().find(".widgetData").val(),data=JSON.parse(jData),chartData=[[],[],[],[]],yMaxValue=void 0,index=void 0,parseData=void 0;if(data.hasOwnProperty("compare"))for(index in data)parseData=this.parseChartData(data[index],chartData),chartData[0].push(parseData[0]),chartData[3].push(parseData[3]),chartData=[chartData[0],parseData[1],parseData[2],chartData[3],["#CC6600","#208CB3"]];else chartData=[[(parseData=this.parseChartData(data,chartData))[0]],parseData[1],parseData[2],[parseData[3]],["#208CB3"]];return yMaxValue=(yMaxValue=chartData[1])+2+yMaxValue/100*25,{chartData:chartData[0],yMaxValue:yMaxValue,labels:chartData[2],data_labels:chartData[3],placement:"inside",location:"n",colors:chartData[4]}},parseChartData:function(data,chartDataGlobal){var chartData=[],xLabels=[],sum=0;for(var index in data){var row=data[index];row[0]=parseInt(row[0]),sum+=row[0],xLabels.push(app.getDecodedValue(row[1])),chartData.push(row[0]),parseInt(row[0])>chartDataGlobal[1]&&(chartDataGlobal[1]=parseInt(row[0]))}return[chartData,chartDataGlobal[1],xLabels,"&nbsp;  "+sum+"&nbsp;"]},registerSectionClick:function(){var data=this.getContainer().find(".widgetData").val(),dataInfo=JSON.parse(data),compare=dataInfo&&dataInfo.hasOwnProperty("compare"),url=void 0;this.getContainer().off("jqplotDataClick").on("jqplotDataClick",(function(ev,seriesIndex,pointIndex,args){url=seriesIndex?dataInfo.compare[pointIndex][2]:compare?dataInfo[0][pointIndex][2]:dataInfo[pointIndex][2],window.location.href=url}))}}),YetiForce_TeamsEstimatedSales_Widget_Js("YetiForce_ActualSalesOfTeam_Widget_Js",{},{}),YetiForce_Widget_Js("YetiForce_History_Widget_Js",{},{postLoadWidget:function(){this._super(),this.registerLoadMore()},postRefreshWidget:function(){this._super(),this.registerLoadMore()},registerLoadMore:function(){var thisInstance=this,loadMoreHandler=thisInstance.getContainer().find(".dashboardWidgetContent").find(".load-more");loadMoreHandler.on("click",(function(){var parent=thisInstance.getContainer(),url=parent.find('a[name="drefresh"]').data("url"),params=url,widgetFilters=parent.find(".widgetFilter");widgetFilters.length>0&&(params={url:url,data:{}},widgetFilters.each((function(index,domElement){var widgetFilter=jQuery(domElement),filterName=widgetFilter.attr("name"),filterValue=widgetFilter.val();params.data[filterName]=filterValue})));var filterData=thisInstance.getFilterData();jQuery.isEmptyObject(filterData)||("string"==typeof params&&(params={url:url,data:{}}),params.data=jQuery.extend(params.data,thisInstance.getFilterData())),params.data.page=loadMoreHandler.data("nextpage");var refreshContainer=parent.find(".dashboardWidgetContent");refreshContainer.progressIndicator(),AppConnector.request(params).done((function(data){refreshContainer.progressIndicator({mode:"hide"}),loadMoreHandler.replaceWith(data),thisInstance.registerLoadMore()})).fail((function(){refreshContainer.progressIndicator({mode:"hide"})}))}))}}),YetiForce_Widget_Js("YetiForce_MiniList_Widget_Js",{},{postLoadWidget:function(){app.hideModalWindow(),this.restrictContentDrag(),this.registerFilter(),this.registerFilterChangeEvent(),this.registerRecordsCount()},postRefreshWidget:function(){this.registerRecordsCount()}}),YetiForce_Widget_Js("YetiForce_Notebook_Widget_Js",{},{postLoadWidget:function(){this.registerNotebookEvents()},registerNotebookEvents:function(){var _this11=this;this.container.on("click",".dashboard_notebookWidget_edit",(function(){_this11.editNotebookContent()})),this.container.on("click",".dashboard_notebookWidget_save",(function(){_this11.saveNotebookContent()}))},editNotebookContent:function(){$(".dashboard_notebookWidget_text",this.container).show(),$(".dashboard_notebookWidget_view",this.container).hide()},saveNotebookContent:function(){var _this12=this,textarea=$(".dashboard_notebookWidget_textarea",this.container),params=this.container.data("url")+"&content=true&mode=save&contents="+encodeURIComponent(textarea.val()),refreshContainer=this.container.find(".dashboardWidgetContent");refreshContainer.progressIndicator(),AppConnector.request(params).done((function(data){refreshContainer.progressIndicator({mode:"hide"}),$(".dashboardWidgetContent",_this12.container).html(data)}))}}),YetiForce_Widget_Js("YetiForce_KpiBar_Widget_Js",{},{generateChartData:function(){var jData=this.getContainer().find(".widgetData").val(),data=JSON.parse(jData);return{chartData:[[[data.result,data.all]]],yMaxValue:data.maxValue,labels:""}},loadChart:function(){var data=this.generateChartData();this.getChartContainer(!1).jqplot(data.chartData,{animate:!$.jqplot.use_excanvas,seriesDefaults:{renderer:jQuery.jqplot.BarRenderer,rendererOptions:{showDataLabels:!0,dataLabels:"value",barDirection:"horizontal"}},axes:{xaxis:{min:0,max:data.yMaxValue},yaxis:{renderer:jQuery.jqplot.CategoryAxisRenderer}}})}}),YetiForce_Widget_Js("YetiForce_ChartFilter_Widget_Js",{},{chartfilterInstance:!1,init:function(container,reload,widgetClassName){this.setContainer(jQuery(container));var chartClassName=container.find('[name="typeChart"]').val();if(!!Number(container.find('[name="stacked"]').val())&&(chartClassName+="Stacked"),this.chartfilterInstance=YetiForce_Widget_Js.getInstance(container,chartClassName),this.chartfilterInstance){var filterIdsStr=container.find('[name="filterIds"]').val();filterIdsStr&&(this.chartfilterInstance.filterIds=JSON.parse(filterIdsStr))}this.registerRecordsCount(),this.registerCache(container)}}),YetiForce_Widget_Js("YetiForce_Multifilter_Widget_Js",{},{multifilterControlsView:!1,multifilterContentView:!1,multifilterSettingsView:!1,registerMultifilter:function(){var _this13=this,selectValue=app.cacheGet("multifilterSelectValue",null),multifilterSettings=this.getMultifilterSettings();null!=selectValue&&this.paramCache&&multifilterSettings.find(".js-select").val(selectValue).trigger("change.select2"),this.loadMultifilterData(!0),multifilterSettings.find(".js-select").on("select2:select",(function(){_this13.loadMultifilterData(!0),_this13.paramCache&&app.cacheSet("multifilterSelectValue",multifilterSettings.find(".js-select").val())})),multifilterSettings.find(".js-select").on("select2:unselect",(function(){_this13.loadMultifilterData(!1),_this13.paramCache&&app.cacheSet("multifilterSelectValue",multifilterSettings.find(".js-select").val())})),this.registerShowHideModuleSettings()},loadMultifilterData:function(){var select=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],self=this,widgetId=self.getMultifilterControls().attr("data-widgetid"),multifilterIds=self.getMultifilterSettings().find(".js-select option:selected"),params=[];select||self.getMultifilterContent().html(""),multifilterIds.each((function(){var existFilter=self.getMultifilterContent().find('[data-id="'+$(this).val()+'"]'),thisInstance=$(this);if(0<existFilter.length)return!0;params={module:thisInstance.data("module"),modulename:thisInstance.data("module"),view:"ShowWidget",name:"Multifilter",content:!0,widget:!0,widgetid:widgetId,filterid:thisInstance.val()},self.loadListData(params)}))},loadListData:function(params){var self=this,aDeferred=jQuery.Deferred(),multiFilterContent=self.getMultifilterContent();return AppConnector.request(params).done((function(data){self.getMultifilterSettings().find('option[value="'+params.filterid+'"]').is(":selected")&&!multiFilterContent.find('.detailViewTable[data-id="'+params.filterid+'"]').length&&(self.registerRecordsCount(multiFilterContent.append(data).children("div:last-child")),self.registerShowHideBlocks(),aDeferred.resolve())})).fail((function(error){aDeferred.reject()})),aDeferred.promise()},registerShowHideModuleSettings:function(){var _this14=this;this.getMultifilterControls().find(".js-widget-settings").on("click",(function(){_this14.getMultifilterSettings().toggleClass("d-none")}))},registerShowHideBlocks:function(){var detailContentsHolder=this.getMultifilterContent();detailContentsHolder.find(".blockHeader").off("click"),detailContentsHolder.find(".blockHeader").click((function(){var currentTarget=$(this).find(".js-block-toggle").not(".d-none"),closestBlock=currentTarget.closest(".js-toggle-panel"),bodyContents=closestBlock.find(".blockContent");"show"==currentTarget.data().mode?(bodyContents.addClass("d-none"),currentTarget.addClass("d-none"),closestBlock.find('[data-mode="hide"]').removeClass("d-none")):(bodyContents.removeClass("d-none"),currentTarget.addClass("d-none"),closestBlock.find("[data-mode='show']").removeClass("d-none"))}))},registerRecordsCount:function(container){var url=container.data("url");AppConnector.request(url).done((function(data){container.find(".js-count").html(data.result.totalCount)}))},getMultifilterControls:function(){return 0==this.multifilterControlsView&&(this.multifilterControlsView=this.getContainer().find(".js-multifilterControls")),this.multifilterControlsView},getMultifilterContent:function(){return 0==this.multifilterContentView&&(this.multifilterContentView=this.getContainer().find(".js-multifilterContent")),this.multifilterContentView},getMultifilterSettings:function(){return 0==this.multifilterSettingsView&&(this.multifilterSettingsView=this.getContainer().find(".js-settings-widget")),this.multifilterSettingsView},postLoadWidget:function(){this.registerMultifilter()},refreshWidget:function(){this.loadMultifilterData(!1)}}),YetiForce_Widget_Js("YetiForce_UpcomingProjectTasks_Widget_Js",{},{postLoadWidget:function(){this._super(),this.registerListViewButton()},registerListViewButton:function(){var container=this.getContainer();container.find(".goToListView").on("click",(function(){var url="index.php?module=ProjectTask&view=List&viewname=All";url+="&search_params=[[";var owner=container.find(".widgetFilter.owner option:selected");"all"!==owner.val()&&(url+='["assigned_user_id","e","'+owner.val()+'"],'),url+='["projecttaskstatus","e","'+encodeURIComponent(container.find('[name="status"]').data("value"))+'"]]]',app.openUrl(url)}))}}),YetiForce_UpcomingProjectTasks_Widget_Js("YetiForce_CompletedProjectTasks_Widget_Js",{},{});
//# sourceMappingURL=Widget.min.js.map
