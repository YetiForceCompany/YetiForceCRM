
jQuery.Class("Vtiger_Widget_Js", {widgetPostLoadEvent:"Vtiget.Dashboard.PostLoad", widgetPostRefereshEvent:"Vtiger.Dashboard.PostRefresh", getInstance:function(b, d, a){if (typeof a == "undefined"){a = app.getModuleName()}var g = d.toCamelCase(); var h = window[a + "_" + g + "_Widget_Js"]; var e = window["Vtiger_" + g + "_Widget_Js"]; var c = window["YetiForce_" + g + "_Widget_Js"]; var i = Vtiger_Widget_Js; var f; if (typeof h != "undefined"){f = new h(b, false, g)} else{if (typeof e != "undefined"){f = new e(b, false, g)} else{if (typeof c != "undefined"){f = new c(b, false, g)} else{f = new i(b, false, g)}}}return f}}, {container:false, plotContainer:false, chartInstance:false, chartData:[], paramCache:false, init:function(b, c, a){this.setContainer(jQuery(b)); this.registerWidgetPostLoadEvent(b); if (!c){this.registerWidgetPostRefreshEvent(b)}this.registerCache(b)}, getContainer:function(){return this.container}, setContainer:function(a){this.container = a; return this}, isEmptyData:function(){var a = this.getContainer(); return(a.find(".noDataMsg").length > 0)?true:false}, getUserDateFormat:function(){return jQuery("#userDateFormat").val()}, getPlotContainer:function(b){if (typeof b == "undefined"){b = false}if (this.plotContainer == false || !b){var a = this.getContainer(); this.plotContainer = a.find(".widgetChartContainer")}return this.plotContainer}, registerRecordsCount:function(){var b = this; var a = b.getContainer().find(".recordCount"); a.on("click", function(){var c = a.data("url"); AppConnector.request(c).then(function(d){a.find(".count").html(d.result.totalCount); a.find("span:not(.count)").addClass("hide"); a.find("a").removeClass("hide")})})}, loadScrollbar:function(){var d = this.getPlotContainer(false).closest(".dashboardWidget"); var c = d.find(".dashboardWidgetContent"); var f = d.find(".dashboardWidgetFooter"); var e = d.find(".dashboardWidgetHeader"); var a = e.outerHeight(); var b = d.height() - a; if (f.length){b -= f.outerHeight()}if (!c.length){return}c.css("height", b + "px"); app.showNewScrollbar(c, {wheelPropagation:true})}, restrictContentDrag:function(){this.getContainer().on("mousedown.draggable", function(c){var b = jQuery(c.target); var a = b.closest(".dashboardWidgetHeader").length > 0?true:false; if (a){return}c.stopPropagation()})}, convertToDateRangePicketFormat:function(a){switch (a){case"yyyy-mm-dd":return"yyyy-MM-dd"; case"mm-dd-yyyy":return"MM-dd-yyyy"; case"dd-mm-yyyy":return"dd-MM-yyyy"; case"yyyy.mm.dd":return"yyyy.MM.dd"; case"mm.dd.yyyy":return"MM.dd.yyyy"; case"dd.mm.yyyy":return"dd.MM.yyyy"; case"yyyy/mm/dd":return"yyyy/MM/dd"; case"mm/dd/yyyy":return"MM/dd/yyyy"; case"dd/mm/yyyy":return"dd/MM/yyyy"}}, generateData:function(){var d = this; var a = d.getContainer(); var b = a.find(".widgetData").val(); var f = JSON.parse(b); var e = []; for (var c in f){e.push(f[c]); d.chartData[f[c].id] = f[c]}return{chartData:e}}, loadChart:function(){}, positionNoDataMsg:function(){var a = this.getContainer(); var c = a.find(".dashboardWidgetContent"); var b = c.find(".noDataMsg"); b.position({my:"center center", at:"center center", of:c})}, postLoadWidget:function(){this.loadScrollbar(); if (!this.isEmptyData()){this.loadChart()} else{this.positionNoDataMsg()}this.registerSectionClick(); this.registerFilter(); this.registerFilterChangeEvent(); this.restrictContentDrag(); app.showBtnSwitch(this.getContainer().find(".switchBtn")); app.showPopoverElementView(this.getContainer().find(".popoverTooltip")); this.registerWidgetSwitch(); this.registerChangeSorting(); this.registerLoadMore(); this.registerUserList(); this.registerHeaderButtons()}, postRefreshWidget:function(){this.loadScrollbar(); if (!this.isEmptyData()){this.loadChart()} else{this.positionNoDataMsg()}this.registerSectionClick(); this.registerLoadMore()}, setSortingButton:function(f){if (f.length){var c = this.getContainer(); var a = c.find('a[name="drefresh"]'); var e = a.data("url"); e = e.replace("&sortorder=desc", ""); e = e.replace("&sortorder=asc", ""); e += "&sortorder="; var g = f.data("sort"); var b = "desc"; var h = "fa-sort-amount-down"; if (g == "desc"){b = "asc"; h = "fa-sort-amount-up"}f.data("sort", b); f.attr("title", f.data(b)); f.attr("alt", f.data(b)); e += b; var d = f.find("[data-fa-i2svg]"); d.removeClass().addClass("[data-fa-i2svg]").addClass(h); a.data("url", e)}}, registerUserList:function(){var b = this.getContainer(); var e = b.find(".dashboardWidgetHeader"); var d = e.find(".ownersFilter"); if (d.length){var c = b.find(".widgetOwners").val(); if (c){var a = d.find("select"); $.each(jQuery.parseJSON(c), function(f, g){a.append($("<option>", {value:f}).text(g))})}}}, registerHeaderButtons:function(){var a = this.getContainer(); var d = a.find(".dashboardWidgetHeader"); var c = d.find(".downloadWidget"); var b = d.find(".printWidget"); b.click(function(h){var g = $(this.chartInstance.jqplotToImageElem()); var f = window.open("", "PRINT", "height=400,width=600"); f.document.write("<html><head><title>" + d.find(".dashboardTitle").text() + "</title>"); f.document.write("</head><body >"); f.document.write($("<div>").append(g.clone()).html()); f.document.write("</body></html>"); f.document.close(); f.focus(); setTimeout(function(){f.print(); f.close()}, 1000)}); c.click({chart:$(this)}, function(h){var g = $(this.chartInstance.jqplotToImageElem()); var f = $("<a>").attr("href", g.attr("src")).attr("download", d.find(".dashboardTitle").text() + ".png").appendTo(a); f[0].click(); f.remove()})}, registerChangeSorting:function(){var b = this; var a = this.getContainer(); b.setSortingButton(a.find(".changeRecordSort")); a.find(".changeRecordSort").click(function(d){var c = a.find('a[name="drefresh"]'); b.setSortingButton(jQuery(d.currentTarget)); c.click()})}, registerWidgetSwitch:function(){var a = this; var b = this.getContainer().find(".dashboardWidgetHeader .switchBtnReload"); a.setUrlSwitch(b); b.on("switchChange.bootstrapSwitch", function(g, f){var d = jQuery(g.currentTarget); var h = d.closest(".dashboardWidgetHeader"); var c = h.find('a[name="drefresh"]'); a.setUrlSwitch(d).then(function(e){if (e){c.click()}})})}, setUrlSwitch:function(b){var a = jQuery.Deferred(); b.each(function(h, i){var g = jQuery(i); var f = g.closest(".dashboardWidgetHeader"); var j = f.find('a[name="drefresh"]'); var c = j.data("url"); var d = g.data("urlparams"); if (d != ""){var l = g.data("on-val"); var k = g.data("off-val"); c = c.replace("&" + d + "=" + l, ""); c = c.replace("&" + d + "=" + k, ""); c += "&" + d + "="; if (g.prop("checked")){c += l} else{c += k}j.data("url", c); a.resolve(true)} else{a.reject()}}); return a.promise()}, getFilterData:function(){return{}}, refreshWidget:function(){var k = this; var l = this.getContainer(); var f = l.find('a[name="drefresh"]'); var b = f.data("url"); var h = l.find(".dashboardWidgetContent"); var d = b; var g = l.find(".widgetFilter"); if (g.length > 0){d = {}; d.url = b; d.data = {}; g.each(function(n, q){var m = jQuery(q); var p = m.attr("type"); var o = m.attr("name"); if ("checkbox" == p){var r = m.is(":checked"); d.data[o] = r} else{var r = m.val(); d.data[o] = r}})}var e = l.find(".widgetFilterByField"); if (e.length){var j = []; e.find(".listSearchContributor").each(function(s, r){var o = []; var t = jQuery(r); var n = t.data("fieldinfo"); var u = t.attr("name"); var m = t.val(); if (typeof m == "object"){if (m == null){m = ""} else{m = m.join(",")}}m = m.trim(); if (m.length <= 0){return true}var q = "a"; if (n.hasOwnProperty("searchOperator")){q = n.searchOperator} else{if (jQuery.inArray(n.type, ["modules", "time", "userCreator", "owner", "picklist", "tree", "boolean", "fileLocationType", "userRole", "companySelect", "multiReferenceValue"]) >= 0){q = "e"} else{if (n.type == "date" || n.type == "datetime"){q = "bw"} else{if (n.type == "multipicklist" || n.type == "categoryMultipicklist"){q = "c"}}}}o.push(u); o.push(q); o.push(m); if (n.type == "tree" || n.type == "categoryMultipicklist"){var p = l.find('.searchInSubcategories[data-columnname="' + u + '"]').prop("checked"); o.push(p)}j.push(o)}); if (j.length){d.data.search_params = new Array(j)}}var i = this.getFilterData(); if (!jQuery.isEmptyObject(i)){if (typeof d == "string"){b = d; d = {}; d.url = b; d.data = {}}d.data = jQuery.extend(d.data, this.getFilterData())}var c = l.find(".dashboardWidgetContent"); var a = l.find(".dashboardWidgetFooter"); c.html(""); a.html(""); c.progressIndicator(); if (this.paramCache && g.length > 0){k.setFilterToCache(d.url, d.data)}AppConnector.request(d).then(function(m){var m = jQuery(m); var n = m.filter(".widgetFooterContent"); c.progressIndicator({mode:"hide"}); if (n.length){n = n.clone(true, true); a.html(n); m.each(function(p, o){if (jQuery(this).hasClass("widgetFooterContent")){m.splice(p, 1)}})}h.html(m).trigger(Vtiger_Widget_Js.widgetPostRefereshEvent)}, function(){c.progressIndicator({mode:"hide"})})}, registerFilter:function(){var c = this; var a = this.getContainer(); var b = a.find("input.dateRangeField"); if (b.length <= 0){return}b.addClass("dateRangeField").attr("data-date-format", c.getUserDateFormat()); app.registerDateRangePickerFields(b, {opens:"auto"}); b.on("apply.daterangepicker", function(e, d){a.find('a[name="drefresh"]').trigger("click")})}, registerFilterChangeEvent:function(){var a = this.getContainer(); a.on("change", ".widgetFilter", function(c){var b = jQuery(c.currentTarget).closest("li"); b.find('a[name="drefresh"]').trigger("click")}); if (a.find(".widgetFilterByField").length){app.showSelect2ElementView(a.find(".select2noactive")); this.getContainer().on("change", ".widgetFilterByField .form-control", function(c){var b = jQuery(c.currentTarget).closest("li"); b.find('a[name="drefresh"]').trigger("click")})}}, registerWidgetPostLoadEvent:function(a){var b = this; a.on(Vtiger_Widget_Js.widgetPostLoadEvent, function(c){b.postLoadWidget()})}, registerWidgetPostRefreshEvent:function(a){var b = this; a.off(Vtiger_Widget_Js.widgetPostRefereshEvent); a.on(Vtiger_Widget_Js.widgetPostRefereshEvent, function(c){b.postRefreshWidget()})}, registerSectionClick:function(){}, registerLoadMore:function(){var c = this; var b = c.getContainer(); var a = b.find(".dashboardWidgetContent"); a.off("click", ".showMoreHistory"); a.on("click", ".showMoreHistory", function(j){var g = jQuery(j.currentTarget); g.hide(); var i = jQuery(j.delegateTarget).closest(".dashboardWidget"); jQuery(i).find(".slimScrollDiv").css("overflow", "visible"); var d = i.find(".owner").val(); var h = i.find("[name='type']").val(); var f = g.data("url") + "&content=true&owner=" + d; if (i.find("[name='type']").length > 0){f += "&type=" + h}if (i.find(".changeRecordSort").length > 0){f += "&sortorder=" + i.find(".changeRecordSort").data("sort")}a.progressIndicator(); AppConnector.request(f).then(function(e){a.progressIndicator({mode:"hide"}); jQuery(i).find(".dashboardWidgetContent").append(e); g.parent().remove()})})}, setFilterToCache:function(c, g){var f = c; var a = this.getContainer(); f = f.replace("&content=", "&notcontent="); for (var e in g){if (typeof g[e] == "object"){g[e] = JSON.stringify(g[e])}f += "&" + e + "=" + g[e]}var d = app.getMainParams("current_user_id"); var b = a.data("name"); app.cacheSet(b + d, f)}, registerCache:function(a){if (a.data("cache") == 1){this.paramCache = true}}}); Vtiger_Widget_Js("Vtiger_History_Widget_Js", {}, {postLoadWidget:function(){this._super(); this.registerLoadMore()}, postRefreshWidget:function(){this._super(); this.registerLoadMore()}, registerLoadMore:function(){var c = this; var b = c.getContainer(); var a = b.find(".dashboardWidgetContent"); var d = a.find(".load-more"); d.click(function(){var h = c.getContainer(); var g = h.find('a[name="drefresh"]'); var f = g.data("url"); var k = f; var e = h.find(".widgetFilter"); if (e.length > 0){k = {url:f, data:{}}; e.each(function(m, o){var l = jQuery(o); var n = l.attr("name"); var p = l.val(); k.data[n] = p})}var j = c.getFilterData(); if (!jQuery.isEmptyObject(j)){if (typeof k == "string"){k = {url:f, data:{}}}k.data = jQuery.extend(k.data, c.getFilterData())}k.data.page = d.data("nextpage"); var i = h.find(".dashboardWidgetContent"); i.progressIndicator(); AppConnector.request(k).then(function(l){i.progressIndicator({mode:"hide"}); d.replaceWith(l); c.registerLoadMore()}, function(){i.progressIndicator({mode:"hide"})})})}}); Vtiger_Widget_Js("YetiForce_Chartfilter_Widget_Js", {}, {chartfilterInstance:false, init:function(b, e, a){this.setContainer(jQuery(b)); var d = b.find('[name="typeChart"]').val(); var c = d.toCamelCase(); this.chartfilterInstance = Vtiger_Widget_Js.getInstance(b, c); this.registerRecordsCount()}, }); Vtiger_Widget_Js("Vtiger_Funnel_Widget_Js", {}, {postLoadWidget:function(){this._super(); var a = this.getContainer(); a.on("jqplotDataHighlight", function(b, c, d, e){$(".jqplot-event-canvas").css("cursor", "pointer")}); a.on("jqplotDataUnhighlight", function(b, c, d, e){$(".jqplot-event-canvas").css("cursor", "auto")})}, loadChart:function(){var a = this.getContainer(); var c = a.find(".widgetData").val(); var b = JSON.parse(c); if (b.length > 0){this.chartInstance = this.getPlotContainer(false).jqplot([b], {seriesDefaults:{renderer:jQuery.jqplot.FunnelRenderer, rendererOptions:{sectionMargin:0, widthRatio:0.1, showDataLabels:true, dataLabelThreshold:0, dataLabels:"value", highlightMouseDown:true}}, legend:{show:true, renderer:$.jqplot.EnhancedLegendRenderer, location:"e", }})}}, registerSectionClick:function(){var a = this.getContainer(); var c = a.find(".widgetData").val(); var b = JSON.parse(c); this.getContainer().off("jqplotDataClick").on("jqplotDataClick", function(h, d, g, f){var e = b[g][2]; window.location.href = e})}}); Vtiger_Widget_Js("Vtiger_Pie_Widget_Js", {}, {generateData:function(){var a = this.getContainer(); var b = a.find(".widgetData").val(); var f = JSON.parse(b); var e = []; for (var c in f){var g = f[c]; var d = [g.last_name, g.id]; e.push(d)}return{chartData:e}}, loadChart:function(){var a = this.generateData(); if (a.chartData.length > 0){this.chartInstance = this.getPlotContainer(false).jqplot([a.chartData], {seriesDefaults:{renderer:jQuery.jqplot.PieRenderer, rendererOptions:{showDataLabels:true, sliceMargin:2, dataLabels:"value"}}, legend:{show:true, renderer:$.jqplot.EnhancedPieLegendRenderer, location:"e"}, title:a.title})}}, registerSectionClick:function(){var a = this.getContainer(); var c = a.find(".widgetData").val(); var b = JSON.parse(c); this.getContainer().off("jqplotDataClick").on("jqplotDataClick", function(h, d, g, f){var e = b[g][2]; window.location.href = e})}, }); Vtiger_Widget_Js("Vtiger_Donut_Widget_Js", {}, {generateData:function(){var a = this.getContainer(); var b = a.find(".widgetData").val(); var f = JSON.parse(b); var e = []; for (var c in f){var g = f[c]; var d = [g.last_name, g.id]; e.push(d)}return{chartData:e}}, loadChart:function(){var a = this.generateData(); if (a.chartData.length > 0){this.chartInstance = this.getPlotContainer(false).jqplot([a.chartData], {seriesDefaults:{renderer:jQuery.jqplot.DonutRenderer, rendererOptions:{sliceMargin:3, startAngle: - 90, showDataLabels:true, dataLabels:"value", totalLabel:true}}, legend:{show:true, renderer:$.jqplot.EnhancedLegendRenderer, location:"e"}})}}, registerSectionClick:function(){var a = this.getContainer(); var c = a.find(".widgetData").val(); var b = JSON.parse(c); this.getContainer().off("jqplotDataClick").on("jqplotDataClick", function(h, d, g, f){var e = b[g][2]; window.location.href = e})}, }); Vtiger_Widget_Js("Vtiger_Axis_Widget_Js", {}, {generateData:function(){var a = this.getContainer(); var b = a.find(".widgetData").val(); var f = JSON.parse(b); var e = []; for (var c in f){var g = f[c]; var d = [g.last_name, g.id]; e.push(d)}return{chartData:e}}, loadChart:function(){var a = this.generateData(); if (a.chartData.length > 0){this.chartInstance = this.getPlotContainer(false).jqplot([a.chartData], {seriesDefaults:{renderer:jQuery.jqplot.DonutRenderer, rendererOptions:{sliceMargin:3, startAngle: - 90, showDataLabels:true, dataLabels:"value", totalLabel:true}}, legend:{show:true, renderer:$.jqplot.EnhancedLegendRenderer, location:"e"}, title:a.title})}}, registerSectionClick:function(){var a = this.getContainer(); var c = a.find(".widgetData").val(); var b = JSON.parse(c); this.getContainer().off("jqplotDataClick").on("jqplotDataClick", function(h, d, g, f){var e = b[g][2]; window.location.href = e})}, }); Vtiger_Widget_Js("Vtiger_Bardivided_Widget_Js", {}, {generateData:function(){var a = this.getContainer(); var b = a.find(".widgetData").val(); var c = JSON.parse(b); return c}, loadChart:function(){var b = this.generateData(); var a = []; $.each(b.divided, function(c, d){a[c] = {label:d}}); if (b.chartData.length > 0){this.chartInstance = this.getPlotContainer(false).jqplot(b.chartData, {stackSeries:true, captureRightClick:true, seriesDefaults:{renderer:jQuery.jqplot.BarRenderer, rendererOptions:{highlightMouseOver:true, varyBarColor:true}, pointLabels:{show:true}}, series:a, axes:{xaxis:{renderer:$.jqplot.CategoryAxisRenderer, tickRenderer:$.jqplot.CanvasAxisTickRenderer, ticks:b.group, tickOptions:{angle: - 65, }}}, legend:{show:true, location:"e"}})}}, registerSectionClick:function(){var b = this.generateData(); var a = b.links; this.getContainer().off("jqplotDataClick").on("jqplotDataClick", function(f, c, e, g){var d = a[c][e]; window.location.href = d})}, }); Vtiger_Widget_Js("Vtiger_Barchat_Widget_Js", {}, {generateChartData:function(){var a = this.getContainer(); var b = a.find(".widgetData").val(); var g = JSON.parse(b); var f = []; var e = []; var d = 0; for (var c in g){var h = g[c]; h[0] = parseInt(h[0]); e.push(app.getDecodedValue(h[1])); f.push(h[0]); if (parseInt(h[0]) > d){d = parseInt(h[0])}}d = d + 2 + (d / 100) * 25; return{chartData:[f], yMaxValue:d, labels:e}}, loadChart:function(){var b = false; var a = this.getContainer(); var c = a.find(".color"); if (c.length){b = c.val() == 0?false:true}var d = this.generateChartData(); if (d.chartData[0].length > 0){this.getPlotContainer(false).jqplot(d.chartData, {title:d.title, animate:!$.jqplot.use_excanvas, seriesColors:(d.colors)?d.colors:false, seriesDefaults:{renderer:jQuery.jqplot.BarRenderer, rendererOptions:{showDataLabels:true, dataLabels:"value", barDirection:"vertical", varyBarColor:b}, pointLabels:{show:true, edgeTolerance: - 15}}, axes:{xaxis:{tickRenderer:jQuery.jqplot.CanvasAxisTickRenderer, renderer:jQuery.jqplot.CategoryAxisRenderer, ticks:d.labels, tickOptions:{angle: - 45, labelPosition:"auto"}}, yaxis:{min:0, max:d.yMaxValue, tickOptions:{formatString:"%d"}, pad:1.2}}, legend:{show:(d.data_labels)?true:false, location:(d.location)?d.location:"e", placement:(d.placement)?d.placement:"outside", showLabels:(d.data_labels)?true:false, showSwatch:(d.data_labels)?true:false, labels:d.data_labels}})}}, registerSectionClick:function(){var a = this.getContainer(); var c = a.find(".widgetData").val(); var b = JSON.parse(c); this.getContainer().off("jqplotDataClick").on("jqplotDataClick", function(h, d, g, f){var e = b[g][2]; window.location.href = e})}, }); Vtiger_Barchat_Widget_Js("Vtiger_Horizontal_Widget_Js", {}, {loadChart:function(){var b = false; var a = this.getContainer(); var c = a.find(".color"); if (c.length){b = c.val() == 0?false:true}var d = this.generateChartData(); this.getPlotContainer(false).jqplot(d.chartData, {title:d.title, animate:!$.jqplot.use_excanvas, seriesDefaults:{renderer:$.jqplot.BarRenderer, showDataLabels:true, pointLabels:{show:true, location:"e", edgeTolerance: - 15}, shadowAngle:135, rendererOptions:{barDirection:"horizontal", varyBarColor:b}}, axes:{yaxis:{tickRenderer:jQuery.jqplot.CanvasAxisTickRenderer, renderer:jQuery.jqplot.CategoryAxisRenderer, ticks:d.labels, tickOptions:{angle: - 45}}}, legend:{show:false, location:"e", placement:"outside", showSwatch:true, showLabels:true, labels:d.data_labels}})}}); Vtiger_Barchat_Widget_Js("Vtiger_Line_Widget_Js", {}, {loadChart:function(){var a = this.generateChartData(); if (a.chartData[0].length > 0){this.getPlotContainer(false).jqplot(a.chartData, {title:a.title, legend:{show:false, labels:a.labels, location:"ne", showSwatch:true, showLabels:true, placement:"outside"}, seriesDefaults:{pointLabels:{show:true}}, axes:{xaxis:{min:0, pad:1, renderer:$.jqplot.CategoryAxisRenderer, ticks:a.labels, tickOptions:{formatString:"%b %#d"}}}, cursor:{show:true}})}}}); Vtiger_Barchat_Widget_Js("Vtiger_Lineplain_Widget_Js", {}, {loadChart:function(){var a = this.generateChartData(); if (a.chartData[0].length > 0){this.getPlotContainer(false).jqplot(a.chartData, {title:a.title, axesDefaults:{labelRenderer:$.jqplot.CanvasAxisLabelRenderer}, seriesDefaults:{rendererOptions:{smooth:true}}, axes:{xaxis:{min:0, pad:0, renderer:$.jqplot.CategoryAxisRenderer, ticks:a.labels, tickOptions:{formatString:"%b %#d"}}}, cursor:{show:true}})}}}); Vtiger_Widget_Js("Vtiger_MultiBarchat_Widget_Js", {getCharRelatedData:function(){var a = this.getContainer(); var l = a.find(".widgetData").val(); var c = []; var d = []; var n = []; for (var m = 0; m < l.length; m++){if ($.inArray(l[m].last_name, c) == - 1){c.push(l[m].last_name)}if ($.inArray(l[m].sales_stage, d) == - 1){d.push(l[m].sales_stage)}}for (var h in d){var f = []; for (m in c){var e = 0; for (var g in l){var b = l[g]; if (b.sales_stage == d[h] && b.last_name == c[m]){e = parseInt(b.count); break}}f.push(e)}n.push(f)}return{data:n, ticks:c, labels:d}}, loadChart:function(){var c = this.getCharRelatedData(); var b = c.data; var a = c.ticks; var d = c.labels; $.jqplot.CanvasAxisTickRenderer.pt2px = 2.4; this.getPlotContainer(false).jqplot(b, {stackSeries:true, captureRightClick:true, seriesDefaults:{renderer:$.jqplot.BarRenderer, rendererOptions:{barMargin:10, highlightMouseDown:true, highlightMouseOver:true}, pointLabels:{show:true, hideZeros:true}}, axes:{xaxis:{renderer:$.jqplot.CategoryAxisRenderer, tickRenderer:$.jqplot.CanvasAxisTickRenderer, tickOptions:{angle: - 45, pt2px:4}, ticks:a}, yaxis:{padMin:0, min:0}}, legend:{show:true, location:"e", renderer:$.jqplot.EnhancedLegendRenderer, placement:"outside", labels:d}})}}); Vtiger_Widget_Js("Vtiger_Minilist_Widget_Js", {}, {postLoadWidget:function(){app.hideModalWindow(); this.restrictContentDrag(); this.registerFilterChangeEvent(); this.registerRecordsCount()}, postRefreshWidget:function(){this.registerRecordsCount()}}); Vtiger_Widget_Js("YetiForce_Charts_Widget_Js", {}, {loadChart:function(){var b = this.getContainer(); var d = b.find('[name="typeChart"]').val(); var c = d.toCamelCase(); var e = window["Report_" + c + "_Js"]; var a = false; if (typeof e != "undefined"){a = new e(b, true); a.loadChart()}}}); Vtiger_Widget_Js("Vtiger_Notebook_Widget_Js", {}, {postLoadWidget:function(){this.reinitNotebookView()}, reinitNotebookView:function(){var a = this; app.showScrollBar(jQuery(".dashboard_notebookWidget_viewarea", this.container), {height:"200px"}); jQuery(".dashboard_notebookWidget_edit", this.container).click(function(){a.editNotebookContent()}); jQuery(".dashboard_notebookWidget_save", this.container).click(function(){a.saveNotebookContent()})}, editNotebookContent:function(){jQuery(".dashboard_notebookWidget_text", this.container).show(); jQuery(".dashboard_notebookWidget_view", this.container).hide(); $("body").on("click", function(a){if ($(a.target).closest(".dashboard_notebookWidget_view").length === 0 && $(a.target).closest(".dashboard_notebookWidget_text").length === 0){$(".dashboard_notebookWidget_save").trigger("click")}})}, saveNotebookContent:function(){$("body").off("click"); var b = this; var a = jQuery(".dashboard_notebookWidget_textarea", this.container); var c = this.container.data("url"); var e = c + "&content=true&mode=save&contents=" + encodeURIComponent(a.val()); var d = this.container.find(".dashboardWidgetContent"); d.progressIndicator(); AppConnector.request(e).then(function(f){d.progressIndicator({mode:"hide"}); jQuery(".dashboardWidgetContent", b.container).html(f); b.reinitNotebookView()})}}); Vtiger_Widget_Js("Vtiger_KpiBarchat_Widget_Js", {}, {generateChartData:function(){var a = this.getContainer(); var b = a.find(".widgetData").val(); var f = JSON.parse(b); var e = []; var d = []; var c = 0; return{chartData:[[[f.result, f.all]]], yMaxValue:f.maxValue, labels:""}}, loadChart:function(){var a = this.generateChartData(); this.getPlotContainer(false).jqplot(a.chartData, {animate:!$.jqplot.use_excanvas, seriesDefaults:{renderer:jQuery.jqplot.BarRenderer, rendererOptions:{showDataLabels:true, dataLabels:"value", barDirection:"horizontal"}, }, axes:{xaxis:{min:0, max:a.yMaxValue, }, yaxis:{renderer:jQuery.jqplot.CategoryAxisRenderer, }}})}}); Vtiger_Widget_Js("YetiForce_Pie_Widget_Js", {}, {loadChart:function(){var a = this; var b = a.generateData(); a.chartInstance = $.plot(a.getPlotContainer(false), b.chartData, {series:{pie:{show:true, label:{formatter:a.getLabelFormat}}}, legend:{show:false}, grid:{hoverable:true, clickable:true}, })}, getLabelFormat:function(a, b){return"<div style='font-size:x-small;text-align:center;padding:2px;color:" + b.color + ";'>" + a + "<br />" + b.data[0][1] + "</div>"}, registerSectionClick:function(){var a = this; a.getPlotContainer().bind("plothover", function(c, d, b){if (b){$(this).css("cursor", "pointer")} else{$(this).css("cursor", "auto")}}); a.getPlotContainer().bind("plotclick", function(c, d, b){if (b){if (b.series.links){window.location.href = b.series.links}}})}}); Vtiger_Widget_Js("YetiForce_Bar_Widget_Js", {}, {generateData:function(){var d = this; var a = d.getContainer(); var b = a.find(".widgetData").val(); var f = JSON.parse(b); var e = []; for (var c in f.chart){e.push(f.chart[c]); d.chartData[f.chart[c].id] = f.chart[c]}return{chartData:e, ticks:f.ticks, links:f.links, legend:f.legend, valueLabels:f.valueLabels?f.valueLabels:{}}}, loadChart:function(){var b = this; var c = b.generateData(); var a = {xaxis:{minTickSize:1, ticks:c.ticks}, yaxis:{min:0, tickDecimals:0}, grid:{hoverable:true, clickable:true}, series:{bars:{show:true, barWidth:0.9, dataLabels:false, align:"center", lineWidth:0}, valueLabels:c.valueLabels, stack:true}, }; b.chartInstance = $.plot(b.getPlotContainer(false), c.chartData, a)}, getLabelFormat:function(a, b){return"<div style='font-size:x-small;text-align:center;padding:2px;color:" + b.color + ";'>" + a + "<br />" + b.data[0][1] + "</div>"}, registerSectionClick:function(){var a = this; var b = a.generateData(); a.getPlotContainer().bind("plothover", function(d, e, c){if (c){$(this).css("cursor", "pointer")} else{$(this).css("cursor", "auto")}}); a.getPlotContainer().bind("plotclick", function(d, e, c){if (c){$(b.links).each(function(){if (c.dataIndex == this[0]){window.location.href = this[1]}})}})}}); YetiForce_Bar_Widget_Js("YetiForce_Ticketsbystatus_Widget_Js", {}, {loadChart:function(){var b = this; var c = b.generateData(); var a = {xaxis:{minTickSize:1, ticks:c.ticks}, yaxis:{min:0, tickDecimals:0}, grid:{hoverable:true, clickable:true}, series:{bars:{show:true, barWidth:0.9, dataLabels:false, align:"center", lineWidth:0}, valueLabels:c.valueLabels, stack:true}, legend:{show:true, sorted:"reverse"}, }; b.chartInstance = $.plot(b.getPlotContainer(false), c.chartData, a)}, }); Vtiger_Widget_Js("YetiForce_Calendar_Widget_Js", {}, {calendarView:false, calendarCreateView:false, weekDaysArray:{Sunday:0, Monday:1, Tuesday:2, Wednesday:3, Thursday:4, Friday:5, Saturday:6}, registerCalendar:function(){var i = this; var a = "month"; var c = i.getContainer(); var g = jQuery("#time_format").val(); if (g == 24){g = "H(:mm)"} else{g = "h(:mm) A"}var e = jQuery("#start_day").val(); var h = i.weekDaysArray[e]; var f = jQuery("#start_hour").val(); var j = f.split(":"); f = j["0"]; var b = app.getMainParams("defaultDate"); if (this.paramCache && b != moment().format("YYYY-MM-DD")){b = moment(b).format("D") == 1?moment(b):moment(b).add(1, "M")}i.getCalendarView().fullCalendar({header:{left:" ", center:"prev title next", right:" "}, defaultDate:b, timeFormat:g, axisFormat:g, firstHour:f, firstDay:h, defaultView:a, editable:false, slotMinutes:15, theme:false, defaultEventMinutes:0, eventLimit:true, allDaySlot:false, monthNames:[app.vtranslate("JS_JANUARY"), app.vtranslate("JS_FEBRUARY"), app.vtranslate("JS_MARCH"), app.vtranslate("JS_APRIL"), app.vtranslate("JS_MAY"), app.vtranslate("JS_JUNE"), app.vtranslate("JS_JULY"), app.vtranslate("JS_AUGUST"), app.vtranslate("JS_SEPTEMBER"), app.vtranslate("JS_OCTOBER"), app.vtranslate("JS_NOVEMBER"), app.vtranslate("JS_DECEMBER")], monthNamesShort:[app.vtranslate("JS_JAN"), app.vtranslate("JS_FEB"), app.vtranslate("JS_MAR"), app.vtranslate("JS_APR"), app.vtranslate("JS_MAY"), app.vtranslate("JS_JUN"), app.vtranslate("JS_JUL"), app.vtranslate("JS_AUG"), app.vtranslate("JS_SEP"), app.vtranslate("JS_OCT"), app.vtranslate("JS_NOV"), app.vtranslate("JS_DEC")], dayNames:[app.vtranslate("JS_SUNDAY"), app.vtranslate("JS_MONDAY"), app.vtranslate("JS_TUESDAY"), app.vtranslate("JS_WEDNESDAY"), app.vtranslate("JS_THURSDAY"), app.vtranslate("JS_FRIDAY"), app.vtranslate("JS_SATURDAY")], dayNamesShort:[app.vtranslate("JS_SUN"), app.vtranslate("JS_MON"), app.vtranslate("JS_TUE"), app.vtranslate("JS_WED"), app.vtranslate("JS_THU"), app.vtranslate("JS_FRI"), app.vtranslate("JS_SAT")], buttonText:{today:app.vtranslate("JS_TODAY"), month:app.vtranslate("JS_MONTH"), week:app.vtranslate("JS_WEEK"), day:app.vtranslate("JS_DAY")}, allDayText:app.vtranslate("JS_ALL_DAY"), eventLimitText:app.vtranslate("JS_MORE"), eventRender:function(n, m, k){m = '<div class="cell-calendar">'; for (var l in n.event){m += '<a class="" href="javascript:;" data-date="' + n.date + '" data-type="' + l + '" title="' + n.event[l].label + '"><span class="' + n.event[l].className + ((n.width <= 20)?" small-badge":"") + ((n.width >= 24)?" big-badge":"") + ' badge">' + n.event[l].count + "</span></a>\n"}m += "</div>"; return m}}); i.getCalendarView().find("td.fc-day-top").mouseenter(function(){jQuery('<span class="plus pull-left fas fa-plus"></span>').prependTo($(this))}).mouseleave(function(){$(this).find(".plus").remove()}); i.getCalendarView().find("td.fc-day-top").click(function(){var k = $(this).data("date"); var l = {noCache:true}; l.data = {date_start:k, due_date:k}; l.callbackFunction = function(){i.getCalendarView().closest(".dashboardWidget").find('a[name="drefresh"]').trigger("click")}; Vtiger_Header_Js.getInstance().quickCreateModule("Calendar", l)}); var d = c.find(".switchBtn"); app.showBtnSwitch(d); d.on("switchChange.bootstrapSwitch", function(l, k){if (k){c.find(".widgetFilterSwitch").val("current")} else{c.find(".widgetFilterSwitch").val("history")}i.refreshWidget()})}, loadCalendarData:function(d){var k = this; k.getCalendarView().fullCalendar("removeEvents"); var j = k.getCalendarView().fullCalendar("getView"); var m = app.getMainParams("userDateFormat").toUpperCase(); var h = j.start.format(m); var c = j.end.format(m); var l = k.getContainer(); var f = l.find(".owner").val(); if (f == "all"){f = ""}var e = {module:"Calendar", action:"Calendar", mode:"getEvents", start:h, end:c, user:f, widget:true}; if (l.find(".customFilter").length > 0){var a = l.find(".customFilter").val(); e.customFilter = a}if (l.find(".widgetFilterSwitch").length > 0){e.time = l.find(".widgetFilterSwitch").val()}if (this.paramCache){var i = this.getContainer().find('a[name="drefresh"]'); var b = i.data("url"); var g = {owner:f, customFilter:a, start:h}; k.setFilterToCache(b, g)}AppConnector.request(e).then(function(p){var n = (k.getCalendarView().find(".fc-bg :first").height() - k.getCalendarView().find(".fc-day-number").height()) - 10; var q = (k.getCalendarView().find(".fc-day-number").width() / 2) - 10; for (var o in p.result){p.result[o]["width"] = q; p.result[o]["height"] = n}k.getCalendarView().fullCalendar("addEventSource", p.result); k.getCalendarView().find(".cell-calendar a").click(function(){var t = k.getContainer(); var v = "index.php?module=Calendar&view=List"; if (a){v += "&viewname=" + t.find("select.widgetFilter.customFilter").val()} else{v += "&viewname=All"}v += "&search_params=[["; var r = t.find(".widgetFilter.owner option:selected"); if (r.val() != "all"){v += '["assigned_user_id","e","' + r.val() + '"],'}if (l.find(".widgetFilterSwitch").length > 0){var s = l.find(".widgetFilterSwitch").data(); v += '["activitystatus","e","' + s[e.time] + '"],'}var u = moment($(this).data("date")).format(k.getUserDateFormat().toUpperCase()); window.location.href = v + '["activitytype","e","' + $(this).data("type") + '"],["date_start","bw","' + u + "," + u + '"]]]'})})}, getCalendarView:function(){if (this.calendarView == false){this.calendarView = this.getContainer().find("#calendarview")}return this.calendarView}, getMonthName:function(){var a = this; var b = a.getCalendarView().find(".fc-toolbar h2").text(); if (b){this.getContainer().find(".headerCalendar .month").html("<h3>" + b + "</h3>")}}, registerChangeView:function(){var d = this; var a = this.getContainer(); a.find(".fc-toolbar").addClass("hide"); var e = a.find(".fc-toolbar h2").text(); if (e){var b = a.find(".headerCalendar").removeClass("hide").find(".month").append("<h3>" + e + "</h3>"); var c = a.find(".headerCalendar button"); c.each(function(){var f = jQuery(this).data("type"); jQuery(this).on("click", function(){d.getCalendarView().find(".fc-toolbar ." + f).trigger("click"); d.loadCalendarData(); d.getMonthName()})})}}, postLoadWidget:function(){this.registerCalendar(); this.loadCalendarData(true); this.registerChangeView(); this.registerFilterChangeEvent()}, refreshWidget:function(){var b = this; var a = this.getContainer().find(".dashboardWidgetContent"); a.progressIndicator(); b.loadCalendarData(); a.progressIndicator({mode:"hide"})}, }); Vtiger_Widget_Js("YetiForce_Calendaractivities_Widget_Js", {}, {modalView:false, postLoadWidget:function(){this._super(); this.registerActivityChange(); this.registerListViewButton()}, postRefreshWidget:function(){this._super(); this.registerActivityChange()}, registerActivityChange:function(){var b = this; var a = this.getContainer().find(".dashboardWidgetContent"); a.find(".changeActivity").on("click", function(f){if (jQuery(f.target).is("a") || b.modalView){return}var d = jQuery(this).data("url"); if (typeof d != "undefined"){var c = function(){b.modalView = false}; b.modalView = true; app.showModalWindow(null, d, c)}})}, registerListViewButton:function(){var b = this; var a = b.getContainer(); a.find(".goToListView").on("click", function(){if (a.data("name") == "OverdueActivities"){var d = "PLL_OVERDUE"} else{var d = "PLL_IN_REALIZATION,PLL_PLANNED"}var e = "index.php?module=Calendar&view=List&viewname=All"; e += "&search_params=[["; var c = a.find(".widgetFilter.owner option:selected"); if (c.val() != "all"){e += '["assigned_user_id","e","' + c.val() + '"],'}e += '["activitystatus","e","' + d + '"]]]'; window.location.href = e})}}); YetiForce_Calendaractivities_Widget_Js("YetiForce_Assignedupcomingcalendartasks_Widget_Js", {}, {}); YetiForce_Calendaractivities_Widget_Js("YetiForce_Creatednotmineactivities_Widget_Js", {}, {}); YetiForce_Calendaractivities_Widget_Js("YetiForce_Overdueactivities_Widget_Js", {}, {}); YetiForce_Calendaractivities_Widget_Js("YetiForce_Assignedoverduecalendartasks_Widget_Js", {}, {}); Vtiger_Widget_Js("YetiForce_Productssoldtorenew_Widget_Js", {}, {modalView:false, postLoadWidget:function(){this._super(); this.registerAction(); this.registerListViewButton()}, postRefreshWidget:function(){this._super(); this.registerAction()}, registerAction:function(){var b = this; var a = this.getContainer().find(".dashboardWidgetContent"); a.find(".rowAction").on("click", function(f){if (jQuery(f.target).is("a") || b.modalView){return}var d = jQuery(this).data("url"); if (typeof d != "undefined"){var c = function(){b.modalView = false}; b.modalView = true; app.showModalWindow(null, d, c)}})}, registerListViewButton:function(){var b = this; var a = b.getContainer(); a.find(".goToListView").on("click", function(){var c = jQuery(this).data("url"); var e = a.find(".orderby"); var d = a.find(".changeRecordSort"); if (e.length){c += "&orderby=" + e.val()}if (d.length){c += "&sortorder=" + d.data("sort").toUpperCase()}window.location.href = c})}}); YetiForce_Productssoldtorenew_Widget_Js("YetiForce_Servicessoldtorenew_Widget_Js", {}, {}); YetiForce_Bar_Widget_Js("YetiForce_Alltimecontrol_Widget_Js", {}, {loadChart:function(){var b = this; var c = b.generateData(); var a = {xaxis:{minTickSize:1, ticks:c.ticks}, yaxis:{min:0, tickDecimals:0}, grid:{hoverable:true, clickable:true}, series:{bars:{show:true, barWidth:0.8, dataLabels:false, align:"center", lineWidth:0, }, stack:true}, legend:{show:true, labelFormatter:function(d, e){return("<b>" + d + "</b>: " + c.legend[d] + " h")}}}; b.chartInstance = $.plot(b.getPlotContainer(false), c.chartData, a)}}); YetiForce_Bar_Widget_Js("YetiForce_Leadsbysource_Widget_Js", {}, {registerSectionClick:function(){var a = this; var b = a.generateData(); a.getPlotContainer().bind("plothover", function(d, e, c){if (c){$(this).css("cursor", "pointer")} else{$(this).css("cursor", "auto")}}); a.getPlotContainer().bind("plotclick", function(d, e, c){if (c){$(b.links).each(function(){if (c.seriesIndex == this[0]){window.location.href = this[1]}})}})}}); Vtiger_Pie_Widget_Js("YetiForce_Closedticketsbypriority_Widget_Js", {}, {generateData:function(){var a = this.getContainer(); var g = a.find(".widgetData").val(); var e = JSON.parse(g); var d = []; var c = []; var h = []; for (var f in e){var i = e[f]; var b = [i.name, i.count]; d.push(b); c.push(i.color); h.push(i.url)}return{chartData:d, color:c, url:h}}, loadChart:function(){var a = this.generateData(); if (a.chartData.length > 0){this.chartInstance = this.getPlotContainer(false).jqplot([a.chartData], {seriesDefaults:{renderer:jQuery.jqplot.PieRenderer, rendererOptions:{showDataLabels:true, dataLabels:"value"}}, seriesColors:a.color, legend:{show:true, location:"e"}, title:a.title})}}, registerSectionClick:function(){var a = this.generateData(); this.getContainer().off("jqplotDataClick").on("jqplotDataClick", function(f, b, e, d){var c = a.url[e]; window.location.href = c})}, }); Vtiger_Barchat_Widget_Js("YetiForce_Closedticketsbyuser_Widget_Js", {}, {}); Vtiger_Barchat_Widget_Js("YetiForce_Opentickets_Widget_Js", {}, {generateChartData:function(){var a = this.getContainer(); var f = a.find(".widgetData").val(); var d = JSON.parse(f); var c = []; var h = []; var g = 0; var b = []; for (var e in d){var i = d[e]; i[0] = parseInt(i[0]); h.push(app.getDecodedValue(i[1])); c.push([app.getDecodedValue(i[1]), i[0]]); if (parseInt(i[0]) > g){g = parseInt(i[0])}b.push(i[3])}g = g + 2 + (g / 100) * 25; return{chartData:[c], yMaxValue:g, labels:h, colors:b}}, loadChart:function(){var a = this.generateChartData(); if (a.chartData[0].length > 0){this.getPlotContainer(false).jqplot(a.chartData, {title:a.title, animate:!$.jqplot.use_excanvas, seriesColors:a.colors != false?a.colors:"", seriesDefaults:{renderer:jQuery.jqplot.BarRenderer, rendererOptions:{showDataLabels:true, dataLabels:"value", barDirection:"vertical", varyBarColor:true}, pointLabels:{show:true, edgeTolerance: - 15}}, axes:{xaxis:{tickRenderer:jQuery.jqplot.CanvasAxisTickRenderer, renderer:jQuery.jqplot.CategoryAxisRenderer, tickOptions:{angle: - 45, labelPosition:"auto"}}, yaxis:{min:0, max:a.yMaxValue, tickOptions:{formatString:"%d"}, pad:1.2}}, legend:{show:false, }})}}, }); YetiForce_Bar_Widget_Js("YetiForce_Accountsbyindustry_Widget_Js", {}, {registerSectionClick:function(){var a = this; var b = a.generateData(); a.getPlotContainer().bind("plothover", function(d, e, c){if (c){$(this).css("cursor", "pointer")} else{$(this).css("cursor", "auto")}}); a.getPlotContainer().bind("plotclick", function(d, e, c){if (c){$(b.links).each(function(){if (c.seriesIndex == this[0]){window.location.href = this[1]}})}})}}); Vtiger_Funnel_Widget_Js("YetiForce_Estimatedvaluebystatus_Widget_Js", {}, {generateData:function(){var a = this.getContainer(); var c = a.find(".widgetData").val(); var b = JSON.parse(c); return b}, loadChart:function(){var a = this.generateData(); if (a.length > 0){this.chartInstance = this.getPlotContainer(false).jqplot([a], {seriesDefaults:{renderer:jQuery.jqplot.FunnelRenderer, rendererOptions:{sectionMargin:0, widthRatio:0.3, showDataLabels:true, dataLabelThreshold:0, dataLabels:"label", highlightMouseDown:true}}, legend:{show:false, location:"e", }})}}}); Vtiger_Barchat_Widget_Js("YetiForce_Notificationsbysender_Widget_Js", {}, {}); Vtiger_Barchat_Widget_Js("YetiForce_Notificationsbyrecipient_Widget_Js", {}, {}); Vtiger_Barchat_Widget_Js("YetiForce_Teamsestimatedsales_Widget_Js", {}, {generateChartData:function(){var f = this; var a = this.getContainer(); var b = a.find(".widgetData").val(); var h = JSON.parse(b); var g = [[], [], [], []]; var e = 0; if (h.hasOwnProperty("compare")){for (var d in h){var c = f.parseChartData(h[d], g); g[0].push(c[0]); g[3].push(c[3]); g = [g[0], c[1], c[2], g[3], ["#CC6600", "#208CB3"]]}} else{var c = f.parseChartData(h, g); g = [[c[0]], c[1], c[2], [c[3]], ["#208CB3"]]}var e = g[1]; e = e + 2 + (e / 100) * 25; return{chartData:g[0], yMaxValue:e, labels:g[2], data_labels:g[3], placement:"inside", location:"n", colors:g[4]}}, parseChartData:function(f, d){var e = []; var c = []; var b = 0; for (var a in f){var g = f[a]; g[0] = parseInt(g[0]); b += g[0]; c.push(app.getDecodedValue(g[1])); e.push(g[0]); if (parseInt(g[0]) > d[1]){d[1] = parseInt(g[0])}}return[e, d[1], c, "&nbsp; \u03A3 " + b + "&nbsp;"]}, registerSectionClick:function(){var a = this.getContainer(); var d = a.find(".widgetData").val(); var b = JSON.parse(d); var c = b && b.hasOwnProperty("compare"); this.getContainer().off("jqplotDataClick").on("jqplotDataClick", function(i, e, h, g){if (e){var f = b.compare[h][2]} else{if (c){var f = b[0][h][2]} else{var f = b[h][2]}}window.location.href = f})}}); YetiForce_Teamsestimatedsales_Widget_Js("YetiForce_Actualsalesofteam_Widget_Js", {}, {});
