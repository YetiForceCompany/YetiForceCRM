{"version":3,"file":"Kanban.min.js","sources":["Kanban.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 4.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\n$.Class(\n\t'Vtiger_Kanban_Js',\n\t{},\n\t{\n\t\t/**\n\t\t * Get params\n\t\t */\n\t\tgetParams: function () {\n\t\t\tconst params = [];\n\t\t\tthis.page.find('.js-params').each(function () {\n\t\t\t\tlet element = $(this);\n\t\t\t\tparams[element.attr('name')] = element.val();\n\t\t\t});\n\t\t\treturn $.extend(\n\t\t\t\t{\n\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\tview: 'Kanban',\n\t\t\t\t\tboard: this.page.find('.js-board-tab.active').data('id')\n\t\t\t\t},\n\t\t\t\tparams\n\t\t\t);\n\t\t},\n\t\tloadKanban: function () {\n\t\t\tconst params = this.getParams(),\n\t\t\t\turlParams = Object.assign({}, params);\n\t\t\tdelete urlParams.orderBy;\n\t\t\tapp.changeUrl(urlParams);\n\t\t\tAppConnector.request(params)\n\t\t\t\t.done((responseData) => {\n\t\t\t\t\tthis.container.html(responseData);\n\t\t\t\t\tthis.registerSortable();\n\t\t\t\t})\n\t\t\t\t.fail((status, errorThrown) => {\n\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\ttitle: app.vtranslate('JS_ERROR'),\n\t\t\t\t\t\ttext: errorThrown,\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t},\n\t\tregisterSortable: function () {\n\t\t\tconst boards = this.container.find('.js-kanban-records');\n\t\t\tboards.sortable({\n\t\t\t\tcontainment: this.container,\n\t\t\t\titems: boards.find('.js-kanban-record'),\n\t\t\t\tcancel: '.js-kanban-disabled',\n\t\t\t\tconnectWith: boards,\n\t\t\t\tplaceholder: 'c-kanban__highlight',\n\t\t\t\trevert: true,\n\t\t\t\ttolerance: 'pointer',\n\t\t\t\tcursor: 'move',\n\t\t\t\tupdate: (e, ui) => {\n\t\t\t\t\tif (ui.sender == null) {\n\t\t\t\t\t\tconst records = ui.item.closest('.js-kanban-records');\n\t\t\t\t\t\tVtiger_Edit_Js.saveAjax({\n\t\t\t\t\t\t\trecord: ui.item.data('id'),\n\t\t\t\t\t\t\tfield: records.data('field'),\n\t\t\t\t\t\t\tvalue: records.data('value')\n\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.done(() => {\n\t\t\t\t\t\t\t\tthis.loadKanban();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.fail(function (error, err) {\n\t\t\t\t\t\t\t\tapp.errorLog(error, err);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tstart: (e, ui) => {\n\t\t\t\t\tui.placeholder.height(ui.helper.outerHeight());\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Registers Kanban view events.\n\t\t */\n\t\tregisterEvents: function () {\n\t\t\tthis.page = $('#centerPanel');\n\t\t\tthis.container = $('.js-kanban-container');\n\t\t\tthis.registerSortable();\n\t\t\tthis.page.on('click', '.js-board-tab', (e) => {\n\t\t\t\tthis.page.find('.js-board-tab.active').removeClass('active');\n\t\t\t\t$(e.currentTarget).addClass('active');\n\t\t\t\tthis.loadKanban();\n\t\t\t});\n\t\t\tthis.page.on('change', '.js-params', () => {\n\t\t\t\tthis.loadKanban();\n\t\t\t});\n\t\t\tthis.page.on('click', '.js-list-reload', (e, data) => {\n\t\t\t\tthis.page.find('#orderBy').val(JSON.stringify(data.orderby)).trigger('change');\n\t\t\t});\n\t\t}\n\t}\n);\n"],"names":["$","Class","getParams","page","find","each","params","element","attr","val","extend","module","app","getModuleName","view","board","data","loadKanban","urlParams","Object","assign","orderBy","changeUrl","AppConnector","request","done","responseData","container","html","registerSortable","fail","status","errorThrown","showNotify","title","vtranslate","text","type","boards","sortable","containment","items","cancel","connectWith","placeholder","revert","tolerance","cursor","update","e","ui","sender","item","closest","Vtiger_Edit_Js","saveAjax","record","field","records","value","error","err","errorLog","start","height","helper","outerHeight","registerEvents","on","removeClass","currentTarget","addClass","JSON","stringify","orderby","trigger"],"mappings":"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"}