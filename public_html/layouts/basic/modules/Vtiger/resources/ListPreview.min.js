'use strict';

Vtiger_List_Js('Vtiger_ListPreview_Js',{},{frameProgress:!1,updatePreview:function d(a){var b=$('.listPreviewframe');this.frameProgress=$.progressIndicator({position:'html',message:app.vtranslate('JS_FRAME_IN_PROGRESS'),blockInfo:{enabled:!0}});var c='';app.getMainParams('defaultDetailViewName')&&(c=c+'&mode=showDetailViewByMode&requestMode='+app.getMainParams('defaultDetailViewName')),b.attr('src',a.replace('view=Detail','view=DetailPreview')+c);},registerRowClickEvent:function c(){var a=this,b=this.getListViewContentContainer();b.on('click','.listViewEntries',function(b){if(!$(b.target).closest('div').hasClass('actions')&&!($(b.target).is('button')||$(b.target).parent().is('button'))&&!$(b.target).closest('a').hasClass('noLinkBtn')&&!$(b.target,$(b.currentTarget)).is('td:first-child')&&!$(b.target).is('input[type="checkbox"]')&&!$.contains($(b.currentTarget).find('td:last-child').get(0),b.target)&&!$.contains($(b.currentTarget).find('td:first-child').get(0),b.target)){var c=$(b.currentTarget),d=c.data('recordurl');'undefined'==typeof d||($('.listViewEntriesTable .listViewEntries').removeClass('active'),$(this).addClass('active'),a.updatePreview(d));}});},registerListEvents:function k(a){var b=this,c=a.find('.js-detail-preview'),d=a.closest('.mainBody'),e=$('.commonActionsContainer').height();app.showNewScrollbarTopBottom(a.find('.js-list-preview--scroll')),app.showNewScrollbarLeft(this.list),$(window).on('resize',function(){d.scrollTop()>=b.list.offset().top+e&&a.find('.gutter').css('left',c.offset().left-8);});var f=this.list.offset().top-this.headerH,g=this.sideBlocks.height(),h={height:d.height()},i={width:d.height()};this.gutter.addClass('js-fixed-scroll');var j=a.find('.js-fixed-scroll');d.on('scroll',function(){d.scrollTop()>=f?(j.css({top:d.scrollTop()-f}),j.css(h),b.rotatedText.css(h),b.rotatedText.css(i)):(j.css({top:'initial'}),j.css({height:g+d.scrollTop()}),b.rotatedText.css({width:g+d.scrollTop(),height:g+d.scrollTop()}));}),this.list.on('click','.listViewEntries',function(){if(10>b.split.getSizes()[1]){var a=b.getDefaultSplitSizes();b.split.setSizes(a),c.show(),b.sideBlockRight.removeClass('d-block'),app.moduleCacheSet('userSplitSet',a);}});},getSecondColMinWidth:function d(a){var b,c;return a.find('.listViewEntries').each(function(a){c=$(this).find('.listViewEntryValue a').first().width(),0===a?b=c:c>b?b=c:b;}),b},getDomParams:function b(a){this.listColumnFirstWidth=a.find('.listViewEntriesDiv .listViewHeaders th').first().width(),this.listColumnSecondWidth=this.getSecondColMinWidth(a),this.windowMinWidth=100*(15/$(window).width()),this.windowMaxWidth=100-this.minWidth,this.sideBlocks=a.find('.js-side-block'),this.sideBlockLeft=this.sideBlocks.first(),this.sideBlockRight=this.sideBlocks.last(),this.list=a.find('.js-list-preview'),this.rotatedText=a.find('.u-rotate-90'),this.footerH=$('.js-footer').outerHeight(),this.headerH=$('.js-header').outerHeight();},getDefaultSplitSizes:function b(){var a=100*((this.listColumnFirstWidth+this.listColumnSecondWidth+82)/$(window).width());return [a,100-a]},getSplitSizes:function b(){var a=app.moduleCacheGet('userSplitSet');return null===a?this.getDefaultSplitSizes():a},registerSplitEvents:function g(a,b){var c=this,d=100*(400/$(window).width()),e=100*(25/$(window).width()),f=a.find('.js-detail-preview');this.gutter.on('dblclick',function(){var a=app.moduleCacheGet('gutterMidPosition');isNaN(c.split.getSizes()[0])&&c.split.setSizes(a),10>b.getSizes()[0]?(c.sideBlockLeft.removeClass('d-block'),c.list.removeClass('u-hide-underneath'),11<a[0]?b.setSizes(a):b.setSizes(c.getDefaultSplitSizes())):20>b.getSizes()[1]?(a[1]>d+1?b.setSizes(a):b.setSizes(c.getDefaultSplitSizes()),c.sideBlockRight.removeClass('d-block'),f.show(),c.gutter.css('right','initial')):10<b.getSizes()[0]&&50>b.getSizes()[0]?(b.setSizes([e,100-e]),c.list.addClass('u-hide-underneath'),c.sideBlockLeft.addClass('d-block')):10<b.getSizes()[1]&&50>b.getSizes()[1]&&(b.collapse(1),c.sideBlockRight.addClass('d-block'),f.hide(),c.list.width(c.list.width()-10)),app.moduleCacheSet('userSplitSet',b.getSizes());}),this.sideBlockLeft.on('click',function(){var a=app.moduleCacheGet('gutterMidPosition');11<a[0]?b.setSizes(a):b.setSizes(c.getDefaultSplitSizes()),c.sideBlockLeft.removeClass('d-block'),c.list.removeClass('u-hide-underneath'),app.moduleCacheSet('userSplitSet',b.getSizes());}),this.sideBlockRight.on('click',function(){var a=app.moduleCacheGet('gutterMidPosition');a[1]>d+1?b.setSizes(a):b.setSizes(c.getDefaultSplitSizes()),c.sideBlockRight.removeClass('d-block'),f.show(),c.gutter.css('right','initial'),app.moduleCacheSet('userSplitSet',b.getSizes());});},registerSplit:function k(a){var b=this,c=100*(400/$(window).width()),d=100*(25/$(window).width()),e=100-d,f=a.find('.listViewEntriesDiv .listViewHeaders th').first();f=100*((f.width()+f.next().width()+62)/$(window).width());var g=a.find('.js-detail-preview'),h=this.getSplitSizes(),i=Split([this.list[0],g[0]],{sizes:h,minSize:10,gutterSize:24,snapOffset:100,onDrag:function a(){i.getSizes()[1]<c&&i.collapse(1),5>i.getSizes()[0]?(b.sideBlockLeft.addClass('d-block'),b.list.addClass('u-hide-underneath')):(b.sideBlockLeft.removeClass('d-block'),b.list.removeClass('u-hide-underneath')),10>i.getSizes()[1]?(b.sideBlockRight.addClass('d-block'),g.hide(),b.list.width(b.list.width()-10)):(b.sideBlockRight.removeClass('d-block'),g.show()),10<i.getSizes()[0]&&i.getSizes()[1]>c&&app.moduleCacheSet('gutterMidPosition',i.getSizes()),app.moduleCacheSet('userSplitSet',i.getSizes());}});10>h[0]?(g.width(g.width()-150),this.sideBlockLeft.addClass('d-block'),i.setSizes([d,e]),this.list.addClass('u-hide-underneath')):h[1]<c&&(this.sideBlockRight.addClass('d-block'),g.hide(),i.setSizes([e,d])),this.gutter=a.find('.gutter');var j={height:$(window).height()-(this.gutter.offset().top+this.footerH)};return this.gutter.css(j),this.list.css(j),this.sideBlocks.css(j),this.registerSplitEvents(a,i),this.rotatedText.first().find('.js-list-name').append($('.breadcrumbsContainer .js-text-content').text()),this.rotatedText.css({width:this.sideBlockLeft.height(),height:this.sideBlockLeft.height()}),i},toggleSplit:function g(a){var b=this,c=this,d=a.find('.js-detail-preview'),e=[],f=a.closest('.mainBody');993<$(window).width()&&!a.find('.gutter').length&&(this.split=c.registerSplit(a),e.push(this.split)),$(window).on('resize',function(){if(993>$(window).width())a.find('.gutter').length&&(e[e.length-1].destroy(),b.sideBlockRight.removeClass('d-block'),b.sideBlockLeft.removeClass('d-block'));else{1!==a.find('.gutter').length&&(b.split=c.registerSplit(a),b.gutter=a.find('.gutter'),b.gutter.addClass('js-fixed-scroll'),f.scrollTop()>=b.list.offset().top&&(gutter.addClass('gutterOnScroll'),gutter.css('left',d.offset().left-8),gutter.on('mousedown',function(){$(this).on('mousemove',function(){$(this).css('left',d.offset().left-8);});})),e.push(b.split));var g=e[e.length-1];if('undefined'==typeof g)return;g.getSizes()[0]<b.windowMinWidth+5?g.setSizes([b.windowMinWidth,b.windowMaxWidth]):g.getSizes()[1]<b.windowMinWidth+5&&g.setSizes([b.windowMaxWidth,b.windowMinWidth]);}});},registerPreviewEvent:function e(){var a=this,c=$('.listPreviewframe'),d=this.getListViewContentContainer();this.getDomParams(d),this.toggleSplit(d),993<$(window).width()&&this.registerListEvents(d),c.on('load',function(){a.frameProgress.progressIndicator({mode:'hide'}),c.height(c.contents().find('.bodyContents').height()-20);}),$('.listViewEntriesTable .listViewEntries').first().trigger('click');},updateWindowHeight:function c(a,b){b.height(a);},postLoadListViewRecordsEvents:function b(a){this._super(a),this.registerPreviewEvent();},registerEvents:function a(){this._super(),this.registerPreviewEvent();}});
