'use strict';

(/MSIE 6.0/.test(navigator.userAgent)||/MSIE 7.0/.test(navigator.userAgent)||/MSIE 8.0/.test(navigator.userAgent)||/MSIE 9.0/.test(navigator.userAgent))&&'true'!=app.getCookie('oldbrowser')&&(app.setCookie('oldbrowser',!0,365),window.location.href='layouts/basic/modules/Vtiger/browsercompatibility/Browser_compatibility.html'),$.Class('Vtiger_Header_Js',{quickCreateModuleCache:{},self:!1,getInstance:function getInstance(){return !1==this.self?(this.self=new Vtiger_Header_Js,this.self):this.self}},{menuContainer:!1,contentContainer:!1,quickCreateCallBacks:[],init:function init(){this.setContentsContainer('.js-base-container');},setContentsContainer:function setContentsContainer(element){return this.contentContainer=element instanceof $?element:$(element),this},getContentsContainer:function getContentsContainer(){return this.contentContainer},registerQuickCreateSearch:function registerQuickCreateSearch(){$('.js-quickcreate-search').on('keyup',function(){var value=$(this).val().toLowerCase();$('.quickCreateModules .js-quickcreate-search-item a').filter(function(){var item=$(this).closest('.js-quickcreate-search-item');-1<$(this).text().toLowerCase().indexOf(value)?item.removeClass('d-none'):item.addClass('d-none');}),$('.js-quickcreate-search-block').hide(),$('.js-quickcreate-search-item').not('.d-none').each(function(){$(this).closest('.js-quickcreate-search-block').show();});});},getQuickCreateForm:function getQuickCreateForm(url,moduleName,params){var requestParams,aDeferred=$.Deferred();return ('undefined'==typeof params&&(params={}),(!params.noCache||'undefined'==typeof params.noCache)&&'undefined'!=typeof Vtiger_Header_Js.quickCreateModuleCache[moduleName])?(aDeferred.resolve(Vtiger_Header_Js.quickCreateModuleCache[moduleName]),aDeferred.promise()):(requestParams=url,'undefined'!=typeof params.data&&(requestParams={},requestParams.data=params.data,requestParams.url=url),AppConnector.request(requestParams).done(function(data){params.noCache&&'undefined'!=typeof params.noCache||(Vtiger_Header_Js.quickCreateModuleCache[moduleName]=data),aDeferred.resolve(data);}),aDeferred.promise())},registerQuickCreateCallBack:function registerQuickCreateCallBack(callBackFunction){return !('function'!=typeof callBackFunction)&&(this.quickCreateCallBacks.push(callBackFunction),!0)},quickCreateSave:function quickCreateSave(form){var aDeferred=$.Deferred(),quickCreateSaveUrl=form.serializeFormData();return AppConnector.request(quickCreateSaveUrl).done(function(data){aDeferred.resolve(data);},function(textStatus,errorThrown){aDeferred.reject(textStatus,errorThrown);}),aDeferred.promise()},quickCreateGoToFullForm:function quickCreateGoToFullForm(form){form.find('input[name="action"]').remove(),form.append('<input type="hidden" name="view" value="Edit" />'),$.each(form.find('[data-validation-engine]'),function(key,data){$(data).removeAttr('data-validation-engine');}),form.addClass('not_validation'),form.submit();},showAnnouncement:function showAnnouncement(){var thisInstance=this,announcementContainer=$('#announcements'),announcements=announcementContainer.find('.announcement');if(0<announcements.length){var announcement=announcements.first(),aid=announcement.data('id');app.showModalWindow(announcement.find('.modal'),function(modal){announcement.remove(),modal.find('button').on('click',function(){AppConnector.request({module:'Announcements',action:'BasicAjax',mode:'mark',record:aid,type:$(this).data('type')}).done(function(){app.hideModalWindow(),thisInstance.showAnnouncement();});});},'',{backdrop:'static'});}},registerAnnouncements:function registerAnnouncements(){var thisInstance=this,announcementContainer=$('#announcements');return 0!=announcementContainer.length&&void thisInstance.showAnnouncement()},registerCalendarButtonClickEvent:function registerCalendarButtonClickEvent(){var element=$('#calendarBtn'),dateFormat=element.data('dateFormat'),currentDate=element.data('date'),vtigerDateFormat=app.convertToDatePickerFormat(dateFormat);element.on('click',function(e){e.stopImmediatePropagation(),element.closest('div.nav').find('div.open').removeClass('open');var calendar=$('#'+element.data('datepickerId'));$(calendar).is(':visible')?element.DatePickerHide():element.DatePickerShow();}),element.DatePicker({format:vtigerDateFormat,date:currentDate,calendars:1,starts:1,className:'globalCalendar'});},registerHelpInfo:function registerHelpInfo(container){'undefined'==typeof container&&(container=$('form[name="QuickCreate"]')),app.showPopoverElementView(container.find('.js-help-info'));},handleQuickCreateData:function handleQuickCreateData(data,params){'undefined'==typeof params&&(params={});var thisInstance=this;app.showModalWindow(data,function(container){var quickCreateForm=container.find('form[name="QuickCreate"]'),moduleName=quickCreateForm.find('[name="module"]').val(),editViewInstance=Vtiger_Edit_Js.getInstanceByModuleName(moduleName);editViewInstance.registerBasicEvents(quickCreateForm);var moduleClassName=moduleName+'_QuickCreate_Js';'undefined'!=typeof window[moduleClassName]&&new window[moduleClassName]().registerEvents(container),quickCreateForm.validationEngine(app.validationEngineOptions),'undefined'!=typeof params.callbackPostShown&&params.callbackPostShown(quickCreateForm),thisInstance.registerQuickCreatePostLoadEvents(quickCreateForm,params),thisInstance.registerHelpInfo(quickCreateForm);});},isFreeDay:function isFreeDay(dayOfWeek){return !(0!=dayOfWeek&&6!=dayOfWeek)},registerQuickCreatePostLoadEvents:function registerQuickCreatePostLoadEvents(form,params){var thisInstance=this,submitSuccessCallbackFunction=params.callbackFunction,goToFullFormCallBack=params.goToFullFormcallback;'undefined'==typeof submitSuccessCallbackFunction&&(submitSuccessCallbackFunction=function(){}),form.on('submit',function(e){var form=$(e.currentTarget);if(form.hasClass('not_validation'))return !0;var module=form.find('[name="module"]').val();if('undefined'!=typeof form.data('submit'))return !1;var invalidFields=form.data('jqv').InvalidFields;if(0<invalidFields.length)return form.removeData('submit'),$.progressIndicator({mode:'hide'}),void e.preventDefault();form.data('submit','true'),$.progressIndicator({mode:'hide'});var recordPreSaveEvent=$.Event(Vtiger_Edit_Js.recordPreSave);if(form.trigger(recordPreSaveEvent,{value:'edit',module:module}),!recordPreSaveEvent.isDefaultPrevented()){var targetInstance=thisInstance,moduleInstance=Vtiger_Edit_Js.getInstanceByModuleName(module);'function'==typeof moduleInstance.quickCreateSave&&(targetInstance=moduleInstance);var progress=$.progressIndicator({message:app.vtranslate('JS_SAVE_LOADER_INFO'),position:'html',blockInfo:{enabled:!0}});targetInstance.quickCreateSave(form).done(function(data){app.hideModalWindow();var parentModule=app.getModuleName(),viewname=app.getViewName();if(module==parentModule&&'List'==viewname){var listinstance=new Vtiger_List_Js;listinstance.getListViewRecords();}submitSuccessCallbackFunction(data);for(var callBack,registeredCallBackList=thisInstance.quickCreateCallBacks,index=0;index<registeredCallBackList.length;index++)callBack=registeredCallBackList[index],callBack({data:data,name:form.find('[name="module"]').val()});app.event.trigger('QuickCreate.AfterSaveFinal',data,form),progress.progressIndicator({mode:'hide'}),data.success&&Vtiger_Helper_Js.showPnotify({text:app.vtranslate('JS_SAVE_NOTIFY_SUCCESS'),type:'success'});});}else form.removeData('submit'),$.progressIndicator({mode:'hide'});e.preventDefault();}),form.find('.js-full-editlink').on('click',function(e){var form=$(e.currentTarget).closest('form'),editViewUrl=$(e.currentTarget).data('url');'undefined'!=typeof goToFullFormCallBack&&goToFullFormCallBack(form),thisInstance.quickCreateGoToFullForm(form,editViewUrl);}),this.registerTabEventsInQuickCreate(form);},registerTabEventsInQuickCreate:function registerTabEventsInQuickCreate(form){var tabElements=form.find('.nav.nav-pills , .nav.nav-tabs').find('a'),quickCreateTabOnHide=function(target){var container=$(target);container.find('[name]').each(function(index,element){element=$(element),element.attr('data-element-name',element.attr('name')).removeAttr('name');});},quickCreateTabOnShow=function(target){var container=$(target);container.find('[data-element-name]').each(function(index,element){element=$(element),element.attr('name',element.attr('data-element-name')).removeAttr('data-element-name');});};tabElements.on('click',function(){quickCreateTabOnHide(tabElements.not('[aria-expanded="false"]').attr('data-target')),quickCreateTabOnShow($(this).attr('data-target')),form.data('jqv').InvalidFields=[];}),tabElements.filter('a:not(.active)').each(function(){quickCreateTabOnHide($(this).attr('data-target'));});},basicSearch:function basicSearch(){var thisInstance=this;$('.js-global-search__value').on('keypress',function(e){var currentTarget=$(e.currentTarget);13==e.which&&(thisInstance.hideSearchMenu(),thisInstance.labelSearch(currentTarget));}),$('.js-global-search-operator').on('click',function(e){var currentTarget=$(e.target),block=currentTarget.closest('.js-global-search__input');block.find('.js-global-search__value').data('operator',currentTarget.data('operator')),block.find('.js-global-search-operator .dropdown-item').removeClass('active'),currentTarget.closest('.dropdown-item').addClass('active');}),1==$('#gsAutocomplete').val()&&($.widget('custom.gsAutocomplete',$.ui.autocomplete,{_create:function _create(){this._super(),this.widget().menu('option','items','> :not(.ui-autocomplete-category)');},_renderMenu:function _renderMenu(ul,items){var that=this,currentCategory='';$.each(items,function(index,item){item.category!=currentCategory&&(ul.append('<li class=\'ui-autocomplete-category\'>'+item.category+'</li>'),currentCategory=item.category),that._renderItemData(ul,item);});},_renderItemData:function _renderItemData(ul,item){return this._renderItem(ul,item).data('ui-autocomplete-item',item)},_renderItem:function _renderItem(ul,item){var url='index.php?module='+item.module+'&view=Detail&record='+item.id;return $('<li>').data('item.autocomplete',item).append($('<a href=\''+url+'\'></a>').html(item.label)).appendTo(ul)}}),$('.js-global-search__value').gsAutocomplete({minLength:app.getMainParams('gsMinLength'),source:function source(request,response){var basicSearch=new Vtiger_BasicSearch_Js;basicSearch.reduceNumberResults=app.getMainParams('gsAmountResponse'),basicSearch.returnHtml=!1,basicSearch.setMainContainer(this.element.closest('.js-global-search__input')),basicSearch.search(request.term).done(function(data){data=JSON.parse(data);var serverDataFormat=data.result,reponseDataList=[];for(var id in serverDataFormat){var responseData=serverDataFormat[id];reponseDataList.push(responseData);}response(reponseDataList);});},select:function select(event,ui){var selectedItemData=ui.item;if(selectedItemData.permitted){var url='index.php?module='+selectedItemData.module+'&view=Detail&record='+selectedItemData.id;window.location.href=url;}return !1},close:function close(){}}));},labelSearch:function labelSearch(currentTarget){var val=currentTarget.val();if(''==val)return app.showAlert(app.vtranslate('JS_PLEASE_ENTER_SOME_VALUE')),currentTarget.focus(),!1;var progress=$.progressIndicator({position:'html',blockInfo:{enabled:!0}}),basicSearch=new Vtiger_BasicSearch_Js;basicSearch.setMainContainer(currentTarget.closest('.js-global-search__input')),basicSearch.search(val).done(function(data){basicSearch.showSearchResults(data),progress.progressIndicator({mode:'hide'});});},registerHotKeys:function registerHotKeys(){$('.hotKey').each(function(){var thisObject=this,key=$(thisObject).data('hotkeys');''!=key&&Mousetrap.bind(key,function(){thisObject.click();});});},quickCreateModule:function quickCreateModule(moduleName,params){if(window!==window.parent)return void window.parent.Vtiger_Header_Js.getInstance().quickCreateModule(moduleName,params);var thisInstance=this;'undefined'==typeof params&&(params={}),'undefined'==typeof params.callbackFunction&&(params.callbackFunction=function(){});var url='index.php?module='+moduleName+'&view=QuickCreateAjax';('Detail'===app.getViewName()||'Edit'===app.getViewName()&&app.getRecordId()!==void 0)&&'Settings'!=app.getParentModuleName()&&(url+='&sourceModule='+app.getModuleName(),url+='&sourceRecord='+app.getRecordId());var progress=$.progressIndicator();thisInstance.getQuickCreateForm(url,moduleName,params).done(function(data){thisInstance.handleQuickCreateData(data,params),app.registerEventForClockPicker(),progress.progressIndicator({mode:'hide'});});},registerReminderNotice:function registerReminderNotice(){var self=this;$('#page').before('<div class="remindersNoticeContainer" tabindex="-1" role="dialog" aria-label="'+app.vtranslate('JS_REMINDER')+'" aria-hidden="true"></div>');var block=$('.remindersNoticeContainer'),remindersNotice=$('.remindersNotice');remindersNotice.on('click',function(){remindersNotice.hasClass('autoRefreshing')||Vtiger_Index_Js.requestReminder(),self.hideActionMenu(),self.hideBreadcrumbActionMenu(),block.toggleClass('toggled'),self.hideReminderNotification(),app.closeSidebar(),self.hideSearchMenu();});},registerReminderNotification:function registerReminderNotification(){var self=this;$('#page').before('<div class="remindersNotificationContainer" tabindex="-1" role="dialog"></div>');var block=$('.remindersNotificationContainer'),remindersNotice=$('.notificationsNotice');remindersNotice.on('click',function(){remindersNotice.hasClass('autoRefreshing')||Vtiger_Index_Js.getNotificationsForReminder(),self.hideActionMenu(),self.hideBreadcrumbActionMenu(),block.toggleClass('toggled'),self.hideReminderNotice(),app.closeSidebar(),self.hideSearchMenu();});},toggleBreadcrumActions:function toggleBreadcrumActions(container){var actionsContainer=container.find('.js-header-toggle__actions');if(actionsContainer.length){var actionBtn=container.find('.js-header-toggle__actions-btn'),cssActionsTop={top:actionBtn.offset().top+actionBtn.outerHeight()+5};actionsContainer.css(cssActionsTop),actionBtn.on('click',function(){actionsContainer.toggleClass('is-active');});}},registerMobileEvents:function registerMobileEvents(){var self=this,container=this.getContentsContainer();$('.rightHeaderBtnMenu').on('click',function(){self.hideActionMenu(),self.hideBreadcrumbActionMenu(),self.hideSearchMenu(),self.hideReminderNotice(),self.hideReminderNotification(),$('.mobileLeftPanel ').toggleClass('mobileMenuOn');}),$('.js-quick-action-btn').on('click',function(){var currentTarget=$(this);app.closeSidebar(),self.hideBreadcrumbActionMenu(),self.hideSearchMenu(),self.hideReminderNotice(),self.hideReminderNotification(),$('.actionMenu').toggleClass('actionMenuOn'),currentTarget.hasClass('active')?(currentTarget.removeClass('active'),currentTarget.attr('aria-expanded','false'),currentTarget.popover()):(currentTarget.addClass('active'),currentTarget.attr('aria-expanded','true'),currentTarget.popover('disable')),$('.quickCreateModules').on('click',function(){self.hideActionMenu();});}),$('.searchMenuBtn').on('click',function(){var currentTarget=$(this);app.closeSidebar(),self.hideActionMenu(),self.hideBreadcrumbActionMenu(),self.hideReminderNotice(),self.hideReminderNotification(),$('.searchMenu').toggleClass('toogleSearchMenu'),currentTarget.hasClass('active')?(currentTarget.removeClass('active'),$('.searchMenuBtn .c-header__btn').attr('aria-expanded','false')):(currentTarget.addClass('active'),$('.searchMenuBtn .c-header__btn').attr('aria-expanded','true'));}),$('.js-header__btn--mail .dropdown').on('show.bs.dropdown',function(){app.closeSidebar(),self.hideActionMenu(),self.hideBreadcrumbActionMenu(),self.hideReminderNotice(),self.hideReminderNotification(),self.hideSearchMenu();}),this.toggleBreadcrumActions(container);},hideMobileMenu:function hideMobileMenu(){$('.mobileLeftPanel ').removeClass('mobileMenuOn');},hideSearchMenu:function hideSearchMenu(){$('.searchMenu').removeClass('toogleSearchMenu');},hideActionMenu:function hideActionMenu(){$('.actionMenu').removeClass('actionMenuOn');},hideBreadcrumbActionMenu:function hideBreadcrumbActionMenu(){$('.js-header-toggle__actions').removeClass('is-active');},hideReminderNotice:function hideReminderNotice(){$('.remindersNoticeContainer').removeClass('toggled');},hideReminderNotification:function hideReminderNotification(){$('.remindersNotificationContainer').removeClass('toggled');},registerFooTable:function registerFooTable(){var container=$('.tableRWD');container.find('thead tr th:gt(1)').attr('data-hide','phone'),container.find('thead tr th:gt(3)').attr('data-hide','tablet,phone'),container.find('thead tr th:last').attr('data-hide','');var whichColumnEnable=container.find('thead').attr('col-visible-alltime');container.find('thead tr th:eq('+whichColumnEnable+')').attr('data-hide',''),$('.tableRWD, .customTableRWD').footable({breakpoints:{phone:768,tablet:1024},addRowToggle:!0,toggleSelector:' > tbody > tr:not(.footable-row-detail)'}),$('.footable-toggle').on('click',function(event){event.stopPropagation(),$(this).trigger('footable_toggle_row');});var records=$('.customTableRWD').find('[data-toggle-visible=false]');records.find('.footable-toggle').css('display','none');},registerSiteBarButton:function registerSiteBarButton(container){var _this=this,key='ShowHideRightPanel'+app.getModuleName();'show'==app.cacheGet(key)?this.toggleSiteBar(container.find('.toggleSiteBarRightButton')):null==app.cacheGet(key)&&1==container.find('.siteBarRight').data('showpanel')&&this.toggleSiteBar(container.find('.toggleSiteBarRightButton')),container.find('.toggleSiteBarRightButton').on('click',function(e){var toogleButton=$(e.currentTarget);toogleButton.closest('.siteBarRight').hasClass('hideSiteBar')?app.cacheSet(key,'show'):app.cacheSet(key,'hide'),_this.toggleSiteBar(toogleButton);});},toggleSiteBar:function toggleSiteBar(toogleButton){$('.rowContent').toggleClass('js-sitebar--active'),toogleButton.closest('.siteBarRight').toggleClass('hideSiteBar'),toogleButton.find('.fas').toggleClass('fa-chevron-right fa-chevron-left'),toogleButton.toggleClass('hideToggleSiteBarRightButton');},registerToggleButton:function registerToggleButton(){$('.buttonTextHolder .dropdown-menu a').on('click',function(){$(this).parents('.d-inline-block').find('.dropdown-toggle .textHolder').html($(this).text());});},listenTextAreaChange:function listenTextAreaChange(){var thisInstance=this;$('textarea').on('keyup',function(){var elem=$(this);elem.data('has-scroll')||(elem.data('has-scroll',!0),elem.on('scroll keyup',function(){thisInstance.resizeTextArea($(this));})),thisInstance.resizeTextArea($(this));});},resizeTextArea:function resizeTextArea(elem){elem.height(1),elem.scrollTop(0),elem.height(elem[0].scrollHeight-elem[0].clientHeight+elem.height());},registerEvents:function registerEvents(){var thisInstance=this;'undefined'!=typeof Chat_JS&&Chat_JS.registerTrackingEvents();var container=thisInstance.getContentsContainer(),menuContainer=container.find('.js-menu--scroll'),quickCreateModal=container.find('.quickCreateModules');app.showNewScrollbarLeft(menuContainer,{suppressScrollX:!0}),app.showNewScrollbar(menuContainer.find('.subMenu').last(),{suppressScrollX:!0}),thisInstance.listenTextAreaChange(),thisInstance.registerFooTable(),$('.js-clear-history').on('click',function(){app.clearBrowsingHistory();}),$('.globalSearch').on('click',function(){var currentTarget=$(this);thisInstance.hideSearchMenu();var advanceSearchInstance=new Vtiger_AdvanceSearch_Js;advanceSearchInstance.setParentContainer(currentTarget.closest('.js-global-search__input')),advanceSearchInstance.initiateSearch().done(function(){advanceSearchInstance.selectBasicSearchValue();});}),$('.searchIcon').on('click',function(){var currentTarget=$(this).closest('.js-global-search__input').find('.js-global-search__value'),pressEvent=$.Event('keypress');pressEvent.which=13,currentTarget.trigger(pressEvent);}),thisInstance.registerAnnouncements(),thisInstance.registerHotKeys(),thisInstance.registerToggleButton(),thisInstance.registerSiteBarButton($('#centerPanel')),$('.basicSearchModulesList').on('change',function(){var value=$(this).closest('.js-global-search__input').find('.js-global-search__value');setTimeout(function(){value.focus();},100);}),thisInstance.basicSearch(),quickCreateModal.on('click','.quickCreateModule',function(e){var moduleName=$(e.currentTarget).data('name');quickCreateModal.modal('hide'),thisInstance.quickCreateModule(moduleName);}),thisInstance.registerMobileEvents(),thisInstance.registerReminderNotice(),thisInstance.registerReminderNotification(),thisInstance.registerQuickCreateSearch();}}),$(document).ready(function(){window.addEventListener('popstate',function(event){event.state&&(window.location.href=event.state);}),Vtiger_Header_Js.getInstance().registerEvents();});
//# sourceMappingURL=Header.min.js.map
