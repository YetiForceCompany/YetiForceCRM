
jQuery.Class("Vtiger_PDF_Js",{validateSubmit:function(b){var d=new Array();var c=0;b.find('[name="pdf_template[]"]').each(function(){if(jQuery(this).is(":checked")){d[c]=jQuery(this).val();c++}});if(d.length>0){b.find("#generate_pdf").attr("disabled",false);var a=app.getUrlVar("view");if(d.length>1||(a&&a.replace("#","")==="List"&&JSON.parse(b.find('[name="validRecords"]').val()).length>0)){b.find("#single_pdf").show()}else{b.find("#single_pdf").hide()}}else{b.find("#generate_pdf").attr("disabled",true);b.find("#single_pdf").hide()}},registerPreSubmitEvent:function(a){a.find("#generate_pdf, #single_pdf, #email_pdf").on("click",function(d){document.progressLoader=jQuery.progressIndicator({message:app.vtranslate("JS_PDF_GENERATING"),position:"html",blockInfo:{enabled:true}});var f=new Array();var c=0;a.find('[name="pdf_template[]"]').each(function(){if(jQuery(this).is(":checked")){f[c]=jQuery(this).val();c++}});var b=app.getUrlVar("view");if(b&&b.replace("#","")==="List"){a.find('[name="record"]').val(a.find('[name="validRecords"]').val())}a.find('[name="template"]').val(f);switch(jQuery(this).attr("id")){case"generate_pdf":break;case"single_pdf":a.find('[name="single_pdf"]').val(1);a.find("#pdfExportModal").submit();break;case"email_pdf":a.find('[name="email_pdf"]').val(1);a.find("#pdfExportModal").submit();break}document.progressLoader.progressIndicator({mode:"hide"});app.hideModalWindow()})},registerValidateSubmit:function(a){var b=this;b.validateSubmit(a);a.find('[name="pdf_template[]"]').on("change",function(){b.validateSubmit(a)})},registerListViewCheckRecords:function(a){var b=this;a.find('[name="pdf_template[]"]').on("change",function(){document.progressLoader=jQuery.progressIndicator({message:app.vtranslate("JS_PDF_RECALCULATING"),position:"html",blockInfo:{enabled:true}});var e=a.find('[name="selectedRecords"]').val();var c=[];a.find('[name="pdf_template[]"]:checked').each(function(f){c[f]=jQuery(this).val()});var d={};d.data={module:app.getModuleName(),action:"PDF",mode:"validateRecords",records:e,view:app.getViewName(),templates:c};d.dataType="json";AppConnector.request(d).then(function(g){var f=g.result;if(g.success){a.find('[name="validRecords"]').val(JSON.stringify(f.valid_records));a.find("#recordsInfo").text(f.message);setTimeout(function(){document.progressLoader.progressIndicator({mode:"hide"})},500);b.validateSubmit(a)}},function(g,f){app.errorLog(g,f)})})},countSelectedRecords:function(a){var b=JSON.parse(a.find('[name="selectedRecords"]').val());return b.length},registerEvents:function(){var b=jQuery("div.modal-content");this.registerPreSubmitEvent(b);if(app.getViewName()==="Detail"){this.registerValidateSubmit(b)}if(app.getViewName()==="List"){this.validateSubmit(b);this.registerListViewCheckRecords(b);var d=JSON.parse(b.find("#all_records").val());var a=b.find('[name="selectedRecords"]');var c=b.find('[name="validRecords"]');b.find("div.modal-body").append('<p id="recordsInfo">'+app.vtranslate("JS_RECORD_INFO"),+"</p>");a.val(JSON.stringify(d));c.val(JSON.stringify(d));jQuery("#recordsInfo").text(d.length+" from "+d.length+" are valid for chosen template.");this.validateSubmit(b)}}});jQuery(function(){var a=new Vtiger_PDF_Js();a.registerEvents()});