'use strict';

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) {
  return typeof obj;
} : function (obj) {
  return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;
};

jQuery.Class("YetiForce_ListSearch_Js",{getInstance:function getInstance(container,noEvents,reletedInstance,moduleName){"undefined"==typeof moduleName&&(moduleName=app.getModuleName());var instance,moduleClassName=module+"_ListSearch_Js";return instance="undefined"==typeof window[moduleClassName]?new window.YetiForce_ListSearch_Js(container,noEvents,reletedInstance):new window[moduleClassName](container,noEvents,reletedInstance),instance.moduleName=moduleName,instance}},{moduleName:!1,container:!1,reletedInstance:!1,viewName:!1,init:function init(container,noEvents,reletedInstance){"undefined"==typeof container&&(container=jQuery(".bodyContents")),this.setContainer(container),!0!=noEvents&&this.getContainer().find("[data-trigger=\"listSearch\"]").length&&this.initialize(),this.reletedInstance=reletedInstance;},setContainer:function setContainer(container){this.container=container;},getContainer:function getContainer(){return this.container},setViewName:function setViewName(viewName){this.viewName=viewName;},initialize:function initialize(){this.registerEvents();},getAlphabetSearchField:function getAlphabetSearchField(){return jQuery("#alphabetSearchKey").val()},getAlphabetSearchValue:function getAlphabetSearchValue(){return jQuery("#alphabetValue").val()},registerListSearch:function registerListSearch(){var thisInstance=this,listViewContainer=this.getContainer();listViewContainer.find("[data-trigger=\"listSearch\"]").on("click",function(){thisInstance.reloadList();}),listViewContainer.find("input.listSearchContributor").on("keypress",function(e){13==e.keyCode&&thisInstance.triggerListSearch();}),listViewContainer.find(".removeSearchConditions").on("click",function(){thisInstance.reloadList({search_params:[],search_key:"",search_value:"",operator:""});});},registerListViewSelect:function registerListViewSelect(){var _this=this,self=this,listViewContainer=this.getContainer();listViewContainer.find(".listViewEntriesTable .select2noactive").each(function(index,domElement){var select=$(domElement);select.data("select2")||App.Fields.Picklist.showSelect2ElementView(select,{placeholder:app.vtranslate("JS_SELECT_AN_OPTION")});}),"1"==app.getMainParams("autoRefreshListOnChange")&&(listViewContainer.find(".listViewEntriesTable select, .searchInSubcategories").on("change",function(){_this.triggerListSearch();}),listViewContainer.find(".listViewEntriesTable .picklistSearchField").on("apply.daterangepicker",function(){_this.triggerListSearch();}),listViewContainer.find(".listViewEntriesTable .dateField").on("DatePicker.onHide",function(){var prevVal=$(this).data("prevVal"),value=$(this).val();prevVal!=value&&self.triggerListSearch();}),app.event.off("Clockpicker.changed"),app.event.on("Clockpicker.changed",function(e,inputEl){listViewContainer.find(inputEl).length&&self.triggerListSearch();}));},resetPagination:function resetPagination(){jQuery("#deSelectAllMsg").trigger("click"),jQuery("#recordsCount").val(""),jQuery("#pageNumber").val("1"),jQuery("#pageToJump").val("1"),jQuery("#totalPageCount").text(""),jQuery(".pagination").data("totalCount",0);},triggerListSearch:function triggerListSearch(){var listInstance=this,listViewContainer=listInstance.getContainer();listViewContainer.find("[data-trigger=\"listSearch\"]").trigger("click");},registerDateListSearch:function registerDateListSearch(){App.Fields.Date.registerRange(this.getContainer().find(".dateRangeField"));},registerTimeListSearch:function registerTimeListSearch(){app.registerEventForClockPicker();},registerAlphabetClick:function registerAlphabetClick(){var thisInstance=this;this.getContainer().find(".alphabetBtn").on("click",function(){app.showModalWindow($(".alphabetModal").html(),function(data){thisInstance.registerEventForAlphabetSearch(data);});});},getCurrentCvId:function getCurrentCvId(){return jQuery("#customFilter").find("option:selected").data("id")},registerEventForAlphabetSearch:function registerEventForAlphabetSearch(modalContainer){var thisInstance=this;modalContainer.find(".alphabetSearch").on("click",function(e){var alphabet=jQuery(e.currentTarget).find("a").text(),cvId=thisInstance.getCurrentCvId(),AlphabetSearchKey=thisInstance.getAlphabetSearchField();thisInstance.resetPagination(),thisInstance.reloadList({viewname:cvId,search_key:AlphabetSearchKey,search_value:alphabet,operator:"s",page:1}),app.hideModalWindow();}),modalContainer.find(".removeAlfabetCondition").on("click",function(){thisInstance.reloadList({search_key:"",search_value:"",operator:""}),app.hideModalWindow();});},updatePaginationOnAlphabetChange:function updatePaginationOnAlphabetChange(alphabet,AlphabetSearchKey){var thisInstance=this,params={};params.module=thisInstance.moduleName,params.parent=app.getParentModuleName(),params.view="Pagination",params.page=1,params.mode="getPagination",params.search_key=AlphabetSearchKey,params.search_value=alphabet,params.operator="s",AppConnector.request(params).done(function(data){jQuery(".paginationDiv").html(data);var instance=thisInstance.getInstanceView();instance&&jQuery.isFunction(instance.registerPageNavigationEvents)&&instance.registerPageNavigationEvents();});},getListSearchParams:function getListSearchParams(urlSearchParams){var listViewPageDiv=this.getContainer(),listViewTable=listViewPageDiv.find(".listViewEntriesTable"),searchParams=[];if(listViewTable.find(".listSearchContributor").each(function(index,domElement){var searchInfo=[],searchContributorElement=jQuery(domElement),fieldInfo=searchContributorElement.data("fieldinfo"),fieldName=searchContributorElement.attr("name"),searchValue=searchContributorElement.val();if("object"==("undefined"==typeof searchValue?"undefined":_typeof(searchValue))&&(null==searchValue?searchValue="":searchValue=searchValue.join("##")),searchValue=searchValue.trim(),0>=searchValue.length)return !0;var searchOperator="a";fieldInfo.hasOwnProperty("searchOperator")?searchOperator=fieldInfo.searchOperator:0<=jQuery.inArray(fieldInfo.type,["modules","time","userCreator","owner","picklist","tree","boolean","fileLocationType","userRole","companySelect","multiReferenceValue"])?searchOperator="e":"date"==fieldInfo.type||"datetime"==fieldInfo.type?searchOperator="bw":("multipicklist"==fieldInfo.type||"categoryMultipicklist"==fieldInfo.type)&&(searchOperator="c");var sourceFieldName=searchContributorElement.data("sourceFieldName");if(sourceFieldName?searchInfo.push(fieldName+":"+searchContributorElement.data("moduleName")+":"+sourceFieldName):searchInfo.push(fieldName),searchInfo.push(searchOperator),searchInfo.push(searchValue),"tree"==fieldInfo.type||"categoryMultipicklist"==fieldInfo.type){var searchInSubcategories=jQuery(".listViewHeaders .searchInSubcategories[data-columnname=\""+fieldName+"\"]").prop("checked");searchInfo.push(searchInSubcategories);}searchParams.push(searchInfo);}),urlSearchParams){var valueInSearch=null,url=app.getUrlVar("search_params");if(null!=url&&url.length){var lengthUrl=url.length;"#"===url.charAt(lengthUrl-1)&&(url=url.substr(0,lengthUrl-1)),url=JSON.parse(decodeURIComponent(url)),$.each(url[0],function(index,value){var exist=!1;if($.each(searchParams,function(index,searchParam){searchParam[0]==value[0]&&(exist=!0);}),-1===value[0].indexOf(":"))valueInSearch=listViewTable.find(".listSearchContributor[name=\""+value[0]+"\"]").val();else{var fieldRelation=value[0].split(":");valueInSearch=listViewTable.find(".listSearchContributor[name=\""+fieldRelation[0]+"\"][data-module-name=\""+fieldRelation[1]+"\"][data-source-field-name=\""+fieldRelation[2]+"\"]").val();}!1==exist&&""!=valueInSearch&&null!==valueInSearch&&searchParams.push(value);});}}return [searchParams]},getInstanceByView:function getInstanceByView(){var viewName=this.viewName?this.viewName:app.getViewName(),instance=!1;return "RecordsList"===viewName?(instance=this.reletedInstance,instance.reloadFunctionName="loadRecordList",instance.execute=["updatePagination"]):this.reletedInstance?(instance=this.reletedInstance,instance.reloadFunctionName="loadRelatedList"):"Detail"===viewName?(instance=Vtiger_Detail_Js.getInstance(),instance.reloadFunctionName="loadRelatedList"):"List"==viewName?(instance=new Vtiger_List_Js,instance.reloadFunctionName="getListViewRecords",instance.execute=["updatePagination"]):"ListPreview"==viewName&&(instance=window.pageController,instance.reloadFunctionName="getListViewRecords",instance.execute=["updatePagination"]),instance},reloadList:function reloadList(params){var thisInstance=this;params==null&&(params={page:1});var instance=this.getInstanceByView();if(instance){var funcName=instance.reloadFunctionName;jQuery.isFunction(instance[funcName])&&instance[funcName](params).done(function(){thisInstance.resetPagination(),thisInstance.executeFunctions(instance);});}},executeFunctions:function executeFunctions(instance){if(instance.execute){var func=instance.execute;for(var i in func){var funcName=func[i];jQuery.isFunction(instance[funcName])&&instance[funcName]();}}},registerBasicEvents:function registerBasicEvents(){this.registerListViewSelect(),this.registerDateListSearch(),this.registerTimeListSearch(),this.registerAlphabetClick(),this.registerListSearch(),this.getContainer().find("select.select2").each(function(i,obj){$(obj).data("select2")||App.Fields.Picklist.showSelect2ElementView($(obj));});},registerEvents:function registerEvents(){this.registerBasicEvents();}});
//# sourceMappingURL=ListSearch.min.js.map
