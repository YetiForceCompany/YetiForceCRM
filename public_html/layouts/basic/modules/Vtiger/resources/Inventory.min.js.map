{"version":3,"file":"Inventory.min.js","sources":["Inventory.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\n$.Class(\n\t'Vtiger_Inventory_Js',\n\t{\n\t\tinventoryInstance: false,\n\t\t/**\n\t\t * Get inventory instance\n\t\t * @param {jQuery} container\n\t\t * @returns {Vtiger_Inventory_Js}\n\t\t */\n\t\tgetInventoryInstance: function (container) {\n\t\t\tif (this.inventoryInstance === false) {\n\t\t\t\tlet moduleClassName = container.find('[name=\"module\"]').val() + '_Inventory_Js';\n\t\t\t\tif (typeof window[moduleClassName] === 'undefined') {\n\t\t\t\t\tmoduleClassName = 'Vtiger_Inventory_Js';\n\t\t\t\t}\n\t\t\t\tif (typeof window[moduleClassName] !== 'undefined') {\n\t\t\t\t\tthis.inventoryInstance = new window[moduleClassName]();\n\t\t\t\t\tthis.inventoryInstance.registerEvents(container);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn this.inventoryInstance;\n\t\t}\n\t},\n\t{\n\t\tform: false,\n\t\tinventoryContainer: false,\n\t\tinventoryHeadContainer: false,\n\t\tsummaryTaxesContainer: false,\n\t\tsummaryDiscountContainer: false,\n\t\tsummaryCurrenciesContainer: false,\n\t\trowClass: 'tr.inventoryRow',\n\t\tdiscountModalFields: [\n\t\t\t'aggregationType',\n\t\t\t'globalDiscount',\n\t\t\t'groupCheckbox',\n\t\t\t'groupDiscount',\n\t\t\t'individualDiscount',\n\t\t\t'individualDiscountType'\n\t\t],\n\t\ttaxModalFields: [\n\t\t\t'aggregationType',\n\t\t\t'globalTax',\n\t\t\t'groupCheckbox',\n\t\t\t'groupTax',\n\t\t\t'individualTax',\n\t\t\t'regionalTax'\n\t\t],\n\t\t/**\n\t\t * Get current form element\n\t\t * @returns {jQuery}\n\t\t */\n\t\tgetForm() {\n\t\t\treturn this.form;\n\t\t},\n\t\t/**\n\t\t * Function that is used to get the line item container\n\t\t * @return : jQuery object\n\t\t */\n\t\tgetInventoryItemsContainer: function () {\n\t\t\tif (this.inventoryContainer === false) {\n\t\t\t\tthis.inventoryContainer = $('.inventoryItems');\n\t\t\t}\n\t\t\treturn this.inventoryContainer;\n\t\t},\n\t\tgetInventoryHeadContainer: function () {\n\t\t\tif (this.inventoryHeadContainer === false) {\n\t\t\t\tthis.inventoryHeadContainer = $('.inventoryHeader');\n\t\t\t}\n\t\t\treturn this.inventoryHeadContainer;\n\t\t},\n\t\tgetInventorySummaryDiscountContainer: function () {\n\t\t\tif (this.summaryDiscountContainer === false) {\n\t\t\t\tthis.summaryDiscountContainer = $('.inventorySummaryDiscounts');\n\t\t\t}\n\t\t\treturn this.summaryDiscountContainer;\n\t\t},\n\t\tgetInventorySummaryTaxesContainer: function () {\n\t\t\tif (this.summaryTaxesContainer === false) {\n\t\t\t\tthis.summaryTaxesContainer = $('.inventorySummaryTaxes');\n\t\t\t}\n\t\t\treturn this.summaryTaxesContainer;\n\t\t},\n\t\tgetInventorySummaryCurrenciesContainer: function () {\n\t\t\tif (this.summaryCurrenciesContainer === false) {\n\t\t\t\tthis.summaryCurrenciesContainer = $('.inventorySummaryCurrencies');\n\t\t\t}\n\t\t\treturn this.summaryCurrenciesContainer;\n\t\t},\n\t\tgetNextLineItemRowNumber: function () {\n\t\t\tlet $inventoryItemsNo = $('#inventoryItemsNo');\n\t\t\tlet rowNumber = parseInt($inventoryItemsNo.val()) + 1;\n\t\t\t$inventoryItemsNo.val(rowNumber);\n\t\t\treturn rowNumber;\n\t\t},\n\t\tgetAccountId: function () {\n\t\t\tlet accountReferenceField = $('#accountReferenceField').val();\n\t\t\tif (accountReferenceField != '') {\n\t\t\t\treturn $('[name=\"' + accountReferenceField + '\"]').val();\n\t\t\t}\n\t\t\treturn '';\n\t\t},\n\t\tcheckDeleteIcon: function () {\n\t\t\tif (this.getInventoryItemsContainer().find(this.rowClass).length > 1) {\n\t\t\t\tthis.showLineItemsDeleteIcon();\n\t\t\t} else if (app.getMainParams('isRequiredInventory')) {\n\t\t\t\tthis.hideLineItemsDeleteIcon();\n\t\t\t}\n\t\t},\n\t\tshowLineItemsDeleteIcon: function () {\n\t\t\tthis.getInventoryItemsContainer().find('.deleteRow').removeClass('d-none');\n\t\t},\n\t\thideLineItemsDeleteIcon: function () {\n\t\t\tthis.getInventoryItemsContainer().find('.deleteRow').addClass('d-none');\n\t\t},\n\t\tgetClosestRow: function (element) {\n\t\t\treturn element.closest(this.rowClass);\n\t\t},\n\t\t/**\n\t\t * Function which will return the basic row which can be used to add new rows\n\t\t * @return jQuery object which you can use to\n\t\t */\n\t\tgetBasicRow: function () {\n\t\t\treturn this.getForm().find('.js-inventory-base-item').eq(0).clone(true, true);\n\t\t},\n\t\tisRecordSelected: function (element) {\n\t\t\tlet parentRow = element.closest('tr');\n\t\t\tlet productField = parentRow.find('.recordLabel');\n\t\t\treturn productField.validationEngine('validate');\n\t\t},\n\t\tgetTaxModeSelectElement: function (row) {\n\t\t\tlet items = this.getInventoryHeadContainer();\n\t\t\tif (items.find('thead .js-taxmode').length > 0) {\n\t\t\t\treturn $('.js-taxmode');\n\t\t\t}\n\t\t\tif (row) {\n\t\t\t\treturn row.find('.js-taxmode');\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tisIndividualTaxMode: function (row) {\n\t\t\tlet taxModeElement = this.getTaxModeSelectElement(row);\n\t\t\tlet selectedOption = taxModeElement.find('option:selected');\n\t\t\treturn selectedOption.val() == '1';\n\t\t},\n\t\tisGroupTaxMode: function () {\n\t\t\tlet taxTypeElement = this.getTaxModeSelectElement();\n\t\t\tif (taxTypeElement) {\n\t\t\t\tlet selectedOption = taxTypeElement.find('option:selected');\n\t\t\t\tif (selectedOption.val() == '0') {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\tshowIndividualTax: function (row) {\n\t\t\tlet thisInstance = this;\n\t\t\tlet groupTax = thisInstance.getInventorySummaryTaxesContainer().find('.groupTax');\n\t\t\tlet items = thisInstance.getInventoryItemsContainer();\n\t\t\tlet newRow = $('#blackIthemTable').find('tbody');\n\t\t\tif (thisInstance.isIndividualTaxMode()) {\n\t\t\t\tgroupTax.addClass('d-none');\n\t\t\t\titems.find('.changeTax').removeClass('d-none');\n\t\t\t\tnewRow.find('.changeTax').removeClass('d-none');\n\t\t\t\tlet parentRow = thisInstance.getInventoryItemsContainer();\n\t\t\t\tlet taxParam = { aggregationType: 'global' };\n\n\t\t\t\tparentRow.find(thisInstance.rowClass).each(function () {\n\t\t\t\t\tlet thisItem = $(this);\n\t\t\t\t\ttaxParam['globalTax'] = parseFloat(thisItem.find('.js-tax').attr('data-default-tax'));\n\t\t\t\t\tthisInstance.setTaxParam(thisItem, taxParam);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthisInstance.setTax(items, 0);\n\t\t\t\tthisInstance.setTaxPercent(items, 0);\n\t\t\t\tthisInstance.setTaxParam(items, []);\n\t\t\t\tthisInstance.setDefaultGlobalTax(row);\n\t\t\t\tgroupTax.removeClass('d-none');\n\t\t\t\titems.find('.changeTax').addClass('d-none');\n\t\t\t\tnewRow.find('.changeTax').addClass('d-none');\n\t\t\t}\n\t\t\tthisInstance.rowsCalculations();\n\t\t},\n\t\tsetDefaultGlobalTax: function (row) {\n\t\t\tlet thisInstance = this;\n\t\t\tlet parentRow = thisInstance.getInventoryItemsContainer();\n\t\t\tlet taxDefaultValue = thisInstance\n\t\t\t\t.getInventorySummaryTaxesContainer()\n\t\t\t\t.find('.js-default-tax')\n\t\t\t\t.data('tax-default-value');\n\t\t\tlet isGroupTax = thisInstance.isGroupTaxMode();\n\t\t\tif (isGroupTax) {\n\t\t\t\tif (app.getRecordId()) {\n\t\t\t\t\ttaxDefaultValue = thisInstance.getTaxPercent($('#blackIthemTable'));\n\t\t\t\t}\n\t\t\t\tif (taxDefaultValue) {\n\t\t\t\t\tlet taxParam = { aggregationType: 'global' };\n\t\t\t\t\ttaxParam['globalTax'] = taxDefaultValue;\n\t\t\t\t\ttaxParam['individualTax'] = '';\n\t\t\t\t\tthisInstance.setTaxParam($('#blackIthemTable'), taxParam);\n\t\t\t\t\tthisInstance.setTaxParam(parentRow, taxParam);\n\t\t\t\t\tparentRow.closest('.inventoryItems').data('taxParam', JSON.stringify(taxParam));\n\t\t\t\t\tparentRow.find(thisInstance.rowClass).each(function () {\n\t\t\t\t\t\tthisInstance.quantityChangeActions($(this));\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthisInstance.setTaxParam($('#blackIthemTable'), []);\n\t\t\t\tparentRow.closest('.inventoryItems').data('taxParam', '[]');\n\t\t\t}\n\t\t},\n\t\tgetDiscountModeSelectElement: function (row) {\n\t\t\tlet items = this.getInventoryHeadContainer();\n\t\t\tif (items.find('thead .js-discountmode').length > 0) {\n\t\t\t\treturn $('.js-discountmode');\n\t\t\t}\n\t\t\treturn row.find('.js-discountmode');\n\t\t},\n\t\tisIndividualDiscountMode: function (row) {\n\t\t\tlet discountModeElement = this.getDiscountModeSelectElement(row);\n\t\t\tlet selectedOption = discountModeElement.find('option:selected');\n\t\t\treturn selectedOption.val() == '1';\n\t\t},\n\t\tshowIndividualDiscount: function (row) {\n\t\t\tlet thisInstance = this;\n\t\t\tlet groupDiscount = thisInstance\n\t\t\t\t.getInventorySummaryDiscountContainer()\n\t\t\t\t.find('.groupDiscount');\n\t\t\tlet items = thisInstance.getInventoryItemsContainer();\n\t\t\tlet newRow = $('#blackIthemTable').find('tbody');\n\t\t\tif (thisInstance.isIndividualDiscountMode(row)) {\n\t\t\t\tgroupDiscount.addClass('d-none');\n\t\t\t\titems.find('.changeDiscount').removeClass('d-none');\n\t\t\t\tnewRow.find('.changeDiscount').removeClass('d-none');\n\t\t\t} else {\n\t\t\t\tgroupDiscount.removeClass('d-none');\n\t\t\t\titems.find('.changeDiscount').addClass('d-none');\n\t\t\t\tnewRow.find('.changeDiscount').addClass('d-none');\n\t\t\t}\n\t\t\tthisInstance.setDiscount(items, 0);\n\t\t\tthisInstance.setDiscountParam(items, []);\n\t\t\tthisInstance.rowsCalculations();\n\t\t},\n\t\tgetCurrency: function () {\n\t\t\tlet currency = $('.js-currency', this.getInventoryHeadContainer());\n\t\t\treturn currency.find('option:selected').val();\n\t\t},\n\t\tgetTax: function (row) {\n\t\t\tlet taxParams = row.find('.taxParam').val();\n\t\t\tif (taxParams == '' || taxParams == '[]' || taxParams == undefined) return 0;\n\t\t\ttaxParams = JSON.parse(taxParams);\n\t\t\tlet aggregationType = $('.aggregationTypeTax').val();\n\t\t\tlet valuePrices = this.getNetPrice(row);\n\t\t\tlet taxRate = 0;\n\t\t\tlet types = taxParams.aggregationType;\n\t\t\tif (typeof types == 'string') {\n\t\t\t\ttypes = [types];\n\t\t\t}\n\t\t\tif (types) {\n\t\t\t\ttypes.forEach(function (entry) {\n\t\t\t\t\tlet taxValue = 0;\n\t\t\t\t\tswitch (entry) {\n\t\t\t\t\t\tcase 'individual':\n\t\t\t\t\t\t\ttaxValue = taxParams.individualTax;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'global':\n\t\t\t\t\t\t\ttaxValue = taxParams.globalTax;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'group':\n\t\t\t\t\t\t\ttaxValue = taxParams.groupTax;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'regional':\n\t\t\t\t\t\t\ttaxValue = taxParams.regionalTax;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\ttaxRate += valuePrices * (taxValue / 100);\n\t\t\t\t\tif (aggregationType == '2') {\n\t\t\t\t\t\tvaluePrices = valuePrices + taxRate;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn taxRate;\n\t\t},\n\t\tgetTaxPercent: function (row) {\n\t\t\tlet taxParams = row.find('.taxParam').val();\n\t\t\tif (taxParams == '' || taxParams == '[]' || taxParams == undefined) return 0;\n\t\t\ttaxParams = JSON.parse(taxParams);\n\t\t\tlet taxPercent = taxParams[taxParams.aggregationType + 'Tax'];\n\t\t\treturn taxPercent ? taxPercent : 0;\n\t\t},\n\t\tgetTaxParams: function (row) {\n\t\t\tlet taxParams = row.find('.taxParam').val();\n\t\t\tif (taxParams == '' || taxParams == '[]' || taxParams == undefined) return false;\n\t\t\treturn JSON.parse(taxParams);\n\t\t},\n\t\tgetQuantityValue: function (row) {\n\t\t\treturn $('.qty', row).getNumberFromValue();\n\t\t},\n\t\tgetUnitPriceValue: function (row) {\n\t\t\treturn $('.unitPrice', row).getNumberFromValue();\n\t\t},\n\t\tgetDiscount: function (row) {\n\t\t\tlet discountParams = row.find('.discountParam').val();\n\t\t\tlet aggregationType = $('.aggregationTypeDiscount').val();\n\t\t\tif (\n\t\t\t\tdiscountParams == '' ||\n\t\t\t\tdiscountParams == 'null' ||\n\t\t\t\tdiscountParams == '[]' ||\n\t\t\t\tdiscountParams == undefined\n\t\t\t) {\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\tdiscountParams = JSON.parse(discountParams);\n\t\t\tlet valuePrices = this.getTotalPrice(row);\n\t\t\tlet discountRate = 0;\n\t\t\tlet types = discountParams.aggregationType;\n\t\t\tif (typeof types == 'string') {\n\t\t\t\ttypes = [types];\n\t\t\t}\n\t\t\tif (types) {\n\t\t\t\ttypes.forEach(function (entry) {\n\t\t\t\t\tlet discountValue;\n\t\t\t\t\tif (entry == 'individual') {\n\t\t\t\t\t\tdiscountValue = discountParams.individualDiscount;\n\t\t\t\t\t\tlet discountType = discountParams.individualDiscountType;\n\t\t\t\t\t\tif (discountType == 'percentage') {\n\t\t\t\t\t\t\tdiscountRate += valuePrices * (discountValue / 100);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdiscountRate += discountValue;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (entry == 'global') {\n\t\t\t\t\t\tdiscountRate += valuePrices * (discountParams.globalDiscount / 100);\n\t\t\t\t\t}\n\t\t\t\t\tif (entry == 'group') {\n\t\t\t\t\t\tlet groupDiscount = discountParams.groupDiscount ? discountParams.groupDiscount : 0;\n\t\t\t\t\t\tdiscountRate += valuePrices * (groupDiscount / 100);\n\t\t\t\t\t}\n\t\t\t\t\tif (aggregationType == '2') {\n\t\t\t\t\t\tvaluePrices = valuePrices - discountRate;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn discountRate;\n\t\t},\n\t\tgetNetPrice: function (row) {\n\t\t\treturn this.getTotalPrice(row) - this.getDiscount(row);\n\t\t},\n\t\tgetTotalPrice: function (row) {\n\t\t\treturn this.getQuantityValue(row) * this.getUnitPriceValue(row);\n\t\t},\n\t\tgetGrossPrice: function (row) {\n\t\t\treturn $('.grossPrice', row).getNumberFromValue();\n\t\t},\n\t\tgetPurchase: function (row) {\n\t\t\tlet qty = this.getQuantityValue(row);\n\t\t\tlet element = $('.purchase', row);\n\t\t\tlet purchase = 0;\n\t\t\tif (element.length > 0) {\n\t\t\t\tpurchase = App.Fields.Double.formatToDb(element.val());\n\t\t\t}\n\t\t\treturn purchase * qty;\n\t\t},\n\t\tgetSummaryGrossPrice: function () {\n\t\t\tlet thisInstance = this;\n\t\t\tlet price = 0;\n\t\t\tthis.getInventoryItemsContainer()\n\t\t\t\t.find(thisInstance.rowClass)\n\t\t\t\t.each(function (index) {\n\t\t\t\t\tprice += thisInstance.getGrossPrice($(this));\n\t\t\t\t});\n\t\t\treturn App.Fields.Double.formatToDb(price);\n\t\t},\n\t\t/**\n\t\t * Set currency\n\t\t * @param {int} val\n\t\t */\n\t\tsetCurrency(val) {\n\t\t\tthis.getInventoryHeadContainer().find('.js-currency').val(val).trigger('change');\n\t\t},\n\t\t/**\n\t\t * Set currency param\n\t\t * @param {string} val json string\n\t\t */\n\t\tsetCurrencyParam(val) {\n\t\t\tthis.getInventoryHeadContainer().find('.js-currencyparam').val(val);\n\t\t},\n\t\t/**\n\t\t * Set discount mode\n\t\t * @param {int} val\n\t\t */\n\t\tsetDiscountMode(val) {\n\t\t\tthis.getInventoryHeadContainer().find('.js-discountmode').val(val).trigger('change');\n\t\t},\n\t\t/**\n\t\t * Set tax mode\n\t\t * @param {int} val\n\t\t */\n\t\tsetTaxMode(val) {\n\t\t\tthis.getInventoryHeadContainer().find('.js-taxmode').val(val).trigger('change');\n\t\t},\n\t\t/**\n\t\t * Set inventory id\n\t\t * @param {jQuery} row\n\t\t * @param {int} val\n\t\t * @param {string} display\n\t\t */\n\t\tsetName(row, val, display) {\n\t\t\trow.find('.js-name').val(val).trigger('change');\n\t\t\trow.find('.js-name_display').val(display).attr('readonly', 'true').trigger('change');\n\t\t},\n\t\t/**\n\t\t * Set inventory row quantity\n\t\t * @param {jQuery} row\n\t\t * @param {int} val\n\t\t */\n\t\tsetQuantity(row, val) {\n\t\t\trow.find('.qty').val(val).trigger('change');\n\t\t},\n\t\t/**\n\t\t * Set unit original (db) value\n\t\t * @param {jQuery} row\n\t\t * @param {string} val\n\t\t * @param {string} display\n\t\t */\n\t\tsetUnit(row, val, display) {\n\t\t\trow.find('.unit').val(val).trigger('change');\n\t\t\trow.find('.unitText').text(display).trigger('change');\n\t\t},\n\t\t/**\n\t\t * Set subUnit original (db) value\n\t\t * @param {jQuery} row\n\t\t * @param {string} val\n\t\t * @param {string} display\n\t\t */\n\t\tsetSubUnit(row, val, display) {\n\t\t\trow.find('.subunit').val(val);\n\t\t\trow.find('.subunitText').val(display);\n\t\t},\n\t\t/**\n\t\t * Set inventory row comment\n\t\t * @param {jQuery} row\n\t\t * @param {string} val\n\t\t */\n\t\tsetComment(row, val) {\n\t\t\trow\n\t\t\t\t.parent()\n\t\t\t\t.find('[numrowex=' + row.attr('numrow') + ']')\n\t\t\t\t.find('.comment')\n\t\t\t\t.val(val)\n\t\t\t\t.trigger('change');\n\t\t},\n\t\tsetUnitPrice: function (row, val) {\n\t\t\tval = App.Fields.Double.formatToDisplay(val);\n\t\t\trow.find('.unitPrice').val(val).attr('title', val);\n\t\t\treturn this;\n\t\t},\n\t\tsetPurchase: function (row, val) {\n\t\t\tval = App.Fields.Double.formatToDisplay(val);\n\t\t\trow.find('.purchase').val(val);\n\t\t\treturn this;\n\t\t},\n\t\tsetNetPrice: function (row, val) {\n\t\t\tval = App.Fields.Double.formatToDisplay(val);\n\t\t\t$('.netPriceText', row).text(val);\n\t\t\t$('.netPrice', row).val(val);\n\t\t},\n\t\tsetGrossPrice: function (row, val) {\n\t\t\tval = App.Fields.Double.formatToDisplay(val);\n\t\t\t$('.grossPriceText', row).text(val);\n\t\t\t$('.grossPrice', row).val(val);\n\t\t},\n\t\tsetTotalPrice: function (row, val) {\n\t\t\tval = App.Fields.Double.formatToDisplay(val);\n\t\t\t$('.totalPriceText', row).text(val);\n\t\t\t$('.totalPrice', row).val(val);\n\t\t},\n\t\tsetMargin: function (row, val) {\n\t\t\tval = App.Fields.Double.formatToDisplay(val);\n\t\t\t$('.margin', row).val(val);\n\t\t},\n\t\tsetMarginP: function (row, val) {\n\t\t\tval = App.Fields.Double.formatToDisplay(val);\n\t\t\t$('.marginp', row).val(val);\n\t\t},\n\t\tsetDiscount: function (row, val) {\n\t\t\tval = App.Fields.Double.formatToDisplay(val);\n\t\t\t$('.discount', row).val(val);\n\t\t},\n\t\tsetDiscountParam: function (row, val) {\n\t\t\t$('.discountParam', row).val(JSON.stringify(val));\n\t\t},\n\t\tsetTax: function (row, val) {\n\t\t\t$('.tax', row).val(App.Fields.Double.formatToDisplay(val));\n\t\t},\n\t\tsetTaxPercent: function (row, val) {\n\t\t\tval = App.Fields.Double.formatToDisplay(val);\n\t\t\t$('.js-tax-percent', row).val(val);\n\t\t},\n\t\tsetTaxParam: function (row, val) {\n\t\t\t$('.taxParam', row).val(JSON.stringify(val));\n\t\t},\n\t\tquantityChangeActions: function (row) {\n\t\t\tthis.rowCalculations(row);\n\t\t\tthis.summaryCalculations();\n\t\t},\n\t\trowCalculations: function (row) {\n\t\t\tthis.calculateTotalPrice(row);\n\t\t\tthis.calculateDiscounts(row);\n\t\t\tthis.calculateNetPrice(row);\n\t\t\tthis.calculateTaxes(row);\n\t\t\tthis.calculateGrossPrice(row);\n\t\t\tthis.calculateMargin(row);\n\t\t},\n\t\trowsCalculations: function () {\n\t\t\tlet thisInstance = this;\n\t\t\tthis.getInventoryItemsContainer()\n\t\t\t\t.find(thisInstance.rowClass)\n\t\t\t\t.each(function (index) {\n\t\t\t\t\tthisInstance.quantityChangeActions($(this));\n\t\t\t\t});\n\t\t\tthisInstance.calculateItemNumbers();\n\t\t},\n\t\tcalculateDiscounts: function (row) {\n\t\t\tthis.setDiscount(row, this.getDiscount(row));\n\t\t},\n\t\tcalculateTaxes: function (row) {\n\t\t\tthis.setTax(row, this.getTax(row));\n\t\t\tthis.setTaxPercent(row, this.getTaxPercent(row));\n\t\t},\n\t\tsummaryCalculations: function () {\n\t\t\tlet thisInstance = this;\n\t\t\tthisInstance\n\t\t\t\t.getInventoryItemsContainer()\n\t\t\t\t.find('tfoot .wisableTd')\n\t\t\t\t.each(function (index) {\n\t\t\t\t\tthisInstance.calculatSummary($(this), $(this).data('sumfield'));\n\t\t\t\t});\n\t\t\tthisInstance.calculatDiscountSummary();\n\t\t\tthisInstance.calculatTaxSummary();\n\t\t\tthisInstance.calculatCurrenciesSummary();\n\t\t\tthisInstance.calculatMarginPSummary();\n\t\t},\n\t\tcalculatSummary: function (element, field) {\n\t\t\tlet thisInstance = this;\n\t\t\tlet sum = 0;\n\t\t\tthis.getInventoryItemsContainer()\n\t\t\t\t.find(thisInstance.rowClass)\n\t\t\t\t.each(function (index) {\n\t\t\t\t\tlet element = $(this).find('.' + field);\n\t\t\t\t\tif (element.length > 0) {\n\t\t\t\t\t\tsum += App.Fields.Double.formatToDb(element.val());\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\telement.text(App.Fields.Double.formatToDisplay(sum));\n\t\t},\n\t\tcalculatMarginPSummary: function () {\n\t\t\tlet sumRow = this.getInventoryItemsContainer().find('tfoot'),\n\t\t\t\ttotalPriceField =\n\t\t\t\t\tsumRow.find('[data-sumfield=\"netPrice\"]').length > 0\n\t\t\t\t\t\t? sumRow.find('[data-sumfield=\"netPrice\"]')\n\t\t\t\t\t\t: sumRow.find('[data-sumfield=\"totalPrice\"]'),\n\t\t\t\tsumPrice = totalPriceField.getNumberFromText(),\n\t\t\t\tpurchase = 0,\n\t\t\t\tmarginp = 0;\n\t\t\tthis.getInventoryItemsContainer()\n\t\t\t\t.find(this.rowClass)\n\t\t\t\t.each(function (index) {\n\t\t\t\t\tlet qty = $(this).find('.qty').getNumberFromValue(),\n\t\t\t\t\t\tpurchasePrice = $(this).find('.purchase').getNumberFromValue();\n\t\t\t\t\tif (qty > 0 && purchasePrice > 0) {\n\t\t\t\t\t\tpurchase += qty * purchasePrice;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\tlet subtraction = sumPrice - purchase;\n\t\t\tif (purchase !== 0 && sumPrice !== 0) {\n\t\t\t\tmarginp = (subtraction / sumPrice) * 100;\n\t\t\t}\n\t\t\tsumRow\n\t\t\t\t.find('[data-sumfield=\"marginP\"]')\n\t\t\t\t.text(App.Fields.Double.formatToDisplay(marginp) + '%');\n\t\t},\n\t\tcalculatDiscountSummary: function () {\n\t\t\tlet thisInstance = this;\n\t\t\tlet discount = thisInstance.getAllDiscount();\n\t\t\tlet container = thisInstance.getInventorySummaryDiscountContainer();\n\t\t\tcontainer.find('input').val(App.Fields.Double.formatToDisplay(discount));\n\t\t},\n\t\tgetAllDiscount: function () {\n\t\t\tlet thisInstance = this;\n\t\t\tlet discount = 0;\n\t\t\tthis.getInventoryItemsContainer()\n\t\t\t\t.find(thisInstance.rowClass)\n\t\t\t\t.each(function (index) {\n\t\t\t\t\tlet row = $(this);\n\t\t\t\t\tdiscount += thisInstance.getDiscount(row);\n\t\t\t\t});\n\t\t\treturn discount;\n\t\t},\n\t\tcalculatCurrenciesSummary: function () {\n\t\t\tlet container = this.getInventorySummaryCurrenciesContainer(),\n\t\t\t\tselected = $('.js-currency option:selected', this.getInventoryHeadContainer()),\n\t\t\t\tbase = $('.js-currency option[data-base-currency=\"1\"]', this.getInventoryHeadContainer()),\n\t\t\t\tconversionRate = selected.data('conversionRate'),\n\t\t\t\tbaseConversionRate = base.data('conversionRate');\n\t\t\tif (conversionRate == baseConversionRate) {\n\t\t\t\tcontainer.addClass('d-none');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconversionRate = parseFloat(baseConversionRate) / parseFloat(conversionRate);\n\t\t\tcontainer.removeClass('d-none');\n\t\t\tlet taxes = this.getAllTaxes();\n\t\t\tlet sum = 0;\n\t\t\tcontainer.find('.js-panel__body').html('');\n\t\t\t$.each(taxes, function (index, value) {\n\t\t\t\tif (value != undefined) {\n\t\t\t\t\tvalue = value * conversionRate;\n\t\t\t\t\tlet row = container.find('.d-none .form-group').clone();\n\t\t\t\t\trow.find('.percent').text(index + '%');\n\t\t\t\t\trow.find('input').val(App.Fields.Double.formatToDisplay(value));\n\t\t\t\t\trow.appendTo(container.find('.js-panel__body'));\n\t\t\t\t\tsum += value;\n\t\t\t\t}\n\t\t\t});\n\t\t\tcontainer.find('.js-panel__footer input').val(App.Fields.Double.formatToDisplay(sum));\n\t\t},\n\t\tcalculatTaxSummary: function () {\n\t\t\tlet thisInstance = this;\n\t\t\tlet taxes = thisInstance.getAllTaxes();\n\t\t\tlet container = thisInstance.getInventorySummaryTaxesContainer();\n\t\t\tcontainer.find('.js-panel__body').html('');\n\t\t\tlet sum = 0;\n\t\t\tfor (let index in taxes) {\n\t\t\t\tlet row = container.find('.d-none .form-group').clone();\n\t\t\t\trow.find('.percent').text(App.Fields.Double.formatToDisplay(index) + '%');\n\t\t\t\trow.find('input').val(App.Fields.Double.formatToDisplay(taxes[index]));\n\t\t\t\trow.appendTo(container.find('.js-panel__body'));\n\t\t\t\tsum += taxes[index];\n\t\t\t}\n\t\t\tcontainer.find('.js-panel__footer input').val(App.Fields.Double.formatToDisplay(sum));\n\t\t},\n\t\tgetAllTaxes: function () {\n\t\t\tlet thisInstance = this;\n\t\t\tlet tax = [];\n\t\t\tlet typeSummary = $('.aggregationTypeTax').val();\n\t\t\tthis.getInventoryItemsContainer()\n\t\t\t\t.find(thisInstance.rowClass)\n\t\t\t\t.each(function (index) {\n\t\t\t\t\tlet row = $(this);\n\t\t\t\t\tlet netPrice = thisInstance.getNetPrice(row);\n\t\t\t\t\tlet params = row.find('.taxParam').val();\n\t\t\t\t\tif (params != '' && params != '[]' && params != undefined) {\n\t\t\t\t\t\tlet param = JSON.parse(params);\n\t\t\t\t\t\tif (typeof param.aggregationType == 'string') {\n\t\t\t\t\t\t\tparam.aggregationType = [param.aggregationType];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (param.aggregationType)\n\t\t\t\t\t\t\t$.each(param.aggregationType, function (index, name) {\n\t\t\t\t\t\t\t\tname = name + 'Tax';\n\t\t\t\t\t\t\t\tif (param[name] == undefined) {\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tlet percent = parseFloat(param[name]);\n\t\t\t\t\t\t\t\tlet old = 0;\n\t\t\t\t\t\t\t\tif (tax[percent] != undefined) {\n\t\t\t\t\t\t\t\t\told = parseFloat(tax[percent]);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tlet taxRate = netPrice * (percent / 100);\n\t\t\t\t\t\t\t\ttax[percent] = old + taxRate;\n\t\t\t\t\t\t\t\tif (typeSummary == '2') {\n\t\t\t\t\t\t\t\t\tnetPrice += taxRate;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\treturn tax;\n\t\t},\n\t\tcalculateNetPrice: function (row) {\n\t\t\tthis.setNetPrice(row, this.getNetPrice(row));\n\t\t},\n\t\tcalculateGrossPrice: function (row) {\n\t\t\tlet netPrice = this.getNetPrice(row);\n\t\t\tif (this.isIndividualTaxMode(row) || this.isGroupTaxMode(row)) {\n\t\t\t\tnetPrice += this.getTax(row);\n\t\t\t}\n\t\t\tthis.setGrossPrice(row, netPrice);\n\t\t},\n\t\tcalculateTotalPrice: function (row) {\n\t\t\tthis.setTotalPrice(row, this.getTotalPrice(row));\n\t\t},\n\t\tcalculateMargin: function (row) {\n\t\t\tlet netPrice;\n\t\t\tif ($('.netPrice', row).length) {\n\t\t\t\tnetPrice = this.getNetPrice(row);\n\t\t\t} else {\n\t\t\t\tnetPrice = this.getTotalPrice(row) - this.getDiscount(row);\n\t\t\t}\n\t\t\tlet purchase = this.getPurchase(row);\n\t\t\tlet margin = netPrice - purchase;\n\t\t\tthis.setMargin(row, margin);\n\t\t\tlet marginp = '0';\n\t\t\tif (purchase !== 0) {\n\t\t\t\tmarginp = (margin / purchase) * 100;\n\t\t\t}\n\t\t\tthis.setMarginP(row, marginp);\n\t\t},\n\t\tcalculateDiscount: function (row, modal) {\n\t\t\tlet netPriceBeforeDiscount = App.Fields.Double.formatToDb(\n\t\t\t\t\tmodal.find('.valueTotalPrice').text()\n\t\t\t\t),\n\t\t\t\tvaluePrices = netPriceBeforeDiscount,\n\t\t\t\tglobalDiscount = 0,\n\t\t\t\tgroupDiscount = 0,\n\t\t\t\tindividualDiscount = 0,\n\t\t\t\tvalueDiscount = 0;\n\n\t\t\tlet discountsType = modal.find('.discountsType').val();\n\n\t\t\tif (discountsType == '0' || discountsType == '1') {\n\t\t\t\tif (modal.find('.js-active .globalDiscount').length > 0) {\n\t\t\t\t\tglobalDiscount = App.Fields.Double.formatToDb(\n\t\t\t\t\t\tmodal.find('.js-active .globalDiscount').val()\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tif (modal.find('.js-active .individualDiscountType').length > 0) {\n\t\t\t\t\tlet individualTypeDiscount = modal\n\t\t\t\t\t\t.find('.js-active .individualDiscountType:checked')\n\t\t\t\t\t\t.val();\n\t\t\t\t\tlet value = App.Fields.Double.formatToDb(\n\t\t\t\t\t\tmodal.find('.js-active .individualDiscountValue').val()\n\t\t\t\t\t);\n\t\t\t\t\tif (individualTypeDiscount == 'percentage') {\n\t\t\t\t\t\tindividualDiscount = netPriceBeforeDiscount * (value / 100);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tindividualDiscount = value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (\n\t\t\t\t\tmodal.find('.js-active .groupCheckbox').length > 0 &&\n\t\t\t\t\tmodal.find('.js-active .groupCheckbox').prop('checked') == true\n\t\t\t\t) {\n\t\t\t\t\tgroupDiscount = App.Fields.Double.formatToDb(modal.find('.groupValue').val());\n\t\t\t\t\tgroupDiscount = netPriceBeforeDiscount * (groupDiscount / 100);\n\t\t\t\t}\n\n\t\t\t\tvaluePrices = valuePrices * ((100 - globalDiscount) / 100);\n\t\t\t\tvaluePrices = valuePrices - individualDiscount;\n\t\t\t\tvaluePrices = valuePrices - groupDiscount;\n\t\t\t} else if (discountsType == '2') {\n\t\t\t\tmodal.find('.js-active').each(function (index) {\n\t\t\t\t\tlet panel = $(this);\n\t\t\t\t\tif (panel.find('.globalDiscount').length > 0) {\n\t\t\t\t\t\tlet globalDiscount = App.Fields.Double.formatToDb(panel.find('.globalDiscount').val());\n\t\t\t\t\t\tvaluePrices = valuePrices * ((100 - globalDiscount) / 100);\n\t\t\t\t\t} else if (\n\t\t\t\t\t\tpanel.find('.groupCheckbox').length > 0 &&\n\t\t\t\t\t\tpanel.find('.groupCheckbox').prop('checked') == true\n\t\t\t\t\t) {\n\t\t\t\t\t\tlet groupDiscount = App.Fields.Double.formatToDb(panel.find('.groupValue').val());\n\t\t\t\t\t\tvaluePrices = valuePrices * ((100 - groupDiscount) / 100);\n\t\t\t\t\t} else if (panel.find('.individualDiscountType').length > 0) {\n\t\t\t\t\t\tlet value = App.Fields.Double.formatToDb(panel.find('.individualDiscountValue').val());\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tpanel.find('.individualDiscountType[name=\"individualDiscountType\"]:checked').val() ==\n\t\t\t\t\t\t\t'percentage'\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tvaluePrices = valuePrices * ((100 - value) / 100);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvaluePrices = valuePrices - value;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tmodal.find('.valuePrices').text(App.Fields.Double.formatToDisplay(valuePrices));\n\t\t\tmodal\n\t\t\t\t.find('.valueDiscount')\n\t\t\t\t.text(App.Fields.Double.formatToDisplay(netPriceBeforeDiscount - valuePrices));\n\t\t},\n\t\tcalculateTax: function (row, modal) {\n\t\t\tlet netPriceWithoutTax = App.Fields.Double.formatToDb(modal.find('.valueNetPrice').text()),\n\t\t\t\tvaluePrices = netPriceWithoutTax,\n\t\t\t\tglobalTax = 0,\n\t\t\t\tgroupTax = 0,\n\t\t\t\tregionalTax = 0,\n\t\t\t\tindividualTax = 0;\n\n\t\t\tlet taxType = modal.find('.taxsType').val();\n\t\t\tif (taxType == '0' || taxType == '1') {\n\t\t\t\tif (modal.find('.js-active .globalTax').length > 0) {\n\t\t\t\t\tglobalTax = App.Fields.Double.formatToDb(modal.find('.js-active .globalTax').val());\n\t\t\t\t}\n\t\t\t\tif (modal.find('.js-active .individualTaxValue').length > 0) {\n\t\t\t\t\tlet value = App.Fields.Double.formatToDb(\n\t\t\t\t\t\tmodal.find('.js-active .individualTaxValue').val()\n\t\t\t\t\t);\n\t\t\t\t\tindividualTax = (value / 100) * valuePrices;\n\t\t\t\t}\n\t\t\t\tif (modal.find('.js-active .groupTax').length > 0) {\n\t\t\t\t\tgroupTax = App.Fields.Double.formatToDb(modal.find('.groupTax').val());\n\t\t\t\t\tgroupTax = netPriceWithoutTax * (groupTax / 100);\n\t\t\t\t}\n\t\t\t\tif (modal.find('.js-active .regionalTax').length > 0) {\n\t\t\t\t\tregionalTax = App.Fields.Double.formatToDb(modal.find('.regionalTax').val());\n\t\t\t\t\tregionalTax = netPriceWithoutTax * (regionalTax / 100);\n\t\t\t\t}\n\n\t\t\t\tvaluePrices = valuePrices * ((100 + globalTax) / 100);\n\t\t\t\tvaluePrices = valuePrices + individualTax;\n\t\t\t\tvaluePrices = valuePrices + groupTax;\n\t\t\t\tvaluePrices = valuePrices + regionalTax;\n\t\t\t} else if (taxType == '2') {\n\t\t\t\tmodal.find('.js-active').each(function (index) {\n\t\t\t\t\tlet panel = $(this);\n\t\t\t\t\tif (panel.find('.globalTax').length > 0) {\n\t\t\t\t\t\tlet globalTax = App.Fields.Double.formatToDb(panel.find('.globalTax').val());\n\t\t\t\t\t\tvaluePrices = valuePrices * ((100 + globalTax) / 100);\n\t\t\t\t\t} else if (panel.find('.groupTax').length > 0) {\n\t\t\t\t\t\tlet groupTax = App.Fields.Double.formatToDb(panel.find('.groupTax').val());\n\t\t\t\t\t\tvaluePrices = valuePrices * ((100 + groupTax) / 100);\n\t\t\t\t\t} else if (panel.find('.regionalTax').length > 0) {\n\t\t\t\t\t\tlet regionalTax = App.Fields.Double.formatToDb(panel.find('.regionalTax').val());\n\t\t\t\t\t\tvaluePrices = valuePrices * ((100 + regionalTax) / 100);\n\t\t\t\t\t} else if (panel.find('.individualTaxValue').length > 0) {\n\t\t\t\t\t\tlet value = App.Fields.Double.formatToDb(panel.find('.individualTaxValue').val());\n\t\t\t\t\t\tvaluePrices = ((value + 100) / 100) * valuePrices;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (netPriceWithoutTax) {\n\t\t\t\tlet taxValue = ((valuePrices - netPriceWithoutTax) / netPriceWithoutTax) * 100;\n\t\t\t\tmodal.find('.js-tax-value').text(App.Fields.Double.formatToDisplay(taxValue));\n\t\t\t}\n\t\t\tmodal.find('.valuePrices').text(App.Fields.Double.formatToDisplay(valuePrices));\n\t\t\tmodal\n\t\t\t\t.find('.valueTax')\n\t\t\t\t.text(App.Fields.Double.formatToDisplay(valuePrices - netPriceWithoutTax));\n\t\t},\n\t\tupdateRowSequence: function () {\n\t\t\tlet items = this.getInventoryItemsContainer();\n\t\t\titems.find(this.rowClass).each(function (index) {\n\t\t\t\t$(this)\n\t\t\t\t\t.find('.sequence')\n\t\t\t\t\t.val(index + 1);\n\t\t\t});\n\t\t},\n\t\tregisterInventorySaveData: function () {\n\t\t\tconst thisInstance = this;\n\t\t\tthisInstance.form.on(Vtiger_Edit_Js.recordPreSave, function (e, data) {\n\t\t\t\tthisInstance.syncHeaderData();\n\t\t\t\tif (!thisInstance.checkLimits(thisInstance.form)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tlet table = thisInstance.form.find('#blackIthemTable');\n\t\t\t\ttable.find('[name]').removeAttr('name');\n\t\t\t});\n\t\t},\n\t\tsyncHeaderData() {\n\t\t\tlet header = this.getInventoryHeadContainer();\n\t\t\tthis.getInventoryItemsContainer()\n\t\t\t\t.find('.js-sync')\n\t\t\t\t.each(function () {\n\t\t\t\t\tlet element = $(this);\n\t\t\t\t\telement.val(header.find('.js-' + element.data('syncId')).val());\n\t\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Function which will be used to handle price book popup\n\t\t * @params :  element - popup image element\n\t\t */\n\t\tpricebooksModalHandler: function (element) {\n\t\t\tconst thisInstance = this;\n\t\t\tlet lineItemRow = element.closest(this.rowClass);\n\t\t\tlet rowName = lineItemRow.find('.rowName');\n\t\t\tapp.showRecordsList(\n\t\t\t\t{\n\t\t\t\t\tmodule: 'PriceBooks',\n\t\t\t\t\tsrc_module: $('[name=\"popupReferenceModule\"]', rowName).val(),\n\t\t\t\t\tsrc_record: $('.sourceField', rowName).val(),\n\t\t\t\t\tsrc_field: $('[name=\"popupReferenceModule\"]', rowName).data('field'),\n\t\t\t\t\tcurrency_id: thisInstance.getCurrency() || CONFIG.defaultCurrencyId\n\t\t\t\t},\n\t\t\t\t(modal, instance) => {\n\t\t\t\t\tinstance.setSelectEvent((responseData) => {\n\t\t\t\t\t\tAppConnector.request({\n\t\t\t\t\t\t\tmodule: 'PriceBooks',\n\t\t\t\t\t\t\taction: 'ProductListPrice',\n\t\t\t\t\t\t\trecord: responseData.id,\n\t\t\t\t\t\t\tsrc_record: $('.sourceField', rowName).val()\n\t\t\t\t\t\t}).done(function (data) {\n\t\t\t\t\t\t\tif (data.result) {\n\t\t\t\t\t\t\t\tthisInstance.setUnitPrice(lineItemRow, data.result);\n\t\t\t\t\t\t\t\tthisInstance.quantityChangeActions(lineItemRow);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tapp.errorLog('Incorrect data', responseData);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t);\n\t\t},\n\t\tsubProductsCashe: [],\n\t\tloadSubProducts: function (parentRow, indicator) {\n\t\t\tlet thisInstance = this;\n\t\t\tlet progressInstace;\n\t\t\tlet recordId = $('input.sourceField', parentRow).val();\n\t\t\tlet recordModule = parentRow.find('.rowName input[name=\"popupReferenceModule\"]').val();\n\t\t\tthisInstance.removeSubProducts(parentRow);\n\t\t\tif (\n\t\t\t\trecordId == '0' ||\n\t\t\t\trecordId == '' ||\n\t\t\t\t$.inArray(recordModule, ['Products', 'Services']) < 0\n\t\t\t) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (thisInstance.subProductsCashe[recordId]) {\n\t\t\t\tthisInstance.addSubProducts(parentRow, thisInstance.subProductsCashe[recordId]);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tlet subProrductParams = {\n\t\t\t\tmodule: 'Products',\n\t\t\t\taction: 'SubProducts',\n\t\t\t\trecord: recordId\n\t\t\t};\n\t\t\tif (indicator) {\n\t\t\t\tprogressInstace = $.progressIndicator();\n\t\t\t}\n\t\t\tAppConnector.request(subProrductParams)\n\t\t\t\t.done(function (data) {\n\t\t\t\t\tlet responseData = data.result;\n\t\t\t\t\tthisInstance.subProductsCashe[recordId] = responseData;\n\t\t\t\t\tthisInstance.addSubProducts(parentRow, responseData);\n\t\t\t\t\tif (progressInstace) {\n\t\t\t\t\t\tprogressInstace.hide();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.fail(function (error, err) {\n\t\t\t\t\tif (progressInstace) {\n\t\t\t\t\t\tprogressInstace.hide();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t},\n\t\tremoveSubProducts: function (parentRow) {\n\t\t\tlet subProductsContainer = $('.subProductsContainer ul', parentRow);\n\t\t\tsubProductsContainer.find('li').remove();\n\t\t},\n\t\taddSubProducts: function (parentRow, responseData) {\n\t\t\tlet subProductsContainer = $('.subProductsContainer ul', parentRow);\n\t\t\tfor (let id in responseData) {\n\t\t\t\tlet priductText = $('<li>').text(responseData[id]);\n\t\t\t\tsubProductsContainer.append(priductText);\n\t\t\t}\n\t\t},\n\t\tmapResultsToFields: function (referenceModule, parentRow, responseData) {\n\t\t\tlet unit,\n\t\t\t\tunitPrice,\n\t\t\t\ttaxParam = [];\n\t\t\tlet thisInstance = this;\n\t\t\tlet isGroupTax = thisInstance.isGroupTaxMode();\n\t\t\tfor (let id in responseData) {\n\t\t\t\tlet recordData = responseData[id];\n\t\t\t\tlet description = recordData.description;\n\t\t\t\tlet unitPriceValues = recordData.unitPriceValues;\n\t\t\t\tlet unitPriceValuesJson = JSON.stringify(unitPriceValues);\n\t\t\t\t// Load taxes detail\n\t\t\t\tif (isGroupTax) {\n\t\t\t\t\tlet parameters = parentRow.closest('.inventoryItems').data('taxParam');\n\t\t\t\t\tif (parameters) {\n\t\t\t\t\t\ttaxParam = JSON.parse(parameters);\n\t\t\t\t\t}\n\t\t\t\t} else if (recordData['taxes']) {\n\t\t\t\t\ttaxParam = { aggregationType: recordData.taxes.type };\n\t\t\t\t\ttaxParam[recordData.taxes.type + 'Tax'] = recordData.taxes.value;\n\t\t\t\t}\n\t\t\t\tif (recordData['taxes']) {\n\t\t\t\t\tparentRow.find('.js-tax').attr('data-default-tax', recordData.taxes.value);\n\t\t\t\t}\n\t\t\t\tthisInstance.setPurchase(parentRow, recordData.purchase);\n\t\t\t\tthisInstance.setTaxParam(parentRow, taxParam);\n\t\t\t\tthisInstance.setTax(parentRow, 0);\n\t\t\t\tthisInstance.setTaxPercent(parentRow, 0);\n\t\t\t\t// Load auto fields\n\t\t\t\tfor (let field in recordData['autoFields']) {\n\t\t\t\t\tparentRow.find('input.' + field).val(recordData['autoFields'][field]);\n\t\t\t\t\tif (recordData['autoFields'][field + 'Text']) {\n\t\t\t\t\t\tparentRow.find('.' + field + 'Text').text(recordData['autoFields'][field + 'Text']);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (recordData.price !== undefined) {\n\t\t\t\t\tthisInstance.setUnitPrice(parentRow, recordData.price);\n\t\t\t\t}\n\t\t\t\tif (unitPriceValuesJson !== undefined) {\n\t\t\t\t\t$('input.unitPrice', parentRow).attr('list-info', unitPriceValuesJson);\n\t\t\t\t}\n\t\t\t\tlet commentElement = $('textarea.commentTextarea', parentRow.next());\n\t\t\t\tlet editorInstance = CKEDITOR.instances[commentElement.attr('id')];\n\t\t\t\tif (editorInstance) {\n\t\t\t\t\teditorInstance.setData(description);\n\t\t\t\t} else {\n\t\t\t\t\tcommentElement.val(description);\n\t\t\t\t}\n\t\t\t\tif (typeof recordData['autoFields']['unit'] !== 'undefined') {\n\t\t\t\t\tunit = recordData['autoFields']['unit'];\n\t\t\t\t}\n\t\t\t\tthis.triggerQtyParam(unit, recordData.qtyPerUnit, parentRow);\n\t\t\t}\n\t\t\tif (referenceModule === 'Products') {\n\t\t\t\tthisInstance.loadSubProducts(parentRow, true);\n\t\t\t}\n\t\t\tthisInstance.quantityChangeActions(parentRow);\n\t\t},\n\t\t/**\n\t\t * Update qtyparam\n\t\t * @param {null|string} unit\n\t\t * @param int perUnit\n\t\t * @param {jQuery} parentRow\n\t\t */\n\t\ttriggerQtyParam(unit, perUnit, parentRow) {\n\t\t\tlet validationEngine;\n\t\t\tswitch (unit) {\n\t\t\t\tdefault:\n\t\t\t\t\t$('.qtyParamInfo', parentRow).addClass('d-none');\n\t\t\t\t\tvalidationEngine =\n\t\t\t\t\t\t'validate[required,funcCall[Vtiger_NumberUserFormat_Validator_Js.invokeValidation]]';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'pack':\n\t\t\t\t\t$('.qtyParamInfo', parentRow).removeClass('d-none').removeClass('active');\n\t\t\t\t\t$('.qtyParamInfo', parentRow).attr('data-content', perUnit);\n\t\t\t\t\tvalidationEngine =\n\t\t\t\t\t\t'validate[required,funcCall[Vtiger_WholeNumber_Validator_Js.invokeValidation]]';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'pcs':\n\t\t\t\t\t$('.qtyParamInfo', parentRow).addClass('d-none');\n\t\t\t\t\tvalidationEngine =\n\t\t\t\t\t\t'validate[required,funcCall[Vtiger_WholeNumber_Validator_Js.invokeValidation]]';\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\t$('input.qty', parentRow).attr('data-validation-engine', validationEngine);\n\t\t},\n\t\tsaveDiscountsParameters: function (parentRow, modal) {\n\t\t\tlet thisInstance = this;\n\t\t\tlet info = {};\n\t\t\tlet typeName = 'aggregationType';\n\t\t\tlet panels = modal.find('[name=\"' + typeName + '\"]:checked');\n\t\t\tinfo[typeName] = [];\n\t\t\tpanels.each(function (i) {\n\t\t\t\tlet type = $(this).val(),\n\t\t\t\t\tcontainer = $(this).closest('.js-panel');\n\t\t\t\tif (panels.length > 1) {\n\t\t\t\t\tinfo[typeName].push(type);\n\t\t\t\t} else {\n\t\t\t\t\tinfo[typeName] = type;\n\t\t\t\t}\n\t\t\t\tcontainer.find('[name=\"' + type + 'Discount\"]').each(function () {\n\t\t\t\t\tlet param = type + 'Discount';\n\t\t\t\t\tlet element = $(this);\n\t\t\t\t\tif ('global' === type) {\n\t\t\t\t\t\tinfo[param] = App.Fields.Double.formatToDb(element.val());\n\t\t\t\t\t} else if (\n\t\t\t\t\t\t'group' === type &&\n\t\t\t\t\t\telement.closest('.input-group').find('.groupCheckbox').prop('checked')\n\t\t\t\t\t) {\n\t\t\t\t\t\tinfo[param] = App.Fields.Double.formatToDb(element.val());\n\t\t\t\t\t} else if ('individual' === type) {\n\t\t\t\t\t\tlet name = 'individualDiscountType';\n\t\t\t\t\t\tinfo[name] = container.find('[name=\"' + name + '\"]:checked').val();\n\t\t\t\t\t\tinfo[param] = App.Fields.Double.formatToDb(element.val());\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\tthisInstance.setDiscountParam($('#blackIthemTable'), info);\n\t\t\tthisInstance.setDiscountParam(parentRow, info);\n\t\t},\n\t\tsaveTaxsParameters: function (parentRow, modal) {\n\t\t\tlet thisInstance = this;\n\t\t\tlet info = {};\n\t\t\tlet extend = ['aggregationType', 'groupCheckbox', 'individualTaxType'];\n\t\t\t$.each(thisInstance.taxModalFields, function (index, param) {\n\t\t\t\tif ($.inArray(param, extend) >= 0) {\n\t\t\t\t\tif (modal.find('[name=\"' + param + '\"]:checked').length > 1) {\n\t\t\t\t\t\tinfo[param] = [];\n\t\t\t\t\t\tmodal.find('[name=\"' + param + '\"]:checked').each(function (index) {\n\t\t\t\t\t\t\tinfo[param].push($(this).val());\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tinfo[param] = modal.find('[name=\"' + param + '\"]:checked').val();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tinfo[param] = App.Fields.Double.formatToDb(modal.find('[name=\"' + param + '\"]').val());\n\t\t\t\t}\n\t\t\t});\n\t\t\tparentRow.data('taxParam', JSON.stringify(info));\n\t\t\tthisInstance.setTaxParam(parentRow, info);\n\t\t\tthisInstance.setTaxParam($('#blackIthemTable'), info);\n\t\t},\n\t\tshowExpandedRow: function (row) {\n\t\t\tlet thisInstance = this;\n\t\t\tlet items = thisInstance.getInventoryItemsContainer();\n\t\t\tlet inventoryRowExpanded = items.find('[numrowex=\"' + row.attr('numrow') + '\"]');\n\t\t\tlet element = row.find('.toggleVisibility');\n\t\t\telement.data('status', '1');\n\t\t\tinventoryRowExpanded.removeClass('d-none');\n\t\t\tlet listInstance = Vtiger_Edit_Js.getInstance();\n\t\t\t$.each(inventoryRowExpanded.find('.js-editor'), function (key, data) {\n\t\t\t\tlistInstance.loadEditorElement($(data));\n\t\t\t});\n\t\t},\n\t\thideExpandedRow: function (row) {\n\t\t\tlet thisInstance = this;\n\t\t\tlet items = thisInstance.getInventoryItemsContainer();\n\t\t\tlet inventoryRowExpanded = items.find('[numrowex=\"' + row.attr('numrow') + '\"]');\n\t\t\tlet element = row.find('.toggleVisibility');\n\t\t\telement.data('status', '0');\n\t\t\tinventoryRowExpanded.addClass('d-none');\n\t\t\t$.each(inventoryRowExpanded.find('.js-editor'), function (key, data) {\n\t\t\t\tlet editorInstance = CKEDITOR.instances[$(data).attr('id')];\n\t\t\t\tif (editorInstance) {\n\t\t\t\t\teditorInstance.destroy();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tinitDiscountsParameters: function (parentRow, modal) {\n\t\t\tlet thisInstance = this;\n\t\t\tlet parameters = parentRow.find('.discountParam').val();\n\t\t\tif (parameters == '' || parameters == undefined) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tparameters = JSON.parse(parameters);\n\t\t\t$.each(thisInstance.discountModalFields, function (index, param) {\n\t\t\t\tlet parameter = parameters[param];\n\t\t\t\tlet field = modal.find('[name=\"' + param + '\"]');\n\t\t\t\tif (field.attr('type') == 'checkbox' || field.attr('type') == 'radio') {\n\t\t\t\t\tif ('groupCheckbox' === param && parameters['groupDiscount'] !== undefined) {\n\t\t\t\t\t\tfield.prop('checked', true);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\tlet array = parameter;\n\t\t\t\t\tif (!$.isArray(array)) {\n\t\t\t\t\t\tarray = [array];\n\t\t\t\t\t}\n\t\t\t\t\t$.each(array, function (index, arrayValue) {\n\t\t\t\t\t\tlet value = field.filter('[value=\"' + arrayValue + '\"]').prop('checked', true);\n\t\t\t\t\t\tif (param == 'aggregationType') {\n\t\t\t\t\t\t\tvalue.closest('.js-panel').find('.js-panel__body').removeClass('d-none');\n\t\t\t\t\t\t\tvalue.closest('.js-panel').addClass('js-active');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else if (field.prop('tagName') == 'SELECT') {\n\t\t\t\t\tfield\n\t\t\t\t\t\t.find('option[value=\"' + parameter + '\"]')\n\t\t\t\t\t\t.prop('selected', 'selected')\n\t\t\t\t\t\t.change();\n\t\t\t\t} else if (!field.prop('readonly')) {\n\t\t\t\t\tfield.val(parameter);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthisInstance.calculateDiscount(parentRow, modal);\n\t\t},\n\t\tinitTaxParameters: function (parentRow, modal) {\n\t\t\tconst thisInstance = this;\n\t\t\tlet parameters;\n\t\t\tif (parentRow.data('taxParam')) {\n\t\t\t\tparameters = parentRow.data('taxParam');\n\t\t\t} else {\n\t\t\t\tparameters = parentRow.find('.taxParam').val();\n\t\t\t}\n\t\t\tif (!parameters) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tparameters = JSON.parse(parameters.toString());\n\t\t\t$.each(thisInstance.taxModalFields, function (index, param) {\n\t\t\t\tlet parameter = parameters[param],\n\t\t\t\t\tfield = modal.find('[name=\"' + param + '\"]');\n\n\t\t\t\tif (field.attr('type') === 'checkbox' || field.attr('type') === 'radio') {\n\t\t\t\t\tlet array = parameter,\n\t\t\t\t\t\tvalue;\n\t\t\t\t\tif (!$.isArray(array)) {\n\t\t\t\t\t\tarray = [array];\n\t\t\t\t\t}\n\t\t\t\t\t$.each(array, function (index, arrayValue) {\n\t\t\t\t\t\tvalue = field.filter('[value=\"' + arrayValue + '\"]').prop('checked', true);\n\t\t\t\t\t\tif (param === 'aggregationType') {\n\t\t\t\t\t\t\tvalue.closest('.js-panel').find('.js-panel__body').removeClass('d-none');\n\t\t\t\t\t\t\tvalue.closest('.js-panel').addClass('js-active');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else if (field.prop('tagName') === 'SELECT') {\n\t\t\t\t\tfield\n\t\t\t\t\t\t.find('option[value=\"' + parameter + '\"]')\n\t\t\t\t\t\t.prop('selected', 'selected')\n\t\t\t\t\t\t.change();\n\t\t\t\t} else {\n\t\t\t\t\tlet input = modal.find('[name=\"' + param + '\"]');\n\t\t\t\t\tinput.val(App.Fields.Double.formatToDisplay(parameter));\n\t\t\t\t\tif (param === 'individualTax') {\n\t\t\t\t\t\tinput.formatNumber();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tthisInstance.calculateTax(parentRow, modal);\n\t\t},\n\t\tlimitEnableSave: false,\n\t\tcheckLimits: function () {\n\t\t\tlet thisInstance = this;\n\t\t\tlet account = thisInstance.getAccountId();\n\t\t\tlet limit = parseInt(app.getMainParams('inventoryLimit'));\n\t\t\tlet response = true;\n\n\t\t\tif (account == '' || thisInstance.limitEnableSave || !limit) {\n\t\t\t\treturn response;\n\t\t\t}\n\n\t\t\tlet params = {};\n\t\t\tparams.data = {\n\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\taction: 'Inventory',\n\t\t\t\tmode: 'checkLimits',\n\t\t\t\trecord: account,\n\t\t\t\tcurrency: thisInstance.getCurrency(),\n\t\t\t\tprice: thisInstance.getSummaryGrossPrice()\n\t\t\t};\n\t\t\tparams.async = false;\n\t\t\tparams.dataType = 'json';\n\t\t\tlet progressInstace = $.progressIndicator();\n\t\t\tAppConnector.request(params)\n\t\t\t\t.done(function (data) {\n\t\t\t\t\tprogressInstace.hide();\n\t\t\t\t\tif (data.result.status == false) {\n\t\t\t\t\t\tapp.showModalWindow(data.result.html, function (data) {});\n\t\t\t\t\t\tresponse = false;\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.fail(function (error, err) {\n\t\t\t\t\tprogressInstace.hide();\n\t\t\t\t});\n\t\t\treturn response;\n\t\t},\n\t\tcurrencyChangeActions: function (select, option) {\n\t\t\tif (option.data('baseCurrency') !== select.val()) {\n\t\t\t\tthis.showCurrencyChangeModal(select, option);\n\t\t\t} else {\n\t\t\t\tthis.currencyConvertValues(select, option);\n\t\t\t\tselect.data('oldValue', select.val());\n\t\t\t}\n\t\t},\n\t\tshowCurrencyChangeModal: function (select, option) {\n\t\t\tlet thisInstance = this;\n\t\t\tif (thisInstance.lockCurrencyChange == true) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthisInstance.lockCurrencyChange = true;\n\t\t\tlet block = select.closest('th');\n\t\t\tlet modal = block.find('.modelContainer').clone();\n\t\t\tapp.showModalWindow(modal, function (data) {\n\t\t\t\tlet modal = $(data);\n\t\t\t\tlet currencyParam = JSON.parse(block.find('.js-currencyparam').val());\n\n\t\t\t\tif (currencyParam != false) {\n\t\t\t\t\tif (typeof currencyParam[option.val()] === 'undefined') {\n\t\t\t\t\t\tlet defaultCurrencyParams = {\n\t\t\t\t\t\t\tvalue: 1,\n\t\t\t\t\t\t\tdate: ''\n\t\t\t\t\t\t};\n\t\t\t\t\t\tcurrencyParam[option.val()] = defaultCurrencyParams;\n\t\t\t\t\t}\n\t\t\t\t\tmodal.find('.currencyName').text(option.text());\n\t\t\t\t\tmodal.find('.currencyRate').val(currencyParam[option.val()]['value']);\n\t\t\t\t\tmodal.find('.currencyDate').text(currencyParam[option.val()]['date']);\n\t\t\t\t}\n\t\t\t\tmodal\n\t\t\t\t\t.on('click', 'button[type=\"submit\"]', function (e) {\n\t\t\t\t\t\tlet rate = modal.find('.currencyRate').val();\n\t\t\t\t\t\tlet value = App.Fields.Double.formatToDb(rate);\n\t\t\t\t\t\tlet conversionRate = 1 / App.Fields.Double.formatToDb(rate);\n\n\t\t\t\t\t\toption.data('conversionRate', conversionRate);\n\t\t\t\t\t\tcurrencyParam[option.val()] = {\n\t\t\t\t\t\t\tdate: option.data('conversionDate'),\n\t\t\t\t\t\t\tvalue: value.toString(),\n\t\t\t\t\t\t\tconversion: conversionRate.toString()\n\t\t\t\t\t\t};\n\t\t\t\t\t\tblock.find('.js-currencyparam').val(JSON.stringify(currencyParam));\n\n\t\t\t\t\t\tthisInstance.currencyConvertValues(select, option);\n\t\t\t\t\t\tselect.data('oldValue', select.val());\n\t\t\t\t\t\tapp.hideModalWindow();\n\t\t\t\t\t\tthisInstance.lockCurrencyChange = false;\n\t\t\t\t\t})\n\t\t\t\t\t.one('hidden.bs.modal', function () {\n\t\t\t\t\t\tselect.val(select.data('oldValue')).change();\n\t\t\t\t\t\tthisInstance.lockCurrencyChange = false;\n\t\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tcurrencyConvertValues: function (select, selected) {\n\t\t\tlet thisInstance = this;\n\n\t\t\tlet previous = select.find('option[value=\"' + select.data('oldValue') + '\"]');\n\t\t\tlet conversionRate = selected.data('conversionRate');\n\t\t\tlet prevConversionRate = previous.data('conversionRate');\n\t\t\tconversionRate = parseFloat(conversionRate) / parseFloat(prevConversionRate);\n\n\t\t\tthis.getInventoryItemsContainer()\n\t\t\t\t.find(thisInstance.rowClass)\n\t\t\t\t.each(function (index) {\n\t\t\t\t\tlet row = $(this);\n\n\t\t\t\t\tthisInstance.setUnitPrice(\n\t\t\t\t\t\trow,\n\t\t\t\t\t\tApp.Fields.Double.formatToDb(thisInstance.getUnitPriceValue(row) * conversionRate)\n\t\t\t\t\t);\n\t\t\t\t\tthisInstance.setDiscount(\n\t\t\t\t\t\trow,\n\t\t\t\t\t\tApp.Fields.Double.formatToDb(thisInstance.getDiscount(row) * conversionRate)\n\t\t\t\t\t);\n\t\t\t\t\tthisInstance.setTax(\n\t\t\t\t\t\trow,\n\t\t\t\t\t\tApp.Fields.Double.formatToDb(thisInstance.getTax(row) * conversionRate)\n\t\t\t\t\t);\n\t\t\t\t\tthisInstance.quantityChangeActions(row);\n\t\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Set up all row data that comes from request\n\t\t * @param {jQuery} row\n\t\t * @param {object} rowData\n\t\t */\n\t\tsetRowData(row, rowData) {\n\t\t\tthis.setName(row, rowData.name, rowData.info.name);\n\t\t\tthis.setQuantity(row, App.Fields.Double.formatToDisplay(rowData.qty));\n\t\t\tthis.setUnit(row, rowData.info.autoFields.unit, rowData.info.autoFields.unitText);\n\t\t\tif (\n\t\t\t\ttypeof rowData.info.autoFields !== 'undefined' &&\n\t\t\t\ttypeof rowData.info.autoFields.subunit !== 'undefined'\n\t\t\t) {\n\t\t\t\tthis.setSubUnit(row, rowData.info.autoFields.subunit, rowData.info.autoFields.subunitText);\n\t\t\t}\n\t\t\tthis.setComment(row, rowData.comment1);\n\t\t\tthis.setUnitPrice(row, App.Fields.Double.formatToDisplay(rowData.price));\n\t\t\tthis.setNetPrice(row, App.Fields.Double.formatToDisplay(rowData.net));\n\t\t\tthis.setGrossPrice(row, App.Fields.Double.formatToDisplay(rowData.gross));\n\t\t\tthis.setTotalPrice(row, App.Fields.Double.formatToDisplay(rowData.total));\n\t\t\tlet discountParam = rowData.discountparam || null;\n\t\t\tthis.setDiscountParam(row, JSON.parse(discountParam));\n\t\t\tthis.setDiscount(row, App.Fields.Double.formatToDisplay(rowData.discount));\n\t\t\tthis.setTaxParam(row, JSON.parse(rowData.taxparam));\n\t\t\tthis.setTax(row, App.Fields.Double.formatToDisplay(rowData.tax));\n\t\t\tthis.setTaxPercent(row, App.Fields.Double.formatToDisplay(rowData.tax_percent));\n\t\t},\n\t\t/**\n\t\t * Add new row to inventory list\n\t\t * @param {string} module\n\t\t * @param {string} baseTableId\n\t\t * @param {object} rowData [optional]\n\t\t */\n\t\taddItem(module, baseTableId, rowData = false) {\n\t\t\tconst items = this.getInventoryItemsContainer();\n\t\t\tlet newRow = this.getBasicRow();\n\t\t\tconst sequenceNumber = this.getNextLineItemRowNumber();\n\t\t\tconst replaced = newRow.html().replace(/\\_NUM_/g, sequenceNumber);\n\t\t\tconst moduleLbls = newRow.data('moduleLbls');\n\t\t\tnewRow.html(replaced);\n\t\t\tnewRow = newRow.children().appendTo(items.find('.js-inventory-items-body'));\n\t\t\tnewRow\n\t\t\t\t.find('.rowName input[name=\"popupReferenceModule\"]')\n\t\t\t\t.val(module)\n\t\t\t\t.data('field', baseTableId);\n\t\t\tnewRow.find('.js-module-icon').removeClass().addClass(`yfm-${module}`);\n\t\t\tnewRow.find('.rowName span.input-group-text').attr('data-content', moduleLbls[module]);\n\t\t\tnewRow.find('.colPicklistField select').each(function (index, select) {\n\t\t\t\tselect = $(select);\n\t\t\t\tselect.find('option').each(function (index, option) {\n\t\t\t\t\toption = $(option);\n\t\t\t\t\tif (option.data('module') !== module) {\n\t\t\t\t\t\toption.remove();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\tthis.initItem(newRow);\n\t\t\tVtiger_Edit_Js.getInstance().registerAutoCompleteFields(newRow);\n\t\t\tif (rowData) {\n\t\t\t\tthis.setRowData(newRow, rowData);\n\t\t\t\tthis.quantityChangeActions(newRow);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Register add item button click\n\t\t * @param {jQuery} container\n\t\t */\n\t\tregisterAddItem() {\n\t\t\tconst thisInstance = this;\n\t\t\tconst itemsHeader = thisInstance.getInventoryHeadContainer();\n\t\t\titemsHeader.find('.js-inv-add-item').on('click', function (e) {\n\t\t\t\tconst btn = $(this);\n\t\t\t\tthisInstance.addItem(btn.data('module'), btn.data('field'));\n\t\t\t});\n\t\t},\n\t\tregisterSortableItems: function () {\n\t\t\tlet thisInstance = this;\n\t\t\tlet items = thisInstance.getInventoryItemsContainer();\n\t\t\titems.sortable({\n\t\t\t\thandle: '.dragHandle',\n\t\t\t\titems: thisInstance.rowClass,\n\t\t\t\trevert: true,\n\t\t\t\ttolerance: 'pointer',\n\t\t\t\tplaceholder: 'ui-state-highlight',\n\t\t\t\thelper: function (e, ui) {\n\t\t\t\t\tui.children().each(function (index, element) {\n\t\t\t\t\t\telement = $(element);\n\t\t\t\t\t\telement.width(element.width());\n\t\t\t\t\t});\n\t\t\t\t\treturn ui;\n\t\t\t\t},\n\t\t\t\tstart: function (event, ui) {\n\t\t\t\t\titems.find(thisInstance.rowClass).each(function (index, element) {\n\t\t\t\t\t\tlet row = $(element);\n\t\t\t\t\t\tthisInstance.hideExpandedRow(row);\n\t\t\t\t\t});\n\t\t\t\t\tui.item.startPos = ui.item.index();\n\t\t\t\t},\n\t\t\t\tstop: function (event, ui) {\n\t\t\t\t\tlet numrow = $(ui.item).attr('numrow');\n\t\t\t\t\tlet child = items\n\t\t\t\t\t\t.find('.numRow' + numrow)\n\t\t\t\t\t\t.remove()\n\t\t\t\t\t\t.clone();\n\t\t\t\t\titems.find('[numrow=\"' + numrow + '\"]').after(child);\n\t\t\t\t\tif (ui.item.startPos < ui.item.index()) {\n\t\t\t\t\t\tchild = items\n\t\t\t\t\t\t\t.find('.numRow' + numrow)\n\t\t\t\t\t\t\t.next()\n\t\t\t\t\t\t\t.remove()\n\t\t\t\t\t\t\t.clone();\n\t\t\t\t\t\titems.find('[numrow=\"' + numrow + '\"]').before(child);\n\t\t\t\t\t}\n\t\t\t\t\tthisInstance.updateRowSequence();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tregisterShowHideExpanded: function () {\n\t\t\tconst thisInstance = this;\n\t\t\tthisInstance.form.on('click', '.toggleVisibility', function (e) {\n\t\t\t\tlet element = $(e.currentTarget);\n\t\t\t\tlet row = thisInstance.getClosestRow(element);\n\t\t\t\tif (element.data('status') == 0) {\n\t\t\t\t\tthisInstance.showExpandedRow(row);\n\t\t\t\t} else {\n\t\t\t\t\tthisInstance.hideExpandedRow(row);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tregisterPriceBookModal: function (container) {\n\t\t\tlet thisInstance = this;\n\t\t\tcontainer.find('.js-price-book-modal').on('click', function (e) {\n\t\t\t\tlet element = $(e.currentTarget);\n\t\t\t\tlet response = thisInstance.isRecordSelected(element);\n\t\t\t\tif (response == true) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthisInstance.pricebooksModalHandler(element);\n\t\t\t});\n\t\t},\n\t\tregisterRowChangeEvent: function (container) {\n\t\t\tcontainer.on('focusout', '.qty', (e) => {\n\t\t\t\tlet element = $(e.currentTarget);\n\t\t\t\telement.formatNumber();\n\t\t\t\tthis.quantityChangeActions(this.getClosestRow(element));\n\t\t\t});\n\t\t\tcontainer.on('focusout', '.unitPrice', (e) => {\n\t\t\t\tlet element = $(e.currentTarget);\n\t\t\t\telement.formatNumber();\n\t\t\t\tthis.quantityChangeActions(this.getClosestRow(element));\n\t\t\t});\n\t\t\tcontainer.on('focusout', '.purchase', (e) => {\n\t\t\t\tlet element = $(e.currentTarget);\n\t\t\t\telement.formatNumber();\n\t\t\t\tthis.quantityChangeActions(this.getClosestRow(element));\n\t\t\t});\n\t\t\tlet headContainer = this.getInventoryHeadContainer();\n\t\t\theadContainer.on('change', '.js-taxmode', (e) => {\n\t\t\t\tlet element = $(e.currentTarget);\n\t\t\t\tthis.showIndividualTax(this.getClosestRow(element));\n\t\t\t\tthis.rowsCalculations();\n\t\t\t});\n\t\t\theadContainer.on('change', '.js-discountmode', (e) => {\n\t\t\t\tlet element = $(e.currentTarget);\n\t\t\t\tthis.showIndividualDiscount(this.getClosestRow(element));\n\t\t\t\tthis.rowsCalculations();\n\t\t\t});\n\t\t},\n\t\tregisterSubProducts: function () {\n\t\t\tconst thisInstance = this;\n\t\t\tthisInstance.form.find('.inventoryItems ' + thisInstance.rowClass).each(function (index) {\n\t\t\t\tthisInstance.loadSubProducts($(this), false);\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Register clear reference selection\n\t\t */\n\t\tregisterClearReferenceSelection() {\n\t\t\tthis.form.on('click', '.clearReferenceSelection', (e) => {\n\t\t\t\tconst referenceGroup = $(e.currentTarget).closest('div.referenceGroup');\n\t\t\t\tif (referenceGroup.length) {\n\t\t\t\t\treferenceGroup.find('input[id$=\"_display\"]').val('').removeAttr('readonly');\n\t\t\t\t} else {\n\t\t\t\t\tconst row = this.getClosestRow($(e.currentTarget));\n\t\t\t\t\tthis.removeSubProducts(row);\n\t\t\t\t\trow\n\t\t\t\t\t\t.find('.unitPrice,.tax,.discount,.margin,.purchase,.js-tax-percent')\n\t\t\t\t\t\t.val(App.Fields.Double.formatToDisplay(0));\n\t\t\t\t\trow.find('.qty').val(1);\n\t\t\t\t\trow.find('textarea,.valueVal').val('');\n\t\t\t\t\trow.find('.valueText').text('');\n\t\t\t\t\trow.find('.qtyParamInfo').addClass('d-none');\n\t\t\t\t\trow.find('.recordLabel').val('').removeAttr('readonly');\n\t\t\t\t\tif (!this.isGroupTaxMode()) {\n\t\t\t\t\t\tthis.setTaxParam(row, []);\n\t\t\t\t\t}\n\t\t\t\t\tthis.quantityChangeActions(row);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tregisterDeleteLineItemEvent: function (container) {\n\t\t\tlet thisInstance = this;\n\t\t\tcontainer.on('click', '.deleteRow', function (e) {\n\t\t\t\tlet num = thisInstance.getClosestRow($(e.currentTarget)).attr('numrow');\n\t\t\t\tthisInstance\n\t\t\t\t\t.getInventoryItemsContainer()\n\t\t\t\t\t.find('[numrow=\"' + num + '\"], [numrowex=\"' + num + '\"]')\n\t\t\t\t\t.remove();\n\t\t\t\tthisInstance.checkDeleteIcon();\n\t\t\t\tthisInstance.rowsCalculations();\n\t\t\t\tif (thisInstance.getInventoryItemsContainer().find('.inventoryRow').length === 0) {\n\t\t\t\t\t$('#inventoryItemsNo').val(0);\n\t\t\t\t}\n\t\t\t\tthisInstance.updateRowSequence();\n\t\t\t});\n\t\t},\n\t\tregisterChangeDiscount: function () {\n\t\t\tlet thisInstance = this;\n\t\t\tthisInstance.form.on('click', '.changeDiscount', function (e) {\n\t\t\t\tlet parentRow;\n\t\t\t\tlet element = $(e.currentTarget);\n\t\t\t\tlet params = {\n\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\tview: 'Inventory',\n\t\t\t\t\tmode: 'showDiscounts',\n\t\t\t\t\tcurrency: thisInstance.getCurrency(),\n\t\t\t\t\trelatedRecord: thisInstance.getAccountId()\n\t\t\t\t};\n\t\t\t\tif (element.hasClass('groupDiscount')) {\n\t\t\t\t\tparentRow = thisInstance.getInventoryItemsContainer();\n\t\t\t\t\tif (parentRow.find('tfoot .colTotalPrice').length != 0) {\n\t\t\t\t\t\tparams.totalPrice = App.Fields.Double.formatToDb(\n\t\t\t\t\t\t\tparentRow.find('tfoot .colTotalPrice').text()\n\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tparams.totalPrice = 0;\n\t\t\t\t\t}\n\t\t\t\t\tparams.discountType = 1;\n\t\t\t\t} else {\n\t\t\t\t\tparentRow = element.closest(thisInstance.rowClass);\n\t\t\t\t\tparams.totalPrice = thisInstance.getTotalPrice(parentRow);\n\t\t\t\t\tparams.discountType = 0;\n\t\t\t\t}\n\n\t\t\t\tlet progressInstace = $.progressIndicator();\n\t\t\t\tAppConnector.request(params)\n\t\t\t\t\t.done(function (data) {\n\t\t\t\t\t\tapp.showModalWindow(data, function (data) {\n\t\t\t\t\t\t\tthisInstance.initDiscountsParameters(parentRow, $(data));\n\t\t\t\t\t\t\tthisInstance.registerChangeDiscountModal(data, parentRow, params);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tprogressInstace.hide();\n\t\t\t\t\t})\n\t\t\t\t\t.fail(function (error, err) {\n\t\t\t\t\t\tprogressInstace.hide();\n\t\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tregisterChangeDiscountModal: function (modal, parentRow, params) {\n\t\t\tlet thisInstance = this;\n\t\t\tmodal.on('change', '.individualDiscountType', function (e) {\n\t\t\t\tlet element = $(e.currentTarget);\n\t\t\t\tmodal.find('.individualDiscountContainer .input-group-text').text(element.data('symbol'));\n\t\t\t});\n\t\t\tmodal.on('change', '.activeCheckbox[name=\"aggregationType\"]', function (e) {\n\t\t\t\tlet element = $(e.currentTarget);\n\n\t\t\t\tif (element.attr('type') == 'checkbox' && this.checked) {\n\t\t\t\t\telement.closest('.js-panel').find('.js-panel__body').removeClass('d-none');\n\t\t\t\t\telement.closest('.js-panel').addClass('js-active');\n\t\t\t\t} else if (element.attr('type') == 'radio') {\n\t\t\t\t\tmodal.find('.js-panel').removeClass('js-active');\n\t\t\t\t\tmodal.find('.js-panel .js-panel__body').addClass('d-none');\n\t\t\t\t\telement.closest('.js-panel').find('.js-panel__body').removeClass('d-none');\n\t\t\t\t\telement.closest('.js-panel').addClass('js-active');\n\t\t\t\t} else {\n\t\t\t\t\telement.closest('.js-panel').find('.js-panel__body').addClass('d-none');\n\t\t\t\t\telement.closest('.js-panel').removeClass('js-active');\n\t\t\t\t}\n\t\t\t});\n\t\t\tmodal.on(\n\t\t\t\t'change',\n\t\t\t\t'.activeCheckbox, .globalDiscount,.individualDiscountValue,.individualDiscountType,.groupCheckbox',\n\t\t\t\tfunction (e) {\n\t\t\t\t\tthisInstance.calculateDiscount(parentRow, modal);\n\t\t\t\t}\n\t\t\t);\n\t\t\tmodal.on('click', '.saveDiscount', function (e) {\n\t\t\t\tthisInstance.saveDiscountsParameters(parentRow, modal);\n\t\t\t\tif (params.discountType == 0) {\n\t\t\t\t\tthisInstance.setDiscount(\n\t\t\t\t\t\tparentRow,\n\t\t\t\t\t\tApp.Fields.Double.formatToDb(modal.find('.valueDiscount').text())\n\t\t\t\t\t);\n\t\t\t\t\tthisInstance.quantityChangeActions(parentRow);\n\t\t\t\t} else {\n\t\t\t\t\tlet rate =\n\t\t\t\t\t\tApp.Fields.Double.formatToDb(modal.find('.valueDiscount').text()) /\n\t\t\t\t\t\tApp.Fields.Double.formatToDb(modal.find('.valueTotalPrice').text());\n\t\t\t\t\tparentRow.find(thisInstance.rowClass).each(function (index) {\n\t\t\t\t\t\tthisInstance.setDiscount($(this), thisInstance.getTotalPrice($(this)) * rate);\n\t\t\t\t\t\tthisInstance.quantityChangeActions($(this));\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tapp.hideModalWindow();\n\t\t\t});\n\t\t},\n\t\tregisterChangeTax: function () {\n\t\t\tconst thisInstance = this;\n\t\t\tthisInstance.form.on('click', '.changeTax', function (e) {\n\t\t\t\tlet parentRow;\n\t\t\t\tlet element = $(e.currentTarget);\n\t\t\t\tlet params = {\n\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\tview: 'Inventory',\n\t\t\t\t\tmode: 'showTaxes',\n\t\t\t\t\tcurrency: thisInstance.getCurrency(),\n\t\t\t\t\tsourceRecord: app.getRecordId()\n\t\t\t\t};\n\t\t\t\tif (element.hasClass('groupTax')) {\n\t\t\t\t\tparentRow = thisInstance.getInventoryItemsContainer();\n\t\t\t\t\tlet totalPrice = 0;\n\t\t\t\t\tif (parentRow.find('tfoot .colNetPrice').length > 0) {\n\t\t\t\t\t\ttotalPrice = parentRow.find('tfoot .colNetPrice').text();\n\t\t\t\t\t} else if (parentRow.find('tfoot .colTotalPrice ').length > 0) {\n\t\t\t\t\t\ttotalPrice = parentRow.find('tfoot .colTotalPrice ').text();\n\t\t\t\t\t}\n\t\t\t\t\tparams.totalPrice = App.Fields.Double.formatToDb(totalPrice);\n\t\t\t\t\tparams.taxType = 1;\n\t\t\t\t} else {\n\t\t\t\t\tparentRow = element.closest(thisInstance.rowClass);\n\t\t\t\t\tlet sourceRecord = parentRow.find('.rowName .sourceField').val();\n\t\t\t\t\tparams.totalPrice = thisInstance.getNetPrice(parentRow);\n\t\t\t\t\tparams.taxType = 0;\n\t\t\t\t\tif (sourceRecord) {\n\t\t\t\t\t\tparams.record = sourceRecord;\n\t\t\t\t\t}\n\t\t\t\t\tparams.recordModule = parentRow.find('.rowName [name=\"popupReferenceModule\"]').val();\n\t\t\t\t}\n\t\t\t\tlet progressInstace = $.progressIndicator();\n\t\t\t\tAppConnector.request(params)\n\t\t\t\t\t.done(function (data) {\n\t\t\t\t\t\tapp.showModalWindow(data, function (data) {\n\t\t\t\t\t\t\tthisInstance.initTaxParameters(parentRow, $(data));\n\t\t\t\t\t\t\tthisInstance.registerChangeTaxModal(data, parentRow, params);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tprogressInstace.hide();\n\t\t\t\t\t})\n\t\t\t\t\t.fail(function (error, err) {\n\t\t\t\t\t\tprogressInstace.hide();\n\t\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tlockCurrencyChange: false,\n\t\tregisterChangeCurrency() {\n\t\t\tthis.getInventoryHeadContainer().on('change', '.js-currency', (e) => {\n\t\t\t\tlet element = $(e.currentTarget),\n\t\t\t\t\tsymbol = element.find('option:selected').data('conversionSymbol');\n\t\t\t\tthis.currencyChangeActions(element, element.find('option:selected'));\n\t\t\t\tthis.form.find('.currencySymbol').text(symbol);\n\t\t\t});\n\t\t},\n\t\tregisterChangeTaxModal: function (modal, parentRow, params) {\n\t\t\tlet thisInstance = this;\n\t\t\tmodal.on('change', '.individualTaxType', function (e) {\n\t\t\t\tlet element = $(e.currentTarget);\n\t\t\t\tmodal.find('.individualTaxContainer .input-group-text').text(element.data('symbol'));\n\t\t\t});\n\t\t\tmodal.on('change', '.activeCheckbox[name=\"aggregationType\"]', function (e) {\n\t\t\t\tlet element = $(e.currentTarget);\n\n\t\t\t\tif (element.attr('type') == 'checkbox' && this.checked) {\n\t\t\t\t\telement.closest('.js-panel').find('.js-panel__body').removeClass('d-none');\n\t\t\t\t\telement.closest('.js-panel').addClass('js-active');\n\t\t\t\t} else if (element.attr('type') == 'radio') {\n\t\t\t\t\tmodal.find('.js-panel').removeClass('js-active');\n\t\t\t\t\tmodal.find('.js-panel .js-panel__body').addClass('d-none');\n\t\t\t\t\telement.closest('.js-panel').find('.js-panel__body').removeClass('d-none');\n\t\t\t\t\telement.closest('.js-panel').addClass('js-active');\n\t\t\t\t} else {\n\t\t\t\t\telement.closest('.js-panel').find('.js-panel__body').addClass('d-none');\n\t\t\t\t\telement.closest('.js-panel').removeClass('js-active');\n\t\t\t\t}\n\t\t\t});\n\t\t\tmodal.on(\n\t\t\t\t'change',\n\t\t\t\t'.activeCheckbox, .globalTax, .individualTaxValue, .groupTax, .regionalTax',\n\t\t\t\tfunction (e) {\n\t\t\t\t\tthisInstance.calculateTax(parentRow, modal);\n\t\t\t\t}\n\t\t\t);\n\t\t\tmodal.on('click', '.saveTaxs', function (e) {\n\t\t\t\tthisInstance.saveTaxsParameters(parentRow, modal);\n\t\t\t\tif (params.taxType == '0') {\n\t\t\t\t\tthisInstance.setTax(\n\t\t\t\t\t\tparentRow,\n\t\t\t\t\t\tApp.Fields.Double.formatToDb(modal.find('.valueTax').text())\n\t\t\t\t\t);\n\t\t\t\t\tthisInstance.setTaxPercent(\n\t\t\t\t\t\tparentRow,\n\t\t\t\t\t\tApp.Fields.Double.formatToDb(modal.find('.js-tax-value').text())\n\t\t\t\t\t);\n\t\t\t\t\tthisInstance.quantityChangeActions(parentRow);\n\t\t\t\t} else {\n\t\t\t\t\tlet rate =\n\t\t\t\t\t\tApp.Fields.Double.formatToDb(modal.find('.valueTax').text()) /\n\t\t\t\t\t\tApp.Fields.Double.formatToDb(modal.find('.valueNetPrice').text());\n\t\t\t\t\tparentRow.find(thisInstance.rowClass).each(function (index) {\n\t\t\t\t\t\tlet totalPrice;\n\t\t\t\t\t\tif ($('.netPrice', $(this)).length > 0) {\n\t\t\t\t\t\t\ttotalPrice = thisInstance.getNetPrice($(this));\n\t\t\t\t\t\t} else if ($('.totalPrice', $(this)).length > 0) {\n\t\t\t\t\t\t\ttotalPrice = thisInstance.getTotalPrice($(this));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthisInstance.setTax($(this), totalPrice * rate);\n\t\t\t\t\t\tthisInstance.setTaxPercent(\n\t\t\t\t\t\t\t$(this),\n\t\t\t\t\t\t\tApp.Fields.Double.formatToDb(modal.find('.js-tax-value').text())\n\t\t\t\t\t\t);\n\t\t\t\t\t\tthisInstance.quantityChangeActions($(this));\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tapp.hideModalWindow();\n\t\t\t});\n\t\t},\n\t\tregisterRowAutoComplete: function (container) {\n\t\t\tconst thisInstance = this;\n\t\t\tlet sourceFieldElement = container.find('.sourceField.js-name');\n\t\t\tsourceFieldElement.on(Vtiger_Edit_Js.referenceSelectionEvent, function (e, params) {\n\t\t\t\tlet record = params.record;\n\t\t\t\tlet element = $(e.currentTarget);\n\t\t\t\tlet parentRow = element.closest(thisInstance.rowClass);\n\t\t\t\tlet selectedModule = parentRow.find('.rowName [name=\"popupReferenceModule\"]').val();\n\t\t\t\tlet dataUrl =\n\t\t\t\t\t'index.php?module=' +\n\t\t\t\t\tapp.getModuleName() +\n\t\t\t\t\t'&action=Inventory&mode=getDetails&record=' +\n\t\t\t\t\trecord +\n\t\t\t\t\t'&fieldname=' +\n\t\t\t\t\telement.data('columnname');\n\t\t\t\tif (thisInstance.getCurrency()) {\n\t\t\t\t\tdataUrl += '&currency_id=' + thisInstance.getCurrency();\n\t\t\t\t}\n\t\t\t\tAppConnector.request(dataUrl).done(function (data) {\n\t\t\t\t\tfor (let id in data) {\n\t\t\t\t\t\tif (typeof data[id] == 'object') {\n\t\t\t\t\t\t\tlet recordData = data[id];\n\t\t\t\t\t\t\tthisInstance.mapResultsToFields(selectedModule, parentRow, recordData);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tcalculateItemNumbers: function () {\n\t\t\tlet thisInstance = this;\n\t\t\tlet items = this.getInventoryItemsContainer();\n\t\t\tlet i = 1;\n\t\t\titems.find(thisInstance.rowClass).each(function (index) {\n\t\t\t\t$(this).find('.itemNumberText').text(i);\n\t\t\t\ti++;\n\t\t\t});\n\t\t},\n\t\tinitItem: function (container) {\n\t\t\tlet thisInstance = this;\n\t\t\tif (typeof container === 'undefined') {\n\t\t\t\tcontainer = thisInstance.getInventoryItemsContainer();\n\t\t\t}\n\t\t\tthisInstance.registerDeleteLineItemEvent(container);\n\t\t\tthisInstance.registerPriceBookModal(container);\n\t\t\tthisInstance.registerRowChangeEvent(container);\n\t\t\tthisInstance.registerRowAutoComplete(container);\n\t\t\tthisInstance.checkDeleteIcon();\n\t\t\tthisInstance.rowsCalculations();\n\t\t\tthisInstance.updateRowSequence();\n\t\t\tApp.Fields.Picklist.showSelect2ElementView(container.find('.selectInv'));\n\t\t\tApp.Fields.Date.register(container, true, {}, 'dateFieldInv');\n\t\t\tcontainer.validationEngine('detach');\n\t\t\tcontainer.validationEngine(app.validationEngineOptions);\n\t\t},\n\t\t/**\n\t\t * Load inventory data for specified record\n\t\t * @param {int} recordId\n\t\t * @param {string} sourceModule\n\t\t * @param {function|bool} success callback\n\t\t * @param {function|bool} fail callback\n\t\t * @returns Promise\n\t\t */\n\t\tloadInventoryData(recordId, sourceModule, success = false, fail = false) {\n\t\t\tconst progressLoader = $.progressIndicator({ blockInfo: { enabled: true } });\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tAppConnector.request({\n\t\t\t\t\tmodule: sourceModule,\n\t\t\t\t\taction: 'Inventory',\n\t\t\t\t\tmode: 'getTableData',\n\t\t\t\t\trecord: recordId\n\t\t\t\t})\n\t\t\t\t\t.done((response) => {\n\t\t\t\t\t\tlet activeModules = [];\n\t\t\t\t\t\tthis.getInventoryHeadContainer()\n\t\t\t\t\t\t\t.find('.js-inv-add-item')\n\t\t\t\t\t\t\t.each((index, addBtn) => {\n\t\t\t\t\t\t\t\tactiveModules.push($(addBtn).data('module'));\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\tprogressLoader.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\tconst oldCurrencyChangeAction = this.currencyChangeActions;\n\t\t\t\t\t\tthis.currencyChangeActions = function changeCurrencyActions(select, option) {\n\t\t\t\t\t\t\tthis.currencyConvertValues(select, option);\n\t\t\t\t\t\t\tselect.data('oldValue', select.val());\n\t\t\t\t\t\t};\n\t\t\t\t\t\tconst first = response.result[Object.keys(response.result)[0]];\n\t\t\t\t\t\tthis.setCurrencyParam(first.currencyparam);\n\t\t\t\t\t\tthis.setCurrency(first.currency);\n\t\t\t\t\t\tthis.setDiscountMode(first.discountmode);\n\t\t\t\t\t\tthis.setTaxMode(first.taxmode);\n\t\t\t\t\t\tthis.currencyChangeActions = oldCurrencyChangeAction;\n\t\t\t\t\t\t$.each(response.result, (index, row) => {\n\t\t\t\t\t\t\tif (activeModules.indexOf(row.moduleName) !== -1) {\n\t\t\t\t\t\t\t\tthis.addItem(row.moduleName, row.basetableid, row);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tVtiger_Helper_Js.showMessage({\n\t\t\t\t\t\t\t\t\ttype: 'error',\n\t\t\t\t\t\t\t\t\ttext: app\n\t\t\t\t\t\t\t\t\t\t.vtranslate('JS_INVENTORY_ITEM_MODULE_NOT_FOUND')\n\t\t\t\t\t\t\t\t\t\t.replace('${sourceModule}', row.moduleName)\n\t\t\t\t\t\t\t\t\t\t.replace('${position}', row.info.name)\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.summaryCalculations();\n\t\t\t\t\t\tresolve(response.result);\n\t\t\t\t\t\tif (typeof success === 'function') {\n\t\t\t\t\t\t\tsuccess(response.result);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.fail((error, err) => {\n\t\t\t\t\t\tprogressLoader.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\treject(error, err);\n\t\t\t\t\t\tif (typeof fail === 'function') {\n\t\t\t\t\t\t\tfail(error, err);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Function which will register all the events\n\t\t */\n\t\tregisterEvents: function (container) {\n\t\t\tthis.form = container;\n\t\t\tthis.registerInventorySaveData();\n\t\t\tthis.registerAddItem();\n\t\t\tthis.initItem();\n\t\t\tthis.registerSortableItems();\n\t\t\tthis.registerSubProducts();\n\t\t\tthis.registerChangeDiscount();\n\t\t\tthis.registerChangeTax();\n\t\t\tthis.registerClearReferenceSelection();\n\t\t\tthis.registerShowHideExpanded();\n\t\t\tthis.registerChangeCurrency();\n\t\t\tthis.setDefaultGlobalTax(container);\n\t\t}\n\t}\n);\n"],"names":["$","Class","inventoryInstance","getInventoryInstance","container","find","val","moduleClassName","registerEvents","form","inventoryContainer","inventoryHeadContainer","summaryTaxesContainer","summaryDiscountContainer","summaryCurrenciesContainer","rowClass","discountModalFields","taxModalFields","getForm","getInventoryItemsContainer","getInventoryHeadContainer","getInventorySummaryDiscountContainer","getInventorySummaryTaxesContainer","getInventorySummaryCurrenciesContainer","getNextLineItemRowNumber","rowNumber","parseInt","$inventoryItemsNo","getAccountId","accountReferenceField","checkDeleteIcon","length","showLineItemsDeleteIcon","app","getMainParams","hideLineItemsDeleteIcon","removeClass","addClass","getClosestRow","element","closest","getBasicRow","eq","clone","isRecordSelected","productField","parentRow","validationEngine","getTaxModeSelectElement","row","isIndividualTaxMode","selectedOption","taxModeElement","isGroupTaxMode","taxTypeElement","showIndividualTax","groupTax","thisInstance","items","newRow","taxParam","aggregationType","each","parseFloat","thisItem","attr","setTaxParam","setTax","setTaxPercent","setDefaultGlobalTax","rowsCalculations","taxDefaultValue","data","isGroupTax","getRecordId","getTaxPercent","JSON","stringify","quantityChangeActions","getDiscountModeSelectElement","isIndividualDiscountMode","discountModeElement","showIndividualDiscount","groupDiscount","setDiscount","setDiscountParam","getCurrency","getTax","taxParams","parse","valuePrices","getNetPrice","taxRate","types","forEach","entry","taxValue","individualTax","globalTax","regionalTax","taxPercent","getTaxParams","getQuantityValue","getNumberFromValue","getUnitPriceValue","getDiscount","discountParams","getTotalPrice","discountRate","discountValue","individualDiscount","individualDiscountType","globalDiscount","getGrossPrice","getPurchase","purchase","App","Fields","Double","formatToDb","qty","getSummaryGrossPrice","price","setCurrency","trigger","setCurrencyParam","setDiscountMode","setTaxMode","setName","display","setQuantity","setUnit","text","setSubUnit","setComment","parent","setUnitPrice","formatToDisplay","setPurchase","setNetPrice","setGrossPrice","setTotalPrice","setMargin","setMarginP","rowCalculations","summaryCalculations","calculateTotalPrice","calculateDiscounts","calculateNetPrice","calculateTaxes","calculateGrossPrice","calculateMargin","calculateItemNumbers","calculatSummary","calculatDiscountSummary","calculatTaxSummary","calculatCurrenciesSummary","calculatMarginPSummary","field","sum","totalPriceField","sumRow","sumPrice","getNumberFromText","marginp","purchasePrice","subtraction","discount","getAllDiscount","selected","base","conversionRate","baseConversionRate","getAllTaxes","html","taxes","index","value","appendTo","tax","typeSummary","netPrice","params","param","name","old","percent","margin","calculateDiscount","modal","netPriceBeforeDiscount","discountsType","prop","panel","calculateTax","netPriceWithoutTax","taxType","updateRowSequence","registerInventorySaveData","on","Vtiger_Edit_Js","recordPreSave","syncHeaderData","checkLimits","table","removeAttr","header","pricebooksModalHandler","lineItemRow","rowName","showRecordsList","module","src_module","src_record","src_field","currency_id","CONFIG","defaultCurrencyId","instance","setSelectEvent","responseData","AppConnector","request","action","record","id","done","result","errorLog","subProductsCashe","loadSubProducts","indicator","progressInstace","recordId","recordModule","removeSubProducts","inArray","addSubProducts","progressIndicator","hide","fail","subProductsContainer","remove","append","priductText","mapResultsToFields","referenceModule","description","recordData","unitPriceValues","unitPriceValuesJson","parameters","type","next","editorInstance","CKEDITOR","instances","commentElement","setData","unit","triggerQtyParam","qtyPerUnit","perUnit","saveDiscountsParameters","info","panels","push","saveTaxsParameters","extend","showExpandedRow","inventoryRowExpanded","getInstance","key","listInstance","loadEditorElement","hideExpandedRow","destroy","initDiscountsParameters","parameter","isArray","array","arrayValue","filter","change","initTaxParameters","toString","input","formatNumber","limitEnableSave","account","limit","response","getModuleName","mode","currency","async","dataType","status","showModalWindow","currencyChangeActions","select","option","currencyConvertValues","showCurrencyChangeModal","lockCurrencyChange","block","currencyParam","date","rate","conversion","hideModalWindow","one","previous","prevConversionRate","setRowData","rowData","autoFields","unitText","subunit","subunitText","comment1","net","gross","total","discountparam","discountParam","taxparam","tax_percent","addItem","baseTableId","sequenceNumber","replaced","replace","moduleLbls","children","initItem","registerAutoCompleteFields","registerAddItem","itemsHeader","btn","registerSortableItems","sortable","handle","revert","tolerance","placeholder","helper","e","ui","width","start","event","item","startPos","stop","child","numrow","after","before","registerShowHideExpanded","currentTarget","registerPriceBookModal","registerRowChangeEvent","headContainer","registerSubProducts","registerClearReferenceSelection","referenceGroup","registerDeleteLineItemEvent","num","registerChangeDiscount","view","relatedRecord","hasClass","totalPrice","discountType","registerChangeDiscountModal","checked","registerChangeTax","sourceRecord","registerChangeTaxModal","registerChangeCurrency","symbol","registerRowAutoComplete","sourceFieldElement","referenceSelectionEvent","selectedModule","dataUrl","i","Picklist","showSelect2ElementView","Date","register","validationEngineOptions","loadInventoryData","sourceModule","success","progressLoader","blockInfo","enabled","resolve","reject","addBtn","activeModules","Object","keys","first","currencyparam","discountmode","taxmode","oldCurrencyChangeAction","indexOf","moduleName","Vtiger_Helper_Js","showMessage","vtranslate","basetableid","error","err"],"mappings":"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"}