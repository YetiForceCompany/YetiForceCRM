'use strict';

jQuery.Class("Vtiger_TreeRecords_Js",{},{mainContainer:!1,treeInstance:!1,treeData:!1,getContainer:function a(){return !1==this.mainContainer&&(this.mainContainer=jQuery("#centerPanel")),this.mainContainer},setContainer:function b(a){this.mainContainer=a;},getTreeListValues:function c(a){if(!1==this.treeData&&"undefined"!==a){var b=a.find("#treeListValues").val();""!=b&&(this.treeData=JSON.parse(b));}return this.treeData},generateTree:function d(a){var b=this;b.treeInstance=a.find("#treeListContents");var c=["checkbox"];"1"==app.getMainParams("isActiveCategory")&&c.push("category"),b.treeInstance.jstree({core:{data:b.getTreeListValues(a),themes:{name:"proton",responsive:!0}},plugins:c});},getRecordsParams:function f(a){var b=this,c=a.find("#moduleFilter").val(),d=[];$.each(b.treeInstance.jstree("get_selected",!0),function(a,b){d.push(b.original.record_id);});var e={module:app.getModuleName(),view:app.getViewName(),branches:d,filter:c};return "1"==app.getMainParams("isActiveCategory")&&(e.category=b.treeInstance.jstree("getCategory")),e},getRecordsList:function d(){var a=this,b=a.getContainer(),c=jQuery.progressIndicator({message:app.vtranslate("JS_LOADING_OF_RECORDS"),blockInfo:{enabled:!0}});$.extend($.fn.dataTable.defaults,{language:{sLengthMenu:app.vtranslate("JS_S_LENGTH_MENU"),sZeroRecords:app.vtranslate("JS_NO_RESULTS_FOUND"),sInfo:app.vtranslate("JS_S_INFO"),sInfoEmpty:app.vtranslate("JS_S_INFO_EMPTY"),sSearch:app.vtranslate("JS_SEARCH"),sEmptyTable:app.vtranslate("JS_NO_RESULTS_FOUND"),sInfoFiltered:app.vtranslate("JS_S_INFO_FILTERED"),sLoadingRecords:app.vtranslate("JS_LOADING_OF_RECORDS"),sProcessing:app.vtranslate("JS_LOADING_OF_RECORDS"),oPaginate:{sFirst:app.vtranslate("JS_S_FIRST"),sPrevious:app.vtranslate("JS_S_PREVIOUS"),sNext:app.vtranslate("JS_S_NEXT"),sLast:app.vtranslate("JS_S_LAST")},oAria:{sSortAscending:app.vtranslate("JS_S_SORT_ASCENDING"),sSortDescending:app.vtranslate("JS_S_SORT_DESCENDING")}}}),AppConnector.request(a.getRecordsParams(b)).done(function(a){b.find("#recordsListContents").html(a),b.find("#recordsListContents table").dataTable(),c.progressIndicator({mode:"hide"});}).fail(function(){c.progressIndicator({mode:"hide"});});},registerFilterChangeEvent:function c(a){var b=this;a.on("change","#moduleFilter",function(){b.getRecordsList();});},registerSelectBrancheEvent:function b(){var a=this;a.treeInstance.on("changed.jstree",function(){a.getRecordsList();});},registerEvents:function b(){var a=this.getContainer();this.generateTree(a),this.registerFilterChangeEvent(a),this.registerSelectBrancheEvent(a);}});
