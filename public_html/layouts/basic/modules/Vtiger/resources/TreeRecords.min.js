
jQuery.Class("Vtiger_TreeRecords_Js",{},{mainContainer:false,treeInstance:false,treeData:false,getContainer:function(){if(this.mainContainer==false){this.mainContainer=jQuery("#centerPanel")}return this.mainContainer},setContainer:function(a){this.mainContainer=a},getTreeListValues:function(b){if(this.treeData==false&&b!="undefined"){var a=b.find("#treeListValues").val();if(a!=""){this.treeData=JSON.parse(a)}}return this.treeData},generateTree:function(b){var c=this;c.treeInstance=b.find("#treeListContents");var a=["checkbox"];if(app.getMainParams("isActiveCategory")=="1"){a.push("category")}c.treeInstance.jstree({core:{data:c.getTreeListValues(b),themes:{name:"proton",responsive:true}},plugins:a})},getRecordsParams:function(a){var d=this;var c=a.find("#moduleFilter").val();var b=[];$.each(d.treeInstance.jstree("get_selected",true),function(f,g){b.push(g.original.record_id)});var e={module:app.getModuleName(),view:app.getViewName(),branches:b,filter:c};if(app.getMainParams("isActiveCategory")=="1"){e.category=d.treeInstance.jstree("getCategory")}return e},getRecordsList:function(){var c=this;var a=c.getContainer();var b=jQuery.progressIndicator({message:app.vtranslate("JS_LOADING_OF_RECORDS"),blockInfo:{enabled:true}});$.extend($.fn.dataTable.defaults,{language:{sLengthMenu:app.vtranslate("JS_S_LENGTH_MENU"),sZeroRecords:app.vtranslate("JS_NO_RESULTS_FOUND"),sInfo:app.vtranslate("JS_S_INFO"),sInfoEmpty:app.vtranslate("JS_S_INFO_EMPTY"),sSearch:app.vtranslate("JS_SEARCH"),sEmptyTable:app.vtranslate("JS_NO_RESULTS_FOUND"),sInfoFiltered:app.vtranslate("JS_S_INFO_FILTERED"),sLoadingRecords:app.vtranslate("JS_LOADING_OF_RECORDS"),sProcessing:app.vtranslate("JS_LOADING_OF_RECORDS"),oPaginate:{sFirst:app.vtranslate("JS_S_FIRST"),sPrevious:app.vtranslate("JS_S_PREVIOUS"),sNext:app.vtranslate("JS_S_NEXT"),sLast:app.vtranslate("JS_S_LAST")},oAria:{sSortAscending:app.vtranslate("JS_S_SORT_ASCENDING"),sSortDescending:app.vtranslate("JS_S_SORT_DESCENDING")}}});AppConnector.request(c.getRecordsParams(a)).then(function(d){a.find("#recordsListContents").html(d);a.find("#recordsListContents table").dataTable();b.progressIndicator({mode:"hide"})},function(d){b.progressIndicator({mode:"hide"})})},registerFilterChangeEvent:function(a){var b=this;a.on("change","#moduleFilter",function(c){b.getRecordsList()})},registerSelectBrancheEvent:function(a){var b=this;b.treeInstance.on("changed.jstree",function(d,c){b.getRecordsList()})},registerEvents:function(){var a=this.getContainer();this.generateTree(a);this.registerFilterChangeEvent(a);this.registerSelectBrancheEvent(a)}});