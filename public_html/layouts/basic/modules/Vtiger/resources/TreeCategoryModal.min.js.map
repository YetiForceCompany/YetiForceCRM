{"version":3,"file":"TreeCategoryModal.min.js","sources":["TreeCategoryModal.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 4.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\njQuery.Class(\n\t'Vtiger_TreeCategory_Js',\n\t{},\n\t{\n\t\tmodalContainer: false,\n\t\ttreeInstance: false,\n\t\ttreeData: false,\n\t\twindowParent: app.getWindowParent(),\n\t\tgetModalContainer: function () {\n\t\t\tif (this.modalContainer == false) {\n\t\t\t\tthis.modalContainer = jQuery('#modalTreeCategoryModal');\n\t\t\t}\n\t\t\treturn this.modalContainer;\n\t\t},\n\t\tgetRecords: function (container) {\n\t\t\tif (this.treeData == false && container !== 'undefined') {\n\t\t\t\tlet treeValues = container.find('#treePopupValues').val();\n\t\t\t\tthis.treeData = JSON.parse(treeValues);\n\t\t\t}\n\t\t\treturn this.treeData;\n\t\t},\n\t\tgenerateTree: function (container) {\n\t\t\tlet thisInstance = this;\n\t\t\tif (thisInstance.treeInstance == false) {\n\t\t\t\tthisInstance.treeInstance = container.find('#treePopupContents');\n\t\t\t\tlet plugins = ['search', 'category'];\n\t\t\t\tif (thisInstance.getRelationType() == '2') {\n\t\t\t\t\tplugins.push('checkbox');\n\t\t\t\t}\n\t\t\t\tif (thisInstance.getRelationType() == '1') {\n\t\t\t\t\tplugins.push('edit');\n\t\t\t\t}\n\t\t\t\tthisInstance.treeInstance.jstree(\n\t\t\t\t\t$.extend(\n\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcore: {\n\t\t\t\t\t\t\t\tdata: thisInstance.getRecords(),\n\t\t\t\t\t\t\t\tthemes: {\n\t\t\t\t\t\t\t\t\tname: 'proton',\n\t\t\t\t\t\t\t\t\tresponsive: true\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcheckbox: {\n\t\t\t\t\t\t\t\tthree_state: false\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tplugins: plugins\n\t\t\t\t\t\t},\n\t\t\t\t\t\tthisInstance.treeInstance.data('params')\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\tgetRelationType: function () {\n\t\t\treturn this.getModalContainer().find('#relationType').val();\n\t\t},\n\t\tsearching: function (text) {\n\t\t\tthis.treeInstance.jstree(true).search(text);\n\t\t},\n\t\tregisterSearchEvent: function () {\n\t\t\tlet thisInstance = this;\n\t\t\tlet valueSearch = $('#valueSearchTree');\n\t\t\tlet btnSearch = $('#btnSearchTree');\n\t\t\tvalueSearch.on('keypress', function (e) {\n\t\t\t\tif (e.which == 13) {\n\t\t\t\t\tthisInstance.searching(valueSearch.val());\n\t\t\t\t}\n\t\t\t});\n\t\t\tbtnSearch.on('click', function () {\n\t\t\t\tthisInstance.searching(valueSearch.val());\n\t\t\t});\n\t\t},\n\t\tregisterSaveRecords: function (container) {\n\t\t\tconst thisInstance = this;\n\t\t\tlet ord = [],\n\t\t\t\tocd = [];\n\t\t\t$.each(thisInstance.getRecords(), function (index, value) {\n\t\t\t\tif (value.state && value.state.selected && value.attr === 'record') {\n\t\t\t\t\tord.push(value.record_id);\n\t\t\t\t}\n\t\t\t\tif (value.category && value.category.checked && value.attr !== 'record') {\n\t\t\t\t\tocd.push(value.record_id);\n\t\t\t\t}\n\t\t\t});\n\t\t\tcontainer.find('[name=\"saveButton\"]').on('click', function (e) {\n\t\t\t\tlet recordsToAdd = [],\n\t\t\t\t\tcategoryToAdd = [],\n\t\t\t\t\trecordsToRemove = Object.assign([], ord),\n\t\t\t\t\tcategoryToRemove = Object.assign([], ocd);\n\t\t\t\tlet saveButton = $(this);\n\t\t\t\tsaveButton.attr('disabled', 'disabled');\n\t\t\t\tlet cSelected = thisInstance.treeInstance.jstree('getCategory', true);\n\t\t\t\t$.each(cSelected, function (index, treeElement) {\n\t\t\t\t\tlet value = treeElement.record_id;\n\t\t\t\t\tif (treeElement.attr === 'record') {\n\t\t\t\t\t\tif (jQuery.inArray(value, recordsToRemove) == -1) {\n\t\t\t\t\t\t\trecordsToAdd.push(value);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trecordsToRemove.splice(recordsToRemove.indexOf(value), 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (treeElement.attr !== 'record') {\n\t\t\t\t\t\tif (jQuery.inArray(value, categoryToRemove) == -1) {\n\t\t\t\t\t\t\tcategoryToAdd.push(value);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcategoryToRemove.splice(categoryToRemove.indexOf(value), 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tlet params = {\n\t\t\t\t\tmodule: thisInstance.windowParent.app.getModuleName(),\n\t\t\t\t\taction: 'RelationAjax',\n\t\t\t\t\tmode: 'updateRelation',\n\t\t\t\t\trecordsToAdd: recordsToAdd,\n\t\t\t\t\trecordsToRemove: recordsToRemove,\n\t\t\t\t\tcategoryToAdd: categoryToAdd,\n\t\t\t\t\tcategoryToRemove: categoryToRemove,\n\t\t\t\t\tsrc_record: thisInstance.windowParent.app.getRecordId(),\n\t\t\t\t\trelated_module: container.find('#relatedModule').val()\n\t\t\t\t};\n\t\t\t\tif (recordsToAdd.length > 4) {\n\t\t\t\t\tbootbox.dialog({\n\t\t\t\t\t\ttitle: app.vtranslate('JS_INFORMATION'),\n\t\t\t\t\t\tmessage: app.vtranslate('JS_SAVE_SELECTED_ITEMS_ALERT').replace('__LENGTH__', recordsToAdd.length),\n\t\t\t\t\t\tbuttons: {\n\t\t\t\t\t\t\tsuccess: {\n\t\t\t\t\t\t\t\tlabel: app.vtranslate('JS_LBL_SAVE'),\n\t\t\t\t\t\t\t\tclassName: 'btn-success',\n\t\t\t\t\t\t\t\tcallback: function () {\n\t\t\t\t\t\t\t\t\tthisInstance.saveRecordsEvent(params);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tdanger: {\n\t\t\t\t\t\t\t\tlabel: app.vtranslate('JS_LBL_CANCEL'),\n\t\t\t\t\t\t\t\tclassName: 'btn-warning',\n\t\t\t\t\t\t\t\tcallback: function () {\n\t\t\t\t\t\t\t\t\tsaveButton.removeAttr('disabled');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tthisInstance.saveRecordsEvent(params);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tsaveRecordsEvent: function (params) {\n\t\t\tconst self = this;\n\t\t\tAppConnector.request(params).done(function (res) {\n\t\t\t\tself.windowParent.Vtiger_Detail_Js.getInstance().reloadTabContent();\n\t\t\t\tapp.hideModalWindow();\n\t\t\t});\n\t\t},\n\t\tregisterCounterSelected: function () {\n\t\t\tlet thisInstance = this;\n\t\t\tthis.treeInstance.on('changed.jstree', function (e, data) {\n\t\t\t\tlet counterSelected = 0;\n\t\t\t\tlet html = '';\n\t\t\t\t$.each(thisInstance.treeInstance.jstree('get_selected', true), function (index, value) {\n\t\t\t\t\tlet id = value.original.record_id.toString();\n\t\t\t\t\tif (id.indexOf('T')) {\n\t\t\t\t\t\tcounterSelected++;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\thtml = app.vtranslate('JS_SELECTED_ELEMENTS') + ': ' + counterSelected;\n\t\t\t\t$('.counterSelected').text(html);\n\t\t\t});\n\t\t},\n\t\tregisterEvents: function () {\n\t\t\tlet container = this.getModalContainer();\n\t\t\tthis.getRecords(container);\n\t\t\tthis.generateTree(container);\n\t\t\tthis.registerSaveRecords(container);\n\t\t\tthis.registerSearchEvent();\n\t\t\tthis.registerCounterSelected();\n\t\t}\n\t}\n);\njQuery(function () {\n\tlet instance = new Vtiger_TreeCategory_Js();\n\tinstance.registerEvents();\n});\n"],"names":["jQuery","Class","modalContainer","treeInstance","treeData","windowParent","app","getWindowParent","getModalContainer","getRecords","container","treeValues","find","val","JSON","parse","generateTree","thisInstance","plugins","getRelationType","push","jstree","$","extend","core","data","themes","name","responsive","checkbox","three_state","searching","text","search","registerSearchEvent","valueSearch","btnSearch","on","e","which","registerSaveRecords","ord","ocd","each","index","value","state","selected","attr","record_id","category","checked","recordsToAdd","categoryToAdd","recordsToRemove","Object","assign","categoryToRemove","saveButton","cSelected","treeElement","inArray","splice","indexOf","params","module","getModuleName","action","mode","src_record","getRecordId","related_module","length","bootbox","dialog","title","vtranslate","message","replace","buttons","success","label","className","callback","saveRecordsEvent","danger","removeAttr","self","AppConnector","request","done","Vtiger_Detail_Js","getInstance","reloadTabContent","hideModalWindow","registerCounterSelected","counterSelected","html","id","original","toString","registerEvents","instance","Vtiger_TreeCategory_Js"],"mappings":"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"}