{"version":3,"file":"outlookMessageCompose.min.js","sources":["outlookMessageCompose.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\nconst MailIntegration_Compose = {\n\t/**\n\t * AppConnector wrapper\n\t *\n\t * @param   {object}  request\n\t *\n\t * @return  {object}           AppConnector object with done method\n\t */\n\tconnector(request) {\n\t\treturn AppConnector.request(request).fail(error => {\n\t\t\tthis.showResponseMessage(false);\n\t\t});\n\t},\n\t/**\n\t * Show response message\n\t *\n\t * @param   {boolean}  success\n\t * @param   {string}  message\n\t */\n\tshowResponseMessage(success, message = '') {\n\t\tif (success) {\n\t\t\tOffice.context.mailbox.item.notificationMessages.replaceAsync('information', {\n\t\t\t\ttype: 'informationalMessage',\n\t\t\t\tmessage: message,\n\t\t\t\ticon: 'iconid',\n\t\t\t\tpersistent: false\n\t\t\t});\n\t\t} else {\n\t\t\tOffice.context.mailbox.item.notificationMessages.replaceAsync('error', {\n\t\t\t\ttype: 'errorMessage',\n\t\t\t\tmessage: app.vtranslate('JS_ERROR') + ' ' + message\n\t\t\t});\n\t\t}\n\t},\n\t/**\n\t * Registered autocomplete template\n\t *\n\t * @return  {object}  overwrite ui-autocomplete list item template\n\t */\n\tregisterAutocompleteTemplate() {\n\t\t$.widget('ui.autocomplete', $.ui.autocomplete, {\n\t\t\t_renderItem: function(ul, item) {\n\t\t\t\tconst listItemTemplate = user => {\n\t\t\t\t\treturn `\n\t\t\t\t\t\t\t<li class=\"c-search-item js-search-item\">\n\t\t\t\t\t\t\t\t<div class=\"d-flex flex-nowrap\">\n\t\t\t\t\t\t\t\t\t<div class=\"d-flex flex-wrap\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"u-font-size-14px\">\n\t\t\t\t\t\t\t\t\t\t\t${user.name}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class=\"c-search-item__mail small\">\n\t\t\t\t\t\t\t\t\t\t\t${user.mail}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class=\"btn-group flex-nowrap align-items-center\">\n\t\t\t\t\t\t\t\t\t\t<button class=\"c-search-item__btn btn btn-xs btn-outline-primary\" data-copy-target=\"cc\">\n\t\t\t\t\t\t\t\t\t\t\t${app.vtranslate('JS_CC')}\n\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t<button class=\"c-search-item__btn btn btn-xs btn-outline-primary\" data-copy-target=\"bcc\">\n\t\t\t\t\t\t\t\t\t\t\t${app.vtranslate('JS_BCC')}\n\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>`;\n\t\t\t\t};\n\t\t\t\treturn $(listItemTemplate(item)).appendTo(ul);\n\t\t\t}\n\t\t});\n\t},\n\t/**\n\t * Register autocomplete\n\t *\n\t * @return  {object}  autocomplete instance\n\t */\n\tregisterAutocomplete() {\n\t\treturn this.container.find('.js-search-input').autocomplete({\n\t\t\tdelay: '600',\n\t\t\tminLength: '3',\n\t\t\tclasses: {\n\t\t\t\t'ui-autocomplete': 'mobile'\n\t\t\t},\n\t\t\tsource: this.findEmail.bind(this),\n\t\t\tselect: this.onSelectRecipient.bind(this)\n\t\t});\n\t},\n\t/**\n\t * Find mail action for autocomplete source\n\t *\n\t * @param   {object}  request   autocomplete param\n\t * @param   {fuction}  callBack  autocomplete callBack\n\t */\n\tfindEmail(request, callBack) {\n\t\tthis.connector({\n\t\t\tmodule: 'MailIntegration',\n\t\t\taction: 'Mail',\n\t\t\tmode: 'findEmail',\n\t\t\tsearch: request.term\n\t\t}).done(responseData => {\n\t\t\tconst data = responseData.result.map(user => {\n\t\t\t\tlet userData = user.split(' <');\n\t\t\t\tconst name = userData[0];\n\t\t\t\tconst mail = userData[1].slice(0, -1);\n\t\t\t\treturn { name, mail };\n\t\t\t});\n\t\t\tcallBack(data);\n\t\t});\n\t},\n\t/**\n\t * [onRecipientSelect description]\n\t *\n\t * @param   {object}  toElement  html node object\n\t * @param   {object}  item       selected item object\n\t */\n\tonSelectRecipient({ toElement }, { item }) {\n\t\tconst newRecipient = [\n\t\t\t{\n\t\t\t\tdisplayName: item.name,\n\t\t\t\temailAddress: item.mail\n\t\t\t}\n\t\t];\n\t\tconst recipientsField = toElement.dataset.copyTarget ? toElement.dataset.copyTarget : 'to';\n\t\tthis.copyRecipient(recipientsField, newRecipient);\n\t},\n\t/**\n\t * Copy recipient to outlook field\n\t *\n\t * @param   {string}  recipientsField  to, cc, bcc\n\t * @param   {object}  newRecipient\n\t */\n\tcopyRecipient(recipientsField, newRecipient) {\n\t\tOffice.context.mailbox.item[recipientsField].addAsync(newRecipient, function(result) {\n\t\t\tif (result.error) {\n\t\t\t\tOffice.context.mailbox.item.notificationMessages.replaceAsync('error', {\n\t\t\t\t\ttype: 'errorMessage',\n\t\t\t\t\tmessage: app.vtranslate('JS_ERROR') + ' ' + result.error\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\tregisterEvents() {\n\t\tif (!$('.js-exception-error').length) {\n\t\t\tthis.container = $('#page');\n\t\t\tthis.registerAutocompleteTemplate();\n\t\t\tthis.registerAutocomplete();\n\t\t}\n\t}\n};\n(function($) {\n\tOffice.onReady(info => {\n\t\tif (info.host === Office.HostType.Outlook) {\n\t\t\tMailIntegration_Compose.registerEvents();\n\t\t}\n\t});\n})($);\n"],"names":["connector","request","fail","showResponseMessage","success","Office","context","mailbox","item","notificationMessages","replaceAsync","type","message","icon","persistent","app","vtranslate","registerAutocompleteTemplate","$","widget","ui","autocomplete","_renderItem","ul","user","name","mail","appendTo","registerAutocomplete","container","find","delay","minLength","classes","source","findEmail","bind","select","onSelectRecipient","callBack","module","action","mode","search","term","done","responseData","result","map","split","userData","slice","data","toElement","newRecipient","displayName","emailAddress","recipientsField","dataset","copyTarget","copyRecipient","addAsync","error","registerEvents","length","onReady","info","host","HostType","Outlook","MailIntegration_Compose"],"mappings":"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"}