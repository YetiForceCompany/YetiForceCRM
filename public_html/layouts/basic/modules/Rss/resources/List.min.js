'use strict';

Vtiger_List_Js('Rss_List_Js',{},{getDocumentHeight:function getDocumentHeight(){return jQuery(document).height()},registerRssButtonClickEvent:function registerRssButtonClickEvent(container){var thisInstance=this;container.on('click','.rssAddButton',function(){thisInstance.showRssModal('getRssAddForm').done(function(data){app.showModalWindow(data,function callBackFunction(data){var params=app.validationEngineOptions,form=data.find('#rssAddForm');params.onValidationComplete=function(form,valid){return valid&&thisInstance.rssFeedSave(form),!1},form.validationEngine(params);});});}),container.on('click','.changeFeedSource',function(){thisInstance.showRssModal('getRssWidget').done(function(data){app.showModalWindow(data,function callBackFunction(data){data.on('click','.rssLink',function(e){var element=jQuery(e.currentTarget),id=element.data('id');thisInstance.getRssFeeds(id).done(function(){app.hideModalWindow();});});});});});},breadCrumbsFilter:function breadCrumbsFilter(){},showRssModal:function showRssModal(mode){var aDeferred=jQuery.Deferred(),progressInstance=jQuery.progressIndicator({}),actionParams={module:app.getModuleName(),view:'ViewTypes',mode:mode};return AppConnector.request(actionParams).done(function(data){progressInstance.progressIndicator({mode:'hide'}),aDeferred.resolve(data);},function(){}),aDeferred.promise()},rssFeedSave:function rssFeedSave(form){var thisInstance=this,data=form.serializeFormData(),progressIndicatorElement=jQuery.progressIndicator({position:'html',blockInfo:{enabled:!0}}),params={module:app.getModuleName(),action:'Save',feedurl:data.feedurl};AppConnector.request(params).done(function(result){if(progressIndicatorElement.progressIndicator({mode:'hide'}),result.result.success)app.hideModalWindow(),thisInstance.getRssFeeds(result.result.id);else{var params={title:app.vtranslate('JS_MESSAGE'),text:app.vtranslate(result.result.message)};Vtiger_Helper_Js.showPnotify(params);}});},getRssFeeds:function getRssFeeds(id){var thisInstance=this,aDeferred=jQuery.Deferred(),container=thisInstance.getListViewContainer(),progressIndicatorElement=jQuery.progressIndicator({position:'html',blockInfo:{enabled:!0}}),params={module:app.getModuleName(),view:'List',id:id};return AppConnector.requestPjax(params).done(function(data){aDeferred.resolve(data),container.find('#listViewContents').html(data),thisInstance.setFeedContainerHeight(container),progressIndicatorElement.progressIndicator({mode:'hide'});}),aDeferred.promise()},setFeedContainerHeight:function setFeedContainerHeight(container){var height=this.getDocumentHeight()/1.5;container.find('.feedListContainer').height(height);},registerFeedClickEvent:function registerFeedClickEvent(container){var thisInstance=this;container.on('click','.feedLink',function(e){var element=jQuery(e.currentTarget),url=element.data('url'),frameElement=thisInstance.getFrameElement(url);container.find('.feedFrame').html(frameElement);});},getFrameElement:function getFrameElement(url){var progressIndicatorElement=jQuery.progressIndicator({position:'html',blockInfo:{enabled:!0}}),frameElement=jQuery('<iframe>',{id:'feedFrame',scrolling:'auto',width:'100%',height:this.getDocumentHeight()/2});return frameElement.addClass('table-bordered'),this.getHtml(url).done(function(html){progressIndicatorElement.progressIndicator({mode:'hide'});var frame=frameElement[0].contentDocument;frame.open(),frame.write(html),frame.close();}),frameElement},getHtml:function getHtml(url){var aDeferred=jQuery.Deferred(),params={module:app.getModuleName(),action:'GetHtml',url:url};return AppConnector.request(params).done(function(data){aDeferred.resolve(data.result.html);}),aDeferred.promise()},registerDeleteRecordClickEvent:function registerDeleteRecordClickEvent(){var container=this.getListViewContainer(),thisInstance=this;container.on('click','#deleteButton',function(){thisInstance.deleteRecord(container);});},deleteRecord:function deleteRecord(container){var thisInstance=this,recordId=container.find('#recordId').val(),message=app.vtranslate('LBL_DELETE_CONFIRMATION');Vtiger_Helper_Js.showConfirmationBox({message:message}).done(function(){var module=app.getModuleName(),deleteMessage=app.vtranslate('JS_RECORD_GETTING_DELETED'),progressIndicatorElement=jQuery.progressIndicator({message:deleteMessage,position:'html',blockInfo:{enabled:!0}});AppConnector.request({module:module,action:'DeleteAjax',record:recordId}).done(function(data){if(progressIndicatorElement.progressIndicator({mode:'hide'}),data.success)thisInstance.getRssFeeds();else{var params={text:app.vtranslate(data.error.message),title:app.vtranslate('JS_LBL_PERMISSION')};Vtiger_Helper_Js.showPnotify(params);}},function(){});},function(){});},registerMakeDefaultClickEvent:function registerMakeDefaultClickEvent(container){var thisInstance=this;container.on('click','#makeDefaultButton',function(){thisInstance.makeDefault(container);});},makeDefault:function makeDefault(container){var recordId=container.find('#recordId').val(),module=app.getModuleName(),progressIndicatorElement=jQuery.progressIndicator({position:'html',blockInfo:{enabled:!0}});AppConnector.request({module:module,action:'MakeDefaultAjax',record:recordId}).done(function(data){if(progressIndicatorElement.progressIndicator({mode:'hide'}),data.success){var params={title:app.vtranslate('JS_MESSAGE'),text:app.vtranslate(data.result.message),type:'info'};Vtiger_Helper_Js.showPnotify(params);}else Vtiger_Helper_Js.showPnotify({text:app.vtranslate(data.error.message),title:app.vtranslate('JS_LBL_PERMISSION')});});},registerEvents:function registerEvents(){this._super();var container=this.getListViewContainer();this.registerRssButtonClickEvent(container),this.registerFeedClickEvent(container),this.registerMakeDefaultClickEvent(container),this.setFeedContainerHeight(container),this.registerDeleteRecordClickEvent();}});
//# sourceMappingURL=List.min.js.map
