{"version":3,"file":"QuickCreate.min.js","sources":["QuickCreate.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\n/**\n *  Class representing a modal calendar.\n * @extends Vtiger_Calendar_Js\n */\nwindow.OSSTimeControl_CalendarModal_Js = class OSSTimeControl_CalendarModal_Js extends Vtiger_Calendar_Js {\n\tconstructor(container, readonly) {\n\t\tsuper(container, readonly);\n\t\tthis.isSwitchAllDays = false;\n\t\tthis.sidebarName = 'add'; //available: add, status, edit\n\t\tthis.eventCreate = false;\n\t\tthis.module = container.find('[name=\"module\"]').val();\n\t\tthis.renderCalendar();\n\t\tthis.registerEvents();\n\t}\n\n\taddCommonMethodsToYearView() {}\n\t/**\n\t * Function sets calendar module's options\n\t */\n\tsetCalendarModuleOptions() {\n\t\tlet options = super.setCalendarModuleOptions();\n\t\toptions.selectable = true;\n\t\toptions.hiddenDays = app.getMainParams('hiddenDays', true);\n\t\toptions.header = {\n\t\t\tleft: 'month,' + app.getMainParams('weekView') + ',' + app.getMainParams('dayView'),\n\t\t\tcenter: 'prevYear,prev,title,next,nextYear',\n\t\t\tright: 'today'\n\t\t};\n\t\toptions.eventClick = function (calEvent, jsEvent) {\n\t\t\tjsEvent.preventDefault();\n\t\t};\n\t\treturn options;\n\t}\n\n\t/**\n\t * Function registers calendar events\n\t */\n\tregisterEvents() {\n\t\tthis.registerSwitchEvents();\n\t\tthis.registerUsersChange();\n\t}\n\n\t/**\n\t * Function registers calendar switch event\n\t */\n\tregisterSwitchEvents() {\n\t\tif (app.getMainParams('hiddenDays', true) !== false) {\n\t\t\tlet calendarView = this.getCalendarView(),\n\t\t\t\tswitchContainer = $(`<div class=\"js-calendar-switch-container\"></div>`).insertAfter(\n\t\t\t\t\tcalendarView.find('.fc-center')\n\t\t\t\t);\n\t\t\t$(this.switchTpl(app.vtranslate('JS_WORK_DAYS'), app.vtranslate('JS_ALL'), this.isSwitchAllDays))\n\t\t\t\t.prependTo(switchContainer)\n\t\t\t\t.on('change', 'input', (e) => {\n\t\t\t\t\tconst currentTarget = $(e.currentTarget);\n\t\t\t\t\tlet hiddenDays = [];\n\t\t\t\t\tif (typeof currentTarget.data('on-text') !== 'undefined') {\n\t\t\t\t\t\thiddenDays = app.getMainParams('hiddenDays', true);\n\t\t\t\t\t\tthis.isSwitchAllDays = false;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.isSwitchAllDays = true;\n\t\t\t\t\t}\n\t\t\t\t\tthis.getCalendarView().fullCalendar('option', 'hiddenDays', hiddenDays);\n\t\t\t\t\tif (this.getCalendarView().fullCalendar('getView').type === 'year') {\n\t\t\t\t\t\tthis.registerViewRenderEvents(this.getCalendarView().fullCalendar('getView'));\n\t\t\t\t\t}\n\t\t\t\t\tthis.registerSwitchEvents();\n\t\t\t\t});\n\t\t}\n\t}\n\tswitchTpl(on, off, state) {\n\t\treturn `<div class=\"btn-group btn-group-toggle js-switch c-calendar-switch\" data-toggle=\"buttons\">\n\t\t\t\t\t<label class=\"btn btn-outline-primary c-calendar-switch__button js-switch--label-on ${state ? '' : 'active'}\">\n\t\t\t\t\t\t<input type=\"radio\" name=\"options\" data-on-text=\"${on}\" autocomplete=\"off\" ${state ? '' : 'checked'}>\n\t\t\t\t\t\t${on}\n\t\t\t\t\t</label>\n\t\t\t\t\t<label class=\"btn btn-outline-primary c-calendar-switch__button ${state ? 'active' : ''}\">\n\t\t\t\t\t\t<input type=\"radio\" name=\"options\" data-off-text=\"${off}\" autocomplete=\"off\" ${state ? 'checked' : ''}>\n\t\t\t\t\t\t${off}\n\t\t\t\t\t</label>\n\t\t\t\t</div>`;\n\t}\n\t/**\n\t * Function registers select's user change event\n\t */\n\tregisterUsersChange() {\n\t\tthis.container.find('.assigned_user_id').on('change', () => {\n\t\t\tthis.getCalendarView().fullCalendar('getCalendar').view.options.loadView();\n\t\t});\n\t}\n\n\t/**\n\t * Function return user's id\n\t * @returns {int}\n\t */\n\tgetSelectedUsersCalendar() {\n\t\treturn this.container.find('.assigned_user_id').val();\n\t}\n\n\t/**\n\t * Function invokes by fullcalendar, sets selected days in form\n\t * @param startDate\n\t * @param endDate\n\t */\n\tselectDays(startDate, endDate) {\n\t\tif (this.sidebarName === 'status') {\n\t\t\tthis.sidebarName = 'add';\n\t\t\tthis.getCalendarCreateView().done(() => {\n\t\t\t\tthis.selectDays(startDate, endDate);\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\t\tlet startHour = app.getMainParams('startHour'),\n\t\t\tendHour = app.getMainParams('endHour'),\n\t\t\tview = this.getCalendarView().fullCalendar('getView');\n\t\tif (endDate.hasTime() == false) {\n\t\t\tendDate.add(-1, 'days');\n\t\t}\n\t\tstartDate = startDate.format();\n\t\tendDate = endDate.format();\n\t\tif (startHour == '') {\n\t\t\tstartHour = '00';\n\t\t}\n\t\tif (endHour == '') {\n\t\t\tendHour = '00';\n\t\t}\n\t\tif (view.name != 'agendaDay' && view.name != 'agendaWeek') {\n\t\t\tstartDate = startDate + 'T' + startHour + ':00';\n\t\t\tendDate = endDate + 'T' + endHour + ':00';\n\t\t}\n\t\tlet dateFormat = this.container.find('[name=\"date_start\"]').data('dateFormat').toUpperCase(),\n\t\t\ttimeFormat = this.container.find('[name=\"time_start\"]').data('format'),\n\t\t\tdefaultTimeFormat = '';\n\t\tif (timeFormat == 24) {\n\t\t\tdefaultTimeFormat = 'HH:mm';\n\t\t} else {\n\t\t\tdefaultTimeFormat = 'hh:mm A';\n\t\t}\n\t\tthis.container.find('[name=\"date_start\"]').val(moment(startDate).format(dateFormat));\n\t\tthis.container.find('[name=\"due_date\"]').val(moment(endDate).format(dateFormat));\n\t\tif (this.container.find('.js-autofill').prop('checked') === true) {\n\t\t\tlet calendarEditInstance = new Calendar_Edit_Js();\n\t\t\tcalendarEditInstance.getFreeTime(this.container);\n\t\t} else {\n\t\t\tthis.container.find('[name=\"time_start\"]').val(moment(startDate).format(defaultTimeFormat));\n\t\t\tthis.container.find('[name=\"time_end\"]').val(moment(endDate).format(defaultTimeFormat));\n\t\t}\n\t}\n};\n\n$.Class(\n\t'OSSTimeControl_QuickCreate_Js',\n\t{},\n\t{\n\t\tcontainer: false,\n\t\tmodule: false,\n\t\tcalendar: false,\n\t\tgetContainer() {\n\t\t\treturn this.container;\n\t\t},\n\t\tsetContainer(container) {\n\t\t\tthis.container = container;\n\t\t},\n\t\tsetModule() {\n\t\t\tthis.module = this.getContainer().find('[name=\"module\"]').val();\n\t\t},\n\t\tinitCalendar() {\n\t\t\tlet className = this.module + '_CalendarModal_Js';\n\t\t\tthis.calendar = new window[className](this.getContainer().closest('.js-modal-container'), true);\n\t\t},\n\t\tregisterEvents: function (container) {\n\t\t\tthis.setContainer(container);\n\t\t\tthis.setModule();\n\t\t\tthis.initCalendar();\n\t\t}\n\t}\n);\n"],"names":["window","OSSTimeControl_CalendarModal_Js","container","readonly","isSwitchAllDays","sidebarName","eventCreate","module","find","val","renderCalendar","registerEvents","selectable","options","hiddenDays","app","getMainParams","header","left","center","right","eventClick","calEvent","jsEvent","preventDefault","registerSwitchEvents","registerUsersChange","getCalendarView","switchContainer","$","insertAfter","calendarView","switchTpl","vtranslate","prependTo","on","e","currentTarget","data","fullCalendar","type","registerViewRenderEvents","off","state","view","loadView","startDate","endDate","getCalendarCreateView","done","selectDays","endHour","hasTime","add","format","startHour","name","toUpperCase","timeFormat","defaultTimeFormat","moment","dateFormat","prop","calendarEditInstance","getFreeTime","Vtiger_Calendar_Js","Class","calendar","getContainer","setContainer","setModule","initCalendar","className","closest"],"mappings":"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"}