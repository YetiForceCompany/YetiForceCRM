{"version":3,"file":"Edit.min.js","sources":["Edit.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\nVtiger_Edit_Js(\"OSSTimeControl_Edit_Js\", {}, {\n\n\tregisterGenerateTCFieldTimeAndCost: function () {\n\t\tvar thisInstance = this;\n\t\t$('input[name=\"sum_time\"]').attr('readonly', 'readonly').css('width', '80px');\n\t\tvar form = thisInstance.getForm();\n\t\tvar sumeTime = thisInstance.differenceDays(form);\n\t\tvar hours = (Math.ceil((sumeTime / 3600000) * 100) / 100).toFixed(2);\n\n\t\tjQuery('input[name=\"sum_time\"]').val(hours);\n\t\tjQuery('.dateField').on('change', function () {\n\t\t\tsumeTime = thisInstance.differenceDays(form);\n\t\t\tif (sumeTime == 'Error') {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\thours = (Math.ceil((sumeTime / 3600000) * 100) / 100).toFixed(2);\n\t\t\tjQuery('input[name=\"sum_time\"]').val(hours);\n\t\t});\n\t\tjQuery('.clockPicker').on('change', function () {\n\t\t\tsumeTime = thisInstance.differenceDays(form);\n\t\t\tif (sumeTime == 'Error') {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\thours = (Math.round((sumeTime / 3600000) * 100) / 100).toFixed(2);\n\t\t\tjQuery('input[name=\"sum_time\"]').val(hours);\n\t\t});\n\n\t},\n\n\tdifferenceDays: function (container) {\n\t\tvar firstDate = container.find('input[name=\"date_start\"]');\n\t\tvar firstDateFormat = firstDate.data('date-format');\n\t\tvar firstDateValue = firstDate.val();\n\t\tvar secondDate = container.find('input[name=\"due_date\"]');\n\t\tvar secondDateFormat = secondDate.data('date-format');\n\t\tvar secondDateValue = secondDate.val();\n\t\tvar firstTime = container.find('input[name=\"time_start\"]');\n\t\tvar secondTime = container.find('input[name=\"time_end\"]');\n\t\tvar firstTimeValue = firstTime.val();\n\t\tvar secondTimeValue = secondTime.val();\n\t\tvar firstDateTimeValue = firstDateValue + ' ' + firstTimeValue;\n\t\tvar secondDateTimeValue = secondDateValue + ' ' + secondTimeValue;\n\t\ttry {\n\t\t\tvar firstDateInstance = Vtiger_Helper_Js.getDateInstance(firstDateTimeValue, firstDateFormat);\n\t\t\tvar secondDateInstance = Vtiger_Helper_Js.getDateInstance(secondDateTimeValue, secondDateFormat);\n\t\t\tvar timeBetweenDates = secondDateInstance - firstDateInstance;\n\t\t\tif (timeBetweenDates >= 0) {\n\t\t\t\treturn timeBetweenDates;\n\t\t\t}\n\t\t} catch (err){\n\t\t\treturn 'Error';\n\t\t}\n\t\treturn 'Error';\n\t},\n\n\t/**\n\t * Function to register recordpresave event\n\t */\n\tregisterRecordPreSaveEvent: function (container) {\n\t\tvar thisInstance = this;\n\t\tvar form = $('.recordEditView[name=\"QuickCreate\"]');\n\t\tif (form.length == 0) {\n\t\t\tform = this.getForm();\n\t\t}\n\t\tform.on(Vtiger_Edit_Js.recordPreSave, function (e, data) {\n\t\t\tvar sumeTime2 = thisInstance.differenceDays(form);\n\t\t\tif (sumeTime2 == 'Error') {\n\t\t\t\tvar parametres = {\n\t\t\t\t\ttext: app.vtranslate('JS_DATE_SHOULD_BE_GREATER_THAN'),\n\t\t\t\t\ttype: 'error'\n\t\t\t\t};\n\t\t\t\tVtiger_Helper_Js.showPnotify(parametres);\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\tif (app.getMainParams('disallowLongerThan24Hours')) {\n\t\t\t\t\tsumeTime2 = sumeTime2 / 1000 / 60 / 60;\n\t\t\t\t\tif (sumeTime2 > 24) {\n\t\t\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\t\t\ttext: app.vtranslate('JS_DATE_NOT_SHOULD_BE_GREATER_THAN_24H'),\n\t\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tform.submit();\n\t\t\t}\n\t\t});\n\t},\n\tregisterGenerateTCFromHelpDesk: function () {\n\t\tvar thisInstance = this;\n\t\tvar sourceDesk = jQuery('input[name=\"sourceRecord\"]').val();\n\t\tvar moduleName = jQuery('input[name=\"sourceModule\"]').val();\n\t\tif (typeof sourceDesk !== \"undefined\") {\n\n\t\t\tvar params = {};\n\t\t\tparams.data = {module: 'OSSTimeControl', action: 'GetTCInfo', id: sourceDesk, sourceModule: moduleName};\n\t\t\tparams.async = false;\n\t\t\tparams.dataType = 'json';\n\t\t\tAppConnector.request(params).done(function (data) {\n\t\t\t\t\tvar response = data['result'];\n\t\t\t\t\tif (response['success']) {\n\t\t\t\t\t\tvar sourceD = response.sourceData;\n\n\t\t\t\t\t\tif (moduleName == 'HelpDesk') {\n\t\t\t\t\t\t\tif ('contact_id' in sourceD) {\n\t\t\t\t\t\t\t\tjQuery('[name=\"contactid\"]').val(sourceD.contact_id);\n\t\t\t\t\t\t\t\tjQuery('[name=\"contactid_display\"]').val(thisInstance.replaceAll(sourceD.contact_label, '&oacute;', 'ó')).prop('readonly', true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif ('parent_id' in sourceD) {\n\t\t\t\t\t\t\t\tjQuery('[name=\"accountid\"]').val(sourceD.parent_id);\n\t\t\t\t\t\t\t\tjQuery('[name=\"accountid_display\"]').val(thisInstance.replaceAll(sourceD.account_label, '&oacute;', 'ó')).prop('readonly', true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (moduleName == 'Project') {\n\t\t\t\t\t\t\tif ('contact_label' in sourceD) {\n\t\t\t\t\t\t\t\tjQuery('[name=\"contactid\"]').val(sourceD.contact_id);\n\t\t\t\t\t\t\t\tjQuery('[name=\"contactid_display\"]').val(thisInstance.replaceAll(sourceD.contact_label, '&oacute;', 'ó')).prop('readonly', true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif ('account_label' in sourceD) {\n\t\t\t\t\t\t\t\tjQuery('[name=\"accountid\"]').val(sourceD.linktoaccountscontacts);\n\t\t\t\t\t\t\t\tjQuery('[name=\"accountid_display\"]').val(thisInstance.replaceAll(sourceD.account_label, '&oacute;', 'ó')).prop('readonly', true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar params = {\n\t\t\t\t\t\t\ttext: app.vtranslate('message'),\n\t\t\t\t\t\t\ttype: 'error',\n\t\t\t\t\t\t};\n\t\t\t\t\t\tVtiger_Helper_Js.showPnotify(params);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t).fail(function () {\n\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\ttext: app.vtranslate('JS_ERROR_CONNECTING'),\n\t\t\t\t\ttype: 'error'\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t},\n\n\tescapeRegExp: function (string) {\n\t\treturn string.replace(/([.*+?^=!:${}()|\\[\\]\\/\\\\])/g, \"\\\\$1\");\n\t},\n\n\treplaceAll: function (string, find, replace) {\n\t\tvar thisInstance = this;\n\t\tstring = string.replace(new RegExp(thisInstance.escapeRegExp('&Oacute;'), 'g'), 'Ó');\n\t\treturn string.replace(new RegExp(thisInstance.escapeRegExp(find), 'g'), replace);\n\t},\n\tregisterBasicEvents: function (container) {\n\t\tthis._super(container);\n\t\tthis.registerRecordPreSaveEvent(container);\n\t},\n\tregisterEvents: function () {\n\t\tthis._super();\n\t\tthis.registerGenerateTCFieldTimeAndCost();\n\t\tthis.registerGenerateTCFromHelpDesk();\n\t}\n});\n"],"names":["Vtiger_Edit_Js","registerGenerateTCFieldTimeAndCost","Math","ceil","thisInstance","$","attr","css","getForm","sumeTime","differenceDays","form","hours","toFixed","jQuery","val","on","round","container","find","firstDateFormat","firstDate","data","firstDateValue","secondDate","secondDateFormat","secondDateValue","firstTime","secondTime","firstTimeValue","secondTimeValue","Vtiger_Helper_Js","getDateInstance","secondDateInstance","timeBetweenDates","firstDateInstance","err","registerRecordPreSaveEvent","length","recordPreSave","text","app","vtranslate","type","showPnotify","parametres","getMainParams","sumeTime2","submit","registerGenerateTCFromHelpDesk","sourceDesk","moduleName","params","module","action","id","sourceModule","async","dataType","AppConnector","request","done","response","sourceData","sourceD","contact_id","replaceAll","contact_label","prop","parent_id","account_label","linktoaccountscontacts","fail","escapeRegExp","string","replace","registerBasicEvents","_super","registerEvents"],"mappings":"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"}