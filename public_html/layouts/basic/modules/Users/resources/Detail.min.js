
Vtiger_Detail_Js("Users_Detail_Js",{triggerChangePassword:function(a,b){AppConnector.request(a).then(function(c){if(c){var d=function(e){var f=app.validationEngineOptions;f.onValidationComplete=function(h,g){if(g){Users_Detail_Js.savePassword(h)}return false};jQuery("#changePassword").validationEngine(app.validationEngineOptions)};app.showModalWindow(c,function(e){if(typeof d=="function"){d(e)}})}})},savePassword:function(d){var f=d.find('[name="new_password"]');var c=d.find('[name="confirm_password"]');var a=d.find('[name="old_password"]');var b=d.find('[name="userid"]').val();if(f.val()==c.val()){var e={module:app.getModuleName(),action:"SaveAjax",mode:"savePassword",old_password:a.val(),new_password:f.val(),userid:b};AppConnector.request(e).then(function(g){if(g.success){app.hideModalWindow();Vtiger_Helper_Js.showPnotify({text:app.vtranslate(g.result.message),type:"success"})}else{Vtiger_Helper_Js.showPnotify(g.error.message);return false}})}else{f.validationEngine("showPrompt",app.vtranslate("JS_REENTER_PASSWORDS"),"error","topLeft",true);return false}},triggerDeleteUser:function(b){var a=app.vtranslate("LBL_DELETE_USER_CONFIRMATION");Vtiger_Helper_Js.showConfirmationBox({message:a}).then(function(c){AppConnector.request(b).then(function(d){if(d){var e=function(f){var g=app.validationEngineOptions;g.onValidationComplete=function(i,h){if(h){Users_Detail_Js.deleteUser(i)}return false};jQuery("#deleteUser").validationEngine(app.validationEngineOptions)};app.showModalWindow(d,function(f){if(typeof e=="function"){e(f)}})}})},function(c,d){})},deleteUser:function(c){var a=c.find('[name="userid"]').val();var b=c.find('[name="tranfer_owner_id"]').val();var d={module:app.getModuleName(),action:"DeleteAjax",mode:"deleteUser",transfer_user_id:b,userid:a,permanent:c.find('[name="deleteUserPermanent"]:checked').val()};AppConnector.request(d).then(function(f){if(f.success){app.hideModalWindow();Vtiger_Helper_Js.showPnotify(app.vtranslate(f.result.message));var e=f.result.listViewUrl;window.location.href=e}})},triggerTransferOwner:function(b){var a=app.vtranslate("LBL_TRANSFEROWNER_CONFIRMATION");Vtiger_Helper_Js.showConfirmationBox({message:a}).then(function(c){AppConnector.request(b).then(function(d){if(d){var e=function(f){var g=app.validationEngineOptions;g.onValidationComplete=function(i,h){if(h){Users_Detail_Js.transferOwner(i)}return false};jQuery("#transferOwner").validationEngine(app.validationEngineOptions)};app.showModalWindow(d,function(f){if(typeof e=="function"){e(f)}})}})},function(c,d){})},transferOwner:function(c){var a=c.find('[name="userid"]').val();var b=c.find('[name="tranfer_owner_id"]').val();var d={module:app.getModuleName(),action:"SaveAjax",mode:"transferOwner",transfer_user_id:b,userid:a};AppConnector.request(d).then(function(f){if(f.success){app.hideModalWindow();Vtiger_Helper_Js.showPnotify(app.vtranslate(f.result.message));var e=f.result.listViewUrl;window.location.href=e}})},triggerChangeAccessKey:function(a){var c=app.vtranslate("JS_NEW_ACCESS_KEY_REQUESTED");var b=app.vtranslate("JS_CHANGE_ACCESS_KEY_CONFIRMATION");Vtiger_Helper_Js.showConfirmationBox({title:c,message:b}).then(function(d){AppConnector.request(a).then(function(f){var g={};if(f.success){f=f.result;g.type="success";b=app.vtranslate(f.message);var e=jQuery("#Users_detailView_fieldValue_accesskey");if(e.length){e.find(".value").html(f.accessKey)}}else{b=app.vtranslate(f.error["message"])}g.text=b;Vtiger_Helper_Js.showPnotify(g)})})},},{usersEditInstance:false,updateStartHourElement:function(a){this.usersEditInstance.triggerHourFormatChangeEvent(a);this.updateStartHourElementValue()},hourFormatUpdateEvent:function(){var a=this;this.getForm().on(this.fieldUpdatedEvent,'[name="hour_format"]',function(b,c){a.updateStartHourElementValue()})},updateStartHourElementValue:function(){var c=this.getForm();var b=jQuery('select[name="start_hour"]',c);var a=b.find("option:selected").text();b.closest("td").find("span.value").text(a)},startHourUpdateEvent:function(b){var a=this;b.on(this.fieldUpdatedEvent,'[name="start_hour"]',function(c,d){a.updateStartHourElement(b)})},saveFieldValues:function(b){var a=jQuery.Deferred();var e=this;var d=false;var c=this.getRecordId();var f={};if(typeof b!="undefined"){f=b;if(f.field=="email1"){e.usersEditInstance.checkEmail(f.value).then(function(h){},function(i,h){d=true;a.reject()})}}if(d!==true){f.record=c;f.module=app.getModuleName();f.action="SaveAjax";var g={};g.data=f;g.async=false;g.dataType="json";AppConnector.request(g).then(function(h){a.resolve(h)})}return a.promise()},registerEvents:function(){this._super();var a=this.getForm();this.usersEditInstance=Vtiger_Edit_Js.getInstance();this.updateStartHourElement(a);this.hourFormatUpdateEvent();this.startHourUpdateEvent(a);Users_Edit_Js.registerChangeEventForCurrencySeparator()}});