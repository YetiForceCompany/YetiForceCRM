'use strict';

Vtiger_List_Js('Settings_Users_List_Js',{deleteRecord:function c(a){var b=app.vtranslate('LBL_DELETE_USER_CONFIRMATION');Vtiger_Helper_Js.showConfirmationBox({message:b}).done(function(){AppConnector.request(a).done(function(a){if(a){var b=function(){var a=app.validationEngineOptions;a.onValidationComplete=function(a,b){return b&&Settings_Users_List_Js.deleteUser(a),!1},jQuery('#deleteUser').validationEngine(app.validationEngineOptions);};app.showModalWindow(a,function(a){'function'==typeof b&&b(a);});}});}).fail(function(a,b){console.error(a,b);});},deleteUser:function g(a){var b=Vtiger_List_Js.getInstance(),c=a.find('[name="userid"]').val(),d=a.find('[name="tranfer_owner_id"]').val(),e=jQuery.progressIndicator({position:'html',blockInfo:{enabled:!0}}),f={module:app.getModuleName(),action:'DeleteAjax',transfer_user_id:d,userid:c,permanent:jQuery('[name="deleteUserPermanent"]:checked',a).val()};AppConnector.request(f).done(function(a){if(a.success){app.hideModalWindow(),e.progressIndicator({mode:'hide'});var c=jQuery('#orderBy').val(),d=jQuery('#sortOrder').val(),g={viewname:a.result.viewname,orderby:c,sortorder:d};jQuery('#recordsCount').val(''),jQuery('#totalPageCount').text(''),b.getListViewRecords(g).done(function(){b.updatePagination();}),f={title:app.vtranslate('JS_MESSAGE'),text:a.result.message,type:'success'},Vtiger_Helper_Js.showPnotify(f);}});},deleteUserPermanently:function e(a,b){b.stopPropagation();var c=app.vtranslate('LBL_DELETE_USER_PERMANENT_CONFIRMATION'),d='index.php?module='+app.getModuleName()+'&parent='+app.getParentModuleName()+'&view=DeleteUser&mode=permanent&record='+a;Vtiger_Helper_Js.showConfirmationBox({message:c}).done(function(){AppConnector.request(d).done(function(b){if(b){var c=function(){var b=app.validationEngineOptions;b.onValidationComplete=function(b,c){if(c){var d=jQuery.progressIndicator({position:'html',blockInfo:{enabled:!0}}),e={module:app.getModuleName(),action:'DeleteAjax',userid:a,transfer_user_id:b.find('[name="tranfer_owner_id"]').val(),mode:'permanent'};app.hideModalWindow(),AppConnector.request(e).done(function(b){b.success&&(d.progressIndicator({mode:'hide'}),e={title:app.vtranslate('JS_MESSAGE'),text:b.result.message,type:'error'},Vtiger_Helper_Js.showPnotify(e),jQuery('[data-id='+a+']').hide());});}return !1},jQuery('#deleteUser').validationEngine(app.validationEngineOptions);};app.showModalWindow(b,function(a){'function'==typeof c&&c(a);});}});});},restoreUser:function c(a,b){b.stopPropagation(),Vtiger_Helper_Js.showConfirmationBox({message:app.vtranslate('LBL_RESTORE_CONFIRMATION')}).done(function(){var b=jQuery.progressIndicator({position:'html',blockInfo:{enabled:!0}}),c={module:app.getModuleName(),action:'SaveAjax',userid:a,mode:'restoreUser'};AppConnector.request(c).done(function(a){if(a.success){b.progressIndicator({mode:'hide'}),Vtiger_Helper_Js.showPnotify(a.result.message);var c=a.result.listViewUrl;window.location.href=c;}});});},triggerExportAction:function d(){var a=window.location.href,b=a.split('?'),c=jQuery('<form>',{method:'post',action:b[0]+'?module=Users&source_module=Users&action=ExportData'}).append(jQuery('<input>',{name:csrfMagicName,value:csrfMagicToken,type:'hidden'}));jQuery(c).appendTo('body')[0].submit();}},{getPageJumpParams:function d(){var a=app.getModuleName(),b=this.getCurrentCvId(),c={module:a,view:'ListAjax',mode:'getPageCount',search_params:jQuery('#usersFilter').val()};return c},registerDeleteRecordClickEvent:function b(){var a=this.getListViewContentContainer();a.on('click','.deleteRecordButton',function(a){var b=jQuery(a.currentTarget),c=b.closest('tr'),d=jQuery('[name="deleteActionUrl"]',c).val();Settings_Users_List_Js.deleteRecord(d),a.stopPropagation();});},usersFilter:function b(){var a=this;jQuery('#usersFilter').on('change',function(){var b=jQuery.progressIndicator({position:'html',blockInfo:{enabled:!0}}),c={module:app.getModuleName(),view:'List',parent:app.getParentModuleName(),search_params:jQuery('#usersFilter').val()};AppConnector.request(c).done(function(c){b.progressIndicator({mode:'hide'}),jQuery('#listViewContents').html(c),a.updatePaginationFilter();var d=a.getListSearchInstance();!1!==d&&d.registerEvents(),App.Fields.Picklist.showSelect2ElementView(jQuery('#listViewContents').find('select.select2'));});});},updatePaginationFilter:function c(){var a=this,b={};b.page=1,b.module=app.getModuleName(),b.parent=app.getParentModuleName(),b.view='Pagination',b.mode='getPagination',b.search_params=jQuery('#usersFilter').val(),AppConnector.request(b).done(function(b){jQuery('.paginationDiv').html(b),a.registerPageNavigationEvents();});},updatePagination:function d(a){a='undefined'==typeof a?1:a;var b=this,c={};c.module=app.getModuleName(),c.parent=app.getParentModuleName(),c.view='Pagination',c.page=a,c.mode='getPagination',c.search_key=this.getAlphabetSearchField(),c.search_value=this.getAlphabetSearchValue(),c.operator='s',c.search_params=JSON.stringify(this.getListSearchInstance().getListSearchParams()),c.noOfEntries=jQuery('#noOfEntries').val(),AppConnector.request(c).done(function(a){jQuery('.paginationDiv').html(a),b.registerPageNavigationEvents();});},registerEvents:function a(){this._super(),this.usersFilter(),this.registerDeleteRecordClickEvent();}});
