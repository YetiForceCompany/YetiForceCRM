'use strict';

Vtiger_Edit_Js("OSSPasswords_Edit_Js",{},{registerRecordPreSaveEvent:function c(a){var b=this;"undefined"==typeof a&&(a=this.getForm()),a.on(Vtiger_Edit_Js.recordPreSave,function(c){var d=a.find("[name=\"password\"]").val(),e=a.find("[name=\"record\"]").val(),f={};"**********"===d&&(f={},f.data={module:"OSSPasswords",action:"GetPass",record:e},f.async=!1,AppConnector.request(f).done(function(a){var b=a.result;if(b.success){var c=document.getElementById("OSSPasswords_editView_fieldName_password");c.value=b.password,c.onchange();}}),passwordStrength("","")),d=a.find("[name=\"password\"]").val(),f={},f.data={module:"OSSPasswords",action:"CheckPass",password:d,id:e},f.async=!1,f.dataType="json",("undefined"==typeof b.passwordError||b.passwordError)&&c.preventDefault(),AppConnector.request(f).done(function(c){if(!1===c.result.success){var d={text:c.result.message,sticker:!1,sticker_hover:!1,type:"error"};Vtiger_Helper_Js.showPnotify(d),b.sending=!1,b.passwordError=!0;}else!0!==c.result.success||"undefined"!=typeof b.sending&&b.sending||(b.sending=!0,b.passwordError=!1,a.submit());});});},generatePassword:function n(a){var b=jQuery(a.currentTarget),c=b.closest("form"),d=parseInt(jQuery("#minChars").val()),e=parseInt(jQuery("#maxChars").val()),f=jQuery("#allowedLetters").val(),g="";"undefined"==typeof f&&(f="!");var h=f.split(",");"undefined"==typeof d&&(d=10),"undefined"==typeof e&&(e=15);var j=parseInt(Math.random()*(e-d)+d),k=0;for(k=0;k<=j;k++){var l=parseInt(Math.random()*h.length);g+=h[l];}var m=c.find("[name =\"password\"]");m.val(g),m.trigger("change");},registerButtonsEvents:function b(){var a=this;$(".js-generatePass").on("click",function(b){a.generatePassword(b);});},registerBasicEvents:function b(a){this._super(a),this.registerButtonsEvents(),this.registerRecordPreSaveEvent(a);}});
