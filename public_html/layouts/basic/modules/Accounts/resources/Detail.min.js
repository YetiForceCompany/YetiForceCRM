'use strict';

Vtiger_Detail_Js('Accounts_Detail_Js',{},{//It stores the Account Hierarchy response data
accountHierarchyResponseCache:{},/*
		 * function to get the AccountHierarchy response data
		 */getAccountHierarchyResponseData:function getAccountHierarchyResponseData(params){var thisInstance=this,aDeferred=jQuery.Deferred();//Check in the cache
return jQuery.isEmptyObject(thisInstance.accountHierarchyResponseCache)?AppConnector.request(params).done(function(data){thisInstance.accountHierarchyResponseCache=data,aDeferred.resolve(thisInstance.accountHierarchyResponseCache);}):aDeferred.resolve(thisInstance.accountHierarchyResponseCache),aDeferred.promise()},registerButtons:function registerButtons(container){container.find('.toChangeBtn').on('click',function(e){var currentTarget=$(e.currentTarget),fieldname=currentTarget.data('fieldname'),params={value:currentTarget.hasClass('btn-success')?0:1,field:fieldname,record:currentTarget.data('recordId'),module:app.getModuleName(),action:'SaveAjax'};AppConnector.request(params).done(function(data){currentTarget.hasClass('btn-warning')?(currentTarget.removeClass('btn-warning'),currentTarget.addClass('btn-success')):(currentTarget.addClass('btn-warning'),currentTarget.removeClass('btn-success')),currentTarget.html(data.result[fieldname].display_value);var params={title:app.vtranslate('JS_LBL_PERMISSION'),text:app.vtranslate('JS_SAVE_NOTIFY_OK'),type:'success'};Vtiger_Helper_Js.showMessage(params);});});},/*
		 * function to display the AccountHierarchy response data
		 */displayAccountHierarchyResponseData:function displayAccountHierarchyResponseData(data){var thisInstance=this,callbackFunction=function(){app.showScrollBar($('#hierarchyScroll'),{height:'300px',railVisible:!0,size:'6px'});};app.showModalWindow(data,function(modalContainer){App.Components.Scrollbar.xy($('#hierarchyScroll',modalContainer)),'function'==typeof callbackFunction&&300<$('#hierarchyScroll',modalContainer).height()&&callbackFunction(),thisInstance.registerButtons(modalContainer);});},registerHierarchyRecordCount:function registerHierarchyRecordCount(){var hierarchyButton=$('.detailViewTitle .hierarchy');if(hierarchyButton.length){var params={module:app.getModuleName(),action:'RelationAjax',record:app.getRecordId(),mode:'getHierarchyCount'};AppConnector.request(params).done(function(response){response.success&&$('.detailViewTitle .hierarchy .badge').html(response.result);});}},registerShowHierarchy:function registerShowHierarchy(){var thisInstance=this,hierarchyButton=$('.detailViewTitle'),url='index.php?module=Accounts&view=AccountHierarchy&record='+app.getRecordId();hierarchyButton.on('click','.js-detail__icon, .recordLabelValue',function(){thisInstance.getAccountHierarchyResponseData(url).done(function(data){thisInstance.displayAccountHierarchyResponseData(data);});});},registerEvents:function registerEvents(){this._super(),this.registerHierarchyRecordCount(),this.registerShowHierarchy();}});
//# sourceMappingURL=Detail.min.js.map
