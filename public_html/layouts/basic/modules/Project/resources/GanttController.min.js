'use strict';

$.Class('Project_Gantt_Js',{},{filterSelectElement:!1,getFilterSelectElement:function a(){return !1==this.filterSelectElement&&(this.filterSelectElement=jQuery('#customFilter')),this.filterSelectElement},getDefaultParams:function b(){var a={module:app.getModuleName(),action:'GanttData'};return app.getParentModuleName()&&(a.parent=app.getParentModuleName()),a},getCurrentCvId:function a(){return jQuery('#customFilter').find('option:selected').data('id')},getGanttData:function e(a){var b=$.Deferred();'undefined'==typeof a&&(a={});var c=$.progressIndicator({position:'html',blockInfo:{enabled:!0}}),d=this.getDefaultParams();return a=$.extend(d,a),AppConnector.request(a).done(function(a){c.progressIndicator({mode:'hide'}),b.resolve(a),app.notifyPostAjaxReady();}).fail(function(a,c){b.reject(a,c);}),b.promise()},loadGantt:function e(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:'.js-gantt__container',b=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];a=$(a);var c=a.parent(),d=a.html();if(a.remove(),a=$(c).append(d),!b){var f=c.find('#ganttData').val();b=JSON.parse(f,!0);}this.gantt=new Gantt(a,b);},reloadData:function b(a){this.gantt.reloadData(a);},registerChangeCustomFilterEvent:function b(){var a=this;this.getFilterSelectElement().on('change',function(b){$('.nav-item[data-cvid=\''+a.getCurrentCvId()+'\'] .nav-link').tab('show');var c=jQuery(b.currentTarget),d=c.find(':selected');app.setMainParams('pageNumber','1'),app.setMainParams('pageToJump','1'),app.setMainParams('orderBy',d.data('orderby')),app.setMainParams('sortOrder',d.data('sortorder')),a.getGanttData({viewname:jQuery(this).val()}).done(function(b){a.reloadData(b.result);}),b.stopPropagation();});},getSelectOptionFromChosenOption:function e(a){var b=a.attr('id'),c=b.split('-'),d='';if(0<c.length)d=c[c.length-1];else return !1;return jQuery('#filterOptionId_'+d)},changeCustomFilterElementView:function d(){var a=this,b=this.getFilterSelectElement();if(0<b.length&&b.is('select')){App.Fields.Picklist.showSelect2ElementView(b,{templateSelection:function c(a){var b=jQuery('<span></span>');return b.append(jQuery(jQuery('.filterImage').clone().get(0)).show()),b.append(a.text),b},customSortOptGroup:!0,closeOnSelect:!0});var c=b.data('select2');jQuery('.filterActionsDiv').appendTo(c.$dropdown.find('.select2-dropdown:last')).removeClass('d-none').on('click',function(b){a.registerCreateFilterClickEvent(b);});}},registerEvents:function a(){this.changeCustomFilterElementView(),this.registerChangeCustomFilterEvent(),Vtiger_Helper_Js.showHorizontalTopScrollBar(),this.loadGantt();}});
