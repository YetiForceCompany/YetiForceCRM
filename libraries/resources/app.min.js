
var app={languageString:[],weekDaysArray:{Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6},cacheParams:[],getModuleName:function(){return jQuery("#module").val()},getParentModuleName:function(){return jQuery("#parent").val()},getViewName:function(){return jQuery("#view").val()},getRecordId:function(){var a=jQuery('[name="view"]').val();var b;if(a=="Edit"){b=jQuery('[name="record"]').val()}else{if(a=="Detail"){b=jQuery("#recordId").val()}}return b},getContentsContainer:function(){return jQuery(".bodyContents")},changeSelectElementView:function(e,b,a){var f=this;var d=jQuery();if(typeof e=="undefined"){e=jQuery("body")}if(b=="select2"){return app.showSelect2ElementView(e,a)}if(b=="selectize"){return app.showSelectizeElementView(e,a)}d=jQuery(".chzn-select",e);if(e.is("select.chzn-select")){d=e}d.each(function(){if($(this).prop("id").length==0){$(this).attr("id","sel"+f.generateRandomChar()+f.generateRandomChar()+f.generateRandomChar())}});d.filter("[multiple]").filter('[data-validation-engine*="validate"]').on("change",function(i){jQuery(i.currentTarget).trigger("focusout")});var h={no_results_text:app.vtranslate("JS_NO_RESULTS_FOUND")+":"};var c=app.getModuleName();if(d.filter("[multiple]")&&c!="Install"){h.placeholder_text_multiple=" "+app.vtranslate("JS_SELECT_SOME_OPTIONS")}if(c!="Install"){h.placeholder_text_single=" "+app.vtranslate("JS_SELECT_AN_OPTION")}d.chosen(h);d.each(function(){var i=$(this);if(i.attr("readonly")=="readonly"){i.on("chosen:updated",function(){if(i.attr("readonly")){var j=i.is(":disabled");i.attr("disabled","disabled");i.data("chosen").search_field_disabled();if(j){i.attr("disabled","disabled")}else{i.removeAttr("disabled")}}});i.trigger("chosen:updated")}});var g=jQuery(".chosen-container-multi .default").css("width","100%");return g},destroyChosenElement:function(b){var a=jQuery();if(typeof b=="undefined"){b=jQuery("body")}a=jQuery(".chzn-select",b);if(b.is("select.chzn-select")){a=b}a.css("display","block").removeClass("chzn-done").data("chosen",null).next().remove();return a},showSelect2ElementView:function(c,f){if(typeof f=="undefined"){f={}}var d=c.data();if(d!=null){f=jQuery.extend(d,f)}f.language={};f.theme="bootstrap";f.width="100%";f.language.noResults=function(g){return app.vtranslate("JS_NO_RESULTS_FOUND")};if(typeof f.customSortOptGroup!="undefined"&&f.customSortOptGroup){jQuery("optgroup",c).each(function(){var h=jQuery(this);var g=h.children().toArray().sort(function(k,j){var l=jQuery(k).text();var i=jQuery(j).text();return l<i?1:-1});jQuery.each(g,function(k,j){h.prepend(j)})});delete f.customSortOptGroup}if(typeof f.maximumSelectionLength!="undefined"&&typeof f.formatSelectionTooBig=="undefined"){var a=f.maximumSelectionLength;var e=function(g){return app.vtranslate("JS_YOU_CAN_SELECT_ONLY")+" "+g.maximum+" "+app.vtranslate("JS_ITEMS")};f.language.maximumSelected=e}if(c.attr("multiple")!="undefined"&&!f.placeholder){f.tags="true";f.placeholder=app.vtranslate("JS_SELECT_SOME_OPTIONS")}else{if(!f.placeholder){f.placeholder=app.vtranslate("JS_SELECT_AN_OPTION")}}var b=c;b.select2(f).on("select2:open",function(i){if(b.data("unselecting")){b.removeData("unselecting");setTimeout(function(j){b.each(function(){jQuery(this).select2("close")})},1)}var h=jQuery(i.currentTarget);var g=h.data("select2");g.$dropdown.css("z-index",1000002)}).on("select2:unselect",function(g){b.data("unselecting",true)});return c},showSelectizeElementView:function(a,b){if(typeof b=="undefined"){b={plugins:["remove_button"]}}a.selectize(b);return a},showPopoverElementView:function(a,c){if(typeof c=="undefined"){c={trigger:"hover",placement:"bottom",html:true}}if(a.data("placement")){c.placement=a.data("placement")}if(a.hasClass("delay0")){c.delay={show:0,hide:0}}var b=a.data();if(b!=null){c=jQuery.extend(b,c)}a.popover(c);return a},registerChangeEventForMultiSelect:function(c,d){if(typeof c=="undefined"){return}var a=c.data("select2");var b=d.maximumSelectionLength;c.on("change",function(g){var f=a.data();if(jQuery.isArray(f)&&f.length>=b){a.updateResults()}})},getSerializedData:function(h,j){if(typeof j=="undefined"){j="string"}h=jQuery(h);var i=h.children().serialize();if(j=="string"){return i}var g={};var b=i.split("&");for(var e in b){var f=b[e];var a=f.split("=");var d=a[0];var c=a[1];g[d]=decodeURIComponent(c)}return g},showModalWindow:function(g,d,a,f){if(typeof g=="object"&&g!=null&&!(g instanceof jQuery)){f=g.css;a=g.cb;d=g.url;g=g.data}if(typeof d=="function"){if(typeof a=="object"){f=a}a=d;d=false}else{if(typeof d=="object"){a=function(){};f=d;d=false}}if(typeof a!="function"){a=function(){}}var h="globalmodal";var b=jQuery("#"+h);if(b.length){b.remove()}var c=jQuery(".modal-backdrop");if(c.length){c.remove()}b=jQuery("<div></div>");b.attr("id",h);var e=function(i){var j={show:true,};if(jQuery("#backgroundClosingModal").val()!=1){j.backdrop="static"}if(typeof f=="object"){b.css(f);j=jQuery.extend(j,f)}b.html(i);$.fn.modal.Constructor.prototype.enforceFocus=function(k){$(document).off("focusin.bs.modal").on("focusin.bs.modal",$.proxy(function(l){if($(l.target).hasClass("select2-search__field")){return true}if(this.$element[0]!==l.target&&!this.$element.has(l.target).length){this.$element.trigger("focus")}},this))};b.find(".modal:first").modal(j);jQuery("body").append(b);app.changeSelectElementView(b);app.showSelect2ElementView(b.find("select.select2"));app.showSelectizeElementView(b.find("select.selectize"));app.registerEventForDatePickerFields(b);a(b)};if(g){e(g)}else{jQuery.get(d).then(function(i){e(i)})}return b},hideModalWindow:function(d){var c="globalmodal";var b=jQuery("#"+c);if(b.length<=0){return}if(typeof d!="function"){d=function(){}}var a=b.find(".modal");a.modal("hide");a.one("hidden.bs.modal",d)},isHidden:function(a){if(a.css("display")=="none"){return true}return false},isInvisible:function(a){if(a.css("visibility")=="hidden"){return true}return false},validationEngineOptions:{scroll:false,promptPosition:"topLeft",prettySelect:true,useSuffix:"_chosen",usePrefix:"s2id_",},validationEngineOptionsForRecord:{scroll:false,promptPosition:"topLeft",prettySelect:true,useSuffix:"_chosen",usePrefix:"s2id_",validateNonVisibleFields:true,onBeforePromptType:function(a){var b=a.closest(".blockContainer");if(b.find("tbody").is(":hidden")){b.find(".blockHeader").click()}},},formAlignmentAfterValidation:function(d){var c=d.find(".formError:not('.greenPopup'):first");if(c.length>0){var a=c.offset().top;var b=a-105;jQuery("html").animate({scrollTop:b},"slow")}},convertToDatePickerFormat:function(a){switch(a){case"yyyy-mm-dd":return"Y-m-d";break;case"mm-dd-yyyy":return"m-d-Y";break;case"dd-mm-yyyy":return"d-m-Y";break;case"yyyy.mm.dd":return"Y.m.d";break;case"mm.dd.yyyy":return"m.d.Y";break;case"dd.mm.yyyy":return"d.m.Y";break;case"yyyy/mm/dd":return"Y/m/d";break;case"mm/dd/yyyy":return"m/d/Y";break;case"dd/mm/yyyy":return"d/m/Y";break}},convertTojQueryDatePickerFormat:function(b){var e=0;var g="-";if(b.indexOf("-")!=-1){g="-"}if(b.indexOf(".")!=-1){g="."}if(b.indexOf("/")!=-1){g="/"}var f=b.split(g);for(var e in f){var d=f[e];var a=d.length;if(a==4){var c=d.substring(0,2);f[e]=c}}var h=f.join(g);return h},getDateInVtigerFormat:function(a,c){var d=app.convertTojQueryDatePickerFormat(a);var b=jQuery.datepicker.formatDate(d,c);return b},getDateInDBInsertFormat:function(a,g){var b=0;var k="-";if(a.indexOf("-")!=-1){k="-"}if(a.indexOf(".")!=-1){k="."}if(a.indexOf("/")!=-1){k="/"}var j=a.split(k);var h=g.split(k);var f="";var d="";var e="";for(b in j){var c=j[b];switch(c){case"dd":f=h[b];break;case"mm":d=h[b];break;case"yyyy":e=h[b];break}}return e+"-"+d+"-"+f},registerEventForTextAreaFields:function(a){if(typeof a=="undefined"){a=jQuery("body")}a=jQuery(a);if(a.is("textarea")){var b=a}else{var b=jQuery("textarea",a)}if(b.length==0){return}b.autosize()},registerEventForDatePickerFields:function(l,c,d){if(typeof l=="undefined"){l=jQuery("body")}if(typeof c=="undefined"){c=true}l=jQuery(l);if(l.hasClass("dateField")){var j=l}else{var j=jQuery(".dateField",l)}if(j.length==0){return}if(c==true){var f=j.closest(".date");jQuery(".input-group-addon",f).on("click",function(n){var m=jQuery(n.currentTarget);m.closest(".date").find("input.dateField").get(0).focus()})}var a=j.data("dateFormat");var e=app.convertToDatePickerFormat(a);var i=jQuery("body").data("language");var b=i.split("_");var h=jQuery("#start_day").val();if(h==""||typeof(h)=="undefined"){var k=1}else{k=this.weekDaysArray[h]}var g={format:e,calendars:1,locale:$.fn.datepicker.dates[b[0]],starts:k,eventName:"focus",onChange:function(p){var m=jQuery(this).data("datepicker").el;m=jQuery(m);var n=jQuery("#"+jQuery(this).data("datepicker").id);var o=n.find("table.datepickerViewDays");if(o.length>0&&m.val()!=p){m.DatePickerHide();m.blur()}m.val(p).trigger("change").focusout()},onBeforeShow:function(m){j.each(function(n,o){var p=jQuery(o);if(p[0]!=document.activeElement){p.DatePickerHide();p.blur()}})},};if(typeof d!="undefined"){var g=jQuery.extend(g,d)}j.each(function(n,p){var q=jQuery(p);var m=new Date();var o=app.getDateInVtigerFormat(a,m);if(q.val()!=""){o=q.val()}g.date=o;g.current=o;q.DatePicker(g)})},registerEventForDateFields:function(a){if(typeof a=="undefined"){a=jQuery("body")}a=jQuery(a);if(a.hasClass("dateField")){var b=a}else{var b=jQuery(".dateField",a)}b.datepicker({autoclose:true}).on("changeDate",function(f){var e=jQuery(f.currentTarget);var c=e.data("dateFormat");var g=app.getDateInVtigerFormat(c,f.date);var d=jQuery.datepicker.formatDate(g,f.date);e.val(d)})},registerEventForTimeFields:function(b,a,f){if(typeof cotainer=="undefined"){b=jQuery("body")}if(typeof a=="undefined"){a=true}b=jQuery(b);if(b.hasClass("timepicker-default")){var c=b}else{var c=b.find(".timepicker-default")}if(a==true){var d=c.closest(".time");jQuery(".input-group-addon",d).on("click",function(i){var h=jQuery(i.currentTarget);h.closest(".time").find(".timepicker-default").focus()})}if(typeof f=="undefined"){f={}}var g=c.data("format");if(g=="24"){g="H:i"}else{g="h:i A"}var e={timeFormat:g,className:"timePicker"};var f=jQuery.extend(e,f);c.timepicker(f);return b},destroyTimeFields:function(a){if(typeof cotainer=="undefined"){a=jQuery("body")}if(a.hasClass("timepicker-default")){var b=a}else{var b=a.find(".timepicker-default")}b.data("timepicker-list",null);return a},getChosenElementFromSelect:function(a){var b=a.attr("id");var c=b+"_chosen";return jQuery("#"+c)},getSelect2ElementFromSelect:function(a){var b=a.attr("id");var c="select2-"+b+"-container";return jQuery("#"+c).closest(".select2-container")},getSelectElementFromChosen:function(c){var b=c.attr("id");var a=b.split("_chosen");var d=a["0"];return jQuery("#"+d)},setInheritWidth:function(a){jQuery(a).each(function(b,c){var d=jQuery(c).parent().width();jQuery(c).width(d)})},initGuiders:function(a){},showScrollBar:function(b,a){if(typeof a=="undefined"){a={}}if(typeof a.height=="undefined"){a.height=b.css("height")}return b.slimScroll(a)},showHorizontalScrollBar:function(b,a){if(typeof a=="undefined"){a={}}var c={horizontalScroll:true,theme:"dark-thick",advanced:{autoExpandHorizontalScroll:true}};if(typeof a!="undefined"){var c=jQuery.extend(c,a)}return b.mCustomScrollbar(c)},vtranslate:function(b){if(app.languageString[b]!=undefined){return app.languageString[b]}else{var a=jQuery("#js_strings").text();if(a!=""){app.languageString=JSON.parse(a);if(b in app.languageString){return app.languageString[b]}}}return b},vimage_path:function(a){return jQuery("body").data("skinpath")+"/images/"+a},cacheNSKey:function(a){return"vtiger6."+a},cacheGet:function(b,a){b=this.cacheNSKey(b);return jQuery.jStorage.get(b,a)},cacheSet:function(a,b){a=this.cacheNSKey(a);jQuery.jStorage.set(a,b)},cacheClear:function(a){a=this.cacheNSKey(a);return jQuery.jStorage.deleteKey(a)},htmlEncode:function(a){if(a){return jQuery("<div />").text(a).html()}else{return""}},htmlDecode:function(a){if(a){return $("<div />").html(a).text()}else{return""}},placeAtCenter:function(a){a.css("position","absolute");a.css("top",((jQuery(window).height()-a.outerHeight())/2)+jQuery(window).scrollTop()+"px");a.css("left",((jQuery(window).width()-a.outerWidth())/2)+jQuery(window).scrollLeft()+"px")},getvalidationEngineOptions:function(a){return app.validationEngineOptions},notifyPostAjaxReady:function(){jQuery(document).trigger("postajaxready")},listenPostAjaxReady:function(a){jQuery(document).on("postajaxready",a)},setFormValues:function(b){for(var a in b){jQuery(a).val(b[a])}},setRTEValues:function(c){for(var a in c){var b=CKEDITOR.instances[a];if(b){b.setData(c[a])}}},getPageController:function(){var c=app.getModuleName();var a=app.getViewName();var e=app.getParentModuleName();var d=e+"_"+c+"_"+a+"_Js";if(typeof window[d]=="undefined"){d=e+"_Vtiger_"+a+"_Js"}if(typeof window[d]=="undefined"){d=c+"_"+a+"_Js"}var b=jQuery("#extendModules").val();if(typeof window[d]=="undefined"&&b!=undefined){d=b+"_"+a+"_Js"}if(typeof window[d]=="undefined"){d="Vtiger_"+a+"_Js"}if(typeof window[d]!="undefined"){return new window[d]()}},getDecodedValue:function(a){return jQuery("<div></div>").html(a).text()},getColorContrast:function(f){var d=parseInt(f.substr(0,2),16);var c=parseInt(f.substr(2,2),16);var a=parseInt(f.substr(4,2),16);var e=((d*299)+(c*587)+(a*114))/1000;return(e>=128)?"light":"dark"},updateRowHeight:function(){var c=jQuery("#row_type").val();if(c.length<=0){var b=app.cacheGet("widthType","mediumWidthType");var e=b;switch(e){case"narrowWidthType":e="narrow";break;case"wideWidthType":e="wide";break;default:e="medium"}var a=jQuery("#current_user_id").val();var d={module:"Users",action:"SaveAjax",record:a,value:e,field:"rowheight"};AppConnector.request(d).then(function(){jQuery(c).val(e)})}},getCookie:function(b){var c=document.cookie;var d=c.indexOf(" "+b+"=");if(d==-1){d=c.indexOf(b+"=")}if(d==-1){c=null}else{d=c.indexOf("=",d)+1;var a=c.indexOf(";",d);if(a==-1){a=c.length}c=unescape(c.substring(d,a))}return c},setCookie:function(a,d,b){var e=new Date();e.setDate(e.getDate()+b);var c=escape(d)+((b==null)?"":"; expires="+e.toUTCString());document.cookie=a+"="+c},getUrlVar:function(b){var a=function(){var d={};var c=window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(e,f,g){d[f]=g});return d};return a()[b]},getStringDate:function(b){var c=b.getDate();var a=b.getMonth()+1;var e=b.getFullYear();c=(c<=9)?("0"+c):c;a=(a<=9)?("0"+a):a;return e+"-"+a+"-"+c},formatDate:function(b){var j=b.getFullYear(),a=b.getMonth()+1,g=b.getDate(),f=b.getHours(),c=b.getMinutes(),e=b.getSeconds();return j+"-"+this.formatDateZ(a)+"-"+this.formatDateZ(g)+" "+this.formatDateZ(f)+":"+this.formatDateZ(c)+":"+this.formatDateZ(e)},formatDateZ:function(a){return(a<=9?"0"+a:a)},howManyDaysFromDate:function(c){var d=c.getTime();var a=new Date();var b=new Date(a.getFullYear(),a.getMonth(),a.getDate()).getTime();return Math.floor(((b-d)/(1000*60*60*24)))+1},saveAjax:function(d,c){var a=jQuery.Deferred();var b={};b.module=app.getModuleName();b.parent=app.getParentModuleName();b.action="SaveAjax";b.mode=d;b.param=c;AppConnector.request(b).then(function(e){a.resolve(e)},function(e){a.reject()});return a.promise()},showBtnSwitch:function(a,b){if(typeof b=="undefined"){b={}}a.bootstrapSwitch(b);return a},generateRandomChar:function(){var c,b,a;c="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZ";a=Math.floor(Math.random()*c.length);return b=c.substring(a,a+1)},getMainParams:function(b){if(app.cacheParams[b]!=undefined){return app.cacheParams[b]}var a=$("#"+b).val();app.cacheParams[b]=a;return a},parseNumberToShow:function(b){if(b==undefined){b=0}var c=parseInt(app.getMainParams("numberOfCurrencyDecimal"));var a=app.getMainParams("currencyDecimalSeparator");b=parseFloat(b).toFixed(c);if(a!="."){b=b.toString().replace(".",a)}return b},parseNumberToFloat:function(b){var c=parseInt(app.getMainParams("numberOfCurrencyDecimal"));var a=app.getMainParams("currencyGroupingSeparator");if(b==undefined){b=0}b=b.toString();if(app.getMainParams("currencyDecimalSeparator")==","){b=b.replace(/\s/g,"").replace(",",".")}b=b.split(a).join("");return parseFloat(b)},errorLog:function(a,b,c){if(typeof a=="object"){a=a.responseText}console.error(a)},registerModal:function(a){if(typeof a=="undefined"){a=jQuery("body")}a.find("button.showModal, a.showModal").on("click",function(d){d.preventDefault();var c=jQuery(d.currentTarget);var b=c.data("url");if(typeof b!="undefined"){if(typeof c.data("cb")!="undefined"){var f={url:b,cb:c.data("cb"),};app.showModalWindow(f)}else{app.showModalWindow(null,b)}}d.stopPropagation()})},initFooTable:function(){var a=$(".tableRWD");a.find("thead tr th:gt(1)").attr("data-hide","phone");a.find("thead tr th:gt(3)").attr("data-hide","tablet,phone");a.find("thead tr th:last").attr("data-hide","");var c=a.find("thead").attr("col-visible-alltime");a.find("thead tr th:eq("+c+")").attr("data-hide","");$(".tableRWD, .customTableRWD").footable({breakpoints:{phone:768,tablet:1024},addRowToggle:true,toggleSelector:" > tbody > tr:not(.footable-row-detail)",});$(".footable-toggle").click(function(d){d.stopPropagation();$(this).trigger("footable_toggle_row")});var b=$(".customTableRWD").find("[data-toggle-visible=false]");b.find(".footable-toggle").css("display","none")}};jQuery(document).ready(function(){app.changeSelectElementView();app.showSelect2ElementView(jQuery("body").find("select.select2"));app.showSelectizeElementView(jQuery("body").find("select.selectize"));app.showPopoverElementView(jQuery("body").find(".popoverTooltip"));app.showBtnSwitch(jQuery("body").find(".switchBtn"));app.registerModal();app.updateRowHeight();String.prototype.toCamelCase=function(){var b=this.valueOf();return b.charAt(0).toUpperCase()+b.slice(1).toLowerCase()};if(/MSIE/.test(navigator.userAgent)||(/Trident/).test(navigator.userAgent)){jQuery("textarea").resizable()}var a=app.getPageController();if(a){a.registerEvents()}});