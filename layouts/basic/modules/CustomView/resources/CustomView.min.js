
var Vtiger_CustomView_Js={contentsCotainer:false,columnListSelect2Element:false,advanceFilterInstance:false,columnSelectElement:false,selectedColumnsList:false,loadFilterView:function(a){var b=jQuery.progressIndicator();AppConnector.request(a).then(function(d){app.hideModalWindow();var c=jQuery(".contentsDiv").html(d);b.progressIndicator({mode:"hide"});Vtiger_CustomView_Js.registerEvents();Vtiger_CustomView_Js.advanceFilterInstance=Vtiger_AdvanceFilter_Js.getInstance(jQuery(".filterContainer",c))},function(c,d){})},loadDateFilterValues:function(){var c=jQuery("#standardDateFilter option:selected");var a=c.data("currentdate");var b=c.data("enddate");jQuery("#standardFilterCurrentDate").val(a);jQuery("#standardFilterEndDate").val(b)},getContentsContainer:function(){if(Vtiger_CustomView_Js.contentsCotainer==false){Vtiger_CustomView_Js.contentsCotainer=jQuery("div.contentsDiv")}return Vtiger_CustomView_Js.contentsCotainer},getColumnListSelect2Element:function(){return Vtiger_CustomView_Js.columnListSelect2Element},getColumnSelectElement:function(){if(Vtiger_CustomView_Js.columnSelectElement==false){Vtiger_CustomView_Js.columnSelectElement=jQuery("#viewColumnsSelect")}return Vtiger_CustomView_Js.columnSelectElement},getSelectedColumnsList:function(){if(Vtiger_CustomView_Js.selectedColumnsList==false){Vtiger_CustomView_Js.selectedColumnsList=jQuery("#selectedColumnsList")}return Vtiger_CustomView_Js.selectedColumnsList},getSelectedColumns:function(){var a=Vtiger_CustomView_Js.getColumnSelectElement();return a.val()},saveFilter:function(){var a=jQuery.Deferred();var c=jQuery("#CustomView");var d=c.serializeFormData();var b=$.progressIndicator({message:app.vtranslate("JS_SAVE_LOADER_INFO"),blockInfo:{enabled:true}});AppConnector.request(d).then(function(e){a.resolve(e)},function(e){a.reject(e)});return a.promise()},saveAndViewFilter:function(){Vtiger_CustomView_Js.saveFilter().then(function(a){if(a.success){var b;if(app.getParentModuleName()=="Settings"){b="index.php?module=CustomView&parent=Settings&view=Index"}else{b=a.result["listviewurl"]}window.location.href=b}else{$.unblockUI();var c={title:app.vtranslate("JS_DUPLICATE_RECORD"),text:a.error.message};Vtiger_Helper_Js.showPnotify(c)}},function(a){})},registerSelect2ElementForColumnsSelection:function(){var a=Vtiger_CustomView_Js.getColumnSelectElement();return app.changeSelectElementView(a,"selectize",{plugins:["drag_drop","remove_button"],maxItems:12})},registerIconEvents:function(){var a=this.getContentsContainer();a.on("change",".iconPreferences input",function(d){var c=$(d.currentTarget);var f=c.closest(".btn");var b=c.next();if(c.prop("checked")){f.removeClass("btn-default").addClass("btn-primary");b.removeClass(b.data("unchecked")).addClass(b.data("check"))}else{f.removeClass("btn-primary").addClass("btn-default");b.removeClass(b.data("check")).addClass(b.data("unchecked"))}});a.find(".iconPreferences input").each(function(b){jQuery(this).trigger("change")})},registerCkEditorElement:function(){var a=this.getContentsContainer();a.find(".ckEditorSource").each(function(c){var b=new Vtiger_CkEditor_Js();b.loadCkEditor(jQuery(this))})},registerBlockToggleEvent:function(){var a=this.getContentsContainer();a.on("click",".blockHeader",function(d){var c=jQuery(d.currentTarget);var b=c.next();var f=c.find(".iconToggle");if(b.hasClass("hide")){b.removeClass("hide");f.removeClass(f.data("hide")).addClass(f.data("show"))}else{b.addClass("hide");f.removeClass(f.data("show")).addClass(f.data("hide"))}})},registerColorEvent:function(){var a=this.getContentsContainer();var d=a.find(".colorPicker");var b=d.val();var c=d.parent().find(".input-group-addon");d.ColorPicker({onChange:function(e,g,f){b="#"+g;d.val(b);c.css("background-color",b)},onBeforeShow:function(){$(this).ColorPickerSetColor(this.value)}})},registerEvents:function(){this.registerIconEvents();this.registerCkEditorElement();this.registerBlockToggleEvent();this.registerColorEvent();var c=Vtiger_CustomView_Js.columnListSelect2Element=Vtiger_CustomView_Js.registerSelect2ElementForColumnsSelection();var a=Vtiger_CustomView_Js.getContentsContainer();jQuery(".stndrdFilterDateSelect").datepicker();jQuery(".chzn-select").chosen();var b=c[0].selectize;var e=JSON.parse(jQuery('input[name="columnslist"]').val());b.clear();for(var d in e){b.addItem(e[d])}jQuery("#standardDateFilter").change(function(){Vtiger_CustomView_Js.loadDateFilterValues()});jQuery("#CustomView").submit(function(l){var k=Vtiger_CustomView_Js.getColumnSelectElement();if(jQuery("#viewname").val().length>40){var h={title:app.vtranslate("JS_MESSAGE"),text:app.vtranslate("JS_VIEWNAME_ALERT")};Vtiger_Helper_Js.showPnotify(h);l.preventDefault();return}var n=JSON.parse(jQuery("#mandatoryFieldsList").val());var g=k.val();var m=true;if(g){for(var j=0;j<g.length;j++){if(jQuery.inArray(g[j],n)>=0){m=false;break}}}if(m){var q=app.vtranslate("JS_PLEASE_SELECT_ATLEAST_ONE_MANDATORY_FIELD");c.validationEngine("showPrompt",q,"error","topLeft",true);l.preventDefault();return}else{c.validationEngine("hide")}var p=jQuery(l.currentTarget).validationEngine("validate");if(p==true){var o={};if((jQuery("#standardFilterCurrentDate").val()!="")&&(jQuery("#standardFilterEndDate").val()!="")&&(jQuery("select.standardFilterColumn option:selected").val()!="none")){o.columnname=jQuery("select.standardFilterColumn option:selected").val();o.stdfilter=jQuery("select#standardDateFilter option:selected").val();o.startdate=jQuery("#standardFilterCurrentDate").val();o.enddate=jQuery("#standardFilterEndDate").val();jQuery("#stdfilterlist").val(JSON.stringify(o))}var f=Vtiger_CustomView_Js.advanceFilterInstance.getValues();jQuery("#advfilterlist").val(JSON.stringify(f));jQuery('input[name="columnslist"]',a).val(JSON.stringify(Vtiger_CustomView_Js.getSelectedColumns()));Vtiger_CustomView_Js.saveAndViewFilter();return false}else{app.formAlignmentAfterValidation(jQuery(l.currentTarget))}});jQuery("#CustomView").validationEngine(app.validationEngineOptions)}};