
Vtiger_Detail_Js("IStorages_Detail_Js",{},{hierarchyResponseCache:{},getHierarchyResponseData:function(c){var b=this;var a=jQuery.Deferred();if(!(jQuery.isEmptyObject(b.hierarchyResponseCache))){a.resolve(b.hierarchyResponseCache)}else{AppConnector.request(c).then(function(d){b.hierarchyResponseCache=d;a.resolve(b.hierarchyResponseCache)})}return a.promise()},displayHierarchyResponseData:function(b){var a=function(c){app.showScrollBar(jQuery("#hierarchyScroll"),{height:"300px",railVisible:true,size:"6px"})};app.showModalWindow(b,function(c){if(typeof a=="function"&&jQuery("#hierarchyScroll").height()>300){a(c)}})},registerHierarchyRecordCount:function(){var a=$(".detailViewTitle .hierarchy");if(a.length){var b={module:app.getModuleName(),action:"RelationAjax",record:app.getRecordId(),mode:"getHierarchyCount",};AppConnector.request(b).then(function(c){if(c.success){$(".detailViewTitle .hierarchy").append(' <span class="badge">'+c.result+"</span>")}})}},registerShowHierarchy:function(){var c=this;var b=$(".detailViewTitle");var a="index.php?module=IStorages&view=Hierarchy&record="+app.getRecordId();b.on("click",".detailViewIcon",function(d){c.getHierarchyResponseData(a).then(function(e){c.displayHierarchyResponseData(e)})})},registerEvents:function(){this._super();this.registerHierarchyRecordCount();this.registerShowHierarchy()}});