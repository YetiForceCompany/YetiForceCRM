
jQuery.Class("Calendar_ActivityStateModal_Js",{},{registerActivityState:function(){var a=this;jQuery("#activityStateModal button:not(.close)").on("click",function(i){var h=jQuery(i.currentTarget);h.closest(".modal").addClass("hide");if(a.saveResultInstance==undefined){a.saveResultInstance=new SaveResult()}if(h.data("type")=="1"){a.updateActivityState(h)}if(h.hasClass("showQuickCreate")){var g=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});var d="Calendar";var c="index.php?module=Calendar&view=QuickCreateAjax&addRelation=true&sourceModule=Calendar&sourceRecord="+h.data("id");var j={};j.noCache=true;var f=h.closest(".modalEditStatus").find(".modalSummaryValues .fieldVal").data("subject");var b=Vtiger_Header_Js.getInstance();b.getQuickCreateForm(c,d,j).then(function(k){g.progressIndicator({mode:"hide"});if(h.data("type")=="0"&&typeof f!="undefined"&&f.length>0){k=jQuery(k);var e=k.find('[name="subject"]');if(e.length){e.val(f)}}b.handleQuickCreateData(k,{callbackFunction:function(l){if(l&&l.success&&l.result.followup.value==h.data("id")){a.updateActivityState(h)}var m={};m.record=h.data("id");m.module="Calendar";m.view="quick_edit";m.activitystatus=h.data("state");a.saveResultInstance.checkData(m)}})})}})},updateActivityState:function(c){var a=this;var d={module:"Calendar",action:"ActivityStateAjax",record:c.data("id"),state:c.data("state")};app.hideModalWindow();var b=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});AppConnector.request(d).then(function(i){if(i.success){var j=app.getViewName();if(j==="Detail"){var h=jQuery(".activityWidgetContainer .widgetContentBlock");var g=Vtiger_Detail_Js.getInstance();if(h.length){g.loadWidget(h)}else{var e=g.getTabByLabel(g.detailViewRecentActivitiesTabLabel);if(e){e.trigger("click")}if(app.getModuleName()=="Calendar"){e=((!g.getSelectedTab().length||g.getSelectedTab().data("linkKey")==g.detailViewDetailsTabLabel)?g.getTabContainer().find('[data-link-key="'+g.detailViewDetailsTabLabel+'"]:not(.hide)'):jQuery("<div></div>"));jQuery(".showModal.closeCalendarRekord").addClass("hide");e.trigger("click")}}}if(j=="List"){var f=new Vtiger_List_Js();f.getListViewRecords()}if(j=="DashBoard"){(new Vtiger_DashBoard_Js()).getContainer().find('a[name="drefresh"]').trigger("click")}if(app.getModuleName()=="Calendar"&&j=="Calendar"){(Calendar_CalendarView_Js.getInstanceByView()).loadCalendarData()}Vtiger_Index_Js.requestReminder();b.progressIndicator({mode:"hide"})}else{return false}})},registerEvents:function(){this.registerActivityState()}});jQuery(document).ready(function(b){var a=new Calendar_ActivityStateModal_Js();a.registerEvents()});