
Vtiger_Edit_Js("Calendar_Edit_Js",{},{isEvents:function(){var b=this.getForm();var a=b.find('[name="module"]').val();if(a=="Events"){return true}return false},registerReminderFieldCheckBox:function(){this.getForm().find('input[name="set_reminder"]').on("change",function(c){var b=jQuery(c.currentTarget);var a=b.closest("div").next();if(b.is(":checked")){a.removeClass("hide")}else{a.addClass("hide")}})},registerRecurrenceFieldCheckBox:function(){var a=this;a.getForm().find('input[name="recurringcheck"]').on("change",function(d){var c=jQuery(d.currentTarget);var b=jQuery("#repeatUI");if(c.is(":checked")){b.removeClass("hide")}else{b.addClass("hide")}})},registerRecurringTypeChangeEvent:function(){var a=this;jQuery("#recurringType").on("change",function(d){var c=jQuery(d.currentTarget);var b=c.val();a.changeRecurringTypesUIStyles(b)})},registerRepeatMonthActions:function(){var a=this;a.getForm().find('input[name="repeatMonth"]').on("change",function(b){a.repeatMonthOptionsChangeHandling()})},changeRecurringTypesUIStyles:function(b){var a=this;if(b=="Daily"||b=="Yearly"){jQuery("#repeatWeekUI").removeClass("show").addClass("hide");jQuery("#repeatMonthUI").removeClass("show").addClass("hide")}else{if(b=="Weekly"){jQuery("#repeatWeekUI").removeClass("hide").addClass("show");jQuery("#repeatMonthUI").removeClass("show").addClass("hide")}else{if(b=="Monthly"){jQuery("#repeatWeekUI").removeClass("show").addClass("hide");jQuery("#repeatMonthUI").removeClass("hide").addClass("show")}}}},repeatMonthOptionsChangeHandling:function(){if(jQuery("#repeatDay").is(":checked")){jQuery("#repeatMonthDate").attr("disabled",true);jQuery("#repeatMonthDayType").prop("disabled",false);jQuery("#repeatMonthDay").prop("disabled",false)}else{jQuery("#repeatMonthDate").removeAttr("disabled");jQuery("#repeatMonthDayType").prop("disabled",true);jQuery("#repeatMonthDay").prop("disabled",true)}},setDefaultEndTime:function(h){var j=h.find('[name="date_start"]');var m=h.find('[name="time_start"]');var c=h.find('[name="time_end"]');var r=h.find('[name="due_date"]');if(r.data("userChangedTime")==true){return}if(jQuery('[name="userChangedEndDateTime"]').val()=="1"){return}var b=j.val();var k=m.val();var g=Vtiger_Time_Validator_Js.invokeValidation(m);if(g!=true){return}var p=b+" "+k;var n=h.find('[name="due_date"]').data("dateFormat");var a=c.data("format");var b=Vtiger_Helper_Js.getDateInstance(p,n);var i=Date.parse(b);var f=false;if(h.find('[name="activitytype"]').val()=="Call"){var d=h.find('[name="defaultCallDuration"]').val();f=i.addMinutes(d)}else{var o=h.find('[name="defaultOtherEventDuration"]').val();f=i.addMinutes(o)}var e=app.getDateInVtigerFormat(n,f);if(a==24){var l="HH:mm"}else{l="hh:mm tt"}var q=i.toString(l);r.val(e);c.val(q)},registerActivityTypeChangeEvent:function(a){var b=this;a.on("change",'select[name="activitytype"]',function(c){b.setDefaultEndTime(a)})},registerTimeStartChangeEvent:function(a){var b=this;a.on("changeTime",'input[name="time_start"]',function(c){b.setDefaultEndTime(a)});a.find('[name="date_start"]').on("change",function(l){var k=jQuery(l.currentTarget);var d=a.find('[name="due_date"]');var g=b.getDateInstance(a,"start");var i=b.getDateInstance(a,"end");var f=$("#userDateFormat").val();var h=$("#userTimeFormat").val();a.find(".autofill").trigger("change");if(g>i){i=g;var j=app.getDateInVtigerFormat(f,i);d.val(j);app.registerEventForDatePickerFields(a)}var c=k.closest(".fieldValue").find('[name="time_start"]');c.trigger("changeTime")});a.find('input[name="time_start"]').on("focus",function(d){var c=jQuery(d.currentTarget);c.data("prevValue",c.val())});a.find('input[name="time_start"]').on("blur",function(i,g){if(typeof g=="undefined"){g={}}if(typeof g.forceChange=="undefined"){g.forceChange=false}var c=jQuery(i.currentTarget);var d=c.val();var h=c.data("prevValue");if(d!=h||g.forceChange){var f=c.data("timepicker-list");if(!f){c.timepicker("show");c.timepicker("hide");f=c.data("timepicker-list")}i=jQuery.Event("keydown");i.which=13;i.keyCode=13;c.trigger(i)}})},registerEndDateTimeChangeLogger:function(a){a.find('[name="time_end"]').on("changeTime",function(f){var d=jQuery(f.currentTarget);var b=Vtiger_Time_Validator_Js.invokeValidation(d);if(b!=true){return}var c=d.closest(".fieldValue").find('[name="due_date"]');jQuery('[name="userChangedEndDateTime"]').val("1");c.data("userChangedTime",true)});a.find('[name="due_date"]').on("change",function(d){var c=jQuery(d.currentTarget);var b=Vtiger_Date_Validator_Js.invokeValidation(c);if(b!=true){return}jQuery('[name="userChangedEndDateTime"]').val("1");c.data("userChangedTime",true)})},registerFormSubmitEvent:function(){var b=this;var a=this.getForm();a.on("submit",function(d){var f=a.find('input[name="recurringcheck"]').is(":checked");if(f==false){jQuery("#recurringType").append(jQuery('<option value="--None--">None</option>')).val("--None--")}if(b.isEvents()){var c=jQuery("#selectedUsers").val();if(c!=null){c=jQuery("#selectedUsers").val().join(";")}jQuery('<input type="hidden" name="inviteesid" />').appendTo(a).val(c)}})},getFreeTime:function(b){var d=b.find('[name="time_start"]');var a=b.find('[name="time_end"]');var c=b.find('[name="date_start"]');var e={module:app.getModuleName(),action:"GetFreeTime",dateStart:c.val()};b.progressIndicator({});AppConnector.request(e).then(function(f){b.progressIndicator({mode:"hide"});d.val(f.result.time_start);a.val(f.result.time_end);c.val(f.result.date_start);b.find('[name="due_date"]').val(f.result.date_start)})},registerAutoFillHours:function(b){var c=this;var d=b.find('[name="allday"]');var e=b.find('[name="time_start"]');var a=b.find('[name="time_end"]');b.find(".autofill").on("change",function(g){var f=$(g.currentTarget);if(f.is(":checked")){c.getFreeTime(b);e.attr("readonly","readonly");a.attr("readonly","readonly");d.attr("disabled","disabled");d.removeAttr("checked");d.trigger("change")}else{d.removeAttr("disabled");e.removeAttr("readonly");a.removeAttr("readonly")}})},registerBasicEvents:function(a){this._super(a);this.toggleTimesInputs(a);this.registerTimesInputs(a);this.registerTimeStartChangeEvent(a);this.registerActivityTypeChangeEvent(a);this.registerEndDateTimeChangeLogger(a);this.registerAutoFillHours(a);a.find('[name="activitytype"]').trigger("change")},toggleTimesInputs:function(a){a.find(":checkbox").change(function(){var b=$(this).attr("name");if("allday"==b){var c=$(this).is(":checked");if(!a.find("#quickCreate").length){if(c){a.find(".time").hide()}else{a.find(".time").show()}}}})},registerTimesInputs:function(b){var a=b.find('[name="allday"]:checkbox');if(a.prop("checked")){b.find(".time").hide()}},getDateInstance:function(d,m){var l=d.find('[name="date_start"]');var c=d.find('[name="due_date"]');var g=d.find('[name="time_end"]');var i=d.find('[name="time_start"]');var f=l.val();var e=i.val();var k=g.val();var j=c.val();var b=$("#userDateFormat").val();var h=$("#userTimeFormat").val();if(m=="start"){var a=Vtiger_Helper_Js.getDateInstance(f+" "+e,b)}if(m=="end"){var a=Vtiger_Helper_Js.getDateInstance(j+" "+k,b)}return a},registerEvents:function(){var a=this.proceedRegisterEvents();if(!a){return}this.registerReminderFieldCheckBox();this.registerRecurrenceFieldCheckBox();this.registerFormSubmitEvent();this.repeatMonthOptionsChangeHandling();this.registerRecurringTypeChangeEvent();this.registerRepeatMonthActions();this._super()}});