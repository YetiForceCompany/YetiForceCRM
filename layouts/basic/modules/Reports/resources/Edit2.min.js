
Reports_Edit_Js("Reports_Edit2_Js",{},{step2Container:false,reportsColumnsList:false,selectedFields:false,init:function(){this.initialize()},getContainer:function(){return this.step2Container},setContainer:function(a){this.step2Container=a;return this},getReportsColumnsList:function(){if(this.reportsColumnsList==false){this.reportsColumnsList=jQuery("#reportsColumnsList")}return this.reportsColumnsList},getSelectedFields:function(){if(this.selectedFields==false){this.selectedFields=jQuery("#seleted_fields")}return this.selectedFields},initialize:function(a){if(typeof a=="undefined"){a=jQuery("#report_step2")}if(a.is("#report_step2")){this.setContainer(a)}else{this.setContainer(jQuery("#report_step2"))}},isFormValidate:function(){var e=this;var c=this.getReportsColumnsList();var b=app.getSelect2ElementFromSelect(c);var a=Vtiger_MultiSelect_Validator_Js.invokeValidation(c);if(a!=true){b.validationEngine("showPrompt",a,"error","bottomLeft",true);var d=e.getContainer();app.formAlignmentAfterValidation(d);return false}else{b.validationEngine("hide");return true}},calculateValues:function(){var c=this.getContainer();var b=this.getSelectedColumns();this.getSelectedFields().val(JSON.stringify(b));var d=new Array();var h=jQuery(".sortFieldRow",c);jQuery.each(h,function(l,m){var k=jQuery(m);var o=k.find(".selectedSortFields").val();var j=k.find(".sortOrder").filter(":checked").val();var n=k.find(".sortType").val();d.push([o,j,n])});jQuery("#selected_sort_fields").val(JSON.stringify(d));var f={};var g=jQuery(".CalculationFields",c);var e=g.find(".calculationFieldRow");var a=0;jQuery.each(e,function(j,k){var l=jQuery(k).find(".calculationType:checked");jQuery.each(l,function(m,n){f[a]=jQuery(n).val();a++})});jQuery("#calculation_fields").val(JSON.stringify(f))},submit:function(){var a=jQuery.Deferred();this.calculateValues();var b=this.getContainer();var d=b.serializeFormData();var c=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});AppConnector.request(d).then(function(e){b.hide();c.progressIndicator({mode:"hide"});a.resolve(e)},function(e,f){});return a.promise()},registerSelect2ElementForReportColumns:function(){var c=this.getReportsColumnsList();var a=JSON.parse(this.getSelectedFields().val());c=app.changeSelectElementView(c,"selectize",{plugins:["drag_drop","remove_button"],maxItems:app.getMainParams("maxReportColumn")});var b=c[0].selectize;b.clear();for(i in a){b.addItem(a[i])}},getSelectedColumns:function(){var b=this.getReportsColumnsList();var a=b.val();return a},registerLineItemCalculationLimit:function(){var d=this;var b=jQuery('input[name="primary_module"]').val();var a=[];var c=jQuery('input[name="secondary_modules"]').val();var e=false;a.forEach(function(f){if(c.indexOf(f)!=-1){e=true}});if(jQuery.inArray(b,a)!==-1||e){jQuery(".CalculationFields").on("change",'input[type="checkbox"]',function(k){var j=jQuery(k.currentTarget);var m=j.val();var h=new RegExp(/cb:vtiger_inventoryproductrel*/);var l=j.is(":checked");var n=jQuery('.CalculationFields input[type="checkbox"]').not('[value^="cb:vtiger_inventoryproductrel"]');var o=jQuery(".CalculationFields").find('[value^="cb:vtiger_inventoryproductrel"]');if(h.test(m)){if(l){n.attr("checked",false).attr("disabled",true)}else{var g=o.filter(":checked").length;if(g==0){n.attr("disabled",false)}else{n.attr("checked",false).attr("disabled",true)}}}else{if(l){o.attr("checked",false).attr("disabled",true)}else{var f=n.filter(":checked").length;if(f==0){o.attr("disabled",false)}else{o.attr("disabled",true).attr("checked",false)}}}d.displayLineItemFieldLimitationMessage()})}},displayLineItemFieldLimitationMessage:function(){var a=app.vtranslate("JS_CALCULATION_LINE_ITEM_FIELDS_SELECTION_LIMITATION");if(jQuery("#calculationLimitationMessage").length==0){jQuery(".CalculationFields").parent().append('<div id="calculationLimitationMessage" class="pull-right alert alert-info">'+a+"</div>")}else{jQuery("#calculationLimitationMessage").html(a)}},registerLineItemCalculationLimitOnLoad:function(){var b=jQuery('.CalculationFields input[type="checkbox"]').not('[value^="cb:vtiger_inventoryproductrel"]');var a=jQuery(".CalculationFields").find('[value^="cb:vtiger_inventoryproductrel"]');if(b.filter(":checked").length!=0){a.attr("checked",false).attr("disabled",true);this.displayLineItemFieldLimitationMessage()}else{if(a.filter(":checked").length!=0){b.attr("checked",false).attr("disabled",true);this.displayLineItemFieldLimitationMessage()}}},registerEvents:function(){var a=this.getContainer();this.reportsColumnsList=false;this.selectedFields=false;this.registerSelect2ElementForReportColumns();this.registerLineItemCalculationLimit();this.registerLineItemCalculationLimitOnLoad();app.changeSelectElementView(a);a.validationEngine({onValidationComplete:function(c,b){return b}})}});