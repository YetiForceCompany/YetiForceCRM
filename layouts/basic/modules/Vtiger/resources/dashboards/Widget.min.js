
jQuery.Class("Vtiger_Widget_Js",{widgetPostLoadEvent:"Vtiget.Dashboard.PostLoad",widgetPostRefereshEvent:"Vtiger.Dashboard.PostRefresh",getInstance:function(b,d,a){if(typeof a=="undefined"){a=app.getModuleName()}var g=d.toCamelCase();var h=window[a+"_"+g+"_Widget_Js"];var e=window["Vtiger_"+g+"_Widget_Js"];var c=window["YetiForce_"+g+"_Widget_Js"];var i=Vtiger_Widget_Js;if(typeof h!="undefined"){var f=new h(b)}else{if(typeof e!="undefined"){var f=new e(b)}else{if(typeof c!="undefined"){var f=new c(b)}else{var f=new i(b)}}}return f}},{container:false,plotContainer:false,plotInstance:false,chartData:[],paramCache:false,init:function(a){this.setContainer(jQuery(a));this.registerWidgetPostLoadEvent(a);this.registerWidgetPostRefreshEvent(a);this.registerCache(a)},getContainer:function(){return this.container},setContainer:function(a){this.container=a;return this},isEmptyData:function(){var a=this.getContainer();return(a.find(".noDataMsg").length>0)?true:false},getUserDateFormat:function(){return jQuery("#userDateFormat").val()},getPlotContainer:function(b){if(typeof b=="undefined"){b=false}if(this.plotContainer==false||!b){var a=this.getContainer();this.plotContainer=a.find(".widgetChartContainer")}return this.plotContainer},registerRecordsCount:function(){var b=this;var a=b.getContainer().find(".recordCount");a.on("click",function(){var c=a.data("url");AppConnector.request(c).then(function(d){a.find(".count").html(d.result.totalCount);a.find("span:not(.count)").addClass("hide");a.find("a").removeClass("hide")})})},restrictContentDrag:function(){this.getContainer().on("mousedown.draggable",function(c){var b=jQuery(c.target);var a=b.closest(".dashboardWidgetHeader").length>0?true:false;if(a){return}c.stopPropagation()})},convertToDateRangePicketFormat:function(a){switch(a){case"yyyy-mm-dd":return"yyyy-MM-dd";break;case"mm-dd-yyyy":return"MM-dd-yyyy";break;case"dd-mm-yyyy":return"dd-MM-yyyy";break;case"yyyy.mm.dd":return"yyyy.MM.dd";break;case"mm.dd.yyyy":return"MM.dd.yyyy";break;case"dd.mm.yyyy":return"dd.MM.yyyy";break;case"yyyy/mm/dd":return"yyyy/MM/dd";break;case"mm/dd/yyyy":return"MM/dd/yyyy";break;case"dd/mm/yyyy":return"dd/MM/yyyy";break}},generateData:function(){var d=this;var a=d.getContainer();var b=a.find(".widgetData").val();var f=JSON.parse(b);var e=[];for(var c in f){e.push(f[c]);d.chartData[f[c].id]=f[c]}return{chartData:e}},loadChart:function(){},positionNoDataMsg:function(){var a=this.getContainer();var c=a.find(".dashboardWidgetContent");var b=c.find(".noDataMsg");b.position({my:"center center",at:"center center",of:c})},postLoadWidget:function(){if(!this.isEmptyData()){this.loadChart()}else{this.positionNoDataMsg()}this.registerSectionClick();this.registerFilter();this.registerFilterChangeEvent();this.restrictContentDrag();app.showBtnSwitch(this.getContainer().find(".switchBtn"));this.registerWidgetSwitch();this.registerChangeSorting();this.registerLoadMore()},postRefreshWidget:function(){if(!this.isEmptyData()){this.loadChart()}else{this.positionNoDataMsg()}this.registerSectionClick();this.registerLoadMore()},setSortingButton:function(f){if(f.length){var c=this.getContainer();var a=c.find('a[name="drefresh"]');var e=a.data("url");e=e.replace("&sortorder=desc","");e=e.replace("&sortorder=asc","");e+="&sortorder=";var g=f.data("sort");var b="desc";var h="glyphicon-sort-by-attributes-alt";if(g=="desc"){b="asc";h="glyphicon-sort-by-attributes"}f.data("sort",b);f.attr("title",f.data(b));f.attr("alt",f.data(b));e+=b;var d=f.find(".glyphicon");d.removeClass().addClass("glyphicon").addClass(h);a.data("url",e)}},registerChangeSorting:function(){var b=this;var a=this.getContainer();b.setSortingButton(a.find(".changeRecordSort"));a.find(".changeRecordSort").click(function(d){var c=a.find('a[name="drefresh"]');b.setSortingButton(jQuery(d.currentTarget));c.click()})},registerWidgetSwitch:function(){var a=this;var b=this.getContainer().find(".dashboardWidgetHeader .switchBtnReload");a.setUrlSwitch(b);b.on("switchChange.bootstrapSwitch",function(g,f){var d=jQuery(g.currentTarget);var h=d.closest(".dashboardWidgetHeader");var c=h.find('a[name="drefresh"]');a.setUrlSwitch(d).then(function(e){if(e){c.click()}})})},setUrlSwitch:function(b){var a=jQuery.Deferred();b.each(function(h,i){var g=jQuery(i);var f=g.closest(".dashboardWidgetHeader");var k=f.find('a[name="drefresh"]');var c=k.data("url");var d=g.data("urlparams");if(d!=""){var m=g.data("on-val");var l=g.data("off-val");c=c.replace("&"+d+"="+m,"");c=c.replace("&"+d+"="+l,"");c+="&"+d+"=";if(g.prop("checked")){c+=m}else{c+=l}k.data("url",c);a.resolve(true)}else{a.reject()}});return a.promise()},getFilterData:function(){return{}},refreshWidget:function(){var i=this;var k=this.getContainer();var e=k.find('a[name="drefresh"]');var b=e.data("url");var g=k.find(".dashboardWidgetContent");var d=b;var f=k.find(".widgetFilter");if(f.length>0){d={};d.url=b;d.data={};f.each(function(r,p){var s=jQuery(p);if(s.is(".dateRange")){var n=s.val();if(n.length<=0){return true}var m=s.attr("name");var o=n.split(",");d.data[m]={};d.data[m].start=o[0];d.data[m].end=o[1]}else{var l=s.attr("type");var q=s.attr("name");if("checkbox"==l){var t=s.is(":checked");d.data[q]=t}else{var t=s.val();d.data[q]=t}}})}var h=this.getFilterData();if(!jQuery.isEmptyObject(h)){if(typeof d=="string"){b=d;d={};d.url=b;d.data={}}d.data=jQuery.extend(d.data,this.getFilterData())}var c=k.find(".dashboardWidgetContent");var a=k.find(".dashboardWidgetFooter");c.html("");a.html("");c.progressIndicator();if(this.paramCache&&f.length>0){i.setFilterToCache(d.url,d.data)}AppConnector.request(d).then(function(l){var l=jQuery(l);var m=l.filter(".widgetFooterContent");c.progressIndicator({mode:"hide"});if(m.length){m=m.clone(true,true);a.html(m);l.each(function(p,o){if(jQuery(this).hasClass("widgetFooterContent")){l.splice(p,1)}})}g.html(l).trigger(Vtiger_Widget_Js.widgetPostRefereshEvent)},function(){c.progressIndicator({mode:"hide"})})},registerFilter:function(){var d=this;var a=this.getContainer();var b=a.find("input.dateRange");var c=false;if(b.length<=0){return}var e={calendars:3,mode:"range",className:"rangeCalendar",onChange:function(g){c=true;var f=jQuery(this).data("datepicker").el;jQuery(f).val(g)},onHide:function(){if(c){a.find('a[name="drefresh"]').trigger("click");c=false}},onBeforeShow:function(f){jQuery(f).css("z-index","3")}};b.addClass("dateField").attr("data-date-format",d.getUserDateFormat());app.registerEventForDatePickerFields(b,false,e)},registerFilterChangeEvent:function(){this.getContainer().on("change",".widgetFilter",function(b){var a=jQuery(b.currentTarget).closest("li");a.find('a[name="drefresh"]').trigger("click")})},registerWidgetPostLoadEvent:function(a){var b=this;a.on(Vtiger_Widget_Js.widgetPostLoadEvent,function(c){b.postLoadWidget()})},registerWidgetPostRefreshEvent:function(a){var b=this;a.on(Vtiger_Widget_Js.widgetPostRefereshEvent,function(c){b.postRefreshWidget()})},registerSectionClick:function(){},registerLoadMore:function(){var c=this;var b=c.getContainer();var a=b.find(".dashboardWidgetContent");a.off("click",".showMoreHistory");a.on("click",".showMoreHistory",function(k){var g=jQuery(k.currentTarget);g.hide();var i=jQuery(k.delegateTarget).closest(".dashboardWidget");jQuery(i).find(".slimScrollDiv").css("overflow","visible");var d=i.find(".owner").val();var h=i.find("[name='type']").val();var f=g.data("url")+"&content=true&owner="+d;if(i.find("[name='type']").length>0){f+="&type="+h}if(i.find(".changeRecordSort").length>0){f+="&sortorder="+i.find(".changeRecordSort").data("sort")}a.progressIndicator();AppConnector.request(f).then(function(e){a.progressIndicator({mode:"hide"});jQuery(i).find(".dashboardWidgetContent").append(e);g.parent().remove()})})},setFilterToCache:function(c,g){var f=c;var a=this.getContainer();f=f.replace("&content=","&notcontent=");for(var e in g){if(typeof g[e]=="object"){g[e]=JSON.stringify(g[e])}f+="&"+e+"="+g[e]}var d=app.getMainParams("current_user_id");var b=a.data("name");app.cacheSet(b+d,f)},registerCache:function(a){if(a.data("cache")==1){this.paramCache=true}}});Vtiger_Widget_Js("Vtiger_History_Widget_Js",{},{postLoadWidget:function(){this._super();var a=jQuery(".dashboardWidgetContent",this.getContainer());this.registerLoadMore()},postRefreshWidget:function(){this._super();this.registerLoadMore()},registerLoadMore:function(){var c=this;var b=c.getContainer();var a=b.find(".dashboardWidgetContent");var d=a.find(".load-more");d.click(function(){var h=c.getContainer();var g=h.find('a[name="drefresh"]');var f=g.data("url");var l=f;var e=h.find(".widgetFilter");if(e.length>0){l={url:f,data:{}};e.each(function(n,p){var m=jQuery(p);var o=m.attr("name");var q=m.val();l.data[o]=q})}var k=c.getFilterData();if(!jQuery.isEmptyObject(k)){if(typeof l=="string"){l={url:f,data:{}}}l.data=jQuery.extend(l.data,c.getFilterData())}l.data.page=d.data("nextpage");var i=h.find(".dashboardWidgetContent");i.progressIndicator();AppConnector.request(l).then(function(m){i.progressIndicator({mode:"hide"});d.replaceWith(m);c.registerLoadMore()},function(){i.progressIndicator({mode:"hide"})})})}});Vtiger_Widget_Js("Vtiger_Funnel_Widget_Js",{},{postLoadWidget:function(){this._super();var a=this;this.getContainer().on("jqplotDataClick",function(e,d,i,h,g){var c=a.getContainer().find(".widgetData").val();var f=JSON.parse(c);var b=f[i][3];if(b){window.location.href=b}});this.getContainer().on("jqplotDataHighlight",function(b,c,d,e){$(".jqplot-event-canvas").css("cursor","pointer")});this.getContainer().on("jqplotDataUnhighlight",function(b,c,d,e){$(".jqplot-event-canvas").css("cursor","auto")})},loadChart:function(){var a=this.getContainer();var c=a.find(".widgetData").val();var b=JSON.parse(c);if(b.length>0){this.getPlotContainer(false).jqplot([b],{seriesDefaults:{renderer:jQuery.jqplot.FunnelRenderer,rendererOptions:{sectionMargin:0,widthRatio:0.1,showDataLabels:true,dataLabelThreshold:0,dataLabels:"value",highlightMouseDown:true}},legend:{show:true,location:"e",}});this.registerSectionClick()}},registerSectionClick:function(){var a=this.getContainer();var c=a.find(".widgetData").val();var b=JSON.parse(c);this.getContainer().on("jqplotDataClick",function(g,d,f,h){var e=b[f][2];window.location.href=e})}});Vtiger_Widget_Js("Vtiger_Pie_Widget_Js",{},{generateData:function(){var a=this.getContainer();var b=a.find(".widgetData").val();var f=JSON.parse(b);var e=[];for(var c in f){var g=f[c];var d=[g.last_name,g.id];e.push(d)}return{chartData:e}},loadChart:function(){var a=this.generateData();if(a.chartData.length>0){this.getPlotContainer(false).jqplot([a.chartData],{seriesDefaults:{renderer:jQuery.jqplot.PieRenderer,rendererOptions:{showDataLabels:true,dataLabels:"value"}},legend:{show:true,location:"e"},title:a.title});this.registerSectionClick()}},registerSectionClick:function(){var a=this.getContainer();var c=a.find(".widgetData").val();var b=JSON.parse(c);this.getContainer().on("jqplotDataClick",function(g,d,f,h){var e=b[f][2];window.location.href=e})}});Vtiger_Widget_Js("Vtiger_Barchat_Widget_Js",{},{generateChartData:function(){var a=this.getContainer();var b=a.find(".widgetData").val();var g=JSON.parse(b);var f=[];var e=new Array();var d=0;for(var c in g){var h=g[c];h[0]=parseInt(h[0]);e.push(app.getDecodedValue(h[1]));f.push(h[0]);if(parseInt(h[0])>d){d=parseInt(h[0])}}d=d+2+(d/100)*25;return{chartData:[f],yMaxValue:d,labels:e}},loadChart:function(){var b=false;var a=this.getContainer();var c=a.find(".color");if(c.length){b=c.val()==0?false:true}var d=this.generateChartData();if(d.chartData[0].length>0){this.getPlotContainer(false).jqplot(d.chartData,{title:d.title,animate:!$.jqplot.use_excanvas,seriesDefaults:{renderer:jQuery.jqplot.BarRenderer,rendererOptions:{showDataLabels:true,dataLabels:"value",barDirection:"vertical",varyBarColor:b},pointLabels:{show:true,edgeTolerance:-15}},axes:{xaxis:{tickRenderer:jQuery.jqplot.CanvasAxisTickRenderer,renderer:jQuery.jqplot.CategoryAxisRenderer,ticks:d.labels,tickOptions:{angle:-45,labelPosition:"auto"}},yaxis:{min:0,max:d.yMaxValue,tickOptions:{formatString:"%d"},pad:1.2}},legend:{show:(d.data_labels)?true:false,location:"e",placement:"outside",showLabels:(d.data_labels)?true:false,showSwatch:(d.data_labels)?true:false,labels:d.data_labels}});this.registerSectionClick()}},registerSectionClick:function(){var a=this.getContainer();var c=a.find(".widgetData").val();var b=JSON.parse(c);this.getContainer().on("jqplotDataClick",function(g,d,f,h){var e=b[f][2];window.location.href=e})}});Vtiger_Barchat_Widget_Js("Vtiger_Horizontal_Widget_Js",{},{loadChart:function(){var b=false;var a=this.getContainer();var c=a.find(".color");if(c.length){b=c.val()==0?false:true}var d=this.generateChartData();this.getPlotContainer(false).jqplot(d.chartData,{title:d.title,animate:!$.jqplot.use_excanvas,seriesDefaults:{renderer:$.jqplot.BarRenderer,showDataLabels:true,pointLabels:{show:true,location:"e",edgeTolerance:-15},shadowAngle:135,rendererOptions:{barDirection:"horizontal",varyBarColor:b}},axes:{yaxis:{tickRenderer:jQuery.jqplot.CanvasAxisTickRenderer,renderer:jQuery.jqplot.CategoryAxisRenderer,ticks:d.labels,tickOptions:{angle:-45}}},legend:{show:false,location:"e",placement:"outside",showSwatch:true,showLabels:true,labels:d.data_labels}});this.registerSectionClick()}});Vtiger_Barchat_Widget_Js("Vtiger_Line_Widget_Js",{},{loadChart:function(){var a=this.generateChartData();if(a.chartData[0].length>0){this.getPlotContainer(false).jqplot(a.chartData,{title:a.title,legend:{show:false,labels:a.labels,location:"ne",showSwatch:true,showLabels:true,placement:"outside"},seriesDefaults:{pointLabels:{show:true}},axes:{xaxis:{min:0,pad:1,renderer:$.jqplot.CategoryAxisRenderer,ticks:a.labels,tickOptions:{formatString:"%b %#d"}}},cursor:{show:true}})}}});Vtiger_Widget_Js("Vtiger_MultiBarchat_Widget_Js",{getCharRelatedData:function(){var a=this.getContainer();var h=a.find(".widgetData").val();var c=new Array();var d=new Array();var m=new Array();for(var l=0;l<h.length;l++){if($.inArray(h[l].last_name,c)==-1){c.push(h[l].last_name)}if($.inArray(h[l].sales_stage,d)==-1){d.push(h[l].sales_stage)}}for(j in d){var f=new Array();for(l in c){var e=0;for(var g in h){var b=h[g];if(b.sales_stage==d[j]&&b.last_name==c[l]){e=parseInt(b.count);break}}f.push(e)}m.push(f)}return{data:m,ticks:c,labels:d}},loadChart:function(){var c=this.getCharRelatedData();var b=c.data;var a=c.ticks;var d=c.labels;$.jqplot.CanvasAxisTickRenderer.pt2px=2.4;this.getPlotContainer(false).jqplot(b,{stackSeries:true,captureRightClick:true,seriesDefaults:{renderer:$.jqplot.BarRenderer,rendererOptions:{barMargin:10,highlightMouseDown:true,highlightMouseOver:true},pointLabels:{show:true,hideZeros:true}},axes:{xaxis:{renderer:$.jqplot.CategoryAxisRenderer,tickRenderer:$.jqplot.CanvasAxisTickRenderer,tickOptions:{angle:-45,pt2px:4},ticks:a},yaxis:{padMin:0,min:0}},legend:{show:true,location:"e",placement:"outside",labels:d}})}});Vtiger_Widget_Js("Vtiger_Minilist_Widget_Js",{},{postLoadWidget:function(){app.hideModalWindow();this.restrictContentDrag();this.registerFilterChangeEvent();this.registerRecordsCount()},postRefreshWidget:function(){this.registerRecordsCount()}});Vtiger_Widget_Js("YetiForce_Charts_Widget_Js",{},{loadChart:function(){var b=this.getContainer();var d=b.find('[name="typeChart"]').val();var c=d.toCamelCase();var e=window["Report_"+c+"_Js"];var a=false;if(typeof e!="undefined"){a=new e();a.setContainer(b);a.loadChart();a.postInitializeCalls()}}});Vtiger_Widget_Js("Vtiger_Notebook_Widget_Js",{},{postLoadWidget:function(){this.reinitNotebookView()},reinitNotebookView:function(){var a=this;app.showScrollBar(jQuery(".dashboard_notebookWidget_viewarea",this.container),{height:"200px"});jQuery(".dashboard_notebookWidget_edit",this.container).click(function(){a.editNotebookContent()});jQuery(".dashboard_notebookWidget_save",this.container).click(function(){a.saveNotebookContent()})},editNotebookContent:function(){jQuery(".dashboard_notebookWidget_text",this.container).show();jQuery(".dashboard_notebookWidget_view",this.container).hide();$("body").on("click",function(a){if($(a.target).closest(".dashboard_notebookWidget_view").length===0&&$(a.target).closest(".dashboard_notebookWidget_text").length===0){$(".dashboard_notebookWidget_save").trigger("click")}})},saveNotebookContent:function(){$("body").off("click");var b=this;var a=jQuery(".dashboard_notebookWidget_textarea",this.container);var c=this.container.data("url");var e=c+"&content=true&mode=save&contents="+encodeURIComponent(a.val());var d=this.container.find(".dashboardWidgetContent");d.progressIndicator();AppConnector.request(e).then(function(f){d.progressIndicator({mode:"hide"});jQuery(".dashboardWidgetContent",b.container).html(f);b.reinitNotebookView()})}});Vtiger_Widget_Js("Vtiger_KpiBarchat_Widget_Js",{},{generateChartData:function(){var a=this.getContainer();var b=a.find(".widgetData").val();var f=JSON.parse(b);var e=[];var d=new Array();var c=0;return{chartData:[[[f.result,f.all]]],yMaxValue:f.maxValue,labels:""}},loadChart:function(){var a=this.generateChartData();this.getPlotContainer(false).jqplot(a.chartData,{animate:!$.jqplot.use_excanvas,seriesDefaults:{renderer:jQuery.jqplot.BarRenderer,rendererOptions:{showDataLabels:true,dataLabels:"value",barDirection:"horizontal"},},axes:{xaxis:{min:0,max:a.yMaxValue,},yaxis:{renderer:jQuery.jqplot.CategoryAxisRenderer,}}})}});Vtiger_Widget_Js("YetiForce_Pie_Widget_Js",{},{loadChart:function(){var a=this;var b=a.generateData();a.plotInstance=$.plot(a.getPlotContainer(false),b.chartData,{series:{pie:{show:true,label:{formatter:a.getLabelFormat}}},legend:{show:false},grid:{hoverable:true,clickable:true},})},getLabelFormat:function(a,b){return"<div style='font-size:x-small;text-align:center;padding:2px;color:"+b.color+";'>"+a+"<br/>"+b.data[0][1]+"</div>"},registerSectionClick:function(){var a=this;a.getPlotContainer().bind("plothover",function(c,d,b){if(b){$(this).css("cursor","pointer")}else{$(this).css("cursor","auto")}});a.getPlotContainer().bind("plotclick",function(c,d,b){if(b){if(b.series.links){window.location.href=b.series.links}}})}});Vtiger_Widget_Js("YetiForce_Bar_Widget_Js",{},{generateData:function(){var d=this;var a=d.getContainer();var b=a.find(".widgetData").val();var f=JSON.parse(b);var e=[];for(var c in f.chart){e.push(f.chart[c]);d.chartData[f.chart[c].id]=f.chart[c]}return{chartData:e,ticks:f.ticks,links:f.links,legend:f.legend,valueLabels:f.valueLabels?f.valueLabels:{}}},loadChart:function(){var b=this;var c=b.generateData();var a={xaxis:{minTickSize:1,ticks:c.ticks},yaxis:{min:0,tickDecimals:0},grid:{hoverable:true,clickable:true},series:{bars:{show:true,barWidth:0.9,dataLabels:false,align:"center",lineWidth:0},valueLabels:c.valueLabels,stack:true},};b.plotInstance=$.plot(b.getPlotContainer(false),c.chartData,a)},getLabelFormat:function(a,b){return"<div style='font-size:x-small;text-align:center;padding:2px;color:"+b.color+";'>"+a+"<br/>"+b.data[0][1]+"</div>"},registerSectionClick:function(){var a=this;var b=a.generateData();a.getPlotContainer().bind("plothover",function(d,e,c){if(c){$(this).css("cursor","pointer")}else{$(this).css("cursor","auto")}});a.getPlotContainer().bind("plotclick",function(d,e,c){if(c){$(b.links).each(function(){if(c.dataIndex==this[0]){window.location.href=this[1]}})}})}});YetiForce_Bar_Widget_Js("YetiForce_Ticketsbystatus_Widget_Js",{},{loadChart:function(){var b=this;var c=b.generateData();var a={xaxis:{minTickSize:1,ticks:c.ticks},yaxis:{min:0,tickDecimals:0},grid:{hoverable:true,clickable:true},series:{bars:{show:true,barWidth:0.9,dataLabels:false,align:"center",lineWidth:0},valueLabels:c.valueLabels,stack:true},legend:{show:true,sorted:"reverse"},};b.plotInstance=$.plot(b.getPlotContainer(false),c.chartData,a)},});Vtiger_Widget_Js("YetiForce_Calendar_Widget_Js",{},{calendarView:false,calendarCreateView:false,weekDaysArray:{Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6},registerCalendar:function(){var i=this;var a="month";var c=i.getContainer();var g=jQuery("#time_format").val();if(g==24){g="H(:mm)"}else{g="h(:mm) A"}var e=jQuery("#start_day").val();var h=i.weekDaysArray[e];var f=jQuery("#start_hour").val();var k=f.split(":");f=k["0"];var b=app.getMainParams("defaultDate");if(this.paramCache&&b!=moment().format("YYYY-MM-DD")){b=moment(b).format("D")==1?moment(b):moment(b).add(1,"M")}i.getCalendarView().fullCalendar({header:{left:" ",center:"prev title next",right:" "},defaultDate:b,timeFormat:g,axisFormat:g,firstHour:f,firstDay:h,defaultView:a,editable:false,slotMinutes:15,theme:false,defaultEventMinutes:0,eventLimit:true,allDaySlot:false,monthNames:[app.vtranslate("JS_JANUARY"),app.vtranslate("JS_FEBRUARY"),app.vtranslate("JS_MARCH"),app.vtranslate("JS_APRIL"),app.vtranslate("JS_MAY"),app.vtranslate("JS_JUNE"),app.vtranslate("JS_JULY"),app.vtranslate("JS_AUGUST"),app.vtranslate("JS_SEPTEMBER"),app.vtranslate("JS_OCTOBER"),app.vtranslate("JS_NOVEMBER"),app.vtranslate("JS_DECEMBER")],monthNamesShort:[app.vtranslate("JS_JAN"),app.vtranslate("JS_FEB"),app.vtranslate("JS_MAR"),app.vtranslate("JS_APR"),app.vtranslate("JS_MAY"),app.vtranslate("JS_JUN"),app.vtranslate("JS_JUL"),app.vtranslate("JS_AUG"),app.vtranslate("JS_SEP"),app.vtranslate("JS_OCT"),app.vtranslate("JS_NOV"),app.vtranslate("JS_DEC")],dayNames:[app.vtranslate("JS_SUNDAY"),app.vtranslate("JS_MONDAY"),app.vtranslate("JS_TUESDAY"),app.vtranslate("JS_WEDNESDAY"),app.vtranslate("JS_THURSDAY"),app.vtranslate("JS_FRIDAY"),app.vtranslate("JS_SATURDAY")],dayNamesShort:[app.vtranslate("JS_SUN"),app.vtranslate("JS_MON"),app.vtranslate("JS_TUE"),app.vtranslate("JS_WED"),app.vtranslate("JS_THU"),app.vtranslate("JS_FRI"),app.vtranslate("JS_SAT")],buttonText:{today:app.vtranslate("JS_TODAY"),month:app.vtranslate("JS_MONTH"),week:app.vtranslate("JS_WEEK"),day:app.vtranslate("JS_DAY")},allDayText:app.vtranslate("JS_ALL_DAY"),eventLimitText:app.vtranslate("JS_MORE")});i.getCalendarView().find("td.fc-day-number").mouseenter(function(){jQuery('<span class="plus pull-left glyphicon glyphicon-plus"></span>').prependTo($(this))}).mouseleave(function(){$(this).find(".plus").remove()});i.getCalendarView().find("td.fc-day-number").click(function(){var l=$(this).data("date");var m={noCache:true};m.data={date_start:l,due_date:l};m.callbackFunction=function(){i.getCalendarView().closest(".dashboardWidget").find('a[name="drefresh"]').trigger("click")};Vtiger_Header_Js.getInstance().quickCreateModule("Calendar",m)});var d=c.find(".switchBtn");app.showBtnSwitch(d);d.on("switchChange.bootstrapSwitch",function(m,l){if(l){c.find(".widgetFilterSwitch").val("current")}else{c.find(".widgetFilterSwitch").val("history")}i.refreshWidget()})},loadCalendarData:function(d){var l=this;l.getCalendarView().fullCalendar("removeEvents");var k=l.getCalendarView().fullCalendar("getView");var h=k.start.format();var c=k.end.format();var m=l.getContainer();var f=m.find(".owner").val();if(f=="all"){f=""}var e={module:"Calendar",action:"Calendar",mode:"getEvents",start:h,end:c,user:f,widget:true};if(m.find(".customFilter").length>0){var a=m.find(".customFilter").val();e.customFilter=a}if(m.find(".widgetFilterSwitch").length>0){e.time=m.find(".widgetFilterSwitch").val()}if(this.paramCache){var i=this.getContainer().find('a[name="drefresh"]');var b=i.data("url");var g={owner:f,customFilter:a,start:h};l.setFilterToCache(b,g)}AppConnector.request(e).then(function(p){var n=(l.getCalendarView().find(".fc-bg :first").height()-l.getCalendarView().find(".fc-day-number").height())-10;var q=(l.getCalendarView().find(".fc-day-number").width()/2)-10;for(var o in p.result){p.result[o]["width"]=q;p.result[o]["height"]=n}l.getCalendarView().fullCalendar("addEventSource",p.result);l.getCalendarView().find(".fc-event-container a").click(function(){var t=l.getContainer();var u="index.php?module=Calendar&view=List";if(a){u+="&viewname="+t.find("select.widgetFilter.customFilter").val()}else{u+="&viewname=All"}u+="&search_params=[[";var r=t.find(".widgetFilter.owner option:selected");if(r.val()!="all"){u+='["assigned_user_id","e","'+r.val()+'"],'}if(m.find(".widgetFilterSwitch").length>0){var s=m.find(".widgetFilterSwitch").data();u+='["activitystatus","e","'+s[e.time]+'"],'}window.location.href=u+'["activitytype","e","'+$(this).data("type")+'"],["date_start","ir","'+$(this).data("date")+'"]]]'})})},getCalendarView:function(){if(this.calendarView==false){this.calendarView=this.getContainer().find("#calendarview")}return this.calendarView},getMonthName:function(){var a=this;var b=a.getCalendarView().find(".fc-toolbar h2").text();if(b){this.getContainer().find(".headerCalendar .month").html("<h3>"+b+"</h3>")}},registerChangeView:function(){var d=this;var a=this.getContainer();a.find(".fc-toolbar").addClass("hide");var e=a.find(".fc-toolbar h2").text();if(e){var b=a.find(".headerCalendar").removeClass("hide").find(".month").append("<h3>"+e+"</h3>");var c=a.find(".headerCalendar button");c.each(function(){var f=jQuery(this).data("type");jQuery(this).on("click",function(){d.getCalendarView().find(".fc-toolbar ."+f).trigger("click");d.loadCalendarData();d.getMonthName()})})}},postLoadWidget:function(){this.registerCalendar();this.loadCalendarData(true);this.registerChangeView();this.registerFilterChangeEvent()},refreshWidget:function(){var b=this;var a=this.getContainer().find(".dashboardWidgetContent");a.progressIndicator();b.loadCalendarData();a.progressIndicator({mode:"hide"})},});Vtiger_Widget_Js("YetiForce_Calendaractivities_Widget_Js",{},{modalView:false,postLoadWidget:function(){this._super();this.registerActivityChange();this.registerListViewButton()},postRefreshWidget:function(){this._super();this.registerActivityChange()},registerActivityChange:function(){var b=this;var a=this.getContainer().find(".dashboardWidgetContent");a.find(".changeActivity").on("click",function(f){if(jQuery(f.target).is("a")||b.modalView){return}var d=jQuery(this).data("url");if(typeof d!="undefined"){var c=function(){b.modalView=false};b.modalView=true;app.showModalWindow(null,d,c)}})},registerListViewButton:function(){var b=this;var a=b.getContainer();a.find(".goToListView").on("click",function(){if(a.data("name")=="OverdueActivities"){var d="PLL_OVERDUE"}else{var d="PLL_IN_REALIZATION,PLL_PLANNED"}var e="index.php?module=Calendar&view=List&viewname=All";e+="&search_params=[[";var c=a.find(".widgetFilter.owner option:selected");if(c.val()!="all"){e+='["assigned_user_id","c","'+c.val()+'"],'}e+='["activitystatus","e","'+d+'"]]]';window.location.href=e})}});YetiForce_Calendaractivities_Widget_Js("YetiForce_Assignedupcomingcalendartasks_Widget_Js",{},{});YetiForce_Calendaractivities_Widget_Js("YetiForce_Creatednotmineactivities_Widget_Js",{},{});YetiForce_Calendaractivities_Widget_Js("YetiForce_Overdueactivities_Widget_Js",{},{});YetiForce_Calendaractivities_Widget_Js("YetiForce_Assignedoverduecalendartasks_Widget_Js",{},{});Vtiger_Widget_Js("YetiForce_Productssoldtorenew_Widget_Js",{},{modalView:false,postLoadWidget:function(){this._super();this.registerAction();this.registerListViewButton()},postRefreshWidget:function(){this._super();this.registerAction()},registerAction:function(){var b=this;var a=this.getContainer().find(".dashboardWidgetContent");a.find(".rowAction").on("click",function(f){if(jQuery(f.target).is("a")||b.modalView){return}var d=jQuery(this).data("url");if(typeof d!="undefined"){var c=function(){b.modalView=false};b.modalView=true;app.showModalWindow(null,d,c)}})},registerListViewButton:function(){var b=this;var a=b.getContainer();a.find(".goToListView").on("click",function(){var c=jQuery(this).data("url");var e=a.find(".orderby");var d=a.find(".changeRecordSort");if(e.length){c+="&orderby="+e.val()}if(d.length){c+="&sortorder="+d.data("sort").toUpperCase()}window.location.href=c})}});YetiForce_Productssoldtorenew_Widget_Js("YetiForce_Servicessoldtorenew_Widget_Js",{},{});Vtiger_Widget_Js("YetiForce_Chartfilter_Widget_Js",{},{loadChart:function(){var b=this.getContainer();var d=b.find('[name="typeChart"]').val();var c=d.toCamelCase();var e=window["Vtiger_"+c+"_Widget_Js"];var a=false;if(typeof e!="undefined"){a=new e(b);a.loadChart()}this.registerRecordsCount()}});YetiForce_Bar_Widget_Js("YetiForce_Alltimecontrol_Widget_Js",{},{loadChart:function(){var b=this;var c=b.generateData();var a={xaxis:{minTickSize:1,ticks:c.ticks},yaxis:{min:0,tickDecimals:0},grid:{hoverable:true,clickable:true},series:{bars:{show:true,barWidth:0.8,dataLabels:false,align:"center",lineWidth:0,},stack:true},legend:{show:true,labelFormatter:function(d,e){return("<b>"+d+"</b>: "+c.legend[d]+" h")}}};b.plotInstance=$.plot(b.getPlotContainer(false),c.chartData,a)}});YetiForce_Bar_Widget_Js("YetiForce_Leadsbysource_Widget_Js",{},{registerSectionClick:function(){var a=this;var b=a.generateData();a.getPlotContainer().bind("plothover",function(d,e,c){if(c){$(this).css("cursor","pointer")}else{$(this).css("cursor","auto")}});a.getPlotContainer().bind("plotclick",function(d,e,c){if(c){$(b.links).each(function(){if(c.seriesIndex==this[0]){window.location.href=this[1]}})}})}});Vtiger_Pie_Widget_Js("YetiForce_Closedticketsbypriority_Widget_Js",{},{generateData:function(){var a=this.getContainer();var g=a.find(".widgetData").val();var e=JSON.parse(g);var d=[];var c=[];var h=[];for(var f in e){var i=e[f];var b=[i.name,i.count];d.push(b);c.push(i.color);h.push(i.url)}return{chartData:d,color:c,url:h}},loadChart:function(){var a=this.generateData();if(a.chartData.length>0){this.getPlotContainer(false).jqplot([a.chartData],{seriesDefaults:{renderer:jQuery.jqplot.PieRenderer,rendererOptions:{showDataLabels:true,dataLabels:"value"}},seriesColors:a.color,legend:{show:true,location:"e"},title:a.title});this.registerSectionClick()}},registerSectionClick:function(){var a=this.generateData();this.getContainer().on("jqplotDataClick",function(e,b,d,f){var c=a.url[d];window.location.href=c})}});Vtiger_Barchat_Widget_Js("YetiForce_Closedticketsbyuser_Widget_Js",{},{});Vtiger_Barchat_Widget_Js("YetiForce_Opentickets_Widget_Js",{},{generateChartData:function(){var a=this.getContainer();var f=a.find(".widgetData").val();var d=JSON.parse(f);var c=[];var h=new Array();var g=0;var b=[];for(var e in d){var i=d[e];i[0]=parseInt(i[0]);h.push(app.getDecodedValue(i[1]));c.push([app.getDecodedValue(i[1]),i[0]]);if(parseInt(i[0])>g){g=parseInt(i[0])}b.push(i[3])}g=g+2+(g/100)*25;return{chartData:[c],yMaxValue:g,labels:h,colors:b}},loadChart:function(){var a=this.generateChartData();if(a.chartData[0].length>0){this.getPlotContainer(false).jqplot(a.chartData,{title:a.title,animate:!$.jqplot.use_excanvas,seriesColors:a.colors,seriesDefaults:{renderer:jQuery.jqplot.BarRenderer,rendererOptions:{showDataLabels:true,dataLabels:"value",barDirection:"vertical",varyBarColor:true},pointLabels:{show:true,edgeTolerance:-15}},axes:{xaxis:{tickRenderer:jQuery.jqplot.CanvasAxisTickRenderer,renderer:jQuery.jqplot.CategoryAxisRenderer,tickOptions:{angle:-45,labelPosition:"auto"}},yaxis:{min:0,max:a.yMaxValue,tickOptions:{formatString:"%d"},pad:1.2}},legend:{show:false,}});this.registerSectionClick()}},});YetiForce_Bar_Widget_Js("YetiForce_Accountsbyindustry_Widget_Js",{},{registerSectionClick:function(){var a=this;var b=a.generateData();a.getPlotContainer().bind("plothover",function(d,e,c){if(c){$(this).css("cursor","pointer")}else{$(this).css("cursor","auto")}});a.getPlotContainer().bind("plotclick",function(d,e,c){if(c){$(b.links).each(function(){if(c.seriesIndex==this[0]){window.location.href=this[1]}})}})}});Vtiger_Funnel_Widget_Js("YetiForce_Estimatedvaluebystatus_Widget_Js",{},{generateData:function(){var a=this.getContainer();var c=a.find(".widgetData").val();var b=JSON.parse(c);return b},loadChart:function(){var a=this.generateData();if(a.length>0){this.getPlotContainer(false).jqplot([a],{seriesDefaults:{renderer:jQuery.jqplot.FunnelRenderer,rendererOptions:{sectionMargin:0,widthRatio:0.3,showDataLabels:true,dataLabelThreshold:0,dataLabels:"label",highlightMouseDown:true}},legend:{show:false,location:"e",}});this.registerSectionClick()}}});Vtiger_Barchat_Widget_Js("YetiForce_Notificationsbysender_Widget_Js",{},{});Vtiger_Barchat_Widget_Js("YetiForce_Notificationsbyrecipient_Widget_Js",{},{});