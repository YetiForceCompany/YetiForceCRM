
var Vtiger_Index_Js={showEmailPreview:function(a,d){var b=Vtiger_Popup_Js.getInstance();var c={};c.module="Emails";c.view="ComposeEmail";c.mode="emailPreview";c.record=a;c.parentId=d;c.relatedLoad=true;b.show(c)},registerWidgetsEvents:function(){var a=jQuery("div.widgetContainer");a.on("shown.bs.collapse",function(d){var c=jQuery(d.currentTarget);Vtiger_Index_Js.loadWidgets(c);var b=c.attr("id");app.cacheSet(b,1)});a.on("hidden.bs.collapse",function(g){var d=jQuery(g.currentTarget);var f=d.parent().find(".imageElement");var b=f.data("rightimage");f.attr("src",b);var c=d.attr("id");app.cacheSet(c,0)})},loadWidgets:function(e,c){var d=jQuery(".loadingWidgetMsg").html();if(e.find(".panel-body").html()!=""){var f=e.parent().find(".imageElement");var a=f.data("downimage");f.attr("src",a);e.css("height","auto");return}e.progressIndicator({message:d});var b=e.data("url");var g={type:"GET",url:"index.php",dataType:"html",data:b};AppConnector.request(g).then(function(k){if(typeof c=="undefined"){c=true}if(c){e.progressIndicator({mode:"hide"});var j=e.parent().find(".imageElement");var h=j.data("downimage");j.attr("src",h);e.css("height","auto")}e.html(k);var i=e.closest(".quickWidget").find(".quickWidgetHeader").data("label");jQuery(".bodyContents").trigger("Vtiger.Widget.Load."+i,jQuery(e))})},loadWidgetsOnLoad:function(){var a=jQuery("div.widgetContainer");a.each(function(c,e){var f=jQuery(e);var d=f.attr("id");var h=app.cacheGet(d);if(h!=null){if(h==1){Vtiger_Index_Js.loadWidgets(f);f.addClass("in")}else{var g=f.parent().find(".imageElement");var b=g.data("rightimage");g.attr("src",b)}}})},changeSkin:function(){jQuery(".themeElement").on("click",function(b){b.stopPropagation();var a=jQuery(b.currentTarget);a.closest("#themeContainer").hide();var d=jQuery("#progressDiv");d.progressIndicator();var c={module:"Users",action:"SaveAjax",record:jQuery("#current_user_id").val(),field:"theme",value:a.data("skinName")};AppConnector.request(c).then(function(e){if(e.success&&e.result){d.progressIndicator({mode:"hide"});jQuery(".settingIcons").removeClass("open");window.location.reload()}},function(e,f){})})},showComposeEmailPopup:function(c,a){var b="Emails";Vtiger_Helper_Js.checkServerConfig(b).then(function(e){if(e==true){var d=jQuery.extend({"text-align":"left"},d);AppConnector.request(c).then(function(i){var m=[];if(i){i=jQuery(i);var h=i.find("#SendEmailFormStep1");var g=h.find(".emailField");var f=g.length;var l=new Emails_MassEdit_Js();if(f>1){app.showModalWindow(i,function(n){l.registerEmailFieldSelectionEvent();if(jQuery("#multiEmailContainer").height()>300){jQuery("#multiEmailContainer").slimScroll({height:"300px",railVisible:true,alwaysVisible:true,size:"6px"})}},d)}else{g.attr("checked","checked");var k=h.serializeFormData();var j=l.showComposeEmailForm(k);m.push(j)}}if(typeof a=="function"){a.apply(null,m)}},function(f,g){})}else{Vtiger_Helper_Js.showPnotify(app.vtranslate("JS_EMAIL_SERVER_CONFIGURATION"))}})},registerActivityReminder:function(){var a=jQuery("#activityReminder").val();if(a!=""){a=a*1000;var c=new Date().getTime();var b=app.cacheGet("nextActivityReminderCheckTime",0);if((c+a)>b){Vtiger_Index_Js.requestReminder();setTimeout("Vtiger_Index_Js.requestReminder()",a);app.cacheSet("nextActivityReminderCheckTime",c+parseInt(a))}}},requestReminder:function(){var c=this;var b=$(".remindersNoticeContainer");var a="index.php?module=Calendar&view=Reminders&type_remainder=true";AppConnector.request(a).then(function(d){b.html(d);c.refreshNumberNotifications(b);app.registerModal(b);b.find(".reminderPostpone").on("click",function(i){var h=jQuery(i.currentTarget);var g=h.closest(".panel").data("record");var f="index.php?module=Calendar&action=ActivityReminder&mode=postpone&record="+g+"&time="+h.data("time");AppConnector.request(f).then(function(e){h.closest(".panel").fadeOut(300,function(){$(this).remove();c.refreshNumberNotifications(b)})})})})},refreshNumberNotifications:function(c){var a=$(".remindersNotice .badge");var b=c.find(".panel:visible").length;a.text(b);a.removeClass("hide");if(b>0){$(".remindersNotice").effect("pulsate",1500)}else{a.addClass("hide")}},registerResizeEvent:function(){$(window).resize(function(){if(this.resizeTO){clearTimeout(this.resizeTO)}this.resizeTO=setTimeout(function(){$(this).trigger("resizeEnd")},600)});$(window).bind("resizeEnd",function(){Vtiger_Index_Js.adjustTopMenuBarItems()})},adjustTopMenuBarItems:function(){var g=125;var f=($(window).outerWidth()<1161)?jQuery("#mediumNav"):jQuery("#largeNav");var b=f.parent().outerWidth();var h=jQuery(".opttabs",f),d=h.length;var a=d;function e(){var j=(a>0)?h[a-1]:null;if(j){j=jQuery(j);j.hide();a--}return j}var c=false;do{if((b-f.outerWidth())<g){var i=e();if(i==null||(b-f.outerWidth())>g){if(i){i.hide()}c=true;break}}else{c=true;break}}while(!c);jQuery(window).load(function(){jQuery("#topMenus").css({overflow:"visible"})})},registerTooltipEvents:function(){var g=jQuery.merge(jQuery('[data-field-type="reference"] > a'),jQuery('[data-field-type="multireference"] > a'));var e=[];var i=true;function d(){b();var l=jQuery(this);var k=l.attr("href")?l.attr("href"):"";if(k==""){return}k=k.replace("view=","xview=")+"&view=TooltipAjax";var j=i?jQuery('[data-url-cached="'+k+'"]'):null;if(j&&j.length){f(l,j.html())}else{AppConnector.request(k).then(function(m){j=jQuery("<div>").css({display:"none"}).attr("data-url-cached",k);j.html(m);jQuery("body").append(j);f(l,m)})}}function h(l){var k=window.innerWidth;var j=jQuery(l).offset().left;if(k-j<400||a(l)){return"left"}return"right"}function a(l){var k=l.closest("tr");var j=k.find("td.listViewEntryValue:last a");if(l.attr("href")==j.attr("href")){return true}return false}function f(k,l){var j=h(k);k.popover({trigger:"manual",content:l,animation:false,html:true,placement:j,template:'<div class="popover popover-tooltip"><div class="arrow"></div><div class="popover-inner"><button name="vtTooltipClose" class="close" style="color:white;opacity:1;font-weight:lighter;position:relative;top:3px;right:3px;">x</button><h3 class="popover-title"></h3><div class="popover-content"><div></div></div></div></div>'});e.push(k.popover("show"));c()}function b(){var j=null;while(j=e.pop()){j.popover("hide")}}g.each(function(j,k){jQuery(k).hoverIntent({interval:100,sensitivity:7,timeout:10,over:d,out:b})});function c(){jQuery('button[name="vtTooltipClose"]').on("click",function(k){var j=e.pop();j.popover("hide")})}},registerShowHideRightPanelEvent:function(){jQuery("#toggleRightPanelButton").click(function(c){c.preventDefault();var a=jQuery("#centerPanel");var b=jQuery("#rightPanel");var d=jQuery("#tRightPanelButtonImage");if(b.attr("class").indexOf("move-action")==-1){b.addClass("move-action");a.removeClass("col-md-10").addClass("col-md-12");d.removeClass("glyphicon-chevron-right").addClass("glyphicon-chevron-left")}else{b.removeClass("move-action");a.removeClass("col-md-12").addClass("col-md-10");d.removeClass("glyphicon-chevron-left").addClass("glyphicon-chevron-right")}})},loadPreSaveRecord:function(a){SaveResult=new SaveResult();return SaveResult.checkData(a)},registerEvents:function(){Vtiger_Index_Js.registerWidgetsEvents();Vtiger_Index_Js.loadWidgetsOnLoad();Vtiger_Index_Js.registerActivityReminder();Vtiger_Index_Js.adjustTopMenuBarItems();Vtiger_Index_Js.registerPostAjaxEvents();Vtiger_Index_Js.changeSkin();Vtiger_Index_Js.registerShowHideRightPanelEvent();Vtiger_Index_Js.registerResizeEvent()},registerPostAjaxEvents:function(){Vtiger_Index_Js.registerTooltipEvents()}};jQuery(document).ready(function(){Vtiger_Index_Js.registerEvents();app.listenPostAjaxReady(function(){Vtiger_Index_Js.registerPostAjaxEvents()})});