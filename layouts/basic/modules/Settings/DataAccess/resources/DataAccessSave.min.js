
function DataAccessSave(){this.displayInfo=false;this.checkAllDoc=function(c,a){var b=this;jQuery(c).on("click",function(){b.displayInfo=false;var e={},d=jQuery("#recordId").val();if("Edit"==a){d=jQuery('[name="record"]').val()}e.data={module:"DataAccess",action:"CheckDoc",rel_module:app.getModuleName(),record:d,form:c.serializeArray(),};e.async=false;AppConnector.request(e).then(function(g){var f=jQuery.extend({},g.result);jQuery("#validation_data").text(JSON.stringify(f))})});if("Edit"==a){jQuery('[type="text"]').on("keyup",function(){b.displayInfo=false;var e={},d=jQuery("#recordId").val();if("Edit"==a){d=jQuery('[name="record"]').val()}e.data={module:"DataAccess",action:"CheckDoc",rel_module:app.getModuleName(),record:d,form:c.serializeArray(),};e.async=false;AppConnector.request(e).then(function(g){var f=jQuery.extend({},g.result);jQuery("#validation_data").text(JSON.stringify(f))})});jQuery('[type="text"]').on("change",function(){b.displayInfo=false;var e={},d=jQuery("#recordId").val();if("Edit"==a){d=jQuery('[name="record"]').val()}e.data={module:"DataAccess",action:"CheckDoc",rel_module:app.getModuleName(),record:d,form:c.serializeArray(),};e.async=false;AppConnector.request(e).then(function(g){var f=jQuery.extend({},g.result);jQuery("#validation_data").text(JSON.stringify(f))})})}},this.preSaveDetail=function(b){var a=this;b.on("Vtiger.Field.PreSave",function(g){var d=jQuery("#validation_data").text();var f=JSON.parse(d);if(f.passCondition){if(!f.condition_allow){var h=f.tr[0]+"<br /><br />"+f.tr[1]+": <br />";for(var c=0;c<f.not_attach_doc_list.length;c++){h+="- "+f.not_attach_doc_list[c]+"<br />"}if(!a.displayInfo){a.displayInfo=true;Vtiger_Helper_Js.showPnotify(h)}g.preventDefault()}}})},this.preSaveEdit=function(){var a=this;jQuery(":submit").on("click",function(){var c=jQuery("#validation_data").text();var d=JSON.parse(c);if(d.passCondition){if(!d.condition_allow){var e=d.tr[0]+"<br /><br />"+d.tr[1]+": <br />";for(var b=0;b<d.not_attach_doc_list.length;b++){e+="- "+d.not_attach_doc_list[b]}if(!a.displayInfo){Vtiger_Helper_Js.showPnotify(e);a.displayInfo=true}return false}}})},this.registerEvents=function(){var d=this;var a=app.getViewName();var b=app.getModuleName();jQuery("body").append('<div id="data_access_save" style="display:none;"></div>');if("Detail"==a){var c=jQuery("#detailView");d.checkAllDoc(c,a);d.preSaveDetail(c)}else{if("Edit"==a){if(jQuery('[name="record"]').val()!=""){var c=jQuery("#EditView");d.checkAllDoc(c,a);d.preSaveEdit()}}}var e=this.getForm();c.on("Vtiger.Field.PreSave",function(f){f.preventDefault()});c.on("Vtiger.Record.PreSave",function(f){f.preventDefault()})}}jQuery(document).ready(function(){var a=new DataAccessSave();a.registerEvents()});