
jQuery.Class("Settings_Module_Manager_Js",{validateField:function(d,e,c,b){var a=/[&\<\>\:\'\"\,]/;if(a.test(d.val())){return app.vtranslate("JS_SPECIAL_CHARACTERS_NOT_ALLOWED")}return true},registerMondalCreateModule:function(c){c.find('[name="saveButton"]').attr("disabled",true);var b=c.find("form");b.validationEngine(app.validationEngineOptions);var a=new Settings_Module_Manager_Js();c.find("input").on("change",function(f){if($(this).attr("name")=="module_name"){a.checkModuleName($(this).val(),c)}else{if($(this).val()!=""){$(this).attr("check",true)}else{$(this).attr("check",false)}}var d=true;c.find("input[name]").each(function(){if($(this).attr("check")=="false"||$(this).attr("check")==undefined){d=false}});if(d){c.find('[name="saveButton"]').attr("disabled",false)}else{c.find('[name="saveButton"]').attr("disabled",true)}});c.find('[name="saveButton"]').click(function(g){if(b.validationEngine("validate")){var f=b.serializeFormData();var d=$.progressIndicator({message:app.vtranslate("Adding a Key"),blockInfo:{enabled:true}});var h={};h.module=app.getModuleName();h.parent=app.getParentModuleName();h.action="Basic";h.mode="createModule";h.formData=f;AppConnector.request(h).then(function(i){var e=i.result;if(!e.success){var j={text:e.text,animation:"show",type:"error"};Vtiger_Helper_Js.showPnotify(j)}else{window.location.href="index.php?parent=Settings&module=LayoutEditor&sourceModule="+e.text}});d.progressIndicator({mode:"hide"})}})}},{updateModuleStatus:function(e){var b=jQuery.Deferred();var c=e.data("module");var a=e.is(":checked");var d=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});var f={};f.module=app.getModuleName();f.parent=app.getParentModuleName();f.updateStatus=a;f.forModule=c;f.action="Basic";f.mode="updateModuleStatus";AppConnector.request(f).then(function(g){d.progressIndicator({mode:"hide"});b.resolve(g)},function(g){d.progressIndicator({mode:"hide"});b.reject(g)});return b.promise()},createModule:function(b){var a=jQuery.progressIndicator();app.showModalWindow(null,"index.php?module=ModuleManager&parent=Settings&view=CreateModule",function(c){a.progressIndicator({mode:"hide"});Settings_Module_Manager_Js.registerMondalCreateModule(c)})},checkModuleName:function(a,b){var c=jQuery.progressIndicator();b.find('[name="module_name"]').attr("check",false);var d={};d.data={module:app.getModuleName(),action:"Basic",parent:app.getParentModuleName(),mode:"checkModuleName",moduleName:a};d.async=false;d.dataType="json";AppConnector.request(d).then(function(f){var e=f.result;if(e.success){b.find('[name="module_name"]').attr("check",true)}else{b.find('[name="module_name"]').attr("check",false);var g={text:e.text,animation:"show",type:"error"};Vtiger_Helper_Js.showPnotify(g);b.find('[name="saveButton"]').attr("disabled",true)}c.progressIndicator({mode:"hide"})})},showNotify:function(a){var b={title:app.vtranslate("JS_MESSAGE"),text:"",animation:"show",type:"info"};$.extend(b,a);Vtiger_Helper_Js.showPnotify(b)},deleteModule:function(a){a.on("click",".deleteModule",function(d){var c=jQuery(d.currentTarget);var b=c.attr("name");var f={};f.data={module:app.getModuleName(),action:"Basic",parent:app.getParentModuleName(),mode:"deleteModule",forModule:b};AppConnector.request(f).then(function(e){var g={title:app.vtranslate("JS_REMOVED_MODULE"),animation:"show",type:"info"};Vtiger_Helper_Js.showPnotify(g);window.location.href="index.php?module=ModuleManager&parent=Settings&view=List"},function(e){})})},registerEvents:function(c){var b=this;var a=jQuery("#moduleManagerContents");a.find(".createModule").click(b.createModule);b.deleteModule(a);a.on("click",'[name="moduleStatus"]',function(i){var h=jQuery(i.currentTarget);var f=h.closest(".moduleManagerBlock");var j=f.find(".actions");var g=h.data("moduleTranslation");var d=f.find(".moduleImage, .moduleName");if(h.is(":checked")){j.removeClass("hide");d.removeClass("dull");b.updateModuleStatus(h).then(function(e){var k={text:g+" "+app.vtranslate("JS_MODULE_ENABLED"),};if(e.success==false){k.type="error";k.text=e.error.message}b.showNotify(k)},function(e){})}else{j.addClass("hide");d.addClass("dull");b.updateModuleStatus(h).then(function(e){var k={text:g+" "+app.vtranslate("JS_MODULE_DISABLED")};b.showNotify(k)},function(e){})}})}});jQuery(document).ready(function(){var a=new Settings_Module_Manager_Js();a.registerEvents()});