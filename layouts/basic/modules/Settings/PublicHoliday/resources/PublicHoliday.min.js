
jQuery.Class("Settings_PublicHoliday_Js",{},{registerDeleteHoliday:function(a){var b=this;a.find(".deleteHoliday").each(function(){jQuery(this).on("click",function(){b.deleteHoliday(jQuery(this).data("holiday-id"))})})},deleteHoliday:function(a){var b=this;var c=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});var d={};d.module=app.getModuleName();d.parent=app.getParentModuleName();d.action="Holiday";d.mode="delete";d.id=a;AppConnector.request(d).then(function(e){var f={};f.module=app.getModuleName();f.view="Configuration";f.parent=app.getParentModuleName();f.async=false;AppConnector.request(f).then(function(g){jQuery(".contentsDiv").html(g);b.registerEvents();c.progressIndicator({mode:"hide"})});f={};f.text=e.result.message;Settings_Vtiger_Index_Js.showMessage(f)},function(e){c.progressIndicator({mode:"hide"})})},registerAddDate:function(){var b=this;var a=jQuery("#layoutDashBoards");a.find(".addDateWindow").click(function(f){var d=a.find(".addDateWindowModal").clone(true,true);var g=app.vtranslate("JS_ADD_NEW_HOLIDAY");d.find(".modal-title").text(g);var c=function(h){h.find(".addDateWindowModal").removeClass("hide").show();var e=h.find(".addDateWindowForm");jQuery('[name="holidayId"]').val("");jQuery('[name="saveButton"]').on("click",function(){var i=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});b.saveNewDate(e).then(function(k){var l={};if(k.success){var j=k.result;l.text=j.message;Settings_Vtiger_Index_Js.showMessage(l);var l={};l.module=app.getModuleName();l.view="Configuration";l.parent=app.getParentModuleName();AppConnector.request(l).then(function(m){jQuery(".contentsDiv").html(m);b.registerEvents();i.progressIndicator({mode:"hide"})})}else{i.progressIndicator({mode:"hide"});l.text=k.result["message"];l.type="error";Settings_Vtiger_Index_Js.showMessage(l)}});app.hideModalWindow();return true});jQuery(document).find("div.blockOverlay").on("click",function(){var i=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});var j={};j.module=app.getModuleName();j.view="Configuration";j.parent=app.getParentModuleName();AppConnector.request(j).then(function(k){jQuery(".contentsDiv").html(k);b.registerEvents();i.progressIndicator({mode:"hide"})})});jQuery(".cancelLink").on("click",function(){var i=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});var j={};j.module=app.getModuleName();j.view="Configuration";j.parent=app.getParentModuleName();AppConnector.request(j).then(function(k){jQuery(".contentsDiv").html(k);b.registerEvents();i.progressIndicator({mode:"hide"})})});e.submit(function(i){i.preventDefault()})};app.showModalWindow(d,function(e){if(typeof c=="function"){c(e)}},{width:"1000px"})})},registerEditDate:function(){var b=this;var a=jQuery("#layoutDashBoards");a.find(".editHoliday").click(function(f){var d=a.find(".addDateWindowModal").clone(true,true);var h=jQuery(this).closest(".holidayElement");d.find('[name="holidayId"]').val(h.data("holiday-id"));d.find('[name="holidayDate"]').val(h.data("holiday-date"));d.find('[name="holidayName"]').val(h.data("holiday-name"));d.find('[name="holidayType"]').val(h.data("holiday-type"));var g=app.vtranslate("JS_EDIT_HOLIDAY");d.find(".modal-title").text(g);var c=function(i){i.find(".addDateWindowModal").removeClass("hide").show();var e=i.find(".addDateWindowForm");jQuery('[name="saveButton"]').on("click",function(){var j=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});b.saveNewDate(e).then(function(l){var m={};if(l.success){var k=l.result;m.text=k.message;Settings_Vtiger_Index_Js.showMessage(m);var m={};m.module=app.getModuleName();m.view="Configuration";m.parent=app.getParentModuleName();AppConnector.request(m).then(function(n){jQuery(".contentsDiv").html(n);b.registerEvents();j.progressIndicator({mode:"hide"})})}else{j.progressIndicator({mode:"hide"});m.text=l.result["message"];m.type="error";Settings_Vtiger_Index_Js.showMessage(m)}});app.hideModalWindow();return true});jQuery(document).find("div.blockOverlay").on("click",function(){var j=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});var k={};k.module=app.getModuleName();k.view="Configuration";k.parent=app.getParentModuleName();AppConnector.request(k).then(function(l){jQuery(".contentsDiv").html(l);b.registerEvents();j.progressIndicator({mode:"hide"})})});jQuery(".cancelLink").on("click",function(){var j=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});var k={};k.module=app.getModuleName();k.view="Configuration";k.parent=app.getParentModuleName();AppConnector.request(k).then(function(l){jQuery(".contentsDiv").html(l);b.registerEvents();j.progressIndicator({mode:"hide"})})});e.submit(function(j){j.preventDefault()})};app.showModalWindow(d,function(e){if(typeof c=="function"){c(e)}},{width:"1000px"})})},saveNewDate:function(c){var b=this;var e=c.serializeFormData();e.module=app.getModuleName();e.parent=app.getParentModuleName();e.action="Holiday";e.mode="save";if(e.holidayName==""||e.holidayDate==""){var e=[];e.text=app.vtranslate("JS_FILL_FORM_ERROR");e.type="error";Settings_Vtiger_Index_Js.showMessage(e);var d=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});var e={};e.module=app.getModuleName();e.view="Configuration";e.parent=app.getParentModuleName();AppConnector.request(e).then(function(f){jQuery(".contentsDiv").html(f);b.registerEvents();d.progressIndicator({mode:"hide"})})}else{var a=jQuery.Deferred();AppConnector.request(e).then(function(f){a.resolve(f)},function(f){a.reject(f)});return a.promise()}return true},registerChangeDate:function(){var a=this;var c=jQuery(".dateFilter");var b={calendars:3,mode:"range",className:"rangeCalendar",onChange:function(f){var d=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});var e={};e.module=app.getModuleName();e.view="Configuration";e.parent=app.getParentModuleName();e.date=f;AppConnector.request(e).then(function(g){jQuery(".contentsDiv").html(g);a.registerEvents();d.progressIndicator({mode:"hide"})})}};app.registerEventForDatePickerFields(c,false,b)},registerEvents:function(){var b=this;var a=jQuery("#moduleBlocks");b.registerDeleteHoliday(a);b.registerAddDate();b.registerEditDate();b.registerChangeDate()}});jQuery(document).ready(function(){var a=new Settings_PublicHoliday_Js();a.registerEvents()});