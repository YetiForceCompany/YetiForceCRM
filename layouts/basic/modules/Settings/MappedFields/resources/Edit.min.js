
Settings_Vtiger_Edit_Js("Settings_MappedFields_Edit_Js",{instance:{}},{currentInstance:false,editContainer:false,init:function(){this.initiate()},getContainer:function(){return this.editContainer},setContainer:function(a){this.editContainer=a;return this},getInstance:function(b){if(b in Settings_MappedFields_Edit_Js.instance){return Settings_MappedFields_Edit_Js.instance[b]}else{var a="Settings_MappedFields_Edit"+b+"_Js";Settings_MappedFields_Edit_Js.instance[b]=new window[a]();return Settings_MappedFields_Edit_Js.instance[b]}},getStepValue:function(){var a=this.currentInstance.getContainer();return jQuery(".step",a).val()},initiate:function(a){if(typeof a==="undefined"){a=jQuery(".mfTemplateContents")}if(a.is(".mfTemplateContents")){this.setContainer(a)}else{this.setContainer(jQuery(".mfTemplateContents",a))}this.initiateStep("1");this.currentInstance.registerEvents()},initiateStep:function(a){var b="step"+a;this.activateHeader(b);this.currentInstance=this.getInstance(a)},activateHeader:function(b){var a=jQuery(".crumbs ");a.find(".active").removeClass("active");jQuery("#"+b,a).addClass("active")},registerFormSubmitEvent:function(b){var a=this;if(jQuery.isFunction(a.currentInstance.submit)){b.on("submit",function(f){var c=jQuery(f.currentTarget);var d=true;if(jQuery.isFunction(a.currentInstance.isFormValidate)){d=a.currentInstance.isFormValidate()}if(c.validationEngine("validate")&&d){a.currentInstance.submit().then(function(i){if(i){a.getContainer().append(i);var h=a.getStepValue();var g=parseInt(h)+1;a.initiateStep(g);a.currentInstance.initialize();var e=a.currentInstance.getContainer();a.registerFormSubmitEvent(e);a.currentInstance.registerEvents()}})}f.preventDefault()})}},back:function(){var e=this.getStepValue();var b=parseInt(e)-1;this.currentInstance.initialize();var a=this.currentInstance.getContainer();var f=jQuery('[name="record"]',a);var d=f.val();a.remove();this.initiateStep(b);var c=this.currentInstance.getContainer();c.show();jQuery('[name="record"]',c).val(d)},registerCancelStepClickEvent:function(a){jQuery("button.cancelLink",a).on("click",function(){window.history.back()})},registerBackStepClickEvent:function(){var b=this;var a=this.getContainer();a.on("click",".backStep",function(c){b.back()})},registerEvents:function(){var a=this.currentInstance.getContainer();this.registerFormSubmitEvent(a);this.registerBackStepClickEvent();this.registerCancelStepClickEvent(a)}});