
jQuery.Class("KnowledgeBase_Tree_Js",{},{treeInstance:false,content:false,getContent:function(){if(!this.content){this.content=$(".contentOfData")}return this.content},generateTree:function(b,e){var d=this;d.treeInstance=b.find("#treeContent");var c=e.result;var a=["search"];d.treeInstance.jstree({core:{data:c,themes:{name:"proton",responsive:true}},plugins:a})},loadTree:function(c){var b=this;var a=$(".treeContainer");var e={module:app.getModuleName(),action:"DataTreeAjax",};var d=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});if(c){b.treeInstance.jstree("destroy")}AppConnector.request(e).then(function(f){d.progressIndicator({mode:"hide"});b.generateTree(a,f);b.registerTreeEvents(a)})},searchingInTree:function(a){this.treeInstance.jstree(true).search(a)},registerSearchEvent:function(){var c=this;var a=$("#valueSearchTree");var b=$("#btnSearchTree");a.keypress(function(d){if(d.which==13){c.searchingInTree(a.val())}});b.click(function(){c.searchingInTree(a.val())})},loadContent:function(b){var c=this;var a=c.getContent();var e={module:app.getModuleName(),view:"Content",};if(typeof b!="undefined"){e.record=b}var d=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});AppConnector.request(e).then(function(f){d.progressIndicator({mode:"hide"});a.html(f);if(typeof b=="undefined"){$.extend($.fn.dataTable.defaults,{language:{sLengthMenu:app.vtranslate("JS_S_LENGTH_MENU"),sZeroRecords:app.vtranslate("JS_NO_RESULTS_FOUND"),sInfo:app.vtranslate("JS_S_INFO"),sInfoEmpty:app.vtranslate("JS_S_INFO_EMPTY"),sSearch:app.vtranslate("JS_SEARCH"),sEmptyTable:app.vtranslate("JS_NO_RESULTS_FOUND"),sInfoFiltered:app.vtranslate("JS_S_INFO_FILTERED"),sLoadingRecords:app.vtranslate("JS_LOADING_OF_RECORDS"),sProcessing:app.vtranslate("JS_LOADING_OF_RECORDS"),oPaginate:{sFirst:app.vtranslate("JS_S_FIRST"),sPrevious:app.vtranslate("JS_S_PREVIOUS"),sNext:app.vtranslate("JS_S_NEXT"),sLast:app.vtranslate("JS_S_LAST")},oAria:{sSortAscending:app.vtranslate("JS_S_SORT_ASCENDING"),sSortDescending:app.vtranslate("JS_S_SORT_DESCENDING")}}});a.find(".dataTableWithDocuments").dataTable()}})},registerTreeEvents:function(){var a=this;a.registerSearchEvent();a.treeInstance.on("changed.jstree",function(c,b){if(b.node.original.type!="folder"){a.loadContent(b.node.original.record_id)}})},registerBasicEvents:function(){var a=this;$(".addRecord").click(function(){var c=Vtiger_Header_Js.getInstance();var b=app.getModuleName();var d=function(f){a.loadTree(true);a.loadContent()};var e={callbackFunction:d,noCache:false};c.quickCreateModule(b,e)})},registerEvents:function(){var a=this;a.registerBasicEvents();a.loadTree(false);a.loadContent()}});