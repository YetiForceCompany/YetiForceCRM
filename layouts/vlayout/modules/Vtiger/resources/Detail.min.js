
jQuery.Class("Vtiger_Detail_Js",{detailInstance:false,SaveResultInstance:false,getInstance:function(){if(Vtiger_Detail_Js.detailInstance==false){var d=app.getModuleName();var b=app.getViewName();var c=d+"_"+b+"_Js";var e=Vtiger_Detail_Js;if(typeof window[c]!="undefined"){var a=new window[c]()}else{var a=new e()}Vtiger_Detail_Js.detailInstance=a}return Vtiger_Detail_Js.detailInstance},triggerSendEmail:function(b,a){Vtiger_Helper_Js.checkServerConfig(a).then(function(e){if(e==true){var d=Vtiger_Detail_Js.getInstance();var c=new Array();var f={};c.push(d.getRecordId());f.module=app.getModuleName();f.view="MassActionAjax";f.selected_ids=c;f.mode="showComposeEmailForm";f.step="step1";f.relatedLoad=true;Vtiger_Index_Js.showComposeEmailPopup(f)}else{alert(app.vtranslate("JS_EMAIL_SERVER_CONFIGURATION"))}})},triggerDetailViewAction:function(f,c){var e=Vtiger_Detail_Js.getInstance();var b=new Array();b.push(e.getRecordId());var a={selected_ids:JSON.stringify(b)};var d={type:"POST",url:f,dataType:"html",data:a};AppConnector.request(d).then(function(g){if(g){app.showModalWindow(g,{"text-align":"left"});if(typeof c=="function"){c(g)}}},function(g,h){})},triggerSendSms:function(b,a){Vtiger_Helper_Js.checkServerConfig(a).then(function(c){if(c==true){Vtiger_Detail_Js.triggerDetailViewAction(b)}else{alert(app.vtranslate("JS_SMS_SERVER_CONFIGURATION"))}})},triggerTransferOwnership:function(c){var b=this;b.getRelatedModulesContainer=false;var a={type:"POST",url:c,dataType:"html",data:{}};AppConnector.request(a).then(function(d){if(d){var e=function(f){var g=app.validationEngineOptions;g.onValidationComplete=function(i,h){if(h){if(i.attr("name")=="changeOwner"){b.transferOwnershipSave(i)}}return false};jQuery("#changeOwner").validationEngine(app.validationEngineOptions)};app.showModalWindow(d,function(g){var f=b.getRelatedModuleContainer();app.changeSelectElementView(f,"select2");if(typeof e=="function"){e(g)}})}})},transferOwnershipSave:function(c){var b=this;var f=jQuery("#transferOwnerId").val();var d=jQuery("#related_modules").val();var a=jQuery("#recordId").val();var e={module:app.getModuleName(),action:"TransferOwnership",record:a,transferOwnerId:f,related_modules:d};AppConnector.request(e).then(function(i){if(i.success){app.hideModalWindow();var k={title:app.vtranslate("JS_MESSAGE"),text:app.vtranslate("JS_RECORDS_TRANSFERRED_SUCCESSFULLY"),animation:"show",type:"info"};var j=jQuery(".assigned_user_id").val();var h=jQuery(".assigned_user_id ");h.find('option[value="'+j+'"]').removeAttr("selected");h.find('option[value="'+f+'"]').attr("selected","selected");h.trigger("liszt:updated");var g=h.find('option[value="'+f+'"]').data("picklistvalue");h.closest(".row-fluid").find(".value").html('<a href="index.php?module=Users&amp;parent=Settings&amp;view=Detail&amp;record='+f+'">'+g+"</a>");Vtiger_Helper_Js.showPnotify(k)}})},getRelatedModuleContainer:function(){if(this.getRelatedModulesContainer==false){this.getRelatedModulesContainer=jQuery("#related_modules")}return this.getRelatedModulesContainer},deleteRecord:function(b){var a=app.vtranslate("LBL_DELETE_CONFIRMATION");Vtiger_Helper_Js.showConfirmationBox({message:a}).then(function(c){AppConnector.request(b+"&ajaxDelete=true").then(function(d){if(d.success==true){window.location.href=d.result}else{Vtiger_Helper_Js.showPnotify(d.error.message)}})},function(c,d){})},reloadRelatedList:function(){var a=jQuery('[name="currentPageNum"]').val();var b=Vtiger_Detail_Js.getInstance();b.loadRelatedList(a)},showWorkflowTriggerView:function(a){$(a).popover("hide");var b=Vtiger_Detail_Js.getInstance();var c={module:app.getModuleName(),view:"WorkflowTrigger",record:b.getRecordId()};var d=function(e){e.find('[type="submit"]').click(function(h){var g=[];e.find('input[type="checkbox"]:checked').each(function(j){g.push($(this).val())});if(g.length==0){var i={title:app.vtranslate("JS_INFORMATION"),text:app.vtranslate("JS_NOT_SELECTED_WORKFLOW_TRIGGER"),type:"error",animation:"show"};Vtiger_Helper_Js.showPnotify(i)}else{var i={title:app.vtranslate("JS_MESSAGE"),text:app.vtranslate("JS_STARTED_PERFORM_WORKFLOW"),type:"info",animation:"show"};Vtiger_Helper_Js.showPnotify(i);var f={module:app.getModuleName(),action:"Workflow",mode:"execute",record:b.getRecordId(),ids:g};AppConnector.request(f).then(function(j){var k={title:app.vtranslate("JS_MESSAGE"),text:app.vtranslate("JS_COMPLETED_PERFORM_WORKFLOW"),type:"success",animation:"show"};Vtiger_Helper_Js.showPnotify(k);app.hideModalWindow();b.loadWidgets()},function(j,k){var l={title:app.vtranslate("JS_ERROR"),text:app.vtranslate("JS_ERROR_DURING_TRIGGER_OF_WORKFLOW"),type:"error",animation:"show"};Vtiger_Helper_Js.showPnotify(l);app.hideModalWindow()})}})};AppConnector.request(c).then(function(e){if(e){app.showModalWindow(e,"",d)}},function(e,f){})},},{targetPicklistChange:false,targetPicklist:false,detailViewContentHolder:false,detailViewForm:false,detailViewDetailsTabLabel:"LBL_RECORD_DETAILS",detailViewSummaryTabLabel:"LBL_RECORD_SUMMARY",detailViewRecentCommentsTabLabel:"ModComments",detailViewRecentActivitiesTabLabel:"Activities",detailViewRecentUpdatesTabLabel:"LBL_UPDATES",detailViewRecentDocumentsTabLabel:"Documents",fieldUpdatedEvent:"Vtiger.Field.Updated",widgetPostLoad:"Vtiger.Widget.PostLoad",updatedFields:["company","designation","title"],fieldPreSave:"Vtiger.Field.PreSave",tempData:[],referenceFieldNames:{Calendar:{Accounts:"link",Leads:"link",Contacts:"link",Vendors:"link",OSSEmployees:"link",Campaigns:"process",HelpDesk:"process",Potentials:"process",Projects:"process",ServiceContracts:"process",},OutsourcedProducts:{Potentials:"potential",Leads:"parent_id",Accounts:"parent_id",Contacts:"parent_id"},Assets:{Potentials:"potential",Accounts:"parent_id",Contacts:"parent_id"},OSSOutsourcedServices:{Potentials:"potential",Leads:"parent_id",Accounts:"parent_id",Contacts:"parent_id"},OSSSoldServices:{Potentials:"potential",Accounts:"parent_id",Contacts:"parent_id"},},init:function(){},getDeleteMessageKey:function(){return"JS_DELETE_CONFIRMATION"},loadWidgets:function(){var a=this;var b=jQuery('[class^="widgetContainer_"]');b.each(function(c,e){var d=jQuery(e);a.loadWidget(d)})},loadWidget:function(f){var e=this;var b=jQuery.Deferred();var d=jQuery(".widget_header",f);var c=jQuery(".widget_contents",f);var a=f.data("url");var h=d.find('[name="relatedModule"]').val();var g={type:"GET",dataType:"html",data:a};c.progressIndicator({});AppConnector.request(g).then(function(i){c.progressIndicator({mode:"hide"});c.html(i);app.registerEventForTextAreaFields(jQuery(".commentcontent"));c.trigger(e.widgetPostLoad,{widgetName:h});app.showPopoverElementView(c.find(".popoverTooltip"));b.resolve(g)},function(i){c.progressIndicator({mode:"hide"});b.reject()});return b.promise()},loadCommentsWidget:function(){},loadContents:function(b,e){var d=this;var a=jQuery.Deferred();var c=this.getContentHolder();var f=b;if(typeof e!="undefined"){f={};f.url=b;f.data=e}AppConnector.requestPjax(f).then(function(g){c.html(g);g=c.html();d.registerBlockStatusCheckOnLoad();app.changeSelectElementView(c);app.registerEventForDatePickerFields(c);app.registerEventForTextAreaFields(jQuery(".commentcontent"));jQuery(".commentcontent").autosize();d.getForm().validationEngine();c.trigger(jQuery.Event("Detail.LoadContents.PostLoad"),g);a.resolve(g)},function(){});return a.promise()},getUpdatefFieldsArray:function(){return this.updatedFields},getTabByLabel:function(a){var c=this.getTabs();var b=false;c.each(function(e,f){var g=jQuery(f);var d=g.data("labelKey");if(d==a){b=g;return false}});return b},selectModuleTab:function(){var a=this.getTabContainer();var b=a.find("li.module-tab");this.deSelectAllrelatedTabs();this.markTabAsSelected(b)},deSelectAllrelatedTabs:function(){var a=this.getTabContainer();this.getTabs().removeClass("active")},markTabAsSelected:function(a){a.addClass("active")},getSelectedTab:function(){var a=this.getTabContainer();return a.find("li.active")},getTabContainer:function(){return jQuery("div.related")},getTabs:function(){return this.getTabContainer().find("li")},getContentHolder:function(){if(this.detailViewContentHolder==false){this.detailViewContentHolder=jQuery("div.details div.contents")}return this.detailViewContentHolder},getForm:function(){if(this.detailViewForm==false){this.detailViewForm=jQuery("#detailView")}return this.detailViewForm},getRecordId:function(){return jQuery("#recordId").val()},getRelatedModuleName:function(){if(jQuery(".relatedModuleName",this.getContentHolder()).length==1){return jQuery(".relatedModuleName",this.getContentHolder()).val()}},saveFieldValues:function(b){var a=jQuery.Deferred();var c=this.getRecordId();var d={};if(typeof b!="undefined"){d=b}d.record=c;d.module=app.getModuleName();d.action="SaveAjax";var e={};e.data=d;e.async=false;e.dataType="json";AppConnector.request(e).then(function(f){a.resolve(f)});return a.promise()},getRelatedListCurrentPageNum:function(){return jQuery('input[name="currentPageNum"]',this.getContentHolder()).val()},removeCommentBlockIfExists:function(){var a=this.getContentHolder();var b=jQuery(".commentsBody",a);jQuery(".addCommentBlock",b).remove()},getCommentThread:function(b){var a=jQuery.Deferred();AppConnector.request(b).then(function(c){a.resolve(c)},function(c,d){});return a.promise()},saveComment:function(k){var p=this;var j=jQuery.Deferred();var b=jQuery(k.currentTarget);var g=b.data("mode");var o=b.closest(".addCommentBlock");var q=o.find(".commentcontent");var l=q.val();var i;if(l==""){i=app.vtranslate("JS_LBL_COMMENT_VALUE_CANT_BE_EMPTY");q.validationEngine("showPrompt",i,"error","bottomLeft",true);j.reject();return j.promise()}if(g=="edit"){var n=o.find('[name="reasonToEdit"]').val()}var d=jQuery.progressIndicator({});var f=jQuery(k.currentTarget);f.attr("disabled","disabled");var m=o.closest(".commentDetails").find(".commentInfoHeader");var h=m.data("commentid");var c=m.data("parentcommentid");var a={commentcontent:l,related_to:p.getRecordId(),module:"ModComments"};if(g=="edit"){a.record=h;a.reasontoedit=n;a.parent_comments=c;a.mode="edit";a.action="Save"}else{if(g=="add"){a.parent_comments=h;a.action="SaveAjax"}}AppConnector.request(a).then(function(e){d.progressIndicator({mode:"hide"});j.resolve(e)},function(r,e){d.progressIndicator({mode:"hide"});f.removeAttr("disabled");j.reject(r,e)});return j.promise()},getCommentUI:function(c){var b=jQuery.Deferred();var a={view:"DetailAjax",module:"ModComments",record:c};AppConnector.request(a).then(function(d){b.resolve(d)},function(d,e){});return b.promise()},getCommentBlock:function(){var b=this.getContentHolder();var a=jQuery(".basicAddCommentBlock",b).clone(true,true).removeClass("basicAddCommentBlock hide").addClass("addCommentBlock");a.find(".commentcontenthidden").removeClass("commentcontenthidden").addClass("commentcontent");return a},getEditCommentBlock:function(){var b=this.getContentHolder();var a=jQuery(".basicEditCommentBlock",b).clone(true,true).removeClass("basicEditCommentBlock hide").addClass("addCommentBlock");a.find(".commentcontenthidden").removeClass("commentcontenthidden").addClass("commentcontent");return a},registerSendSmsSubmitEvent:function(){var a=this;jQuery("body").on("submit","#massSave",function(f){var d=jQuery(f.currentTarget);var b=d.find("#message").val().length;if(b>160){var g={title:app.vtranslate("JS_MESSAGE"),text:app.vtranslate("LBL_SMS_MAX_CHARACTERS_ALLOWED"),animation:"show",type:"error"};Vtiger_Helper_Js.showPnotify(g);return false}var c=d.find(":submit");c.attr("disabled","disabled");a.SendSmsSave(d);f.preventDefault()})},SendSmsSave:function(b){var c=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});var a=b.serializeFormData();AppConnector.request(a).then(function(d){app.hideModalWindow();c.progressIndicator({mode:"hide"})},function(d,e){})},registerNameAjaxEditEvent:function(){var b=this;var a=b.getContentHolder();a.on(b.fieldUpdatedEvent,".nameField",function(i,j){var h=b.getForm();var f=h.data("nameFields");var d="";for(var g in f){if(g!=0){d+=" "}var k=f[g];d+=h.find('[name="'+k+'"]').val()}var c=a.closest(".contentsDiv").find(".recordLabel");c.text(d)})},updateHeaderNameFields:function(){var k=this;var a=k.getContentHolder();var c=k.getForm();var b=c.data("nameFields");var l=a.closest(".contentsDiv").find(".recordLabel");var i="";for(var g in b){var f=b[g];var j=c.find('[name="'+f+'"]');if(j.length>0){var h=j.val();i+=h+" ";l.find('[class="'+f+'"]').text(h)}}var d=l.find(".salutation");if(d.length>0){var e=d.text();i=e+i}l.attr("title",i)},registerAjaxEditEvent:function(){var b=this;var a=b.getContentHolder();a.on(b.fieldUpdatedEvent,"input,select,textarea",function(c){b.updateHeaderValues(jQuery(c.currentTarget))})},updateHeaderValues:function(d){var f=this;if(d.hasClass("nameField")){f.updateHeaderNameFields();return true}var c=d.attr("name");var g=this.getUpdatefFieldsArray();var e=f.getContentHolder();if(jQuery.inArray(c,g)!="-1"){var b=d.val();var a=e.closest(".contentsDiv").find("."+c+"_label");a.text(b)}},registerEmailFieldClickEvent:function(){var a=this.getContentHolder();a.on("click",".emailField",function(b){b.stopPropagation()})},registerPhoneFieldClickEvent:function(){var a=this.getContentHolder();a.on("click",".phoneField",function(b){b.stopPropagation()})},registerUrlFieldClickEvent:function(){var a=this.getContentHolder();a.on("click",".urlField",function(b){b.stopPropagation()})},registerRelatedRowClickEvent:function(){var a=this.getContentHolder();a.on("click",".listViewEntries",function(d){var b=jQuery(d.target,jQuery(d.currentTarget));if(b.is("td:first-child")&&(b.children('input[type="checkbox"]').length>0)){return}if(jQuery(d.target).is('input[type="checkbox"]')){return}var c=jQuery(d.currentTarget);var f=c.data("recordurl");if(typeof f!="undefined"){window.location.href=f}})},loadRelatedList:function(a){var b=new Vtiger_RelatedList_Js(this.getRecordId(),app.getModuleName(),this.getSelectedTab(),this.getRelatedModuleName());var c={page:a};b.loadRelatedList(c)},registerEventForRelatedListPagination:function(){var b=this;var a=this.getContentHolder();a.on("click","#relatedListNextPageButton",function(g){var d=jQuery(g.currentTarget);if(d.attr("disabled")=="disabled"){return}var c=b.getSelectedTab();var h=b.getRelatedModuleName();var f=new Vtiger_RelatedList_Js(b.getRecordId(),app.getModuleName(),c,h);f.nextPageHandler()});a.on("click","#relatedListPreviousPageButton",function(){var c=b.getSelectedTab();var e=b.getRelatedModuleName();var d=new Vtiger_RelatedList_Js(b.getRecordId(),app.getModuleName(),c,e);d.previousPageHandler()});a.on("click","#relatedListPageJump",function(f){var c=b.getSelectedTab();var g=b.getRelatedModuleName();var d=new Vtiger_RelatedList_Js(b.getRecordId(),app.getModuleName(),c,g);d.getRelatedPageCount()});a.on("click","#relatedListPageJumpDropDown > li",function(c){c.stopImmediatePropagation()}).on("keypress","#pageToJump",function(f){var c=b.getSelectedTab();var g=b.getRelatedModuleName();var d=new Vtiger_RelatedList_Js(b.getRecordId(),app.getModuleName(),c,g);d.pageJumpHandler(f)})},registerEventForRelatedList:function(){var b=this;var a=this.getContentHolder();a.on("click",".relatedListHeaderValues",function(g){var d=jQuery(g.currentTarget);var c=b.getSelectedTab();var h=b.getRelatedModuleName();var f=new Vtiger_RelatedList_Js(b.getRecordId(),app.getModuleName(),c,h);f.sortHandler(d)});a.on("click","button.selectRelation",function(g){var c=b.getSelectedTab();var i=b.getRelatedModuleName();if(i==undefined){i=jQuery(g.currentTarget).data("modulename")}var d=jQuery(g.currentTarget).data("rf");var h={};if(d&&Object.keys(d).length>0){h={search_key:d.key,search_value:d.name}}var f=new Vtiger_RelatedList_Js(b.getRecordId(),app.getModuleName(),c,i);f.showSelectRelationPopup(h).then(function(j){var e=jQuery(j).find('[name="emailEnabledModules"]').val();if(e){b.registerEventToEditRelatedStatus()}})});a.on("click","a.relationDelete",function(h){h.stopImmediatePropagation();var f=jQuery(h.currentTarget);var c=Vtiger_Detail_Js.getInstance();var d=c.getDeleteMessageKey();var g=app.vtranslate(d);Vtiger_Helper_Js.showConfirmationBox({message:g}).then(function(m){var o=f.closest("tr");var k=o.data("id");var i=f.closest(".widget_contents");var j=b.getSelectedTab();var n=b.getRelatedModuleName();if(n==undefined){n=i.find(".relatedModuleName").val()}var l=new Vtiger_RelatedList_Js(b.getRecordId(),app.getModuleName(),j,n);l.deleteRelation([k]).then(function(e){l.loadRelatedList()})},function(e,i){})})},registerBlockAnimationEvent:function(){var a=this.getContentHolder();a.on("click",".blockHeader",function(h){var c=jQuery(h.currentTarget).find(".blockToggle").not(".hide");var f=c.data("id");var i=c.closest(".detailview-table");var b=i.find("tbody");var g=c.data();var d=app.getModuleName();var j=function(){b.addClass("hide");app.cacheSet(d+"."+f,0)};var k=function(){b.removeClass("hide");app.cacheSet(d+"."+f,1)};var g=c.data();if(g.mode=="show"){j();c.addClass("hide");i.find('[data-mode="hide"]').removeClass("hide")}else{k();c.addClass("hide");i.find("[data-mode='show']").removeClass("hide")}})},registerBlockStatusCheckOnLoad:function(){var b=this.getContentHolder().find(".detailview-table");var a=app.getModuleName();b.each(function(d,j){var g=jQuery(j);var f=g.find(".blockToggle").not(".hide");var i=g.find("tbody");var c=f.data("id");var h=a+"."+c;var e=app.cacheGet(h,null);if(e!=null){if(e==1){f.addClass("hide");g.find("[data-mode='show']").removeClass("hide");i.removeClass("hide")}else{f.addClass("hide");g.find("[data-mode='hide']").removeClass("hide");i.addClass("hide")}}})},registerEventForAddingRelatedRecord:function(){var b=this;var a=this.getContentHolder();a.on("click",'[name="addButton"]',function(g){var d=jQuery(g.currentTarget);var c=b.getSelectedTab();var h=b.getRelatedModuleName();if(d.hasClass("quickCreateSupported")!=true){window.location.href=d.data("url");return}var f=new Vtiger_RelatedList_Js(b.getRecordId(),app.getModuleName(),c,h);f.addRelatedRecord(d)})},ajaxEditHandling:function(d){var c=this;var b=jQuery(".value",d);var f=jQuery(".edit",d);var e=jQuery(".summaryViewEdit",d);var a=jQuery(".fieldname",f);jQuery(a).each(function(l,k){var n=jQuery(k).val();var j=jQuery(k);var g=jQuery('[name="'+n+'"]',f);if(g.attr("disabled")=="disabled"){return}if(f.length<=0){return}if(f.is(":visible")){return}g.inputmask();var i=false;if(g.inputmask("hasMaskedValue")){i=true}b.addClass("hide");e.addClass("hide");f.removeClass("hide").children().filter('input[type!="hidden"]input[type!="image"],select').filter(":first").focus();var o=false;var m=false;var h=function(w){var v=jQuery(w.target);if((v.closest("td").is(d))){return}g.inputmask("remove");d.removeAttr("tabindex");var u=j.data("prevValue");var y=c.getForm();var t=y.serializeFormData();var z=t[n];var s=z;var q=Vtiger_Field_Js.getInstance(g.data("fieldinfo"));if(g.is("input:checkbox")){if(g.is(":checked")){z="1"}else{z="0"}g=g.filter('[type="checkbox"]')}var x=g.validationEngine("validate");if(x){if(i){g.inputmask()}return}g.validationEngine("hide");if(u==z){f.addClass("hide");b.removeClass("hide");e.removeClass("hide");jQuery(document).off("click","*",h)}else{var p=jQuery.Event(c.fieldPreSave);g.trigger(p,{fieldValue:s,recordId:c.getRecordId()});if(p.isDefaultPrevented()){o=false;m=true;return}m=false;jQuery(document).off("click","*",h);if(!o&&!m){o=true;if(Vtiger_Detail_Js.SaveResultInstance==false){Vtiger_Detail_Js.SaveResultInstance=new SaveResult()}t.record=c.getRecordId();t.module=app.getModuleName();t.view="quick_edit";if(Vtiger_Detail_Js.SaveResultInstance.checkData(t)==false){f.addClass("hide");b.removeClass("hide");e.removeClass("hide");jQuery(document).off("click","*",h);return}}else{return}d.progressIndicator();f.addClass("hide");var A={};if(q.getType()=="multipicklist"||q.getType()=="sharedOwner"){var r=n.split("[]");n=r[0]}A.value=s;A.field=n;A=c.getCustomFieldNameValueMap(A);c.saveFieldValues(A).then(function(B){var E=B.result;d.progressIndicator({mode:"hide"});b.removeClass("hide");e.removeClass("hide");b.html(E[n].display_value);g.trigger(c.fieldUpdatedEvent,{old:u,"new":s});j.data("prevValue",z);g.data("selectedValue",z);if(c.targetPicklistChange){if(jQuery(".summaryView",c.getForm()).length>0){c.targetPicklist.find(".summaryViewEdit").trigger("click")}else{c.targetPicklist.trigger("click")}c.targetPicklistChange=false;c.targetPicklist=false}var D=c.getSelectedTab();if(D.data("linkKey")==c.detailViewSummaryTabLabel){var C=c.getContentHolder();jQuery(".detailViewInfo .related li.active").trigger("click");c.registerSummaryViewContainerEvents(C);c.registerEventForPicklistDependencySetup(c.getForm())}else{if(D.data("linkKey")==c.detailViewDetailsTabLabel){c.registerEventForPicklistDependencySetup(c.getForm())}}},function(B){d.progressIndicator({mode:"hide"})})}};jQuery(document).on("click","*",h)})},triggerDisplayTypeEvent:function(){var a=app.cacheGet("widthType","narrowWidthType");if(a){var b=jQuery("#detailView").find("td");b.addClass(a)}},addElementsToQuickCreateForCreatingRelation:function(a,b){jQuery('<input type="hidden" name="relationOperation" value="true" >').appendTo(a);jQuery.each(b,function(c,d){jQuery('<input type="hidden" name="'+c+'" value="'+d+'" >').appendTo(a)})},registerEventForActivityWidget:function(){var a=this;jQuery(".createActivity").on("click",function(j){var b="Calendar";var f=a.getRecordId();var c=app.getModuleName();var h=jQuery(j.currentTarget);var d={};d.sourceModule=c;d.sourceRecord=f;if(c!=""&&b!=""&&typeof a.referenceFieldNames[b]!="undefined"&&typeof a.referenceFieldNames[b][c]!="undefined"){var l=a.referenceFieldNames[b][c];d[l]=f}var k=h.data("url");var m=function(q){a.addElementsToQuickCreateForCreatingRelation(q,d);var o=q.find('[class^="CalendarQuikcCreateContents"]').find("#goToFullForm");var p=q.find('[class^="EventsQuikcCreateContents"]').find("#goToFullForm");var e=o.data("edit-view-url")+"&"+k;var n=p.data("edit-view-url")+"&"+k;o.data("editViewUrl",e);p.data("editViewUrl",n)};var i=function(){var o=h.closest(".summaryWidgetContainer");var e=o.find(".widgetContentBlock");var n=e.data("url");var p={type:"GET",dataType:"html",data:n};AppConnector.request(p).then(function(r){var q=o.find(".widget_contents");q.html(r);app.changeSelectElementView(q);a.registerEventForActivityWidget()});a.loadWidgets()};var g={};g.callbackPostShown=m;g.callbackFunction=i;g.data=d;g.noCache=false;Vtiger_Header_Js.getInstance().quickCreateModule(b,g)})},getEndDate:function(a){var d=a.split("-");var c=new Date(d[0],d[1],d[2]);var b=new Date();b.setDate(c.getDate()+2);return app.getStringDate(b)},getSingleEventType:function(e,b,g){var f=jQuery('[name="date_start"]');var c=jQuery(f).val();var h=jQuery(f).data("date-format");var j=Vtiger_Helper_Js.convertToDateString(c,h,e,g);var a=jQuery.extend({},["#b6a996,black"]);var i=this;var d={module:"Calendar",action:"Feed",start:j,end:this.getEndDate(j),type:g,mapping:a};AppConnector.request(d).then(function(m){var k=Vtiger_Helper_Js.convertToDateString(c,h,e);if(!jQuery.isEmptyObject(m)){if(m[0]["activitytype"]==="Task"){for(var n in m){if(m[n]["start"].indexOf(k)>-1){jQuery("#"+b+" .table").append('<tr><td><a target="_blank" href="'+m[n]["url"]+'">'+m[n]["title"]+"</a></td></tr>")}}}else{for(var l=0;l<m[0].length;l++){if(m[0][l]["start"].indexOf(k)>-1){jQuery("#"+b+" .table").append('<tr><td><a target="_blank" href="'+m[0][l]["url"]+'">'+m[0][l]["title"]+"</a></td></tr>")}}}}})},registerFilterForAddingModuleRelatedRecordFromSummaryWidget:function(){var a=this;jQuery(".createRecordFromFilter").on("click",function(o){var m=jQuery(o.currentTarget);var n=m.closest(".summaryWidgetContainer");var g=n.find(".widget_contents");var h=g.find('[name="relatedModule"]').val();var q=m.data("url");var k=a.getRecordId();var i={};var f=m.data("prf");var l=m.data("acf");var c=m.closest(".widget_header").find('[name="relatedModule"]').val();var j={};var d=function(e){a.postSummaryWidgetAddRecord(e,m);if(h=="ProjectTask"){a.loadModuleSummary()}};if(typeof f!="undefined"){j[f]=k}if(typeof l!="undefined"){$.each(l,function(e,r){j[e]=r})}if(Object.keys(j).length>0){i.data=j}i.noCache=true;i.callbackFunction=d;var b=jQuery.progressIndicator();var p=new Vtiger_Header_Js();p.getQuickCreateForm(q,c,i).then(function(e){p.handleQuickCreateData(e,i);b.progressIndicator({mode:"hide"})})})},registerChangeFilterForWidget:function(){var a=this;jQuery(".widget_header .filterField").on("change",function(m){var n=this.name;var j={};var i={};var k=jQuery(m.currentTarget);var l=k.closest(".summaryWidgetContainer");var b=l.find(".widget_contents");b.progressIndicator();var f=b.find('[name="relatedModule"]').val();var h=a.getRecordId();var d=app.getModuleName();var o=k.find("option:selected").val();var c=k.data("fieldlable");var g=l.find('[name="filter_data"]').val();if(o!=c){j[g]=o;i.whereCondition=j}i.record=h;i.view="Detail";i.module=d;i.page=b.find('[name="page"]').val();i.limit=b.find('[name="pageLimit"]').val();i.col=b.find('[name="col"]').val();i.relatedModule=f;i.mode="showRelatedRecords";AppConnector.request(i).then(function(e){b.html(e);currentDiv.progressIndicator({mode:"hide"})})})},registerChangeSwitchForWidget:function(){var a=this;$(".summaryWidgetContainer .widget_header .switchBtnReload").on("switchChange.bootstrapSwitch",function(j,c){var h=jQuery(j.currentTarget);var i=h.closest(".summaryWidgetContainer");var g=i.find(".widgetContentBlock");var d=g.data("url");var f=h.data("urlparams");if(f!=""){var l=h.data("on-val");var k=h.data("off-val");d=d.replace("&"+f+"="+l,"");d=d.replace("&"+f+"="+k,"");if(c){var b=l}else{var b=k}if(b!=""){d+="&"+f+"="+b}g.data("url",d);a.loadWidget($(g))}});$(".activityWidgetContainer .switchBtn").on("switchChange.bootstrapSwitch",function(h,g){var d=jQuery(h.currentTarget);var b=d.closest(".summaryWidgetContainer");var f=b.find(".widgetContentBlock");var c=f.data("url");c=c.replace("&type=current","");c+="&type=";if(g){c+="current"}else{c+="history"}f.data("url",c);a.loadWidget($(f))});$(".calculationsWidgetContainer .calculationsSwitch").on("switchChange.bootstrapSwitch",function(h,g){var d=jQuery(h.currentTarget);var b=d.closest(".summaryWidgetContainer");var f=b.find(".widgetContentBlock");var c=f.data("url");c=c.replace("&showtype=open","");c=c.replace("&showtype=archive","");c+="&showtype=";if(g){c+="open"}else{c+="archive"}f.data("url",c);a.loadWidget($(f))});$(".potentialsWidgetContainer .potentialsSwitch").on("switchChange.bootstrapSwitch",function(h,g){var d=jQuery(h.currentTarget);var b=d.closest(".summaryWidgetContainer");var f=b.find(".widgetContentBlock");var c=f.data("url");c=c.replace("&showtype=open","");c=c.replace("&showtype=archive","");c+="&showtype=";if(g){c+="open"}else{c+="archive"}f.data("url",c);a.loadWidget($(f))})},registerSummaryViewContainerEvents:function(d){var b=this;this.registerEventForActivityWidget();this.registerChangeFilterForWidget();this.registerChangeSwitchForWidget();this.registerFilterForAddingModuleRelatedRecordFromSummaryWidget();if(Vtiger_Detail_Js.SaveResultInstance==false){Vtiger_Detail_Js.SaveResultInstance=new SaveResult()}var a=b.getForm();var c=a.serializeFormData();d.on("click",".row .summaryViewEdit",function(h){var g=jQuery(h.currentTarget);g.addClass("hide");var f=g.closest("td.fieldValue");b.ajaxEditHandling(f);Vtiger_Detail_Js.SaveResultInstance.loadFormData(c)});Vtiger_Detail_Js.SaveResultInstance.loadFormData(c);d.on(b.fieldUpdatedEvent,".recordDetails",function(g,h){var f=d.find("[data-name='LBL_UPDATES']");b.loadWidget(f)});d.on("click",".editDefaultStatus",function(m){var l=jQuery(m.currentTarget);l.popover("hide");var h=l.closest(".activityStatus");var k=l.closest(".activityEntries");var f=k.find(".activityId").val();var j=h.find(".edit");var i=jQuery('[name="'+l.data("field")+'"]',j);var g=h.find(".editStatus");if(b.tempData.indexOf(f)<0){b.tempData.push(f);g.trigger("click");i.val(l.data("status")).trigger("chosen:updated");g.trigger("clickoutside")}});d.on("click",".editStatus",function(k){var j=jQuery(k.currentTarget);var g=j.closest(".activityStatus");var h=g.find(".edit");var i=g.find(".value");j.hide();i.addClass("hide");h.removeClass("hide").show();var f=function(){var t=jQuery(".fieldname",h);var w=t.val();var m=jQuery('[name="'+w+'"]',h);var o=t.data("prevValue");var u=m.find("option:selected").val();var s=m.find("option:selected").text();var n=g.closest(".activityEntries");var l=n.find(".activityId").val();var e=n.find(".activityModule").val();var v=n.find(".activityType").val();if(Vtiger_Detail_Js.SaveResultInstance==false){Vtiger_Detail_Js.SaveResultInstance=new SaveResult()}var q={};q.record=l;q.module=e;q.view="quick_edit";q[w]=u;q["p_"+w]=o;if(Vtiger_Detail_Js.SaveResultInstance.checkData(q)==false){return}if(o==u){h.addClass("hide");i.removeClass("hide");j.show()}else{var r=m.validationEngine("validate");if(r){Vtiger_Helper_Js.addClickOutSideEvent(g,f);return}h.addClass("hide");var p={action:"SaveAjax",record:l,field:w,value:u,module:e,activitytype:v};AppConnector.request(p).then(function(z){i.removeClass("hide");j.show();i.html(s);t.data("prevValue",u);if("Held"==u||"Completed"==u){var A=j.closest(".activityEntries");A.find("popoverTooltip").popover("hide");var y=j.closest(".widgetContentBlock");var x=jQuery(y);b.loadWidget(x)}})}};Vtiger_Helper_Js.addClickOutSideEvent(g,f)});d.on("click",".editDescription",function(k){var j=jQuery(k.currentTarget);var g=j.closest(".activityDescription");var h=g.find(".edit");var i=g.find(".value");j.hide();i.addClass("hide");h.removeClass("hide").show();var f=function(){var t=jQuery(".fieldname",h);var w=t.val();var m=jQuery('[name="'+w+'"]',h);var o=t.data("prevValue");var u=m.val();var s=m.val();var n=g.closest(".activityEntries");var l=n.find(".activityId").val();var e=n.find(".activityModule").val();var v=n.find(".activityType").val();if(Vtiger_Detail_Js.SaveResultInstance==false){Vtiger_Detail_Js.SaveResultInstance=new SaveResult()}var q={};q.record=l;q.module=e;q.view="quick_edit";q[w]=u;q["p_"+w]=o;if(Vtiger_Detail_Js.SaveResultInstance.checkData(q)==false){return}if(o==u){h.addClass("hide");i.removeClass("hide");j.show()}else{var r=m.validationEngine("validate");if(r){Vtiger_Helper_Js.addClickOutSideEvent(g,f);return}g.progressIndicator();h.addClass("hide");var p={action:"SaveAjax",record:l,field:w,value:u,module:e,activitytype:v};AppConnector.request(p).then(function(x){g.progressIndicator({mode:"hide"});i.removeClass("hide");j.show();i.html(s);t.data("prevValue",u)})}};Vtiger_Helper_Js.addClickOutSideEvent(g,f)});jQuery(".changeDetailViewMode").on("click",function(g){var f=jQuery(".detailViewContainer");f.find('.nav li[data-link-key="LBL_RECORD_DETAILS"]').trigger("click")});jQuery(".createRecord").on("click",function(p){var n=jQuery(p.currentTarget);var o=n.closest(".summaryWidgetContainer");var l=o.find(".widget_header");var g=l.find('[name="relatedModule"]').val();var k=b.getRecordId();var h=app.getModuleName();var j={};j.sourceModule=h;j.sourceRecord=k;if(h!=""&&g!=""&&typeof b.referenceFieldNames[g]!="undefined"&&typeof b.referenceFieldNames[g][h]!="undefined"){var q=b.referenceFieldNames[g][h];j[q]=k}var f=function(e){b.postSummaryWidgetAddRecord(e,n)};var i=function(e){b.addElementsToQuickCreateForCreatingRelation(e,j)};var m={};m.callbackFunction=f;m.goToFullFormcallback=i;m.data=j;m.noCache=false;Vtiger_Header_Js.getInstance().quickCreateModule(g,m)});this.registerFastEditingFiels()},addRelationBetweenRecords:function(e,a){var b=jQuery.Deferred();var d=this;var c=d.getSelectedTab();var f=new Vtiger_RelatedList_Js(d.getRecordId(),app.getModuleName(),c,e);f.addRelations(a).then(function(h){var i=d.getContentHolder();var g=i.find("[data-name='LBL_UPDATES']");if(g.length>0){d.loadWidget(g)}b.resolve(h)},function(h,g){b.reject(h,g)});return b.promise()},postSummaryWidgetAddRecord:function(f,h){var i=h.closest(".summaryWidgetContainer");var e=i.find(".widget_header");var a=i.find(".widget_contents");var b=e.find('[name="relatedModule"]').val();var d=this.getRecordId();var c=app.getModuleName();var g=new Array();g.push(f.result._recordId);a.progressIndicator({});this.addRelationBetweenRecords(b,g).then(function(j){var k={};k.record=d;k.view="Detail";k.module=c;k.page=a.find('[name="page"]').val();k.limit=a.find('[name="pageLimit"]').val();k.col=a.find('[name="col"]').val();k.relatedModule=b;k.mode="showRelatedRecords";AppConnector.request(k).then(function(m){var l=jQuery("#relatedDocuments");a.progressIndicator({mode:"hide"});a.html(m);app.changeSelectElementView(l)})})},registerEventForEmailsRelatedRecord:function(){var a=this.getContentHolder();var c=a.find('[name="emailsRelatedRecord"]');var d=this.getRecordId();var b=Vtiger_Popup_Js.getInstance();a.on("click",'[name="emailsRelatedRecord"]',function(h){var g=jQuery(h.currentTarget);var f=g.data("id");var i={};i.module="Emails";i.view="ComposeEmail";i.mode="emailPreview";i.record=f;i.parentId=d;i.relatedLoad=true;b.show(i)});a.on("click",'[name="emailsEditView"]',function(g){g.stopPropagation();var f="Emails";Vtiger_Helper_Js.checkServerConfig(f).then(function(k){if(k==true){var i=jQuery(g.currentTarget);var e=i.closest("tr");var h=e.data("id");var j=new Array();j.push(d);var l={};l.module="Emails";l.view="ComposeEmail";l.mode="emailEdit";l.record=h;l.selected_ids=j;l.parentId=d;l.relatedLoad=true;b.show(l)}else{Vtiger_Helper_Js.showPnotify(app.vtranslate("JS_EMAIL_SERVER_CONFIGURATION"))}})})},registerEventForAddingEmailFromRelatedList:function(){var a=this.getContentHolder();var b=this.getRecordId();a.on("click",'[name="composeEmail"]',function(f){f.stopPropagation();var c=jQuery(f.currentTarget);var d=new Array();var g={};d.push(b);g.module=app.getModuleName();g.view="MassActionAjax";g.selected_ids=d;g.mode="showComposeEmailForm";g.step="step1";g.relatedLoad=true;Vtiger_Index_Js.showComposeEmailPopup(g)})},registerEnterClickEventForTagRecord:function(){jQuery("#tagRecordText").keypress(function(a){if(a.which==13){jQuery("#tagRecord").trigger("click")}})},checkTagExists:function(e){var b=e.split(" ");for(var d=0;d<b.length;d++){var a=jQuery("#tagsList").find("[data-tagname='"+b[d]+"']");if(a.length>0){b.splice(d,1);d--}}var c=b.join(" ");if(c==""){return true}else{return c}},addTagsToList:function(d){for(var b in d.result[1]){var c=d.result[1][b];var a=jQuery("#tagsList").find("[data-tagid='"+c+"']");if(a.length==0){jQuery("#tagsList").prepend('<div class="tag btn-info btn-xs pull-right" data-tagname="'+b+'" data-tagid="'+c+'"><span class="tagName textOverflowEllipsis"><a class="cursorPointer">'+b+'</a></span><span id="deleteTag" class="glyphicon glyphicon-remove cursorPointer deleteTag" aria-hidden="true"></span></div>')}}},checkTagMaxLengthExceeds:function(d){var a=d.split(" ");var c=jQuery("#maxTagLength").val();for(var b=0;b<a.length;b++){if(a[b].length>parseInt(c)){return true}}return false},registerClickEventForAddingTagRecord:function(){var a=this;jQuery("#tagRecord").on("click",function(){var d=jQuery("#tagRecordText");var h=d.val();tagTextSplit=h.split(" ");if((tagTextSplit.length+$("#tagsList").children().length)>$("#maxTag").val()){var c=jQuery("#maxTag").val();d.validationEngine("showPrompt",app.vtranslate("JS_MAX_TAG_EXCEEDS")+" "+c,"error","bottomLeft",true);return}if(h==""){d.validationEngine("showPrompt",app.vtranslate("JS_PLEASE_ENTER_A_TAG"),"error","bottomLeft",true);return}var e=a.checkTagMaxLengthExceeds(h);if(e==true){var b=jQuery("#maxTagLength").val();d.validationEngine("showPrompt",app.vtranslate("JS_MAX_TAG_LENGTH_EXCEEDS")+" "+b,"error","bottomLeft",true);return}var g=a.checkTagExists(h);if(g==true){d.validationEngine("showPrompt",app.vtranslate("JS_TAG_NAME_ALREADY_EXIST"),"error","bottomLeft",true);return}else{h=g}var f={module:app.getModuleName(),action:"TagCloud",mode:"save",tagname:h,record:a.getRecordId()};AppConnector.request(f).then(function(i){a.addTagsToList(i);d.val("")})})},registerRemovePromptEventForTagCloud:function(a){jQuery("#tagRecordText").on("focus",function(c){var b=jQuery(".formError",a);if(b.length>0){b.remove()}})},registerDeleteEventForTag:function(b){var a=this;jQuery(b).on("click",".deleteTag",function(f){var c=jQuery(f.currentTarget).closest(".tag");var d=c.data("tagid");c.fadeOut("slow",function(){c.remove()});var g={module:app.getModuleName(),action:"TagCloud",mode:"delete",tag_id:d,record:a.getRecordId()};AppConnector.request(g).then(function(e){})})},registerTagClickEvent:function(b){var a=this;jQuery(b).on("click",".tagName",function(f){var c=jQuery(f.currentTarget);var d=c.closest(".tag").data("tagid");var g={module:app.getModuleName(),view:"TagCloudSearchAjax",tag_id:d,tag_name:c.find("a").text()};AppConnector.request(g).then(function(e){var h={data:e};app.showModalWindow(h);a.registerChangeEventForModulesList()})})},registerChangeEventForModulesList:function(){jQuery("#tagSearchModulesList").on("change",function(c){var a=jQuery(c.currentTarget);if(a.val()=="all"){jQuery('[name="tagSearchModuleResults"]').removeClass("hide")}else{jQuery('[name="tagSearchModuleResults"]').removeClass("hide");var b=a.val();jQuery('[name="tagSearchModuleResults"]').filter(":not(#"+b+")").addClass("hide")}})},registerPostTagCloudWidgetLoad:function(){var a=this;app.getContentsContainer().on("Vtiger.Widget.Load.LBL_TAG_CLOUD",function(c,b){a.registerClickEventForAddingTagRecord();a.registerEnterClickEventForTagRecord();a.registerDeleteEventForTag(b);a.registerRemovePromptEventForTagCloud(b);a.registerTagClickEvent(b)})},registerGetAllTagCloudWidgetLoad:function(){var a=this;var b={module:app.getModuleName(),mode:"showTags",source_module:app.getModuleName(),record:this.getRecordId(),view:"ShowTagCloudTop"};AppConnector.request(b).then(function(c){if(c.length>0){c=$(c);$(".detailViewTitle .detailViewToolbar").append(c);a.registerDeleteEventForTag(c);a.registerRemovePromptEventForTagCloud(c);a.registerTagClickEvent(c);a.registerClickEventForAddingTagRecord();a.registerEnterClickEventForTagRecord()}})},registerEventForRelatedTabClick:function(){var c=this;var b=c.getContentHolder();var a=b.closest("div.detailViewInfo");jQuery(".related",a).on("click","li",function(j,i){var g=jQuery(j.currentTarget);var f=jQuery("<div></div>");f.progressIndicator({position:"html",blockInfo:{enabled:true,elementToBlock:a}});var d=g.data("url");if(typeof i!="undefined"){var h=i.callback;delete i.callback}c.loadContents(d,i).then(function(e){c.deSelectAllrelatedTabs();c.markTabAsSelected(g);app.registerEventForDatePickerFields(b);app.registerEventForTimeFields(b);app.showBtnSwitch(b.find(".switchBtn"));Vtiger_Helper_Js.showHorizontalTopScrollBar();f.progressIndicator({mode:"hide"});c.registerHelpInfo();if(typeof h=="function"){h(e)}if(g.data("linkKey")==c.detailViewSummaryTabLabel){c.loadWidgets();c.registerSummaryViewContainerEvents(b);c.registerEventForPicklistDependencySetup(c.getForm())}else{if(g.data("linkKey")==c.detailViewDetailsTabLabel){c.registerEventForPicklistDependencySetup(c.getForm())}}app.notifyPostAjaxReady()},function(){f.progressIndicator({mode:"hide"})})})},registerEventForPicklistDependencySetup:function(a){var e=this;var c=jQuery('[name="picklistDependency"]',a);if(c.length<=0){return}var d=JSON.parse(c.val());var f=Object.keys(d);if(f.length<=0){return}var h=[];for(var b=0;b<f.length;b++){h.push('[name="'+f[b]+'"]')}h=h.join(",");var g=a.find(h);g.on("change",function(o){var m=jQuery(o.currentTarget);var l=m.attr("name");var k=d[l];var n=m.val();var j=k[n];var i=k.__DEFAULT__;if(typeof j=="undefined"){j=i}jQuery.each(i,function(w,y){var q=j[w];if(typeof q=="undefined"){q=y}var x=jQuery('[name="'+w+'"]',a);if(x.length<=0){return}var v=x.data("selectedValue");if(jQuery.inArray(v,q)==-1){e.targetPicklistChange=true;e.targetPicklist=x.closest("td")}else{e.targetPicklistChange=false;e.targetPicklist=false}var p=x.data("availableOptions");if(typeof p=="undefined"){p=jQuery("option",x);x.data("available-options",p)}var t=new jQuery();var r=[];r.push("");for(var u=0;u<q.length;u++){r.push(q[u])}jQuery.each(p,function(z,B){var A=jQuery(B).val();if(jQuery.inArray(A,r)!=-1){t=t.add(jQuery(B))}});var s="";s=t.filter("[selected]").val();if(q.length==1){s=q[0]}x.html(t).val(s).trigger("chosen:updated")})});g.trigger("change")},getChildComments:function(d){var b=jQuery.Deferred();var c="module="+app.getModuleName()+"&view=Detail&record="+this.getRecordId()+"&mode=showChildComments&commentid="+d;var a=this.getCommentThread(c);a.then(function(e){b.resolve(e)});return b.promise()},registerEventForTotalRecordsCount:function(){var b=this;var a=this.getContentHolder();a.on("click",".totalNumberOfRecords",function(g){var d=jQuery(g.currentTarget);var i=jQuery("#totalCount").val();d.addClass("hide");d.parent().progressIndicator({});if(i==""){var c=b.getSelectedTab();var h=b.getRelatedModuleName();var f=new Vtiger_RelatedList_Js(b.getRecordId(),app.getModuleName(),c,h);f.getRelatedPageCount().then(function(){b.showPagingInfo()})}else{b.showPagingInfo()}d.parent().progressIndicator({mode:"hide"})})},registerEventForActivityFollowupClickEvent:function(){var b=this;var a=this.getContentHolder();a.on("click",".holdFollowupOn",function(f){f.stopPropagation();var c=b.getSelectedTab();var g=b.getRelatedModuleName();var d=new Vtiger_RelatedList_Js(b.getRecordId(),app.getModuleName(),c,g);d.addFollowupEvent(f)})},registerEventForMarkAsCompletedClick:function(){var b=this;var a=this.getContentHolder();a.on("click",".markAsHeld",function(f){f.stopPropagation();var c=b.getSelectedTab();var g=b.getRelatedModuleName();var d=new Vtiger_RelatedList_Js(b.getRecordId(),app.getModuleName(),c,g);d.markAsCompleted(f)})},showPagingInfo:function(){var c=jQuery("#totalCount").val();var e=jQuery(".pageNumbersText");var d=e.text();var b=d+" ("+c+")";var a=parseInt(jQuery("#noOfEntries").val());if(a!=0){jQuery(".pageNumbersText").html(b)}else{jQuery(".pageNumbersText").html("")}},getCustomFieldNameValueMap:function(a){return a},registerSetReadRecord:function(a){var b=this;a.on("click",".setReadRecord",function(d){var c=jQuery(d.currentTarget);c.hide();jQuery("#Accounts_detailView_fieldValue_was_read").find(".value").text(app.vtranslate("LBL_YES"));var f={module:app.getModuleName(),action:"SaveAjax",record:b.getRecordId(),field:"was_read",value:"on",};AppConnector.request(f).then(function(e){var g={text:app.vtranslate("JS_SET_READ_RECORD"),title:app.vtranslate("System"),type:"info",animation:"show"};Vtiger_Helper_Js.showPnotify(g)})})},registerFastEditingFiels:function(){var a=this;var b=jQuery(".summaryWidgetFastEditing select");b.on("change",function(l){var f=jQuery(l.currentTarget);var j=f.closest(".editField");var i=jQuery.progressIndicator({message:app.vtranslate("JS_SAVE_LOADER_INFO"),position:"summaryWidgetFastEditing",blockInfo:{enabled:true}});var o=j.data("fieldname");o=o.replace("q_","");var k=j.data("prevvalue");var d=f.val();var m=f.validationEngine("validate");if(m){j.progressIndicator({mode:"hide"});return}var c=jQuery.Event(a.fieldPreSave);f.trigger(c,{fieldValue:d,recordId:a.getRecordId()});if(Vtiger_Detail_Js.SaveResultInstance==false){Vtiger_Detail_Js.SaveResultInstance=new SaveResult()}var g={};g.record=a.getRecordId();g.module=app.getModuleName();g.view="quick_edit";g[o]=d;g["p_"+o]=k;if(Vtiger_Detail_Js.SaveResultInstance.checkData(g)==false){i.progressIndicator({mode:"hide"});jQuery(".detailViewInfo .related li.active").trigger("click");return}var n={};n.value=d;n.field=o;n=a.getCustomFieldNameValueMap(n);a.saveFieldValues(n);i.progressIndicator({mode:"hide"});var h={title:app.vtranslate("JS_SAVE_NOTIFY_OK"),type:"success",animation:"show"};Vtiger_Helper_Js.showPnotify(h);jQuery(".detailViewInfo .related li.active").trigger("click")})},registerHelpInfo:function(){var a=this.getForm();app.showPopoverElementView(a.find(".HelpInfoPopover"))},registerRelatedModulesRecordCount:function(){var a=new Vtiger_Detail_Js();$(".related .nav li").each(function(d,b){if($(b).hasClass("relatedNav")&&$(b).data("count")=="1"){var c={module:app.getModuleName(),action:"RelationAjax",record:a.getRecordId(),relatedModule:$(b).data("reference"),mode:"getRelatedListPageCount",tab_label:$(b).data("label-key"),};AppConnector.request(c).then(function(e){if(e.success){$(b).find(".count").text("("+e.result.numberOfRecords+")")}})}})},registerEvents:function(){var c=this;this.registerHelpInfo();c.registerSendSmsSubmitEvent();c.registerAjaxEditEvent();this.registerRelatedRowClickEvent();this.registerBlockAnimationEvent();this.registerBlockStatusCheckOnLoad();this.registerEmailFieldClickEvent();this.registerPhoneFieldClickEvent();this.registerEventForActivityFollowupClickEvent();this.registerEventForMarkAsCompletedClick();this.registerEventForRelatedList();this.registerEventForRelatedListPagination();this.registerEventForAddingRelatedRecord();this.registerEventForEmailsRelatedRecord();this.registerEventForAddingEmailFromRelatedList();this.registerPostTagCloudWidgetLoad();this.registerEventForRelatedTabClick();Vtiger_Helper_Js.showHorizontalTopScrollBar();this.registerUrlFieldClickEvent();var a=jQuery("div.detailViewContainer");if(a.length<=0){return}var b=c.getContentHolder();app.registerEventForDatePickerFields(b);app.registerEventForTimeFields(b);this.registerSetReadRecord(a);this.registerSummaryViewContainerEvents(b);c.registerEventForPicklistDependencySetup(c.getForm());b.on("click","#detailViewNextRecordButton",function(i){var g=c.getSelectedTab();var f=g.data("url");var h=c.getRelatedListCurrentPageNum();var k=parseInt(h)+1;var j=f+"&page="+k;c.loadContents(j)});b.on("click","#detailViewPreviousRecordButton",function(i){var g=c.getSelectedTab();var f=g.data("url");var h=c.getRelatedListCurrentPageNum();var l=parseInt(h)-1;var k={};var j=f+"&page="+l;c.loadContents(j)});b.on("click","table.detailview-table td.fieldValue",function(g){if(jQuery(g.target).closest("a").hasClass("btnNoFastEdit")){return}var f=jQuery(g.currentTarget);c.ajaxEditHandling(f)});b.on("click","div.recordDetails span.squeezedWell",function(h){var g=jQuery(h.currentTarget);var f=g.data("reference");jQuery('.detailViewInfo .related li[data-reference="'+f+'"]').trigger("click")});b.on("click",".relatedPopup",function(g){var f=new Vtiger_Edit_Js();f.openPopUp(g);return false});b.on("click",".addCommentBtn",function(g){c.removeCommentBlockIfExists();var f=c.getCommentBlock();f.appendTo(".commentBlock")});b.on("click",".closeCommentBlock",function(h){var g=jQuery(h.currentTarget);var f=g.closest(".singleComment");f.find(".commentActionsContainer").show();f.find(".commentInfoContent").show();c.removeCommentBlockIfExists()});b.on("click",".replyComment",function(i){c.removeCommentBlockIfExists();var h=jQuery(i.currentTarget);var g=h.closest(".singleComment");var f=c.getCommentBlock();g.find(".commentActionsContainer").hide();f.appendTo(g).show();app.registerEventForTextAreaFields(jQuery(".commentcontent",g))});b.on("click",".editComment",function(k){c.removeCommentBlockIfExists();var j=jQuery(k.currentTarget);var g=j.closest(".singleComment");var i=g.find(".commentInfoContent");var h=g.find('[name="editReason"]');var f=c.getEditCommentBlock();f.find(".commentcontent").text(i.text());f.find('[name="reasonToEdit"]').val(h.text());i.hide();g.find(".commentActionsContainer").hide();f.appendTo(g).show();app.registerEventForTextAreaFields(jQuery(".commentcontent",g))});b.on("click",".deleteComment",function(m){c.removeCommentBlockIfExists();var l=jQuery(m.currentTarget);var j=l.closest(".singleComment");var i=j.find(".commentInfoHeader");var k="index.php?module=ModComments&action=DeleteAjax&record="+i.data("commentid");var h=l.closest(".commentDetails");var f=h.find(".commentDetails");var g=h.find(".viewThreadBlock");if(f.length>0||g.length>0){Vtiger_Helper_Js.showPnotify(app.vtranslate("JS_CAN_NOT_REMOVE_COMMENT"))}else{Vtiger_Helper_Js.showConfirmationBox({message:app.vtranslate("JS_DELETE_COMMENT_CONFIRMATION")}).then(function(e){AppConnector.request(k).then(function(n){if(n.success==true){h.fadeOut(400,function(){h.remove()})}else{Vtiger_Helper_Js.showPnotify(n.error.message)}})},function(e,n){})}});b.on("click",".viewThread",function(k){var j=jQuery(k.currentTarget);var i=j.parent();var f=j.closest(".commentActions");var g=j.closest(".commentDetails");var l=g.find("ul");if(l.length>0){l.show();f.find(".hideThreadBlock").show();i.hide();return}var h=j.closest(".commentDiv").find(".commentInfoHeader").data("commentid");c.getChildComments(h).then(function(e){jQuery(e).appendTo(jQuery(k.currentTarget).closest(".commentDetails"));f.find(".hideThreadBlock").show();i.hide()})});b.on("click",".hideThread",function(j){var i=jQuery(j.currentTarget);var h=i.parent();var f=i.closest(".commentActions");var g=i.closest(".commentDetails");g.find("ul").hide();h.hide();f.find(".viewThreadBlock").show()});b.on("click",".detailViewThread",function(i){var h=c.getTabByLabel(c.detailViewRecentCommentsTabLabel);var g=jQuery(i.currentTarget).closest(".singleComment").find(".commentInfoHeader").data("commentid");var f=function(e){window.location.href=window.location.href+"#"+g};h.trigger("click",{commentid:g,callback:f})});b.on("click",".detailViewSaveComment",function(h){var g=jQuery(h.currentTarget);if(!g.is(":disabled")){var f=c.saveComment(h);f.then(function(){var e=b.find("[data-name='ModComments']");c.loadWidget(e).then(function(){g.removeAttr("disabled")})})}});b.on("click",".saveComment",function(i){var g=jQuery(i.currentTarget);if(!g.is(":disabled")){var h=jQuery(i.currentTarget);var j=h.data("mode");var f=c.saveComment(i);f.then(function(n){var l=h.closest(".addCommentBlock");var k=l.find(".commentcontent");var r=h.closest(".singleComment");k.val("");if(j=="add"){var p=n.result["id"];var o=c.getCommentUI(p);o.then(function(v){var y=l.closest(".commentDetails");var u=c.getContentHolder();var x=jQuery(".noCommentsMsgContainer",u);x.remove();if(y.length>0){l.remove();var t=y.find("ul");if(t.length<=0){var w=r.find(".viewThreadBlock").data("childCommentsCount");var A=w+1;r.find(".childCommentsCount").text(A);var z=r.find(".commentInfoHeader").data("commentid");c.getChildComments(z).then(function(B){jQuery(B).appendTo(y);r.find(".viewThreadBlock").hide();r.find(".hideThreadBlock").show()})}else{jQuery('<ul class="liStyleNone"><li class="commentDetails">'+v+"</li></ul>").appendTo(y)}}else{jQuery('<ul class="liStyleNone"><li class="commentDetails">'+v+"</li></ul>").prependTo(l.closest(".commentContainer").find(".commentsList"));k.css({height:"71px"})}r.find(".commentActionsContainer").show()})}else{if(j=="edit"){var m=r.find(".commentModifiedTime");var q=r.find(".commentInfoContent");var e=r.find('[name="editStatus"]');var s=r.find('[name="editReason"]');q.html(n.result.commentcontent);s.html(n.result.reasontoedit);m.text(n.result.modifiedtime);m.attr("title",n.result.modifiedtimetitle);if(e.hasClass("hide")){e.removeClass("hide")}if(n.result.reasontoedit!=""){r.find(".editReason").removeClass("hide")}q.show();r.find(".commentActionsContainer").show();l.remove()}}g.removeAttr("disabled")})}});b.on("click",".moreRecentComments",function(){var e=c.getTabByLabel(c.detailViewRecentCommentsTabLabel);e.trigger("click")});b.on("click",".moreRecentRecords",function(h){h.preventDefault();var f=jQuery(h.currentTarget);var g=c.getTabByLabel(f.data("label-key"));g.trigger("click")});b.on("click",".moreRecentUpdates",function(){var h=jQuery("#updatesCurrentPage").val();var g=jQuery("#recordId").val();var e=parseInt(h)+1;var f="index.php?module="+app.getModuleName()+"&view=Detail&record="+g+"&mode=showRecentActivities&page="+e+"&tab_label=LBL_UPDATES";AppConnector.request(f).then(function(i){jQuery("#updatesCurrentPage").remove();jQuery("#moreLink").remove();jQuery("#updates").append(i)},function(i,j){})});b.on("click",".moreRecentDocuments",function(){var e=c.getTabByLabel(c.detailViewRecentDocumentsTabLabel);e.trigger("click")});b.on("click",".moreRecentActivities",function(){var e=c.getTabByLabel(c.detailViewRecentActivitiesTabLabel);e.trigger("click")});b.on("switchChange.bootstrapSwitch",".relatedContainer .switchBtn",function(i,h){var f=c.getTabByLabel(c.detailViewRecentActivitiesTabLabel);var g=f.data("url");g=g.replace("&time=current","");g=g.replace("&time=history","");g+="&time=";if(h){g+="current"}else{g+="history"}f.data("url",g);f.trigger("click")});c.getForm().validationEngine(app.validationEngineOptions);c.loadWidgets();app.registerEventForTextAreaFields(jQuery(".commentcontent"));this.registerEventForTotalRecordsCount();this.registerGetAllTagCloudWidgetLoad();this.registerRelatedModulesRecordCount();var d=Vtiger_Header_Js.getInstance();d.registerQuickCreateCallBack(this.registerRelatedModulesRecordCount)}});