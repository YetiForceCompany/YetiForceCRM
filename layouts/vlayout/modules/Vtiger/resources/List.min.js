
jQuery.Class("Vtiger_List_Js",{listInstance:false,getRelatedModulesContainer:false,massEditPreSave:"Vtiger.MassEdit.PreSave",getInstance:function(){if(Vtiger_List_Js.listInstance==false){var c=app.getModuleName();var e=app.getParentModuleName();if(e=="Settings"){var b=e+"_"+c+"_List_Js";if(typeof window[b]=="undefined"){b=c+"_List_Js"}var d=e+"_Vtiger_List_Js";if(typeof window[d]=="undefined"){d="Vtiger_List_Js"}}else{b=c+"_List_Js";d="Vtiger_List_Js"}if(typeof window[b]!="undefined"){var a=new window[b]()}else{var a=new window[d]()}Vtiger_List_Js.listInstance=a;return a}return Vtiger_List_Js.listInstance},triggerSendEmail:function(h,e,g){var a=Vtiger_List_Js.getInstance();var d=a.checkListRecordSelected();if(d!=true){var i=a.readSelectedIds(true);var j=a.readExcludedIds(true);var b=a.getCurrentCvId();var c=a.getDefaultParams();delete c.module;delete c.view;delete c.parent;c.selected_ids=i;c.excluded_ids=j;c.viewname=b;if(g){jQuery.extend(c,g)}var f={type:"POST",url:h,dataType:"html",data:c};Vtiger_Index_Js.showComposeEmailPopup(f)}else{a.noRecordSelectedAlert()}},triggerSendSms:function(e,b){var c=Vtiger_List_Js.getInstance();var a=c.checkListRecordSelected();if(a!=true){var d=jQuery.progressIndicator();Vtiger_Helper_Js.checkServerConfig(b).then(function(f){d.progressIndicator({mode:"hide"});if(f==true){Vtiger_List_Js.triggerMassAction(e)}else{alert(app.vtranslate("JS_SMS_SERVER_CONFIGURATION"))}})}else{c.noRecordSelectedAlert()}},triggerTransferOwnership:function(f){var d=this;var c=Vtiger_List_Js.getInstance();var a=c.checkListRecordSelected();if(a!=true){var e=jQuery.progressIndicator();d.getRelatedModulesContainer=false;var b={type:"POST",url:f,dataType:"html",data:{}};AppConnector.request(b).then(function(g){e.progressIndicator({mode:"hide"});if(g){var h=function(i){var j=app.validationEngineOptions;j.onValidationComplete=function(l,k){if(k){d.transferOwnershipSave(l)}return false};jQuery("#changeOwner").validationEngine(app.validationEngineOptions)};app.showModalWindow(g,function(j){var i=d.getRelatedModuleContainer();app.changeSelectElementView(i,"select2");if(typeof h=="function"){h(j)}})}})}else{c.noRecordSelectedAlert()}},triggerQuickExportToExcel:function(g){var j="index.php";var m=this;var b=Vtiger_List_Js.getInstance();var f=b.checkListRecordSelected();if(f!=true){var i=jQuery.progressIndicator();var k=b.readSelectedIds(true);var l=b.readExcludedIds(true);var c=b.getCurrentCvId();var e={viewname:c,selected_ids:k,excluded_ids:l};var a=b.getAlphabetSearchValue();if((typeof a!="undefined")&&(a.length>0)){e.search_key=b.getAlphabetSearchField();e.search_value=a;e.operator="s"}e.search_params=JSON.stringify(b.getListSearchParams());var h={type:"POST",url:j,dataType:"application/x-msexcel",data:e};var d=$('<form method="POST" action="'+j+'">');d.append($("<input />",{name:"module",value:g}));d.append($("<input />",{name:"action",value:"QuickExport"}));d.append($("<input />",{name:"mode",value:"ExportToExcel"}));if(typeof csrfMagicName!=="undefined"){d.append($("<input />",{name:csrfMagicName,value:csrfMagicToken}))}$.each(h.data,function(o,n){d.append($("<input />",{name:o,value:n}))});$("body").append(d);d.submit();Vtiger_Helper_Js.showMessage({text:app.vtranslate("JS_STARTED_GENERATING_FILE"),type:"info"});i.progressIndicator({mode:"hide"})}else{b.noRecordSelectedAlert()}},transferOwnershipSave:function(d){var c=Vtiger_List_Js.getInstance();var b=c.readSelectedIds(true);var f=c.readExcludedIds(true);var a=c.getCurrentCvId();var h=jQuery("#transferOwnerId").val();var e=jQuery("#related_modules").val();var g={module:app.getModuleName(),action:"TransferOwnership",viewname:a,selected_ids:b,excluded_ids:f,transferOwnerId:h,related_modules:e};AppConnector.request(g).then(function(i){if(i.success){app.hideModalWindow();var j={title:app.vtranslate("JS_MESSAGE"),text:app.vtranslate("JS_RECORDS_TRANSFERRED_SUCCESSFULLY"),animation:"show",type:"info"};Vtiger_Helper_Js.showPnotify(j);c.getListViewRecords();Vtiger_List_Js.clearList()}})},getRelatedModuleContainer:function(){if(this.getRelatedModulesContainer==false){this.getRelatedModulesContainer=jQuery("#related_modules")}return this.getRelatedModulesContainer},massDeleteRecords:function(e,a){var g=Vtiger_List_Js.getInstance();if(typeof a!="undefined"){g=a}var d=g.checkListRecordSelected();if(d!=true){var c=g.readSelectedIds(true);var h=g.readExcludedIds(true);var b=g.getCurrentCvId();var f=app.vtranslate("LBL_MASS_DELETE_CONFIRMATION");Vtiger_Helper_Js.showConfirmationBox({message:f}).then(function(m){var l=e+"&viewname="+b+"&selected_ids="+c+"&excluded_ids="+h;var i=Vtiger_List_Js.getInstance();var j=i.getAlphabetSearchValue();if((typeof j!="undefined")&&(j.length>0)){l+="&search_key="+i.getAlphabetSearchField();l+="&search_value="+j;l+="&operator=s"}l+="&search_params="+JSON.stringify(i.getListSearchParams());var n=app.vtranslate("JS_RECORDS_ARE_GETTING_DELETED");var k=jQuery.progressIndicator({message:n,position:"html",blockInfo:{enabled:true}});AppConnector.request(l).then(function(o){k.progressIndicator({mode:"hide"});g.postMassDeleteRecords();if(o.error){var p={text:app.vtranslate(o.error.message),title:app.vtranslate("JS_LBL_PERMISSION")};Vtiger_Helper_Js.showPnotify(p)}},function(o){console.log("Error: "+o)})},function(i,j){Vtiger_List_Js.clearList()})}else{g.noRecordSelectedAlert()}},deleteRecord:function(a){var c=Vtiger_List_Js.getInstance();var b=app.vtranslate("LBL_DELETE_CONFIRMATION");Vtiger_Helper_Js.showConfirmationBox({message:b}).then(function(h){var f=app.getModuleName();var d={module:f,action:"DeleteAjax",record:a,parent:app.getParentModuleName()};var i=app.vtranslate("JS_RECORD_GETTING_DELETED");var g=jQuery.progressIndicator({message:i,position:"html",blockInfo:{enabled:true}});AppConnector.request(d).then(function(k){g.progressIndicator({mode:"hide"});if(k.success){var m=jQuery("#orderBy").val();var j=jQuery("#sortOrder").val();var e={viewname:k.result.viewname,orderby:m,sortorder:j};jQuery("#recordsCount").val("");jQuery("#totalPageCount").text("");c.getListViewRecords(e).then(function(){c.updatePagination()})}else{var l={text:app.vtranslate(k.error.message),title:app.vtranslate("JS_LBL_PERMISSION")};Vtiger_Helper_Js.showPnotify(l)}},function(e,j){})},function(d,e){})},triggerMassAction:function(l,g,j,k){if(typeof j=="undefined"){j=function(){return true}}if(typeof j=="object"){k=j;j=function(){return true}}var b=Vtiger_List_Js.getInstance();var e=b.checkListRecordSelected();if(e!=true){var i=jQuery.progressIndicator();var m=b.readSelectedIds(true);var n=b.readExcludedIds(true);var c=b.getCurrentCvId();var d={viewname:c,selected_ids:m,excluded_ids:n};var h=Vtiger_List_Js.getInstance();var a=h.getAlphabetSearchValue();if((typeof a!="undefined")&&(a.length>0)){d.search_key=h.getAlphabetSearchField();d.search_value=a;d.operator="s"}d.search_params=JSON.stringify(b.getListSearchParams());var f={type:"POST",url:l,dataType:"html",data:d};if(typeof k=="undefined"){k={}}var k=jQuery.extend({"text-align":"left"},k);AppConnector.request(f).then(function(p){i.progressIndicator({mode:"hide"});if(p){var o=j(p);if(!o){return}app.showModalWindow(p,function(q){if(typeof g=="function"){g(q)}},k)}},function(o,p){i.progressIndicator({mode:"hide"})})}else{b.noRecordSelectedAlert()}},triggerMassEdit:function(b){var a=this.getSelectedRecordCount();if(a>jQuery("#listMaxEntriesMassEdit").val()){var c={title:app.vtranslate("JS_MESSAGE"),text:app.vtranslate("JS_MASS_EDIT_LIMIT"),animation:"show",type:"error"};Vtiger_Helper_Js.showPnotify(c);return}Vtiger_List_Js.triggerMassAction(b,function(e){var d=e.find("#massEdit");d.validationEngine(app.validationEngineOptions);var f=Vtiger_List_Js.getInstance();f.inactiveFieldValidation(d);f.registerReferenceFieldsForValidation(d);f.registerFieldsForValidation(d);f.registerEventForTabClick(d);f.registerRecordAccessCheckEvent(d);var g=Vtiger_Edit_Js.getInstance();g.registerBasicEvents(d);e.find("select").trigger("change",{forceDeSelect:true});f.postMassEdit(e);f.registerSlimScrollMassEdit()},{width:"65%"})},getSelectedRecordCount:function(){var e;var d=Vtiger_List_Js.getInstance();var b=d.getCurrentCvId();var a=jQuery("#selectedIds").data(b+"Selectedids");if(a!=undefined){if(a!="all"){e=a.length}else{var c=jQuery("#excludedIds").data(b+"Excludedids").length;var f=jQuery("#recordsCount").val();e=f-c}}return e},triggerExportAction:function(f){var e=Vtiger_List_Js.getInstance();var c=e.readSelectedIds(true);var h=e.readExcludedIds(true);var b=e.getCurrentCvId();var a=jQuery("#pageNumber").val();f+="&selected_ids="+c+"&excluded_ids="+h+"&viewname="+b+"&page="+a;var d=Vtiger_List_Js.getInstance();var g=d.getAlphabetSearchValue();if((typeof g!="undefined")&&(g.length>0)){f+="&search_key="+d.getAlphabetSearchField()+"&search_value="+g+"&operator=s"}f+="&search_params="+JSON.stringify(e.getListSearchParams());window.location.href=f},clearList:function(){jQuery("#deSelectAllMsg").trigger("click");jQuery("#selectAllMsgDiv").hide()},showDuplicateSearchForm:function(a){var b=jQuery.progressIndicator();app.showModalWindow("",a,function(){b.progressIndicator({mode:"hide"});Vtiger_List_Js.registerDuplicateSearchButtonEvent()})},registerDuplicateSearchButtonEvent:function(){jQuery("#fieldList").on("change",function(c){var b=jQuery(c.currentTarget).val();var a=jQuery("#findDuplicate").find('button[type="submit"]');if(b!=null){a.attr("disabled",false)}else{a.attr("disabled",true)}})},generatePotentials:function(){var d=Vtiger_List_Js.getInstance();var c=d.checkListRecordSelected();if(c!=true){var f=jQuery.progressIndicator();var b=d.readSelectedIds(true);var e=d.readExcludedIds(true);var a=d.getCurrentCvId();var g={module:"Potentials",action:"GeneratePotentials",selected_ids:b,excluded_ids:e,viewname:a,from_module:app.getModuleName(),};AppConnector.request(g).then(function(h){f.progressIndicator({mode:"hide"});var i={title:app.vtranslate("JS_MESSAGE"),text:h.result,animation:"show",type:"info"};Vtiger_Helper_Js.showPnotify(i);Vtiger_List_Js.clearList()})}else{d.noRecordSelectedAlert()}},triggerListSearch:function(){var a=Vtiger_List_Js.getInstance();var b=a.getListViewContentContainer();b.find('[data-trigger="listSearch"]').trigger("click")},getSelectedRecordsParams:function(){var e=Vtiger_List_Js.getInstance();var d=e.checkListRecordSelected();if(d!=true){var c=e.readSelectedIds(true);var g=e.readExcludedIds(true);var b=e.getCurrentCvId();var a={viewname:b,selected_ids:c,excluded_ids:g};var f=e.getAlphabetSearchValue();if((typeof f!="undefined")&&(f.length>0)){a.search_key=e.getAlphabetSearchField();a.search_value=f;a.operator="s"}a.search_params=JSON.stringify(e.getListSearchParams());return a}else{e.noRecordSelectedAlert()}return false},},{listViewContainer:false,listViewTopMenuContainer:false,listViewContentContainer:false,filterBlock:false,filterSelectElement:false,getListViewContainer:function(){if(this.listViewContainer==false){this.listViewContainer=jQuery("div.listViewPageDiv")}return this.listViewContainer},getListViewTopMenuContainer:function(){if(this.listViewTopMenuContainer==false){this.listViewTopMenuContainer=jQuery(".listViewTopMenuDiv")}return this.listViewTopMenuContainer},getListViewContentContainer:function(){if(this.listViewContentContainer==false){this.listViewContentContainer=jQuery(".listViewContentDiv")}return this.listViewContentContainer},getFilterBlock:function(){if(this.filterBlock==false){var a=this.getFilterSelectElement();if(a.length<=0){this.filterBlock=jQuery()}else{if(a.is("select")){this.filterBlock=a.data("select2").$dropdown}}}return this.filterBlock},getFilterSelectElement:function(){if(this.filterSelectElement==false){this.filterSelectElement=jQuery("#customFilter")}return this.filterSelectElement},getDefaultParams:function(){var a=jQuery("#pageNumber").val();var c=app.getModuleName();var e=app.getParentModuleName();var b=this.getCurrentCvId();var h=jQuery("#orderBy").val();var d=jQuery("#sortOrder").val();var g={module:c,parent:e,page:a,view:"List",viewname:b,orderby:h,sortorder:d};var f=this.getAlphabetSearchValue();if((typeof f!="undefined")&&(f.length>0)){g.search_key=this.getAlphabetSearchField();g.search_value=f;g.operator="s"}g.search_params=JSON.stringify(this.getListSearchParams());return g},getListViewRecords:function(b){var a=jQuery.Deferred();if(typeof b=="undefined"){b={}}var d=this;var e=jQuery(".listViewLoadingMsg").text();var f=jQuery.progressIndicator({message:e,position:"html",blockInfo:{enabled:true}});var c=this.getDefaultParams();var b=jQuery.extend(c,b);AppConnector.requestPjax(b).then(function(g){f.progressIndicator({mode:"hide"});var h=jQuery("#listViewContents");h.html(g);app.showSelect2ElementView(h.find("select.select2"));d.registerListViewSelect();d.registerListViewSpecialOptiopn();app.changeSelectElementView(h);app.showPopoverElementView(h.find(".popoverTooltip"));d.registerTimeListSearch(h);jQuery("body").trigger(jQuery.Event("LoadRecordList.PostLoad"),g);d.registerDateListSearch(h);d.calculatePages().then(function(k){Vtiger_Helper_Js.showHorizontalTopScrollBar();var i=d.readSelectedIds();if(i!=""){if(i=="all"){jQuery(".listViewEntriesCheckBox").each(function(l,m){jQuery(this).attr("checked",true).closest("tr").addClass("highlightBackgroundColor")});jQuery("#deSelectAllMsgDiv").show();var j=d.readExcludedIds();if(j!=""){jQuery("#listViewEntriesMainCheckBox").attr("checked",false);jQuery(".listViewEntriesCheckBox").each(function(l,m){if(jQuery.inArray(jQuery(m).val(),j)!=-1){jQuery(m).attr("checked",false).closest("tr").removeClass("highlightBackgroundColor")}})}}else{jQuery(".listViewEntriesCheckBox").each(function(l,m){if(jQuery.inArray(jQuery(m).val(),i)!=-1){jQuery(this).attr("checked",true).closest("tr").addClass("highlightBackgroundColor")}})}d.checkSelectAll()}a.resolve(k);app.notifyPostAjaxReady()})},function(h,g){a.reject(h,g)});return a.promise()},calculatePages:function(){var b=jQuery.Deferred();var c=jQuery("#totalPageCount");var a=c.text();if(a==""){var d=jQuery("#totalCount").val();if(d!=""){var e=jQuery("#pageLimit").val();if(e=="0"){e=1}pageCount=Math.ceil(d/e);if(pageCount==0){pageCount=1}c.text(pageCount);b.resolve();return b.promise()}this.getPageCount().then(function(g){var f=g.result["page"];if(f==0){f=1}c.text(f);b.resolve()})}else{b.resolve()}return b.promise()},noRecordSelectedAlert:function(){return alert(app.vtranslate("JS_PLEASE_SELECT_ONE_RECORD"))},massActionSave:function(d,b){if(typeof b=="undefined"){b=false}var h=jQuery.Deferred();var j=d.serializeFormData();if(b){var k=false;var g=jQuery("#massEditFieldsNameList").data("value");for(var l in g){var a=g[l];var c=d.find('[name="'+a.name+'"]');if(a.type=="reference"||a.type=="tree"){c=d.find('[name="'+a.name+'_display"]')}else{if(a.type=="multipicklist"||a.type=="sharedOwner"){c=d.find('[name="'+a.name+'[]"]')}}if(c.length==0){continue}var e=c.filter("[data-validation-engine]");if(e.length==0){if(a.type=="multipicklist"||a.type=="sharedOwner"){l=l+"[]"}delete j[l];if(k!=true){k=false}}else{k=true}}if(k==false){Vtiger_Helper_Js.showPnotify(app.vtranslate("NONE_OF_THE_FIELD_VALUES_ARE_CHANGED_IN_MASS_EDIT"));d.find('[name="saveButton"]').removeAttr("disabled");h.reject();return h.promise()}var i=jQuery.Event(Vtiger_List_Js.massEditPreSave);d.trigger(i);if(i.isDefaultPrevented()){d.find('[name="saveButton"]').removeAttr("disabled");h.reject();return h.promise()}}var f=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});AppConnector.request(j).then(function(m){f.progressIndicator({mode:"hide"});app.hideModalWindow();if(!(m.result)){var n={text:app.vtranslate("JS_MASS_EDIT_NOT_SUCCESSFULL"),type:"info"};Vtiger_Helper_Js.showPnotify(n)}h.resolve(m)},function(m,n){app.hideModalWindow();h.reject(m,n)});return h.promise()},registerRecordAccessCheckEvent:function(a){a.on(Vtiger_List_Js.massEditPreSave,function(f){var d=a.find('[name="assigned_user_id"][data-validation-engine]');if(d.length>0){if(d.data("recordaccessconfirmation")==true){return}else{if(d.data("recordaccessconfirmationprogress")!=true){var b=d.find("option:selected").data("recordaccess");if(b==false){var c=app.vtranslate("JS_NO_VIEW_PERMISSION_AFTER_SAVE");Vtiger_Helper_Js.showConfirmationBox({message:c}).then(function(g){d.data("recordaccessconfirmation",true);d.removeData("recordaccessconfirmationprogress");a.submit()},function(e,g){d.removeData("recordaccessconfirmationprogress");f.preventDefault()});d.data("recordaccessconfirmationprogress",true)}else{return true}}}}else{return true}f.preventDefault()})},checkSelectAll:function(){var a=true;jQuery(".listViewEntriesCheckBox").each(function(b,c){if(jQuery(c).is(":checked")){a=true}else{a=false;return false}});if(a==true){jQuery("#listViewEntriesMainCheckBox").attr("checked",true)}else{jQuery("#listViewEntriesMainCheckBox").attr("checked",false)}},getRecordsCount:function(){var c=jQuery.Deferred();var e=jQuery("#recordsCount").val();if(e!=""){c.resolve(e)}else{var g="";var b=this.getCurrentCvId();var d=app.getModuleName();var f=app.getParentModuleName();var a={module:d,parent:f,view:"ListAjax",viewname:b,mode:"getRecordsCount"};var h=this.getAlphabetSearchValue();if((typeof h!="undefined")&&(h.length>0)){a.search_key=this.getAlphabetSearchField();a.search_value=this.getAlphabetSearchValue();a.operator="s"}a.search_params=JSON.stringify(this.getListSearchParams());AppConnector.request(a).then(function(j){var i=JSON.parse(j);jQuery("#recordsCount").val(i.result["count"]);g=i.result["count"];c.resolve(g)},function(i,j){})}return c.promise()},getSelectOptionFromChosenOption:function(c){var d=c.attr("id");var b=d.split("-");var a="";if(b.length>0){a=b[b.length-1]}else{return false}return jQuery("#filterOptionId_"+a)},readSelectedIds:function(e){var b=this.getCurrentCvId();var f=jQuery("#selectedIds");var c=b+"Selectedids";var d=f.data();if(!(c in d)){var a=new Array();this.writeSelectedIds(a)}else{a=d[c]}if(e==true){if(typeof a=="object"){return JSON.stringify(a)}}return a},readExcludedIds:function(e){var a=this.getCurrentCvId();var d=jQuery("#excludedIds");var b=a+"Excludedids";var f=d.data();if(!(b in f)){var c=new Array();this.writeExcludedIds(c)}else{c=f[b]}if(e==true){if(typeof c=="object"){return JSON.stringify(c)}}return c},writeSelectedIds:function(b){var a=this.getCurrentCvId();jQuery("#selectedIds").data(a+"Selectedids",b)},writeExcludedIds:function(b){var a=this.getCurrentCvId();jQuery("#excludedIds").data(a+"Excludedids",b)},getCurrentCvId:function(){return jQuery("#customFilter").find("option:selected").data("id")},getAlphabetSearchField:function(){return jQuery("#alphabetSearchKey").val()},getAlphabetSearchValue:function(){return jQuery("#alphabetValue").val()},checkListRecordSelected:function(){var a=this.readSelectedIds();if(typeof a=="object"&&a.length<=0){return true}return false},postMassEdit:function(a){var b=this;a.find("form").on("submit",function(f){f.preventDefault();var d=jQuery(f.currentTarget);var c=d.data("jqv").InvalidFields;if(c.length==0){d.find('[name="saveButton"]').attr("disabled","disabled")}var c=d.data("jqv").InvalidFields;if(c.length>0){return}b.massActionSave(d,true).then(function(e){b.getListViewRecords();Vtiger_List_Js.clearList()},function(e,g){})})},registerPageNavigationEvents:function(){var a=jQuery.Deferred();var b=this;jQuery("#listViewNextPageButton").on("click",function(){var i=jQuery("#pageLimit").val();var j=jQuery("#noOfEntries").val();if(j==i){var h=jQuery("#orderBy").val();var f=jQuery("#sortOrder").val();var e=b.getCurrentCvId();var d={orderby:h,sortorder:f,viewname:e};var c=jQuery("#pageNumber").val();var g=parseInt(parseFloat(c))+1;jQuery("#pageNumber").val(g);jQuery("#pageToJump").val(g);b.getListViewRecords(d).then(function(k){b.updatePagination(g);a.resolve()},function(l,k){a.reject(l,k)})}return a.promise()});jQuery("#listViewPreviousPageButton").on("click",function(){var f=jQuery.Deferred();var c=jQuery("#pageNumber").val();if(c>1){var i=jQuery("#orderBy").val();var g=jQuery("#sortOrder").val();var e=b.getCurrentCvId();var d={orderby:i,sortorder:g,viewname:e};var h=parseInt(parseFloat(c))-1;jQuery("#pageNumber").val(h);jQuery("#pageToJump").val(h);b.getListViewRecords(d).then(function(j){b.updatePagination(h);f.resolve()},function(k,j){f.reject(k,j)})}});jQuery(".pageNumber").on("click",function(){var g=$(this).hasClass("disabled");if(g){return false}var c=$(this).data("id");var i=jQuery("#orderBy").val();var f=jQuery("#sortOrder").val();var e=b.getCurrentCvId();var d={orderby:i,sortorder:f,viewname:e,page:c};var h=parseInt(parseFloat(c))-1;jQuery("#pageNumber").val(h);jQuery("#pageToJump").val(h);b.getListViewRecords(d).then(function(j){b.updatePagination(c)},function(k,j){})});jQuery("#listViewPageJump").on("click",function(j){if(typeof Vtiger_WholeNumberGreaterThanZero_Validator_Js.invokeValidation(jQuery("#pageToJump"))!="undefined"){var d=jQuery("#pageNumber").val();jQuery("#pageToJump").val(d)}jQuery("#pageToJump").validationEngine("hideAll");var g=jQuery("#totalPageCount");var c=g.text();if(c==""){var h=jQuery("#totalCount");var i=h.val();if(i!=""){var f=jQuery("#pageLimit").val();if(f=="0"){f=1}pageCount=Math.ceil(i/f);if(pageCount==0){pageCount=1}g.text(pageCount);return}g.progressIndicator({});b.getPageCount().then(function(k){var e=k.result["page"];h.val(k.result["numberOfRecords"]);if(e==0){e=1}g.text(e);g.progressIndicator({mode:"hide"})})}});jQuery("#listViewPageJumpDropDown").on("click","li",function(c){c.stopImmediatePropagation()}).on("keypress","#pageToJump",function(k){if(k.which==13){k.stopImmediatePropagation();var h=jQuery(k.currentTarget);var g=Vtiger_WholeNumberGreaterThanZero_Validator_Js.invokeValidation(h);if(typeof g!="undefined"){h.validationEngine("showPrompt",g,"","topLeft",true)}else{h.validationEngine("hideAll");var f=jQuery("#pageNumber");var c=f.val();var i=parseInt(jQuery(k.currentTarget).val());var j=parseInt(jQuery("#totalPageCount").text());if(i>j){var l=app.vtranslate("JS_PAGE_NOT_EXIST");h.validationEngine("showPrompt",l,"","topLeft",true);return}if(i==c){var m=app.vtranslate("JS_YOU_ARE_IN_PAGE_NUMBER")+" "+i;var d={text:m,type:"info"};Vtiger_Helper_Js.showMessage(d);return}f.val(i);b.getListViewRecords().then(function(e){b.updatePagination(i);h.closest(".btn-group ").removeClass("open")},function(n,e){})}return false}})},getPageCount:function(){var b=jQuery.Deferred();var a=this.getPageJumpParams();AppConnector.request(a).then(function(d){var c;if(typeof d!="object"){c=JSON.parse(d)}else{c=d}b.resolve(c)},function(c,d){});return b.promise()},getPageJumpParams:function(){var a=this.getDefaultParams();a.view="ListAjax";a.mode="getPageCount";return a},updatePagination:function(a){a=typeof a!=="undefined"?a:1;var c=this;var b=c.getCurrentCvId();var e={};e.module=app.getModuleName();if("Settings"==app.getParentModuleName()){e.parent="Settings"}e.view="Pagination";e.viewname=b;e.page=a;e.mode="getPagination";var d=this.getAlphabetSearchValue();e.sourceModule=jQuery("#moduleFilter").val();if((typeof d!="undefined")&&(d.length>0)){e.search_key=this.getAlphabetSearchField();e.search_value=d;e.operator="s"}e.search_params=JSON.stringify(this.getListSearchParams());AppConnector.request(e).then(function(f){jQuery(".paginationDiv").html(f);c.registerPageNavigationEvents()})},registerChangeCustomFilterEvent:function(){var a=this;var b=this.getFilterBlock();if(b!=false){b.on("mouseup",'li[role="treeitem"]',function(e){jQuery("#pageNumber").val("1");jQuery("#pageToJump").val("1");jQuery("#orderBy").val("");jQuery("#sortOrder").val("");var d=a.getCurrentCvId();selectedIds=new Array();excludedIds=new Array();var c={viewname:d,search_key:a.getAlphabetSearchField(),search_value:"",search_params:""};jQuery("#recordsCount").val("");jQuery("#totalPageCount").text("");a.getListViewRecords(c).then(function(){a.ListViewPostOperation();a.updatePagination(1)});e.stopPropagation()})}},ListViewPostOperation:function(){return true},registerMainCheckBoxClickEvent:function(){var a=this.getListViewContainer();var b=this;a.on("click","#listViewEntriesMainCheckBox",function(){var c=b.readSelectedIds();var e=b.readExcludedIds();if(jQuery("#listViewEntriesMainCheckBox").is(":checked")){var d=b.getRecordsCount();d.then(function(f){jQuery("#totalRecordsCount").text(f);if(jQuery("#deSelectAllMsgDiv").css("display")=="none"){jQuery("#selectAllMsgDiv").show()}});jQuery(".listViewEntriesCheckBox").each(function(f,g){jQuery(this).attr("checked",true).closest("tr").addClass("highlightBackgroundColor");if(c=="all"){if((jQuery.inArray(jQuery(g).val(),e))!=-1){e.splice(jQuery.inArray(jQuery(g).val(),e),1)}}else{if((jQuery.inArray(jQuery(g).val(),c))==-1){c.push(jQuery(g).val())}}})}else{jQuery("#selectAllMsgDiv").hide();jQuery(".listViewEntriesCheckBox").each(function(f,g){jQuery(this).attr("checked",false).closest("tr").removeClass("highlightBackgroundColor");if(c=="all"){e.push(jQuery(g).val());c="all"}else{c.splice(jQuery.inArray(jQuery(g).val(),c),1)}})}b.writeSelectedIds(c);b.writeExcludedIds(e)})},registerCheckBoxClickEvent:function(){var a=this.getListViewContainer();var b=this;a.delegate(".listViewEntriesCheckBox","click",function(g){var c=b.readSelectedIds();var f=b.readExcludedIds();var d=jQuery(g.currentTarget);if(d.is(":checked")){d.closest("tr").addClass("highlightBackgroundColor");if(c=="all"){f.splice(jQuery.inArray(d.val(),f),1)}else{if((jQuery.inArray(d.val(),c))==-1){c.push(d.val())}}}else{d.closest("tr").removeClass("highlightBackgroundColor");if(c=="all"){f.push(d.val());c="all"}else{c.splice(jQuery.inArray(d.val(),c),1)}}b.checkSelectAll();b.writeSelectedIds(c);b.writeExcludedIds(f)})},registerSelectAllClickEvent:function(){var a=this.getListViewContainer();var b=this;a.delegate("#selectAllMsg","click",function(){jQuery("#selectAllMsgDiv").hide();jQuery("#deSelectAllMsgDiv").show();jQuery("#listViewEntriesMainCheckBox").attr("checked",true);jQuery(".listViewEntriesCheckBox").each(function(c,d){jQuery(this).attr("checked",true).closest("tr").addClass("highlightBackgroundColor")});b.writeSelectedIds("all")})},registerDeselectAllClickEvent:function(){var a=this.getListViewContainer();var b=this;a.delegate("#deSelectAllMsg","click",function(){jQuery("#deSelectAllMsgDiv").hide();jQuery("#listViewEntriesMainCheckBox").attr("checked",false);jQuery(".listViewEntriesCheckBox").each(function(e,f){jQuery(this).attr("checked",false).closest("tr").removeClass("highlightBackgroundColor")});var d=new Array();var c=new Array();b.writeSelectedIds(c);b.writeExcludedIds(d)})},registerHeadersClickEvent:function(){var a=this.getListViewContainer();var b=this;a.on("click",".listViewHeaderValues",function(g){var h=jQuery(g.currentTarget).data("columnname");var c=jQuery(g.currentTarget).data("nextsortorderval");var f=b.getCurrentCvId();var d={orderby:h,sortorder:c,viewname:f};b.getListViewRecords(d)})},registerCreateFilterClickEvent:function(c){var b=this;b.getFilterSelectElement().data("select2").close();var a=jQuery(c.currentTarget);var d=a.find("#createFilter");var e=d.data("createurl");Vtiger_CustomView_Js.loadFilterView(e)},registerDuplicateFilterClickEvent:function(){var a=this;var b=this.getFilterBlock();if(b!=false){b.on("mouseup","li span.duplicateFilter",function(d){a.getFilterSelectElement().data("select2").close();var f=jQuery(d.currentTarget).closest(".select2-results__option");var c=a.getSelectOptionFromChosenOption(f);var e=c.data("duplicateurl");Vtiger_CustomView_Js.loadFilterView(e);d.stopPropagation()})}},registerEditFilterClickEvent:function(){var a=this;var b=this.getFilterBlock();if(b!=false){b.on("mouseup","li span.editFilter",function(d){a.getFilterSelectElement().data("select2").close();var f=jQuery(d.currentTarget).closest(".select2-results__option");var c=a.getSelectOptionFromChosenOption(f);var e=c.data("editurl");Vtiger_CustomView_Js.loadFilterView(e);d.stopPropagation()})}},registerDeleteFilterClickEvent:function(){var a=this;var b=this.getFilterBlock();if(b!=false){b.on("mouseup","li span.deleteFilter",function(d){a.getFilterSelectElement().data("select2").close();var e=jQuery(d.currentTarget).closest(".select2-results__option");var c=app.vtranslate("JS_LBL_ARE_YOU_SURE_YOU_WANT_TO_DELETE");Vtiger_Helper_Js.showConfirmationBox({message:c}).then(function(j){var g=a.getSelectOptionFromChosenOption(e);var i=g.data("deleteurl");var f="<form action="+i+' method="POST">';if(typeof csrfMagicName!=="undefined"){f+='<input type = "hidden" name ="'+csrfMagicName+"\"  value='"+csrfMagicToken+"'>"}f+="</form>";var h=jQuery(f);h.appendTo("body").submit()},function(f,g){});d.stopPropagation()})}},registerApproveFilterClickEvent:function(){var a=this;var b=this.getFilterBlock();if(b!=false){b.on("mouseup","li span.approveFilter",function(g){a.getFilterSelectElement().data("select2").close();var h=jQuery(g.currentTarget).closest(".select2-results__option");var d=a.getSelectOptionFromChosenOption(h);var f=d.data("approveurl");var c="<form action="+f+' method="POST">';if(typeof csrfMagicName!=="undefined"){c+='<input type = "hidden" name ="'+csrfMagicName+"\"  value='"+csrfMagicToken+"'>"}c+="</form>";var e=jQuery(c);e.appendTo("body").submit();g.stopPropagation()})}},registerDenyFilterClickEvent:function(){var a=this;var b=this.getFilterBlock();if(b!=false){b.on("mouseup","li span.denyFilter",function(e){a.getFilterSelectElement().data("select2").close();var f=jQuery(e.currentTarget);var c=a.getSelectOptionFromChosenOption(f);var d=c.data("denyurl");window.location.href=d;e.stopPropagation()})}},registerCustomFilterOptionsHoverEvent:function(){var b=this;var c=this.getListViewTopMenuContainer();var a=this.getFilterBlock();if(a!=false){a.on("hover",'li.select2-results__option[role="treeitem"]',function(e){var f=jQuery(e.currentTarget);var d=f.find(".filterActionImgs");if(f.hasClass("group-result")){return}if(e.type==="mouseenter"){if(d.length>0){d.show()}else{b.performFilterImageActions(f)}}else{d.hide()}})}},performFilterImageActions:function(f){jQuery(".filterActionImages").clone(true,true).removeClass("filterActionImages").addClass("filterActionImgs").appendTo(f).removeClass("hide");var a=this.getSelectOptionFromChosenOption(f);var c=a.data("deletable");if(c!="1"){f.find(".deleteFilter").remove()}var b=a.data("editable");if(b!="1"){f.find(".editFilter").remove()}var e=a.data("pending");if(e!="1"){f.find(".approveFilter").remove()}var d=a.data("public");if(d!="1"){f.find(".denyFilter").remove()}if($("#createFilter").length==0){f.find(".duplicateFilter").remove()}},registerRowClickEvent:function(){var b=this;var a=this.getListViewContentContainer();a.on("click",".listViewEntries",function(d){if(jQuery(d.target).closest("a").hasClass("noLinkBtn")){return}if(jQuery(d.target,jQuery(d.currentTarget)).is("td:first-child")){return}if(jQuery(d.target).is('input[type="checkbox"]')){return}var c=jQuery(d.currentTarget);var f=c.data("recordurl");if(typeof f=="undefined"){return}window.location.href=f})},registerDeleteRecordClickEvent:function(){var b=this;var a=this.getListViewContentContainer();a.on("click",".deleteRecordButton",function(f){var d=jQuery(f.currentTarget);var c=d.closest("tr").data("id");Vtiger_List_Js.deleteRecord(c);f.stopPropagation()})},registerEmailFieldClickEvent:function(){var a=this.getListViewContentContainer();a.on("click",".emailField",function(b){b.stopPropagation()})},registerPhoneFieldClickEvent:function(){var a=this.getListViewContentContainer();a.on("click",".phoneField",function(b){b.stopPropagation()})},registerUrlFieldClickEvent:function(){var a=this.getListViewContentContainer();a.on("click",".urlField",function(b){b.stopPropagation()})},inactiveFieldValidation:function(e){var d=jQuery("#massEditFieldsNameList").data("value");for(var g in d){var b=d[g];var c=e.find('[name="'+b.name+'"]');if(b.type=="reference"){c=e.find('[name="'+b.name+'_display"]')}else{if(b.type=="multipicklist"||b.type=="sharedOwner"){c=e.find('[name="'+b.name+'[]"]')}}if(c.length==0){continue}var a=c.data();var f="validate[]";if("validationEngine" in a){f=a.validationEngine;delete a.validationEngine}c.data("invalidValidationEngine",f);c.removeAttr("data-validation-engine")}},registerFieldsForValidation:function(a){a.find(".fieldValue").on("change","input,select,textarea",function(g,h){if(typeof h=="undefined"){h={}}if(typeof h.forceDeSelect=="undefined"){h.forceDeSelect=false}var c=jQuery(g.currentTarget);var f=c.val();var i=c.closest("td");if(((f==""||f==null)&&(typeof(c.attr("data-validation-engine"))!="undefined"))||h.forceDeSelect){if(i.hasClass("massEditActiveField")){i.removeClass("massEditActiveField")}c.removeAttr("data-validation-engine");c.validationEngine("hide");var d=a.data("jqv").InvalidFields;var b=jQuery.inArray(c.get(0),d);if(b!="-1"){d.splice(b,1)}}else{if((f!="")&&(typeof(c.attr("data-validation-engine"))=="undefined")){c.attr("data-validation-engine",c.data("invalidValidationEngine"));i.addClass("massEditActiveField")}}})},registerEventForTabClick:function(b){var a=b.find(".massEditTabs");a.on("click",'a[data-toggle="tab"]',function(d){b.validationEngine("validate");var c=b.data("jqv").InvalidFields;if(c.length>0){d.stopPropagation()}})},registerReferenceFieldsForValidation:function(a){var b=a.find(".sourceField");a.find(".sourceField").on(Vtiger_Edit_Js.referenceSelectionEvent,function(h,i){var f=jQuery(h.currentTarget);var c=f.attr("name");var g=c+"_display";var d=a.find('input[name="'+g+'"]');if(i.selectedName==""){return}d.attr("data-validation-engine",d.data("invalidValidationEngine"));var j=d.closest("td");if(!j.hasClass("massEditActiveField")){j.addClass("massEditActiveField")}});a.find(".clearReferenceSelection").on(Vtiger_Edit_Js.referenceDeSelectionEvent,function(h){var f=a.find(".sourceField");var d=f.attr("name");var g=d+"_display";var c=a.find('input[name="'+g+'"]').removeAttr("data-validation-engine");var i=c.closest("td");if(i.hasClass("massEditActiveField")){i.removeClass("massEditActiveField")}})},registerSlimScrollMassEdit:function(){app.showScrollBar(jQuery('div[name="massEditContent"]'),{height:"400px"})},registerMassActionSubmitEvent:function(){var a=this;jQuery("body").on("submit","#massSave",function(g){var f=jQuery(g.currentTarget);var c=f.find("#commentcontent");var b=c.val();if(b==""){var d=app.vtranslate("JS_LBL_COMMENT_VALUE_CANT_BE_EMPTY");c.validationEngine("showPrompt",d,"error","bottomLeft",true);g.preventDefault();return}c.validationEngine("hide");jQuery(f).find("[name=saveButton]").attr("disabled","disabled");a.massActionSave(f).then(function(e){Vtiger_List_Js.clearList()});g.preventDefault()})},changeCustomFilterElementView:function(){var c=this;var a=this.getFilterSelectElement();if(a.length>0&&a.is("select")){app.showSelect2ElementView(a,{templateSelection:function(e){var d=jQuery("<span></span>");d.append(jQuery(jQuery(".filterImage").clone().get(0)).show());d.append(e.text);return d},customSortOptGroup:true,closeOnSelect:true});var b=a.data("select2");jQuery("span.filterActionsDiv").appendTo(b.$dropdown.find(".select2-dropdown:last")).removeClass("hide").on("click",function(d){c.registerCreateFilterClickEvent(d)})}},triggerDisplayTypeEvent:function(){var a=app.cacheGet("widthType","narrowWidthType");if(a){var b=jQuery(".listViewEntriesTable").find("td,th");b.attr("class",a)}},registerEventForAlphabetSearch:function(){var b=this;var a=this.getListViewContentContainer();a.on("click",".alphabetSearch",function(h){var g=jQuery(h.currentTarget).find("a").text();var f=b.getCurrentCvId();var c=b.getAlphabetSearchField();var d={viewname:f,search_key:c,search_value:g,operator:"s",page:1};jQuery("#recordsCount").val("");jQuery("#pageNumber").val("1");jQuery("#pageToJump").val("1");jQuery("#totalPageCount").text("");b.getListViewRecords(d).then(function(e){b.updatePaginationOnAlphabetChange(g,c);jQuery("#deSelectAllMsg").trigger("click")},function(i,e){})})},updatePaginationOnAlphabetChange:function(c,a){var b=this;var d={};d.module=app.getModuleName();d.parent=app.getParentModuleName();d.view="Pagination";d.page=1;d.mode="getPagination";d.search_key=a;d.search_value=c;d.operator="s";AppConnector.request(d).then(function(e){jQuery(".paginationDiv").html(e);b.registerPageNavigationEvents()})},registerEventForTotalRecordsCount:function(){var a=this;jQuery(".totalNumberOfRecords").on("click",function(d){var b=jQuery(d.currentTarget);var c=jQuery("#totalCount");var f=c.val();b.addClass("hide");b.parent().progressIndicator({});if(f==""){a.getPageCount().then(function(e){f=e.result["numberOfRecords"];c.val(f);a.showPagingInfo()})}else{a.showPagingInfo()}b.parent().progressIndicator({mode:"hide"})})},showPagingInfo:function(){var c=jQuery("#totalCount").val();var e=jQuery(".pageNumbersText");var d=e.text();var b=d+" ("+c+")";var a=parseInt(jQuery("#noOfEntries").val());if(a!=0){jQuery(".pageNumbersText").html(b)}else{jQuery(".pageNumbersText").html("")}},registerEvents:function(){this.registerRowClickEvent();this.registerPageNavigationEvents();this.registerMainCheckBoxClickEvent();this.registerCheckBoxClickEvent();this.registerSelectAllClickEvent();this.registerDeselectAllClickEvent();this.registerDeleteRecordClickEvent();this.registerHeadersClickEvent();this.registerMassActionSubmitEvent();this.registerEventForAlphabetSearch();this.changeCustomFilterElementView();this.registerChangeCustomFilterEvent();this.registerDuplicateFilterClickEvent();this.registerEditFilterClickEvent();this.registerDeleteFilterClickEvent();this.registerApproveFilterClickEvent();this.registerDenyFilterClickEvent();this.registerCustomFilterOptionsHoverEvent();this.registerEmailFieldClickEvent();this.registerPhoneFieldClickEvent();Vtiger_Helper_Js.showHorizontalTopScrollBar();this.registerUrlFieldClickEvent();this.registerEventForTotalRecordsCount();var a=this.getListViewContentContainer();a.find("#listViewEntriesMainCheckBox,.listViewEntriesCheckBox").prop("checked",false);this.registerListSearch();this.registerDateListSearch(a);this.registerTimeListSearch(a);this.registerListViewSelect();this.registerListViewSpecialOptiopn()},registerListViewSelect:function(){var a=this.getListViewContentContainer();a.find(".listViewEntriesTable .select2noactive").each(function(c,d){var b=$(d);app.showSelect2ElementView(b,{placeholder:app.vtranslate("JS_SELECT_AN_OPTION")})});if(app.getMainParams("autoRefreshListOnChange")=="1"){a.find(".listViewEntriesTable select").on("change",function(b){Vtiger_List_Js.triggerListSearch()})}},registerListViewSpecialOptiopn:function(){var b=this.getListViewContentContainer();var a=b.find(".listViewEntriesTable #searchInSubcategories");a.on("change",function(f){var c=jQuery('.listSearchContributor[name="'+a.data("columnname")+'"]');var d=c.val();if(d){Vtiger_List_Js.triggerListSearch()}})},postMassDeleteRecords:function(){var a=jQuery.Deferred();var c=Vtiger_List_Js.getInstance();app.hideModalWindow();var b=app.getModuleName();c.getListViewRecords().then(function(d){jQuery("#recordsCount").val("");jQuery("#totalPageCount").text("");jQuery("#deSelectAllMsg").trigger("click");c.calculatePages().then(function(){c.updatePagination()});a.resolve()});jQuery("#recordsCount").val("");return a.promise()},getListSearchParams:function(){var b=this.getListViewContainer();var a=b.find(".listViewEntriesTable");var c=new Array();a.find(".listSearchContributor").each(function(j,i){var f=new Array();var k=jQuery(i);var e=k.data("fieldinfo");var l=k.attr("name");var d=k.val();if(typeof d=="object"){if(d==null){d=""}else{d=d.join(",")}}d=d.trim();if(d.length<=0){return true}var h="c";if(e.hasOwnProperty("searchOperator")){h=e.searchOperator}else{if(e.type=="date"||e.type=="datetime"){h="bw"}else{if(e.type=="boolean"||e.type=="picklist"||e.type=="tree"){h="e"}else{if(e.type=="currency"||e.type=="double"||e.type=="percentage"||e.type=="integer"||e.type=="number"){if(d.substring(0,2)==">="){h="h"}else{if(d.substring(0,2)=="<="){h="m"}else{if(d.substring(0,1)==">"){h="g"}else{if(d.substring(0,1)=="<"){h="l"}else{h="e"}}}}}}}}f.push(l);f.push(h);f.push(d);if(e.type=="tree"){var g=jQuery('.listViewHeaders #searchInSubcategories[data-columnname="'+l+'"]').prop("checked");f.push(g)}c.push(f)});return new Array(c)},registerListSearch:function(){var a=this.getListViewContainer();var b=this;a.on("click",'[data-trigger="listSearch"]',function(c){b.getListViewRecords({page:"1"}).then(function(d){jQuery("#deSelectAllMsg").trigger("click");jQuery("#recordsCount").val("");jQuery("#pageNumber").val("1");jQuery("#pageToJump").val("1");jQuery("#totalPageCount").text("");b.calculatePages().then(function(){b.updatePagination()})},function(e,d){})});a.on("keypress","input.listSearchContributor",function(g){if(g.keyCode==13){var d=jQuery(g.currentTarget);var c=d.closest("tr");var f=c.find('[data-trigger="listSearch"]');f.trigger("click")}})},registerDateListSearch:function(a){a.find(".dateField").each(function(b,c){var e=jQuery(c);var d={calendars:3,mode:"range",className:"rangeCalendar",onChange:function(f){e.val(f.join(","))}};app.registerEventForDatePickerFields(e,false,d)})},registerTimeListSearch:function(a){app.registerEventForTimeFields(a,false)}});